/*!
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2018 Chananya Freiman
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 */
var ModelViewer=function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=41)}([function(t,e,i){"use strict";i.d(e,"n",function(){return d}),i.d(e,"l",function(){return f}),i.d(e,"m",function(){return m}),i.d(e,"o",function(){return g}),i.d(e,"p",function(){return p}),i.d(e,"q",function(){return v}),i.d(e,"j",function(){return b}),i.d(e,"k",function(){return w}),i.d(e,"f",function(){return y}),i.d(e,"d",function(){return A}),i.d(e,"e",function(){return _}),i.d(e,"h",function(){return x}),i.d(e,"i",function(){return T}),i.d(e,"b",function(){return E}),i.d(e,"c",function(){return S}),i.d(e,"g",function(){return M}),i.d(e,"a",function(){return R});let n=new ArrayBuffer(8),r=new Int8Array(n),a=new Int16Array(n),s=new Int32Array(n),o=new Uint8Array(n),l=new Uint16Array(n),h=new Uint32Array(n),u=new Float32Array(n),c=new Float64Array(n);function d(t){return o[0]=t,r[0]}function f(t,e){return o[0]=t,o[1]=e,a[0]}function m(t,e,i,n){return o[0]=t,o[1]=e,o[2]=i,o[3]=n,s[0]}function g(t,e){return o[0]=t,o[1]=e,l[0]}function p(t,e,i){return o[0]=t,o[1]=e,o[2]=i,o[3]=0,h[0]}function v(t,e,i,n){return o[0]=t,o[1]=e,o[2]=i,o[3]=n,h[0]}function b(t,e,i,n){return o[0]=t,o[1]=e,o[2]=i,o[3]=n,u[0]}function w(t,e,i,n,r,a,s,l){return o[0]=t,o[1]=e,o[2]=i,o[3]=n,o[4]=r,o[5]=a,o[6]=s,o[7]=l,c[0]}function y(t){return o[0]=t,r[0]}function A(t,e){return a[0]=e,t[0]=o[0],t[1]=o[1],t}function _(t,e){return s[0]=e,t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t}function x(t,e){return l[0]=e,t[0]=o[0],t[1]=o[1],t}function T(t,e){return h[0]=e,t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t}function E(t,e){return u[0]=e,t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t}function S(t,e){return c[0]=e,t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t}function M(t){return h[0]=t,h[0]}function R(t){let e=[];for(;t>0;)e.push(String.fromCharCode(t%256)),t=Math.floor(t/256);return e.reverse().join("")}},function(t,e){let i=0;class n{constructor(t){this.line=t.line,this.uid=i++}}class r extends n{}class a extends n{}t.exports={Node:n,Statement:r,Expression:a,Program:class extends n{constructor(t){super(t),this.blocks=t.blocks}},Globals:class extends r{constructor(t){super(t),this.variables=t.variables}},FunctionDefinition:class extends r{constructor(t){super(t),this.name=t.name,this.args=t.args,this.returnType=t.returnType,this.body=t.body}},FunctionArgument:class extends n{constructor(t){super(t),this.type=t.type,this.name=t.name}},IfThenElse:class extends r{constructor(t){super(t),this.condition=t.condition,this.thenActions=t.thenActions,this.elseActions=t.elseActions}},SetVariable:class extends r{constructor(t){super(t),this.name=t.name,this.value=t.value}},SetVariableArray:class extends r{constructor(t){super(t),this.name=t.name,this.index=t.index,this.value=t.value}},Literal:class extends a{constructor(t){super(t),this.type=t.type,this.value=t.value}},GetVariable:class extends a{constructor(t){super(t),this.name=t.name}},GetVariableArray:class extends a{constructor(t){super(t),this.name=t.name,this.index=t.index}},Return:class extends r{constructor(t){super(t),this.value=t.value}},Infix:class extends a{constructor(t){super(t),this.lhs=t.lhs,this.operator=t.operator,this.rhs=t.rhs}},VariableDefinition:class extends r{constructor(t){super(t),this.type=t.type,this.name=t.name,this.value=t.value||null,this.isArray=t.isArray||!1,this.isConstant=t.isConstant||!1,this.isLocal=t.isLocal||!1}},Loop:class extends r{constructor(t){super(t),this.actions=t.actions}},ExitWhen:class extends r{constructor(t){super(t),this.condition=t.condition}},FunctionCall:class extends a{constructor(t){super(t),this.name=t.name,this.args=t.args}},FunctionReference:class extends a{constructor(t){super(t),this.name=t.name}},Unary:class extends a{constructor(t){super(t),this.operator=t.operator,this.value=t.value}},Type:class extends r{constructor(t){super(t),this.name=t.name,this.extends=t.extends}},Native:class extends r{constructor(t){super(t),this.name=t.name,this.args=t.args,this.returnType=t.returnType,this.isConstant=t.isConstant||!1}},FunctionCallStatement:class extends r{constructor(t){super(t),this.functionCall=t.functionCall}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i(5);class r extends n.a{constructor(t){super(t),this.references=new Set}addReference(t){this.references.add(t)}removeReference(t){this.references.delete(t)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i(11),r=i(9);class a{constructor(t){this.map={},t&&this.load(t)}load(t){if(t.startsWith("ID;")){let e=new n.a(t).rows,i=e[0],r=this.map;for(let t=1,n=e.length;t<n;t++){let n=e[t],a=n[0];if(a){r[a=a.toLowerCase()]||(r[a]={});let t=r[a];for(let e=0,r=i.length;e<r;e++){let r=i[e];void 0===r&&(r=`column${e}`),t[r]=n[e]}}}}else{let e=new r.a(t).sections,i=this.map;for(let[t,n]of e.entries()){i[t]||(i[t]={});let e=i[t];for(let[t,i]of n)e[t]=i}}}getRow(t){return this.map[t.toLowerCase()]}getProperty(t,e){return this.map[t.toLowerCase()][e]}setRow(t,e){this.map[t.toLowerCase()]=e}}},function(t,e,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function h(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,i,n){var r,a,s,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),s=a[e]),void 0===s)s=a[e]=i,++t._eventsCount;else if("function"==typeof s?s=a[e]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=h(t))>0&&s.length>r&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,o=l,console&&console.warn&&console.warn(o)}return t}function c(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,t))}.bind(n);return r.listener=i,n.wrapFn=r,r}function d(t,e,i){var n=t._events;if(void 0===n)return[];var r=n[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):m(r,r.length)}function f(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function m(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");l=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=r[t];if(void 0===l)return!1;if("function"==typeof l)a(l,this,e);else{var h=l.length,u=m(l,h);for(i=0;i<h;++i)a(u[i],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,c(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,c(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,n,r,a,s;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){s=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return d(this,t,!0)},o.prototype.rawListeners=function(t){return d(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});class n{constructor(t){this.jass=t,this.handleId=-1,this.handleNames=[]}addName(t){this.handleNames.push(t)}kill(){this.handleId=-1,this.handleNames.length=[]}toString(){return this.handleNames.length?this.handleNames[0]:`HANDLE_${this.handleId}`}}},function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)r(i,n)&&(t[n]=i[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var a={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){var e,i,n,r,a,s;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(s=new Uint8Array(n),r=0,e=0,i=t.length;e<i;e++)a=t[e],s.set(a,r),r+=a.length;return s}},s={arraySet:function(t,e,i,n,r){for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,a)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(n)},function(t,e,i){"use strict";i.d(e,"a",function(){return n});class n{constructor(t,e){this.name=t,this.object=e}toString(){return this.name||this.object.toString()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i(2);class r extends n.a{constructor(t,e,i){super(t),this.x=e,this.y=i,this.z=0}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});class n{constructor(t){this.properties=new Map,this.sections=new Map,t&&this.load(t)}load(t){let e=this.properties,i=this.sections;for(let n of t.split("\r\n"))if(n.length&&!n.startsWith("//")&&!n.startsWith(";")){let t=n.match(/^\[(.+?)\]/);if(t){let n=t[1].trim().toLowerCase();(e=i.get(n))||(e=new Map,i.set(n,e))}else(t=n.match(/^(.+?)=(.*?)$/))&&e.set(t[1].toLowerCase(),t[2])}}save(){let t=[];for(let[e,i]of this.properties)t.push(`${e}=${i}`);for(let[e,i]of this.sections){t.push(`[${e}]`);for(let[e,n]of i)t.push(`${e}=${n}`)}return t.join("\r\n")}getSection(t){return this.sections.get(t.toLowerCase())}}},function(t,e,i){var n=function(){var t=function(t,e,i,n){for(i=i||{},n=t.length;n--;i[t[n]]=e);return i},e=[1,4],n=[1,11],r=[1,12],a=[1,13],s=[1,9],o=[1,10],l=[6,11,12,18,21,29],h=[1,19],u=[1,18],c=[11,19,23],d=[1,40],f=[1,38],m=[1,48],g=[1,50],p=[1,47],v=[1,46],b=[1,45],w=[1,51],y=[16,35],A=[1,58],_=[1,59],x=[1,60],T=[1,61],E=[1,62],S=[1,63],M=[1,64],R=[1,65],I=[1,66],B=[1,67],C=[1,68],L=[1,69],U=[11,19,23,31,35,38,39,41,42,44,45,47,48,49,50,51,53,54,57,59,60,61,62,63,64,65,66,67,68,69,70],k=[1,74],F=[1,78],P=[1,79],D=[11,19,23,31,35,38,39,41,42,44,45,47,48,49,50,51,53,54,57,59,60,63,64,65,66,67,68,69,70],O=[2,30],N=[1,103],V=[1,104],G=[1,105],j=[1,106],H=[1,107],$=[1,108],q=[1,109],z=[6,11,12,18,21,29,31,38,42,45,47,48,50,51],K=[11,19,23,31,35,38,39,41,42,44,45,47,48,49,50,51,53,54,57,63,64,65,66,67,68,69,70],W=[11,19,23,31,35,38,39,41,42,44,45,47,48,49,50,51,53,54,57,69,70],Y=[35,57],X=[31,38,41,42,45,47,48,49,50,51,53,54],J=[41,53,54],Z=[2,46],Q=[1,138],tt=[1,139],et={trace:function(){},yy:{},symbols_:{error:2,Program:3,Blocks:4,Block:5,EOF:6,Globals:7,Function:8,Native:9,TypeDefinition:10,constant:11,native:12,IDENT:13,takes:14,FunctionArguments:15,returns:16,FunctionReturn:17,type:18,TYPE:19,extends:20,globals:21,GlobalVariableDefinitions:22,endglobals:23,GlobalVariableDefinition:24,array:25,"=":26,Expression:27,Functions:28,function:29,Statements:30,endfunction:31,ArgumentList:32,nothing:33,Argument:34,",":35,StatementsReal:36,Statement:37,if:38,then:39,Elses:40,endif:41,set:42,"[":43,"]":44,call:45,FunctionCall:46,return:47,loop:48,endloop:49,exitwhen:50,local:51,ElseIf:52,else:53,elseif:54,"(":55,FunctionCallArguments:56,")":57,Expressions:58,"+":59,"-":60,"*":61,"/":62,"<":63,">":64,">=":65,"<=":66,"==":67,"!=":68,and:69,or:70,not:71,LITERAL:72,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",11:"constant",12:"native",13:"IDENT",14:"takes",16:"returns",18:"type",19:"TYPE",20:"extends",21:"globals",23:"endglobals",25:"array",26:"=",29:"function",31:"endfunction",33:"nothing",35:",",38:"if",39:"then",41:"endif",42:"set",43:"[",44:"]",45:"call",47:"return",48:"loop",49:"endloop",50:"exitwhen",51:"local",53:"else",54:"elseif",55:"(",57:")",59:"+",60:"-",61:"*",62:"/",63:"<",64:">",65:">=",66:"<=",67:"==",68:"!=",69:"and",70:"or",71:"not",72:"LITERAL"},productions_:[0,[3,1],[4,2],[4,1],[5,1],[5,1],[5,1],[5,1],[9,7],[9,6],[10,4],[7,3],[7,2],[22,2],[22,1],[24,3],[24,2],[24,4],[24,5],[28,1],[28,2],[8,8],[15,1],[15,1],[32,1],[32,3],[34,2],[17,1],[17,1],[30,1],[30,0],[36,1],[36,2],[37,6],[37,4],[37,7],[37,2],[37,2],[37,1],[37,3],[37,2],[37,4],[37,5],[37,3],[40,2],[40,2],[40,0],[52,4],[46,4],[56,1],[56,0],[58,1],[58,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,3],[27,2],[27,2],[27,3],[27,4],[27,1],[27,1],[27,2],[27,1]],performAction:function(t,e,i,n,r,a,s){var o=a.length-1;switch(r){case 1:return new it.Program({line:i,blocks:a[o]});case 2:this.$=[a[o-1]].concat(a[o]);break;case 3:case 12:case 23:case 30:case 46:case 50:this.$=[];break;case 4:this.$=new it.Globals({line:i,variables:a[o]});break;case 5:case 6:case 7:case 27:case 28:case 45:case 70:this.$=a[o];break;case 8:this.$=new it.Native({line:i,name:a[o-4],args:a[o-2],returnType:a[o]}),this.$.isConstant=!0;break;case 9:this.$=new it.Native({line:i,name:a[o-4],args:a[o-2],returnType:a[o]});break;case 10:this.$=new it.Type({line:i,name:a[o-2],extends:a[o]});break;case 11:case 67:this.$=a[o-1];break;case 13:case 20:case 32:this.$=a[o-1].concat(a[o]);break;case 14:case 19:case 24:case 31:case 51:this.$=[a[o]];break;case 15:this.$=new it.VariableDefinition({line:i,type:a[o-2],name:a[o],value:null}),this.$.isArray=!0;break;case 16:this.$=new it.VariableDefinition({line:i,type:a[o-1],name:a[o],value:null});break;case 17:this.$=new it.VariableDefinition({line:i,type:a[o-3],name:a[o-2],value:a[o]});break;case 18:this.$=new it.VariableDefinition({line:i,type:a[o-3],name:a[o-2],value:a[o]}),this.$.isConstant=!0;break;case 21:this.$=new it.FunctionDefinition({line:i,name:a[o-6],args:a[o-4],returnType:a[o-2],body:a[o-1]});break;case 25:case 52:this.$=a[o-2].concat(a[o]);break;case 26:this.$=new it.FunctionArgument({line:i,type:a[o-1],name:a[o]});break;case 33:this.$=new it.IfThenElse({line:i,condition:a[o-4],thenActions:a[o-2],elseActions:a[o-1]});break;case 34:this.$=new it.SetVariable({line:i,name:a[o-2],value:a[o]});break;case 35:this.$=new it.SetVariableArray({line:i,name:a[o-5],index:a[o-3],value:a[o]});break;case 36:this.$=new it.FunctionCallStatement({line:i,functionCall:a[o]});break;case 37:this.$=new it.Return({line:i,value:a[o]});break;case 38:this.$=new it.Return({line:i,value:null});break;case 39:this.$=new it.Loop({line:i,actions:a[o-1]});break;case 40:this.$=new it.ExitWhen({line:i,condition:a[o]});break;case 41:this.$=new it.VariableDefinition({line:i,type:a[o-2],name:a[o],value:null}),this.$.isLocal=!0,this.$.isArray=!0;break;case 42:this.$=new it.VariableDefinition({line:i,type:a[o-3],name:a[o-2],value:a[o]}),this.$.isLocal=!0;break;case 43:this.$=new it.VariableDefinition({line:i,type:a[o-1],name:a[o],value:null}),this.$.isLocal=!0;break;case 44:a[o-1].elseActions=a[o],this.$=[a[o-1]];break;case 47:this.$=new it.IfThenElse({line:i,condition:a[o-2],thenActions:a[o],elseActions:[]});break;case 48:this.$=new it.FunctionCall({line:i,name:a[o-3],args:a[o-1]});break;case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:case 64:this.$=new it.Infix({line:i,lhs:a[o-2],rhs:a[o],operator:a[o-1]});break;case 65:case 66:this.$=new it.Unary({line:i,value:a[o],operator:a[o-1]});break;case 68:this.$=new it.GetVariableArray({line:i,name:a[o-3],index:a[o-1]});break;case 69:this.$=new it.GetVariable({line:i,name:a[o]});break;case 71:this.$=new it.FunctionReference({line:i,name:a[o]});break;case 72:literalValue=nt.literalValue(a[o]),this.$=new it.Literal({line:i,type:literalValue.type,value:literalValue.value})}},table:[{3:1,4:2,5:3,6:e,7:5,8:6,9:7,10:8,11:n,12:r,18:a,21:s,29:o},{1:[3]},{1:[2,1]},{4:14,5:3,6:e,7:5,8:6,9:7,10:8,11:n,12:r,18:a,21:s,29:o},{1:[2,3]},t(l,[2,4]),t(l,[2,5]),t(l,[2,6]),t(l,[2,7]),{11:h,19:u,22:15,23:[1,16],24:17},{13:[1,20]},{12:[1,21]},{13:[1,22]},{19:[1,23]},{1:[2,2]},{11:h,19:u,23:[1,24],24:25},t(l,[2,12]),t(c,[2,14]),{13:[1,27],25:[1,26]},{19:[1,28]},{14:[1,29]},{13:[1,30]},{14:[1,31]},{20:[1,32]},t(l,[2,11]),t(c,[2,13]),{13:[1,33]},t(c,[2,16],{26:[1,34]}),{13:[1,35]},{15:36,19:d,32:37,33:f,34:39},{14:[1,41]},{15:42,19:d,32:37,33:f,34:39},{19:[1,43]},t(c,[2,15]),{13:m,27:44,29:g,46:49,55:p,60:v,71:b,72:w},{26:[1,52]},{16:[1,53]},{16:[2,22],35:[1,54]},{16:[2,23]},t(y,[2,24]),{13:[1,55]},{15:56,19:d,32:37,33:f,34:39},{16:[1,57]},t(l,[2,10]),t(c,[2,17],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),{13:m,27:70,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:71,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:72,29:g,46:49,55:p,60:v,71:b,72:w},t(U,[2,69],{43:[1,73],55:k}),t(U,[2,70]),{13:[1,75]},t(U,[2,72]),{13:m,27:76,29:g,46:49,55:p,60:v,71:b,72:w},{17:77,19:F,33:P},{19:d,34:80},t(y,[2,26]),{16:[1,81]},{17:82,19:F,33:P},{13:m,27:83,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:84,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:85,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:86,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:87,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:88,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:89,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:90,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:91,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:92,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:93,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:94,29:g,46:49,55:p,60:v,71:b,72:w},t(U,[2,65]),t(D,[2,66],{61:x,62:T}),{57:[1,95],59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L},{13:m,27:96,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:99,29:g,46:49,55:p,56:97,57:[2,50],58:98,60:v,71:b,72:w},t(U,[2,71]),t(c,[2,18],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),{30:100,31:O,36:101,37:102,38:N,42:V,45:G,47:j,48:H,50:$,51:q},t(z,[2,27]),t(z,[2,28]),t(y,[2,25]),{17:110,19:F,33:P},t(l,[2,9]),t(D,[2,53],{61:x,62:T}),t(D,[2,54],{61:x,62:T}),t(U,[2,55]),t(U,[2,56]),t(K,[2,57],{59:A,60:_,61:x,62:T}),t(K,[2,58],{59:A,60:_,61:x,62:T}),t(K,[2,59],{59:A,60:_,61:x,62:T}),t(K,[2,60],{59:A,60:_,61:x,62:T}),t(K,[2,61],{59:A,60:_,61:x,62:T}),t(K,[2,62],{59:A,60:_,61:x,62:T}),t(W,[2,63],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B}),t(W,[2,64],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B}),t(U,[2,67]),{44:[1,111],59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L},{57:[1,112]},{35:[1,113],57:[2,49]},t(Y,[2,51],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),{31:[1,114]},t([31,41,49,53,54],[2,29],{37:115,38:N,42:V,45:G,47:j,48:H,50:$,51:q}),t(X,[2,31]),{13:m,27:116,29:g,46:49,55:p,60:v,71:b,72:w},{13:[1,117]},{13:[1,119],46:118},t(X,[2,38],{46:49,27:120,13:m,29:g,55:p,60:v,71:b,72:w}),{30:121,36:101,37:102,38:N,42:V,45:G,47:j,48:H,49:O,50:$,51:q},{13:m,27:122,29:g,46:49,55:p,60:v,71:b,72:w},{19:[1,123]},t(l,[2,8]),t(U,[2,68]),t(U,[2,48]),{13:m,27:124,29:g,46:49,55:p,60:v,71:b,72:w},t(l,[2,21]),t(X,[2,32]),{39:[1,125],59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L},{26:[1,126],43:[1,127]},t(X,[2,36]),{55:k},t(X,[2,37],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),{49:[1,128]},t(X,[2,40],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),{13:[1,130],25:[1,129]},t(Y,[2,52],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),t(J,O,{36:101,37:102,30:131,38:N,42:V,45:G,47:j,48:H,50:$,51:q}),{13:m,27:132,29:g,46:49,55:p,60:v,71:b,72:w},{13:m,27:133,29:g,46:49,55:p,60:v,71:b,72:w},t(X,[2,39]),{13:[1,134]},t(X,[2,43],{26:[1,135]}),{40:136,41:Z,52:137,53:Q,54:tt},t(X,[2,34],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),{44:[1,140],59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L},t(X,[2,41]),{13:m,27:141,29:g,46:49,55:p,60:v,71:b,72:w},{41:[1,142]},{40:143,41:Z,52:137,53:Q,54:tt},{30:144,36:101,37:102,38:N,41:O,42:V,45:G,47:j,48:H,50:$,51:q},{13:m,27:145,29:g,46:49,55:p,60:v,71:b,72:w},{26:[1,146]},t(X,[2,42],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),t(X,[2,33]),{41:[2,44]},{41:[2,45]},{39:[1,147],59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L},{13:m,27:148,29:g,46:49,55:p,60:v,71:b,72:w},t(J,O,{36:101,37:102,30:149,38:N,42:V,45:G,47:j,48:H,50:$,51:q}),t(X,[2,35],{59:A,60:_,61:x,62:T,63:E,64:S,65:M,66:R,67:I,68:B,69:C,70:L}),t(J,[2,47])],defaultActions:{2:[2,1],4:[2,3],14:[2,2],38:[2,23],143:[2,44],144:[2,45]},parseError:function(t,e){if(!e.recoverable){var i=new Error(t);throw i.hash=e,i}this.trace(t)},parse:function(t){var e=this,i=[0],n=[null],r=[],a=this.table,s="",o=0,l=0,h=0,u=r.slice.call(arguments,1),c=Object.create(this.lexer),d={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(d.yy[f]=this.yy[f]);c.setInput(t,d.yy),d.yy.lexer=c,d.yy.parser=this,void 0===c.yylloc&&(c.yylloc={});var m=c.yylloc;r.push(m);var g=c.options&&c.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var p,v,b,w,y,A,_,x,T,E=function(){var t;return"number"!=typeof(t=c.lex()||1)&&(t=e.symbols_[t]||t),t},S={};;){if(b=i[i.length-1],this.defaultActions[b]?w=this.defaultActions[b]:(null==p&&(p=E()),w=a[b]&&a[b][p]),void 0===w||!w.length||!w[0]){var M="";for(A in T=[],a[b])this.terminals_[A]&&A>2&&T.push("'"+this.terminals_[A]+"'");M=c.showPosition?"Parse error on line "+(o+1)+":\n"+c.showPosition()+"\nExpecting "+T.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(M,{text:c.match,token:this.terminals_[p]||p,line:c.yylineno,loc:m,expected:T})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+p);switch(w[0]){case 1:i.push(p),n.push(c.yytext),r.push(c.yylloc),i.push(w[1]),p=null,v?(p=v,v=null):(l=c.yyleng,s=c.yytext,o=c.yylineno,m=c.yylloc,h>0&&h--);break;case 2:if(_=this.productions_[w[1]][1],S.$=n[n.length-_],S._$={first_line:r[r.length-(_||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(_||1)].first_column,last_column:r[r.length-1].last_column},g&&(S._$.range=[r[r.length-(_||1)].range[0],r[r.length-1].range[1]]),void 0!==(y=this.performAction.apply(S,[s,l,o,d.yy,w[1],n,r].concat(u))))return y;_&&(i=i.slice(0,-1*_*2),n=n.slice(0,-1*_),r=r.slice(0,-1*_)),i.push(this.productions_[w[1]][0]),n.push(S.$),r.push(S._$),x=a[i[i.length-2]][i[i.length-1]],i.push(x);break;case 3:return!0}}return!0}},it=i(1),nt=i(40),rt={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var i,n,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(n=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var a in r)this[a]=r[a];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,i,n;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),a=0;a<r.length;a++)if((i=this._input.match(this.rules[r[a]]))&&(!e||i[0].length>e[0].length)){if(e=i,n=a,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,r[a])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[n]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,n){switch(i){case 0:case 1:case 2:break;case 3:throw"Oh noes, unterminated comment";case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:return 72;case 12:case 13:case 14:return e.yytext;case 15:return 19;case 16:return 61;case 17:return 62;case 18:return 60;case 19:return 59;case 20:return 55;case 21:return 57;case 22:return 43;case 23:return 44;case 24:return 66;case 25:return 65;case 26:return 67;case 27:return 68;case 28:return 26;case 29:return 63;case 30:return 64;case 31:return 69;case 32:return 70;case 33:return",";case 34:return 13;case 35:return 6}},rules:[/^(?:\/\/(.*)[\r\n]*)/,/^(?:[\s\n]+)/,/^(?:[\/][*][^*]*[*]+([^*\/][^*]*[*]+)*[\/])/,/^(?:[\/][*])/,/^(?:[0-9]*\.[0-9]+)/,/^(?:[0-9]+\.[0-9]*)/,/^(?:(\$|0x)[A-Fa-f0-9]+)/,/^(?:[0-9]+)/,/^(?:"(\\.|[^\"])*")/,/^(?:'.{1}')/,/^(?:'.{4}')/,/^(?:\b(true|false|null)\b)/,/^(?:\b(array|constant|nothing)\b)/,/^(?:\b(function|endfunction|takes|returns|return|call|set|if|then|else|elseif|endif|globals|endglobals|loop|exitwhen|endloop|local|native|type|extends)\b)/,/^(?:\bnot\b)/,/^(?:\b(integer|string|unit|boolean|rect|real|texttag|hashtable|timer|player|group|dialog|boolexpr|location|trigger|item|region|sound|quest|code|destructable|playercolor|camerasetup|gamecache|effect|multiboard|fogmodifier|lightning|trackable|attacktype|itemtype|multiboarditem|event|widget|ability|buff|force|triggercondition|triggeraction|conditionfunc|filterfunc|unitpool|itempool|race|alliancetype|racepreference|gamestate|igamestate|fgamestate|playerstate|playergameresult|unitstate|aidifficulty|eventid|gameevent|playerevent|playerunitevent|unitevent|limitop|widgetevent|dialogevent|unittype|gamespeed|gamedifficulty|gametype|mapflag|mapvisibility|mapsetting|mapdensity|mapcontrol|playerslotstate|volumegroup|camerafield|placement|startlocprio|raritycontrol|blendmode|texmapflags|effecttype|weathereffect|terraindeformation|fogstate|button|questitem|defeatcondition|timerdialog|leaderboard|version|agent|handle|image|ubersplat|damagetype|playerscore|weapontype|soundtype|pathingtype|mousebuttontype)\b)/,/^(?:\*)/,/^(?:\/)/,/^(?:-)/,/^(?:\+)/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:<=)/,/^(?:>=)/,/^(?:==)/,/^(?:!=)/,/^(?:=)/,/^(?:<)/,/^(?:>)/,/^(?:and\b)/,/^(?:or\b)/,/^(?:,)/,/^(?:\b[a-zA-Z][a-zA-Z0-9_]*\b)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35],inclusive:!0}}};function at(){this.yy={}}return et.lexer=rt,at.prototype=et,et.Parser=at,new at}();e.parser=n,e.Parser=n.Parser,e.parse=function(){return n.parse.apply(n,arguments)}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});class n{constructor(t){this.rows=[],t&&this.load(t)}load(t){if(!t.startsWith("ID"))throw new Error("WrongMagicNumber");let e=this.rows,i=0,n=0;for(let r of t.split("\n"))if("B"!==r[0])for(let t of r.split(";")){let r,a=t[0],s=t.substring(1).trim();"X"===a?i=parseInt(s,10)-1:"Y"===a?n=parseInt(s,10)-1:"K"===a&&(e[n]||(e[n]=[]),r='"'===s[0]?s.substring(1,s.length-1):"TRUE"===s||"FALSE"!==s&&parseFloat(s),e[n][i]=r)}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return l});var n=i(10),r=i(1),a=i.n(r);function s(t,e){return`${function(t,e){return!e||!e.arguments.includes(t)&&!e.locals.includes(t)}(t,e)?"globals.":""}${t}`}function o(t){return"and"===t?"&&":"or"===t?"||":"not"===t?"!":t}function l(t,e){return function t(e,i,n){let r="";if(e){let l=function(t){return"this"===t||"new"===t?`_${t}`:t}(e.name);if(e instanceof a.a.Program)r+=`${e.blocks.map(e=>t(e,i,n)).join("\n")}\n`;else if(e instanceof a.a.Globals)n=null,r+=`${e.variables.map(e=>t(e,i,n)).join("\n")}\n`;else if(e instanceof a.a.FunctionDefinition)n={type:"function",arguments:[],locals:[]},i[l]=n,r+=`globals.${l} = jass.onFunctionDef("${l}", function ${l} (${["jass"].concat(e.args.map(e=>t(e,i,n))).join(", ")}) {\n${e.body.map(e=>t(e,i,n)).join("\n")}\n})\n`;else if(e instanceof a.a.FunctionArgument)n.arguments.push(l),r+=l;else if(e instanceof a.a.IfThenElse)r+=`if (${t(e.condition,i,n)}) {\n${e.thenActions.map(e=>t(e,i,n)).join("\n")}\n}`,e.elseActions.length&&(r+=` else {\n${e.elseActions.map(e=>t(e,i,n)).join("\n")}\n}`);else if(e instanceof a.a.SetVariable){let a=s(l,n);r+=`${a} = jass.onVarSet("${l}", ${a}, ${t(e.value,i,n)})`}else if(e instanceof a.a.SetVariableArray)r+=`jass.onArrayVarSet("${l}", ${s(l,n)}, ${t(e.index,i,n)}, ${t(e.value,i,n)})`;else if(e instanceof a.a.Literal)"string"===e.type?r+=`"${e.value.replace(/(\r|\n)/g,"%1")}"`:r+=e.value;else if(e instanceof a.a.GetVariable)r+=`jass.onVarGet("${l}", ${s(l,n)})`;else if(e instanceof a.a.GetVariableArray)r+=`jass.onArrayVarGet("${l}", ${s(l,n)}, ${t(e.index,i,n)})`;else if(e instanceof a.a.Return)r+=`return ${t(e.value,i,n)}`;else if(e instanceof a.a.Infix)r+=`${t(e.lhs,i,n)} ${o(e.operator)} ${t(e.rhs,i,n)}`;else if(e instanceof a.a.VariableDefinition){let a;e.isArray?a="[]":null!==e.value&&(a=t(e.value,i,n)),e.isLocal?(r+=`let ${l} = jass.onLocalVarDef("${l}", ${a})`,n.locals.push(l)):r+=`globals.${l} = jass.onGlobalVarDef("${l}", ${a})`}else e instanceof a.a.Loop?r+=`while (true) {\n${e.actions.map(e=>t(e,i,n)).join("\n")}\n}`:e instanceof a.a.ExitWhen?r+=`if (${t(e.condition,i,n)}) { break }`:e instanceof a.a.FunctionCall?r+=`jass.call(${[`"${l}"`].concat(e.args.map(e=>t(e,i,n))).join(", ")})`:e instanceof a.a.FunctionReference?r+=`globals.${l}`:e instanceof a.a.Unary?r+=`${o(e.operator)}${t(e.value,i,n)}`:e instanceof a.a.Type||(e instanceof a.a.Native?(i[l]={type:"native"},r+=`jass.onNativeDef("${l}")`):e instanceof a.a.FunctionCallStatement&&(r+=t(e.functionCall,i,n)))}return r}(Object(n.parse)(t),e)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return JassContext});var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4),events__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__),_mappeddata__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_recompile__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(12),_natives__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14),_types_handle__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5),_types_agent__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2),_types_reference__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7),_types_player__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(25),_constanthandles__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(26);class JassContext extends events__WEBPACK_IMPORTED_MODULE_0___default.a{constructor(t){super(),this.debugMode=!1,this.map=t,this.globals={},this.data={},this.natives=new Map,this.addNatives(Object.entries(_natives__WEBPACK_IMPORTED_MODULE_3__)),this.currentHandle=0,this.freeHandles=[],this.handles=new Set,this.references=new Set,this.mappedData=new _mappeddata__WEBPACK_IMPORTED_MODULE_1__.a,this.constantHandles=Object(_constanthandles__WEBPACK_IMPORTED_MODULE_8__.a)(this),this.mapName="",this.mapDescription="",this.gamePlacement=null,this.gameSpeed=null,this.gameDifficulty=null,this.playerCount=0,this.teamCount=0,this.startLocations=[],this.players=[],this.teams=[],this.timers=new Set;for(let t=0;t<28;t++)this.players[t]=new _types_player__WEBPACK_IMPORTED_MODULE_7__.a(this,t,28);this.stringTable=t.readStringTable()}addNatives(t){for(let[e,i]of t)this.natives.set(e,i)}onNativeDef(t){this.debugMode&&this.emit("nativedef",t)}onFunctionDef(t,e){return this.debugMode&&this.emit("functiondef",t,e),e}onLocalVarDef(t,e){return this.debugMode&&this.emit("localvardef",t,e),e instanceof _types_agent__WEBPACK_IMPORTED_MODULE_5__.a?this.addReference(t,e):e}onGlobalVarDef(t,e){return this.debugMode&&this.emit("globalvardef",t,e),e instanceof _types_handle__WEBPACK_IMPORTED_MODULE_4__.a&&e.addName(t),e instanceof _types_agent__WEBPACK_IMPORTED_MODULE_5__.a?this.addReference(t,e):e instanceof _types_reference__WEBPACK_IMPORTED_MODULE_6__.a?this.addReference(t,e.object):e}onVarSet(t,e,i){return this.debugMode&&this.emit("varset",t,e,i),e instanceof _types_reference__WEBPACK_IMPORTED_MODULE_6__.a&&this.removeReference(e),i instanceof _types_agent__WEBPACK_IMPORTED_MODULE_5__.a?this.addReference(t,i):i instanceof _types_reference__WEBPACK_IMPORTED_MODULE_6__.a?this.addReference(t,i.object):i}onArrayVarSet(t,e,i,n){let r=e[i];this.debugMode&&this.emit("arrayvarset",t,i,r,n),r instanceof _types_reference__WEBPACK_IMPORTED_MODULE_6__.a&&this.removeReference(r),n instanceof _types_agent__WEBPACK_IMPORTED_MODULE_5__.a?e[i]=this.addReference(`${t}[${i}]`,n):n instanceof _types_reference__WEBPACK_IMPORTED_MODULE_6__.a?e[i]=this.addReference(`${t}[${i}]`,n.object):e[i]=n}onVarGet(t,e){return this.debugMode&&this.emit("varget",t,e),e}onArrayVarGet(t,e,i){let n=e[i];return this.debugMode&&this.emit("arrayvarget",t,i,n),n}onHandleCreation(t){this.debugMode&&this.emit("handlecreated",t)}onHandleDestruction(t){this.debugMode&&this.emit("handledestroyed",t)}onReferenceCreation(t){this.debugMode&&this.emit("refcreated",t)}onReferenceDestruction(t){this.debugMode&&this.emit("refdestroyed",t)}call(t,...e){let i=this.globals[t];if(i||(i=this.natives.get(t)),this.debugMode&&this.emit("call",t,e,i),i)return i(this,...e.map(t=>{if("string"==typeof t){let e=t.match(/^TRIGSTR_(\d+)$/);if(e)return this.stringTable.stringMap.get(parseInt(e[1]))}else if(t instanceof _types_reference__WEBPACK_IMPORTED_MODULE_6__.a)return t.object;return t}))}run(js){eval(`(function (jass, globals) {\n${js}\n})`)(this,this.globals)}recompile(t){return Object(_recompile__WEBPACK_IMPORTED_MODULE_2__.a)(t,this.data)}start(){this.run(this.recompile(this.commonj)),this.run(this.recompile(this.blizzardj)),this.run(this.recompile(this.map.getScript()))}addHandle(t){return this.handles.add(t),this.onHandleCreation(t),t}removeHandle(t){if(!this.handles.delete(t))throw new Error(`Trying to free handle ${t} which does not refer to any data`);return t.kill(),this.freeHandles.push(t),this.onHandleDestruction(t),t}addReference(t,e){let i=new _types_reference__WEBPACK_IMPORTED_MODULE_6__.a(t,e);return e.addReference(i),this.references.add(i),this.onReferenceCreation(i),i}removeReference(t){t.object.removeReference(t),this.references.delete(t),this.onReferenceDestruction(t)}getAvailableHandle(){return this.currentHandle++}}},function(t,e,i){"use strict";i.r(e);var n=i(0);let r=new Uint8Array(1024);var a=i(15),s=i(2);class o extends s.a{constructor(t){super(t),this.players=new Set}}class l extends s.a{constructor(t){super(t),this.units=new Set}}class h extends s.a{constructor(t){super(t),this.enabled=!0}}class u extends s.a{constructor(t){super(t),this.elapsed=0,this.timeout=0,this.periodic=!1,this.handlerFunc=null}}var c=i(8);class d extends s.a{constructor(t){super(t),this.rects=new Set}}class f extends s.a{constructor(t,e,i,n,r){super(t),this.center=new Float32Array([n-e,r-i]),this.min=new Float32Array([e,i]),this.max=new Float32Array([n,r])}}var m=i(5);class g extends m.a{constructor(t){super(t),this.targetDistance=0,this.farZ=0,this.angleOfAttack=0,this.fieldOfView=0,this.roll=0,this.rotation=0,this.zOffset=0,this.destPosition=new c.a(t,0,0)}}class p extends m.a{constructor(t,e,i){super(t),this.whichRect=e,this.effectId=i,this.enabled=!1}}class v extends s.a{constructor(t){super(t),this.table=new Map}save(t,e,i){let n=this.table,r=n.get(t);r||(r=new Map,n.set(t,r)),r.set(e,i)}load(t,e,i){let n=this.table.get(t);if(n){let t=n.get(e);if(void 0!==t)return t}return i}have(t,e){let i=this.table.get(t);return!!i&&i.has(e)}remove(t,e){let i=this.table,n=i.get(t);n&&(n.delete(e),n.size||i.delete(t))}flush(){this.table.clear()}flushChild(t){this.table.get(t).clear()}}function b(t,e){return t.constantHandles.races[e]}function w(t,e){return t.constantHandles.allianceTypes[e]}function y(t,e){return t.constantHandles.racePreferences[e]}function A(t,e){return t.constantHandles.iGameStates[e]}function _(t,e){return t.constantHandles.fGameStates[e]}function x(t,e){return t.constantHandles.playerStates[e]}function T(t,e){return t.constantHandles.playerScores[e]}function E(t,e){return t.constantHandles.playerGameResults[e]}function S(t,e){return t.constantHandles.unitStates[e]}function M(t,e){return t.constantHandles.aiDifficulties[e]}function R(t,e){return t.constantHandles.events[e]}function I(t,e){return t.constantHandles.events[e]}function B(t,e){return t.constantHandles.events[e]}function C(t,e){return t.constantHandles.events[e]}function L(t,e){return t.constantHandles.events[e]}function U(t,e){return t.constantHandles.events[e]}function k(t,e){return t.constantHandles.limitOps[e]}function F(t,e){return t.constantHandles.unitTypes[e]}function P(t,e){return t.constantHandles.gameSpeeds[e]}function D(t,e){return t.constantHandles.placements[e]}function O(t,e){return t.constantHandles.startLocPrios[e]}function N(t,e){return t.constantHandles.gameDifficulties[e]}function V(t,e){return t.constantHandles.gameTypes[e]}function G(t,e){return t.constantHandles.mapFlags[e]}function j(t,e){return t.constantHandles.mapVisibilities[e]}function H(t,e){return t.constantHandles.mapSettings[e]}function $(t,e){return t.constantHandles.mapDensities[e]}function q(t,e){return t.constantHandles.mapControls[e]}function z(t,e){return t.constantHandles.playerColors[e]}function K(t,e){return t.constantHandles.playerSlotStates[e]}function W(t,e){return t.constantHandles.volumeGroups[e]}function Y(t,e){return t.constantHandles.cameraFields[e]}function X(t,e){return t.constantHandles.blendModes[e]}function J(t,e){return t.constantHandles.rarityControls[e]}function Z(t,e){return t.constantHandles.texMapFlags[e]}function Q(t,e){return t.constantHandles.fogStates[e]}function tt(t,e){return t.constantHandles.effectTypes[e]}function et(t,e){return t.constantHandles.versions[e]}function it(t,e){return t.constantHandles.itemTypes[e]}function nt(t,e){return t.constantHandles.attackTypes[e]}function rt(t,e){return t.constantHandles.damageTypes[e]}function at(t,e){return t.constantHandles.weaponTypes[e]}function st(t,e){return t.constantHandles.soundTypes[e]}function ot(t,e){return t.constantHandles.pathingTypes[e]}function lt(t){return 28}function ht(t){return 24}function ut(t){return 25}function ct(t){return 24}function dt(t){return 26}function ft(t){return 27}function mt(t,e){return e*(Math.PI/180)}function gt(t,e){return e*(180/Math.PI)}function pt(t,e){return Math.sin(e)}function vt(t,e){return Math.cos(e)}function bt(t,e){return Math.tan(e)}function wt(t,e){return Math.asin(e)}function yt(t,e){return Math.acos(e)}function At(t,e){return Math.atan(e)}function _t(t,e,i){return Math.atan2(e,i)}function xt(t,e){return Math.sqrt(e)}function Tt(t,e,i){return Math.pow(e,i)}function Et(t,e){return e}function St(t,e){return 0|e}function Mt(t,e){return""+e}function Rt(t,e){return""+e}function It(t,e){return parseInt(e,10)}function Bt(t,e){return parseFloat(e)}function Ct(t,e){return e.handleId}function Lt(t,e,i,n){return e.substring(i,n)}function Ut(t,e){return e.length}function kt(t,e,i){return i?e.toUpperCase():e.toLowerCase()}function Ft(t,e){return function(t){let e=0;r.fill(0);for(let i of t){let t=i.charCodeAt(0);r[e]=t<97||t>122?47===t?92:t:t-32,e+=1}return function(t,e){let i=0,n=t.length,r=2654435769,a=2654435769,s=e;for(;n>=12;)r+=t[i+0]+(t[i+1]<<8)+(t[i+2]<<16)+(t[i+3]<<24),r-=a+=t[i+4]+(t[i+5]<<8)+(t[i+6]<<16)+(t[i+7]<<24),r-=s+=t[i+8]+(t[i+9]<<8)+(t[i+10]<<16)+(t[i+11]<<24),a-=s,a-=r^=s>>13,s-=r,s-=a^=r<<8,r-=a,r-=s^=a>>13,a-=s,a-=r^=s>>12,s-=r,s-=a^=r<<16,r-=a,r-=s^=a>>5,a-=s,a-=r^=s>>3,s-=r,s-=a^=r<<10,s^=a>>15,i+=12,n-=12;return s+=t.length,11===n?s+=t[i+10]<<24:10===n?s+=t[i+9]<<16:9===n?s+=t[i+8]<<8:8===n?a+=t[i+7]<<24:7===n?a+=t[i+6]<<16:6===n?a+=t[i+5]<<8:5===n?a+=t[i+4]:4===n?r+=t[i+3]<<24:3===n?r+=t[i+2]<<16:2===n?r+=t[i+1]<<8:1===n&&(r+=t[i+0]),r-=a,r-=s,a-=s,a-=r^=s>>13,s-=r,s-=a^=r<<8,r-=a,r-=s^=a>>13,a-=s,a-=r^=s>>12,s-=r,s-=a^=r<<16,r-=a,r-=s^=a>>5,a-=s,a-=r^=s>>3,s-=r,s-=a^=r<<10,s^=a>>15}(r,0)}(e)}function Pt(t,e){t.mapName=e}function Dt(t,e){t.mapDescription=e}function Ot(t,e){t.teamCount=e}function Nt(t,e){t.playerCount=e}function Vt(t,e,i,n){t.startLocations[e]=t.addHandle(new c.a(t,i,n))}function Gt(t,e,i){Vt(t,e,i.x,i.y)}function jt(t,e){t.gamePlacement=e}function Ht(t,e){t.gameSpeed=e}function $t(t,e){t.gameDifficulty=e}function qt(t){return t.teamCount}function zt(t){return t.playerCount}function Kt(t){return t.gamePlacement}function Wt(t){return t.gameSpeed}function Yt(t){return t.gameDifficulty}function Xt(t,e){return t.startLocations[e].x}function Jt(t,e){return t.startLocations[e].y}function Zt(t,e){return t.startLocations[e]}function Qt(t,e,i){e.team=i}function te(t,e,i){e.startLocation=i}function ee(t,e,i){e.forcedStartLocation=i}function ie(t,e,i){e.color=i}function ne(t,e,i,n,r){let a=e.alliances.get(i.index),s=n.value;0===s?a.passive=r:1===s?a.helpRequest=r:2===s?a.helpResponse=r:3===s?a.sharedXp=r:4===s?a.sharedSpells=r:5===s?a.sharedVision=r:6===s?a.sharedControl=r:7===s?a.sharedAdvancedControl=r:8===s?a.rescuable=r:9===s&&(a.sharedVisionForced=r)}function re(t,e,i){e.racePreference=i}function ae(t,e,i){e.raceSelectable=i}function se(t,e,i){e.controller=i}function oe(t,e,i){e.name=i}function le(t,e){return e.team}function he(t,e){return e.startLocation}function ue(t,e){return e.color}function ce(t,e){return e.raceSelectable}function de(t,e){return e.controller}function fe(t,e){return e.name}function me(t){return t.addHandle(new u(t))}function ge(t,e){t.removeHandle(e)}function pe(t,e,i,n,r){e.elapsed=0,e.timeout=i,e.periodic=n,e.handlerFunc=r,t.timers.add(e)}function ve(t,e){return e.elapsed}function be(t,e){return e.timeout-e.elapsed}function we(t,e){return e.timeout}function ye(t,e){t.timers.delete(e)}function Ae(t,e){t.timers.add(e)}function _e(t){return t.addHandle(new l(t))}function xe(t,e){t.removeHandle(e)}function Te(t,e,i){e.units.add(i)}function Ee(t,e,i){e.units.delete(i)}function Se(t,e){e.units.clear()}function Me(t,e){let i=e.units;if(i.size){let t=i.values().next().value;return i.delete(t),t}return null}function Re(t){return t.addHandle(new o(t))}function Ie(t,e){t.removeHandle(e)}function Be(t,e,i){e.players.add(i)}function Ce(t,e,i){e.players.delete(i)}function Le(t,e){e.players.clear()}function Ue(t,e,i,n,r){return t.addHandle(new f(t,e,i,n,r))}function ke(t,e,i){return Ue(t,e.x,e.y,i.x,i.y)}function Fe(t,e){t.removeHandle(e)}function Pe(t,e,i,n,r,a){let s=e.center,o=e.min,l=e.max;s[0]=r-i,s[1]=a-n,o[0]=i,o[1]=n,l[0]=r,l[1]=a}function De(t,e,i,n){Pe(0,e,i.x,i.y,n.x,n.y)}function Oe(t,e,i,n){let r=e.center,a=e.min,s=e.max,o=(s[0]-a[0])/2,l=(s[1]-a[1])/2;r[0]=i,r[1]=n,a[0]=i-o,a[1]=n-l,s[0]=i+o,s[1]=n+l}function Ne(t,e,i){Oe(0,e,i.x,i.y)}function Ve(t,e){return e.center[0]}function Ge(t,e){return e.center[1]}function je(t,e){return e.min[0]}function He(t,e){return e.min[1]}function $e(t,e){return e.max[0]}function qe(t,e){return e.max[1]}function ze(t){return t.addHandle(new d(t))}function Ke(t,e){t.removeHandle(e)}function We(t,e,i){return t.addHandle(new c.a(t,e,i))}function Ye(t,e){t.removeHandle(e)}function Xe(t,e,i,n){e.x=i,e.y=n}function Je(t,e){return e.x}function Ze(t,e){return e.y}function Qe(t,e){return e.z}function ti(t){return t.debugMode&&console.warn("GetWorldBounds not implemented!"),t.addHandle(new f(t,0,0,0,0))}function ei(t){return t.addHandle(new h(t))}function ii(t,e){t.removeHandle(e)}function ni(t,e){e.enabled=!0}function ri(t,e){e.enabled=!1}function ai(t,e){return e.enabled}function si(t,e){t.call(e)}function oi(t,e,i,r,s,o){return t.addHandle(new a.a(t,e,Object(n.a)(i),r,s,o))}function li(t,e,i,n,r){return oi(t,e,i,n.x,n.y,r)}function hi(t,e,i,n){0===i.value?e.health=n:2===i.value&&(e.mana=n)}function ui(t,e,i){e.location[0]=i}function ci(t,e,i){e.location[1]=i}function di(t,e,i,n){e.location[0]=i,e.location[1]=n}function fi(t,e,i){e.location[0]=i.x,e.location[1]=i.y}function mi(t,e,i){e.facing=i}function gi(t,e,i){e.acquireRange=i}function pi(t,e){return e.acquireRange}function vi(t,e,i){return 0===i.value?e.health:1===i.value?e.maxHealth:2===i.value?e.mana:3===i.value?e.maxMana:void 0}function bi(t,e){return e.player}function wi(t,e){return t.players[e]}function yi(t,e){return e.index}function Ai(t){return t.addHandle(new v(t))}function _i(t,e,i,n,r){e.save(i,n,r)}function xi(t,e,i,n,r){e.save(i,n,r)}function Ti(t,e,i,n,r){e.save(i,n,r)}function Ei(t,e,i,n,r){return e.save(i,n,r)}function Si(t,e,i,n,r){return e.save(i,n,r)}function Mi(t,e,i,n,r){return e.save(i,n,r)}function Ri(t,e,i,n,r){return e.save(i,n,r)}function Ii(t,e,i,n,r){return e.save(i,n,r)}function Bi(t,e,i,n,r){return e.save(i,n,r)}function Ci(t,e,i,n,r){return e.save(i,n,r)}function Li(t,e,i,n,r){return e.save(i,n,r)}function Ui(t,e,i,n,r){return e.save(i,n,r)}function ki(t,e,i,n,r){return e.save(i,n,r)}function Fi(t,e,i,n,r){return e.save(i,n,r)}function Pi(t,e,i,n,r){return e.save(i,n,r)}function Di(t,e,i,n,r){return e.save(i,n,r)}function Oi(t,e,i,n,r){return e.save(i,n,r)}function Ni(t,e,i,n,r){return e.save(i,n,r)}function Vi(t,e,i,n,r){return e.save(i,n,r)}function Gi(t,e,i,n,r){return e.save(i,n,r)}function ji(t,e,i,n,r){return e.save(i,n,r)}function Hi(t,e,i,n,r){return e.save(i,n,r)}function $i(t,e,i,n,r){return e.save(i,n,r)}function qi(t,e,i,n,r){return e.save(i,n,r)}function zi(t,e,i,n,r){return e.save(i,n,r)}function Ki(t,e,i,n,r){return e.save(i,n,r)}function Wi(t,e,i,n,r){return e.save(i,n,r)}function Yi(t,e,i,n,r){return e.save(i,n,r)}function Xi(t,e,i,n,r){return e.save(i,n,r)}function Ji(t,e,i,n,r){return e.save(i,n,r)}function Zi(t,e,i,n,r){return e.save(i,n,r)}function Qi(t,e,i,n,r){return e.save(i,n,r)}function tn(t,e,i,n,r){return e.save(i,n,r)}function en(t,e,i,n,r){return e.save(i,n,r)}function nn(t,e,i,n,r){return e.save(i,n,r)}function rn(t,e,i,n,r){return e.save(i,n,r)}function an(t,e,i,n,r){return e.save(i,n,r)}function sn(t,e,i,n,r){return e.save(i,n,r)}function on(t,e,i,n,r){return e.save(i,n,r)}function ln(t,e,i,n,r){return e.save(i,n,r)}function hn(t,e,i,n,r){return e.save(i,n,r)}function un(t,e,i,n,r){return e.save(i,n,r)}function cn(t,e,i,n,r){return e.save(i,n,r)}function dn(t,e,i,n){return e.load(i,n,0)}function fn(t,e,i,n){return e.load(i,n,0)}function mn(t,e,i,n){return e.load(i,n,!1)}function gn(t,e,i,n){return e.load(i,n,null)}function pn(t,e,i,n){return e.load(i,n,null)}function vn(t,e,i,n){return e.load(i,n,null)}function bn(t,e,i,n){return e.load(i,n,null)}function wn(t,e,i,n){return e.load(i,n,null)}function yn(t,e,i,n){return e.load(i,n,null)}function An(t,e,i,n){return e.load(i,n,null)}function _n(t,e,i,n){return e.load(i,n,null)}function xn(t,e,i,n){return e.load(i,n,null)}function Tn(t,e,i,n){return e.load(i,n,null)}function En(t,e,i,n){return e.load(i,n,null)}function Sn(t,e,i,n){return e.load(i,n,null)}function Mn(t,e,i,n){return e.load(i,n,null)}function Rn(t,e,i,n){return e.load(i,n,null)}function In(t,e,i,n){return e.load(i,n,null)}function Bn(t,e,i,n){return e.load(i,n,null)}function Cn(t,e,i,n){return e.load(i,n,null)}function Ln(t,e,i,n){return e.load(i,n,null)}function Un(t,e,i,n){return e.load(i,n,null)}function kn(t,e,i,n){return e.load(i,n,null)}function Fn(t,e,i,n){return e.load(i,n,null)}function Pn(t,e,i,n){return e.load(i,n,null)}function Dn(t,e,i,n){return e.load(i,n,null)}function On(t,e,i,n){return e.load(i,n,null)}function Nn(t,e,i,n){return e.load(i,n,null)}function Vn(t,e,i,n){return e.load(i,n,null)}function Gn(t,e,i,n){return e.load(i,n,null)}function jn(t,e,i,n){return e.load(i,n,null)}function Hn(t,e,i,n){return e.load(i,n,null)}function $n(t,e,i,n){return e.load(i,n,null)}function qn(t,e,i,n){return e.load(i,n,null)}function zn(t,e,i,n){return e.load(i,n,null)}function Kn(t,e,i,n){return e.load(i,n,null)}function Wn(t,e,i,n){return e.load(i,n,null)}function Yn(t,e,i,n){return e.load(i,n,null)}function Xn(t,e,i,n){return e.load(i,n,null)}function Jn(t,e,i,n){return e.load(i,n,null)}function Zn(t,e,i,n){return e.load(i,n,null)}function Qn(t,e,i,n){return e.load(i,n,null)}function tr(t,e,i,n){return e.have(i,n)}function er(t,e,i,n){return e.have(i,n)}function ir(t,e,i,n){return e.have(i,n)}function nr(t,e,i,n){return e.have(i,n)}function rr(t,e,i,n){return e.have(i,n)}function ar(t,e,i,n){e.remove(i,n)}function sr(t,e,i,n){e.remove(i,n)}function or(t,e,i,n){e.remove(i,n)}function lr(t,e,i,n){e.remove(i,n)}function hr(t,e,i,n){e.remove(i,n)}function ur(t,e){e.flush()}function cr(t,e,i){e.flushChild(i)}function dr(t,e,i){return 0|fr()}function fr(t,e,i){return e+Math.random()*(i-e)}function mr(t){return t.addHandle(new g(t))}function gr(t,e,i,n,r){r>0&&console.warn("CameraSetupSetField: duration not supported"),0===i.value?e.targetDistance=n:1===i.value?e.farZ=n:2===i.value?e.angleOfAttack=n:3===i.value?e.fieldOfView=n:4===i.value?e.roll=n:5===i.value?e.rotation=n:6===i.value&&(e.zOffset=n)}function pr(t,e,i){return 0===i.value?e.targetDistance:1===i.value?e.farZ:2===i.value?e.angleOfAttack:3===i.value?e.fieldOfView:4===i.value?e.roll:5===i.value?e.rotation:6===i.value?e.zOffset:void 0}function vr(t,e,i,n,r){r>0&&console.warn("CameraSetupSetDestPosition: duration not supported"),e.destPosition.x=i,e.destPosition.y=n}function br(t,e){return e.destPosition}function wr(t,e){return e.destPosition.x}function yr(t,e){return e.destPosition.y}function Ar(t,e,i){return t.addHandle(new p(t,e,Object(n.a)(i)))}function _r(t,e){t.removeHandle(e)}function xr(t,e,i){e.enabled=i}i.d(e,"ConvertRace",function(){return b}),i.d(e,"ConvertAllianceType",function(){return w}),i.d(e,"ConvertRacePref",function(){return y}),i.d(e,"ConvertIGameState",function(){return A}),i.d(e,"ConvertFGameState",function(){return _}),i.d(e,"ConvertPlayerState",function(){return x}),i.d(e,"ConvertPlayerScore",function(){return T}),i.d(e,"ConvertPlayerGameResult",function(){return E}),i.d(e,"ConvertUnitState",function(){return S}),i.d(e,"ConvertAIDifficulty",function(){return M}),i.d(e,"ConvertGameEvent",function(){return R}),i.d(e,"ConvertPlayerEvent",function(){return I}),i.d(e,"ConvertPlayerUnitEvent",function(){return B}),i.d(e,"ConvertWidgetEvent",function(){return C}),i.d(e,"ConvertDialogEvent",function(){return L}),i.d(e,"ConvertUnitEvent",function(){return U}),i.d(e,"ConvertLimitOp",function(){return k}),i.d(e,"ConvertUnitType",function(){return F}),i.d(e,"ConvertGameSpeed",function(){return P}),i.d(e,"ConvertPlacement",function(){return D}),i.d(e,"ConvertStartLocPrio",function(){return O}),i.d(e,"ConvertGameDifficulty",function(){return N}),i.d(e,"ConvertGameType",function(){return V}),i.d(e,"ConvertMapFlag",function(){return G}),i.d(e,"ConvertMapVisibility",function(){return j}),i.d(e,"ConvertMapSetting",function(){return H}),i.d(e,"ConvertMapDensity",function(){return $}),i.d(e,"ConvertMapControl",function(){return q}),i.d(e,"ConvertPlayerColor",function(){return z}),i.d(e,"ConvertPlayerSlotState",function(){return K}),i.d(e,"ConvertVolumeGroup",function(){return W}),i.d(e,"ConvertCameraField",function(){return Y}),i.d(e,"ConvertBlendMode",function(){return X}),i.d(e,"ConvertRarityControl",function(){return J}),i.d(e,"ConvertTexMapFlags",function(){return Z}),i.d(e,"ConvertFogState",function(){return Q}),i.d(e,"ConvertEffectType",function(){return tt}),i.d(e,"ConvertVersion",function(){return et}),i.d(e,"ConvertItemType",function(){return it}),i.d(e,"ConvertAttackType",function(){return nt}),i.d(e,"ConvertDamageType",function(){return rt}),i.d(e,"ConvertWeaponType",function(){return at}),i.d(e,"ConvertSoundType",function(){return st}),i.d(e,"ConvertPathingType",function(){return ot}),i.d(e,"GetBJMaxPlayers",function(){return lt}),i.d(e,"GetBJPlayerNeutralVictim",function(){return ht}),i.d(e,"GetBJPlayerNeutralExtra",function(){return ut}),i.d(e,"GetBJMaxPlayerSlots",function(){return ct}),i.d(e,"GetPlayerNeutralPassive",function(){return dt}),i.d(e,"GetPlayerNeutralAggressive",function(){return ft}),i.d(e,"Deg2Rad",function(){return mt}),i.d(e,"Rad2Deg",function(){return gt}),i.d(e,"Sin",function(){return pt}),i.d(e,"Cos",function(){return vt}),i.d(e,"Tan",function(){return bt}),i.d(e,"Asin",function(){return wt}),i.d(e,"Acos",function(){return yt}),i.d(e,"Atan",function(){return At}),i.d(e,"Atan2",function(){return _t}),i.d(e,"SquareRoot",function(){return xt}),i.d(e,"Pow",function(){return Tt}),i.d(e,"I2R",function(){return Et}),i.d(e,"R2I",function(){return St}),i.d(e,"I2S",function(){return Mt}),i.d(e,"R2S",function(){return Rt}),i.d(e,"S2I",function(){return It}),i.d(e,"S2R",function(){return Bt}),i.d(e,"GetHandleId",function(){return Ct}),i.d(e,"SubString",function(){return Lt}),i.d(e,"StringLength",function(){return Ut}),i.d(e,"StringCase",function(){return kt}),i.d(e,"StringHash",function(){return Ft}),i.d(e,"SetMapName",function(){return Pt}),i.d(e,"SetMapDescription",function(){return Dt}),i.d(e,"SetTeams",function(){return Ot}),i.d(e,"SetPlayers",function(){return Nt}),i.d(e,"DefineStartLocation",function(){return Vt}),i.d(e,"DefineStartLocationLoc",function(){return Gt}),i.d(e,"SetGamePlacement",function(){return jt}),i.d(e,"SetGameSpeed",function(){return Ht}),i.d(e,"SetGameDifficulty",function(){return $t}),i.d(e,"GetTeams",function(){return qt}),i.d(e,"GetPlayers",function(){return zt}),i.d(e,"GetGamePlacement",function(){return Kt}),i.d(e,"GetGameSpeed",function(){return Wt}),i.d(e,"GetGameDifficulty",function(){return Yt}),i.d(e,"GetStartLocationX",function(){return Xt}),i.d(e,"GetStartLocationY",function(){return Jt}),i.d(e,"GetStartLocationLoc",function(){return Zt}),i.d(e,"SetPlayerTeam",function(){return Qt}),i.d(e,"SetPlayerStartLocation",function(){return te}),i.d(e,"ForcePlayerStartLocation",function(){return ee}),i.d(e,"SetPlayerColor",function(){return ie}),i.d(e,"SetPlayerAlliance",function(){return ne}),i.d(e,"SetPlayerRacePreference",function(){return re}),i.d(e,"SetPlayerRaceSelectable",function(){return ae}),i.d(e,"SetPlayerController",function(){return se}),i.d(e,"SetPlayerName",function(){return oe}),i.d(e,"GetPlayerTeam",function(){return le}),i.d(e,"GetPlayerStartLocation",function(){return he}),i.d(e,"GetPlayerColor",function(){return ue}),i.d(e,"GetPlayerSelectable",function(){return ce}),i.d(e,"GetPlayerController",function(){return de}),i.d(e,"GetPlayerName",function(){return fe}),i.d(e,"CreateTimer",function(){return me}),i.d(e,"DestroyTimer",function(){return ge}),i.d(e,"TimerStart",function(){return pe}),i.d(e,"TimerGetElapsed",function(){return ve}),i.d(e,"TimerGetRemaining",function(){return be}),i.d(e,"TimerGetTimeout",function(){return we}),i.d(e,"PauseTimer",function(){return ye}),i.d(e,"ResumeTimer",function(){return Ae}),i.d(e,"CreateGroup",function(){return _e}),i.d(e,"DestroyGroup",function(){return xe}),i.d(e,"GroupAddUnit",function(){return Te}),i.d(e,"GroupRemoveUnit",function(){return Ee}),i.d(e,"GroupClear",function(){return Se}),i.d(e,"FirstOfGroup",function(){return Me}),i.d(e,"CreateForce",function(){return Re}),i.d(e,"DestroyForce",function(){return Ie}),i.d(e,"ForceAddPlayer",function(){return Be}),i.d(e,"ForceRemovePlayer",function(){return Ce}),i.d(e,"ForceClear",function(){return Le}),i.d(e,"Rect",function(){return Ue}),i.d(e,"RectFromLoc",function(){return ke}),i.d(e,"RemoveRect",function(){return Fe}),i.d(e,"SetRect",function(){return Pe}),i.d(e,"SetRectFromLoc",function(){return De}),i.d(e,"MoveRectTo",function(){return Oe}),i.d(e,"MoveRectToLoc",function(){return Ne}),i.d(e,"GetRectCenterX",function(){return Ve}),i.d(e,"GetRectCenterY",function(){return Ge}),i.d(e,"GetRectMinX",function(){return je}),i.d(e,"GetRectMinY",function(){return He}),i.d(e,"GetRectMaxX",function(){return $e}),i.d(e,"GetRectMaxY",function(){return qe}),i.d(e,"CreateRegion",function(){return ze}),i.d(e,"RemoveRegion",function(){return Ke}),i.d(e,"Location",function(){return We}),i.d(e,"RemoveLocation",function(){return Ye}),i.d(e,"MoveLocation",function(){return Xe}),i.d(e,"GetLocationX",function(){return Je}),i.d(e,"GetLocationY",function(){return Ze}),i.d(e,"GetLocationZ",function(){return Qe}),i.d(e,"GetWorldBounds",function(){return ti}),i.d(e,"CreateTrigger",function(){return ei}),i.d(e,"DestroyTrigger",function(){return ii}),i.d(e,"EnableTrigger",function(){return ni}),i.d(e,"DisableTrigger",function(){return ri}),i.d(e,"IsTriggerEnabled",function(){return ai}),i.d(e,"ExecuteFunc",function(){return si}),i.d(e,"CreateUnit",function(){return oi}),i.d(e,"CreateUnitAtLoc",function(){return li}),i.d(e,"SetUnitState",function(){return hi}),i.d(e,"SetUnitX",function(){return ui}),i.d(e,"SetUnitY",function(){return ci}),i.d(e,"SetUnitPosition",function(){return di}),i.d(e,"SetUnitPositionLoc",function(){return fi}),i.d(e,"SetUnitFacing",function(){return mi}),i.d(e,"SetUnitAcquireRange",function(){return gi}),i.d(e,"GetUnitAcquireRange",function(){return pi}),i.d(e,"GetUnitState",function(){return vi}),i.d(e,"GetOwningPlayer",function(){return bi}),i.d(e,"Player",function(){return wi}),i.d(e,"GetPlayerId",function(){return yi}),i.d(e,"InitHashtable",function(){return Ai}),i.d(e,"SaveInteger",function(){return _i}),i.d(e,"SaveReal",function(){return xi}),i.d(e,"SaveBoolean",function(){return Ti}),i.d(e,"SaveStr",function(){return Ei}),i.d(e,"SavePlayerHandle",function(){return Si}),i.d(e,"SaveWidgetHandle",function(){return Mi}),i.d(e,"SaveDestructableHandle",function(){return Ri}),i.d(e,"SaveItemHandle",function(){return Ii}),i.d(e,"SaveUnitHandle",function(){return Bi}),i.d(e,"SaveAbilityHandle",function(){return Ci}),i.d(e,"SaveTimerHandle",function(){return Li}),i.d(e,"SaveTriggerHandle",function(){return Ui}),i.d(e,"SaveTriggerConditionHandle",function(){return ki}),i.d(e,"SaveTriggerActionHandle",function(){return Fi}),i.d(e,"SaveTriggerEventHandle",function(){return Pi}),i.d(e,"SaveForceHandle",function(){return Di}),i.d(e,"SaveGroupHandle",function(){return Oi}),i.d(e,"SaveLocationHandle",function(){return Ni}),i.d(e,"SaveRectHandle",function(){return Vi}),i.d(e,"SaveBooleanExprHandle",function(){return Gi}),i.d(e,"SaveSoundHandle",function(){return ji}),i.d(e,"SaveEffectHandle",function(){return Hi}),i.d(e,"SaveUnitPoolHandle",function(){return $i}),i.d(e,"SaveItemPoolHandle",function(){return qi}),i.d(e,"SaveQuestHandle",function(){return zi}),i.d(e,"SaveQuestItemHandle",function(){return Ki}),i.d(e,"SaveDefeatConditionHandle",function(){return Wi}),i.d(e,"SaveTimerDialogHandle",function(){return Yi}),i.d(e,"SaveLeaderboardHandle",function(){return Xi}),i.d(e,"SaveMultiboardHandle",function(){return Ji}),i.d(e,"SaveMultiboardItemHandle",function(){return Zi}),i.d(e,"SaveTrackableHandle",function(){return Qi}),i.d(e,"SaveDialogHandle",function(){return tn}),i.d(e,"SaveButtonHandle",function(){return en}),i.d(e,"SaveTextTagHandle",function(){return nn}),i.d(e,"SaveLightningHandle",function(){return rn}),i.d(e,"SaveImageHandle",function(){return an}),i.d(e,"SaveUbersplatHandle",function(){return sn}),i.d(e,"SaveRegionHandle",function(){return on}),i.d(e,"SaveFogStateHandle",function(){return ln}),i.d(e,"SaveFogModifierHandle",function(){return hn}),i.d(e,"SaveAgentHandle",function(){return un}),i.d(e,"SaveHashtableHandle",function(){return cn}),i.d(e,"LoadInteger",function(){return dn}),i.d(e,"LoadReal",function(){return fn}),i.d(e,"LoadBoolean",function(){return mn}),i.d(e,"LoadStr",function(){return gn}),i.d(e,"LoadPlayerHandle",function(){return pn}),i.d(e,"LoadWidgetHandle",function(){return vn}),i.d(e,"LoadDestructableHandle",function(){return bn}),i.d(e,"LoadItemHandle",function(){return wn}),i.d(e,"LoadUnitHandle",function(){return yn}),i.d(e,"LoadAbilityHandle",function(){return An}),i.d(e,"LoadTimerHandle",function(){return _n}),i.d(e,"LoadTriggerHandle",function(){return xn}),i.d(e,"LoadTriggerConditionHandle",function(){return Tn}),i.d(e,"LoadTriggerActionHandle",function(){return En}),i.d(e,"LoadTriggerEventHandle",function(){return Sn}),i.d(e,"LoadForceHandle",function(){return Mn}),i.d(e,"LoadGroupHandle",function(){return Rn}),i.d(e,"LoadLocationHandle",function(){return In}),i.d(e,"LoadRectHandle",function(){return Bn}),i.d(e,"LoadBooleanExprHandle",function(){return Cn}),i.d(e,"LoadSoundHandle",function(){return Ln}),i.d(e,"LoadEffectHandle",function(){return Un}),i.d(e,"LoadUnitPoolHandle",function(){return kn}),i.d(e,"LoadItemPoolHandle",function(){return Fn}),i.d(e,"LoadQuestHandle",function(){return Pn}),i.d(e,"LoadQuestItemHandle",function(){return Dn}),i.d(e,"LoadDefeatConditionHandle",function(){return On}),i.d(e,"LoadTimerDialogHandle",function(){return Nn}),i.d(e,"LoadLeaderboardHandle",function(){return Vn}),i.d(e,"LoadMultiboardHandle",function(){return Gn}),i.d(e,"LoadMultiboardItemHandle",function(){return jn}),i.d(e,"LoadTrackableHandle",function(){return Hn}),i.d(e,"LoadDialogHandle",function(){return $n}),i.d(e,"LoadButtonHandle",function(){return qn}),i.d(e,"LoadTextTagHandle",function(){return zn}),i.d(e,"LoadLightningHandle",function(){return Kn}),i.d(e,"LoadImageHandle",function(){return Wn}),i.d(e,"LoadUbersplatHandle",function(){return Yn}),i.d(e,"LoadRegionHandle",function(){return Xn}),i.d(e,"LoadFogStateHandle",function(){return Jn}),i.d(e,"LoadFogModifierHandle",function(){return Zn}),i.d(e,"LoadHashtableHandle",function(){return Qn}),i.d(e,"HaveSavedInteger",function(){return tr}),i.d(e,"HaveSavedReal",function(){return er}),i.d(e,"HaveSavedBoolean",function(){return ir}),i.d(e,"HaveSavedString",function(){return nr}),i.d(e,"HaveSavedHandle",function(){return rr}),i.d(e,"RemoveSavedInteger",function(){return ar}),i.d(e,"RemoveSavedReal",function(){return sr}),i.d(e,"RemoveSavedBoolean",function(){return or}),i.d(e,"RemoveSavedString",function(){return lr}),i.d(e,"RemoveSavedHandle",function(){return hr}),i.d(e,"FlushParentHashtable",function(){return ur}),i.d(e,"FlushChildHashtable",function(){return cr}),i.d(e,"GetRandomInt",function(){return dr}),i.d(e,"GetRandomReal",function(){return fr}),i.d(e,"CreateCameraSetup",function(){return mr}),i.d(e,"CameraSetupSetField",function(){return gr}),i.d(e,"CameraSetupGetField",function(){return pr}),i.d(e,"CameraSetupSetDestPosition",function(){return vr}),i.d(e,"CameraSetupGetDestPositionLoc",function(){return br}),i.d(e,"CameraSetupGetDestPositionX",function(){return wr}),i.d(e,"CameraSetupGetDestPositionY",function(){return yr}),i.d(e,"AddWeatherEffect",function(){return Ar}),i.d(e,"RemoveWeatherEffect",function(){return _r}),i.d(e,"EnableWeatherEffect",function(){return xr})},function(t,e,i){"use strict";var n=i(2);class r extends n.a{constructor(t){super(t),this.health=0,this.maxHealth=0}}var a=i(8);i.d(e,"a",function(){return s});class s extends r{constructor(t,e,i,n,r,s){super(t);let o=t.mappedData.getRow(i);this.id=i,this.player=e,this.location=new a.a(t,n,r),this.face=s,this.acquireRange=500,o?(this.balanceRow=o,this.health=o.realHP,this.maxHealth=this.health,this.mana=parseFloat(o.realM)||0,this.maxMana=this.mana):t.debugMode&&console.log("Unknown unitid",i)}}},function(t,e,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,i){"use strict";var n={};(0,i(6).assign)(n,i(27),i(30),i(22)),t.exports=n},function(t,e,i){"use strict";t.exports=function(t,e,i,n){for(var r=65535&t|0,a=t>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{a=a+(r=r+e[n++]|0)|0}while(--s);r%=65521,a%=65521}return r|a<<16|0}},function(t,e,i){"use strict";var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();t.exports=function(t,e,i,r){var a=n,s=r+i;t^=-1;for(var o=r;o<s;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}},function(t,e,i){"use strict";var n=i(6),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new n.Buf8(256),o=0;o<256;o++)s[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(t,e){if(e<65534&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}s[254]=s[254]=1,e.string2buf=function(t){var e,i,r,a,s,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(l),s=0,a=0;s<l;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},e.buf2binstring=function(t){return l(t,t.length)},e.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},e.buf2string=function(t,e){var i,n,r,a,o=e||t.length,h=new Array(2*o);for(n=0,i=0;i<o;)if((r=t[i++])<128)h[n++]=r;else if((a=s[r])>4)h[n++]=65533,i+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&i<o;)r=r<<6|63&t[i++],a--;a>1?h[n++]=65533:r<65536?h[n++]=r:(r-=65536,h[n++]=55296|r>>10&1023,h[n++]=56320|1023&r)}return l(h,n)},e.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+s[t[i]]>e?i:e}},function(t,e,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,i){"use strict";let n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t){this.message="JPEG error: "+t}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}(),a=function(){let t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),e=4017,i=799,a=3406,s=2276,o=1567,l=3784,h=5793,u=2896;function c(){this.decodeTransform=null,this.colorTransform=-1}function d(t,e){let i,n,r=0,a=[],s=16;for(;s>0&&!t[s-1];)s--;a.push({children:[],index:0});let o,l=a[0];for(i=0;i<s;i++){for(n=0;n<t[i];n++){for((l=a.pop()).children[l.index]=e[r];l.index>0;)l=a.pop();for(l.index++,a.push(l);a.length<=i;)a.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o;r++}i+1<s&&(a.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o)}return a[0].children}function f(t,e,i){return 64*((t.blocksPerLine+1)*e+i)}function m(e,i,a,s,o,l,h,u,c){let d=a.mcusPerLine,m=a.progressive,g=i,p=0,b=0;function w(){if(b>0)return p>>--b&1;if(255===(p=e[i++])){let t=e[i++];if(t)throw new r("unexpected marker "+(p<<8|t).toString(16))}return b=7,p>>>7}function y(t){let e=t;for(;;){if("number"==typeof(e=e[w()]))return e;if("object"!==(void 0===e?"undefined":n(e)))throw new r("invalid huffman sequence")}}function A(t){let e=0;for(;t>0;)e=e<<1|w(),t--;return e}function _(t){if(1===t)return 1===w()?1:-1;let e=A(t);return e>=1<<t-1?e:e+(-1<<t)+1}let x=0;let T,E=0;function S(t,e,i,n,r){let a=i%d;e(t,f(t,(i/d|0)*t.v+n,a*t.h+r))}function M(t,e,i){e(t,f(t,i/t.blocksPerLine|0,i%t.blocksPerLine))}let R,I,B,C,L,U,k=s.length;U=m?0===l?0===u?function(t,e){let i=y(t.huffmanTableDC),n=0===i?0:_(i)<<c;t.blockData[e]=t.pred+=n}:function(t,e){t.blockData[e]|=w()<<c}:0===u?function(e,i){if(x>0)return void x--;let n=l,r=h;for(;n<=r;){let r=y(e.huffmanTableAC),a=15&r,s=r>>4;if(0===a){if(s<15){x=A(s)+(1<<s)-1;break}n+=16;continue}let o=t[n+=s];e.blockData[i+o]=_(a)*(1<<c),n++}}:function(e,i){let n,a,s=l,o=h,u=0;for(;s<=o;){let o=t[s];switch(E){case 0:if(u=(a=y(e.huffmanTableAC))>>4,0==(n=15&a))u<15?(x=A(u)+(1<<u),E=4):(u=16,E=1);else{if(1!==n)throw new r("invalid ACn encoding");T=_(n),E=u?2:3}continue;case 1:case 2:e.blockData[i+o]?e.blockData[i+o]+=w()<<c:0==--u&&(E=2===E?3:0);break;case 3:e.blockData[i+o]?e.blockData[i+o]+=w()<<c:(e.blockData[i+o]=T<<c,E=0);break;case 4:e.blockData[i+o]&&(e.blockData[i+o]+=w()<<c)}s++}4===E&&0==--x&&(E=0)}:function(e,i){let n=y(e.huffmanTableDC),r=0===n?0:_(n);e.blockData[i]=e.pred+=r;let a=1;for(;a<64;){let n=y(e.huffmanTableAC),r=15&n,s=n>>4;if(0===r){if(s<15)break;a+=16;continue}let o=t[a+=s];e.blockData[i+o]=_(r),a++}};let F,P,D,O,N=0;for(P=1===k?s[0].blocksPerLine*s[0].blocksPerColumn:d*a.mcusPerColumn;N<P;){let t=o?Math.min(P-N,o):P;for(I=0;I<k;I++)s[I].pred=0;if(x=0,1===k)for(R=s[0],L=0;L<t;L++)M(R,U,N),N++;else for(L=0;L<t;L++){for(I=0;I<k;I++)for(D=(R=s[I]).h,O=R.v,B=0;B<O;B++)for(C=0;C<D;C++)S(R,U,N,B,C);N++}b=0,(F=v(e,i))&&F.invalid&&(i=F.offset);let n=F&&F.marker;if(!n||n<=65280)throw new r("marker was not found");if(!(n>=65488&&n<=65495))break;i+=2}return(F=v(e,i))&&F.invalid&&(i=F.offset),i-g}function g(t,n,c){let d,f,m,g,p,v,b,w,y,A,_,x,T,E,S,M,R,I=t.quantizationTable,B=t.blockData;if(!I)throw new r("missing required Quantization Table.");for(let t=0;t<64;t+=8)y=B[n+t],A=B[n+t+1],_=B[n+t+2],x=B[n+t+3],T=B[n+t+4],E=B[n+t+5],S=B[n+t+6],M=B[n+t+7],y*=I[t],0!=(A|_|x|T|E|S|M)?(A*=I[t+1],_*=I[t+2],x*=I[t+3],T*=I[t+4],E*=I[t+5],S*=I[t+6],M*=I[t+7],f=(d=(d=h*y+128>>8)+(f=h*T+128>>8)+1>>1)-f,R=(m=_)*l+(g=S)*o+128>>8,m=m*o-g*l+128>>8,b=(p=(p=u*(A-M)+128>>8)+(b=E<<4)+1>>1)-b,v=(w=(w=u*(A+M)+128>>8)+(v=x<<4)+1>>1)-v,g=(d=d+(g=R)+1>>1)-g,m=(f=f+m+1>>1)-m,R=p*s+w*a+2048>>12,p=p*a-w*s+2048>>12,w=R,R=v*i+b*e+2048>>12,v=v*e-b*i+2048>>12,b=R,c[t]=d+w,c[t+7]=d-w,c[t+1]=f+b,c[t+6]=f-b,c[t+2]=m+v,c[t+5]=m-v,c[t+3]=g+p,c[t+4]=g-p):(R=h*y+512>>10,c[t]=R,c[t+1]=R,c[t+2]=R,c[t+3]=R,c[t+4]=R,c[t+5]=R,c[t+6]=R,c[t+7]=R);for(let t=0;t<8;++t)y=c[t],0!=((A=c[t+8])|(_=c[t+16])|(x=c[t+24])|(T=c[t+32])|(E=c[t+40])|(S=c[t+48])|(M=c[t+56]))?(f=(d=4112+((d=h*y+2048>>12)+(f=h*T+2048>>12)+1>>1))-f,R=(m=_)*l+(g=S)*o+2048>>12,m=m*o-g*l+2048>>12,g=R,b=(p=(p=u*(A-M)+2048>>12)+(b=E)+1>>1)-b,v=(w=(w=u*(A+M)+2048>>12)+(v=x)+1>>1)-v,R=p*s+w*a+2048>>12,p=p*a-w*s+2048>>12,w=R,R=v*i+b*e+2048>>12,v=v*e-b*i+2048>>12,y=(y=(d=d+g+1>>1)+w)<16?0:y>=4080?255:y>>4,A=(A=(f=f+m+1>>1)+(b=R))<16?0:A>=4080?255:A>>4,_=(_=(m=f-m)+v)<16?0:_>=4080?255:_>>4,x=(x=(g=d-g)+p)<16?0:x>=4080?255:x>>4,T=(T=g-p)<16?0:T>=4080?255:T>>4,E=(E=m-v)<16?0:E>=4080?255:E>>4,S=(S=f-b)<16?0:S>=4080?255:S>>4,M=(M=d-w)<16?0:M>=4080?255:M>>4,B[n+t]=y,B[n+t+8]=A,B[n+t+16]=_,B[n+t+24]=x,B[n+t+32]=T,B[n+t+40]=E,B[n+t+48]=S,B[n+t+56]=M):(R=(R=h*y+8192>>14)<-2040?0:R>=2024?255:R+2056>>4,B[n+t]=R,B[n+t+8]=R,B[n+t+16]=R,B[n+t+24]=R,B[n+t+32]=R,B[n+t+40]=R,B[n+t+48]=R,B[n+t+56]=R)}function p(t,e){let i=e.blocksPerLine,n=e.blocksPerColumn,r=new Int16Array(64);for(let t=0;t<n;t++)for(let n=0;n<i;n++){g(e,f(e,t,n),r)}return e.blockData}function v(t,e,i){function n(e){return t[e]<<8|t[e+1]}let r=t.length-1,a=i<e?i:e;if(e>=r)return null;let s=n(e);if(s>=65472&&s<=65534)return{invalid:null,marker:s,offset:e};let o=n(a);for(;!(o>=65472&&o<=65534);){if(++a>=r)return null;o=n(a)}return{invalid:s.toString(16),marker:o,offset:a}}return c.prototype={parse:function(e){function i(){let t=e[s]<<8|e[s+1];return s+=2,t}function n(){let t=i(),n=s+t-2,r=v(e,n,s);r&&r.invalid&&(n=r.offset);let a=e.subarray(s,n);return s+=a.length,a}function a(t){let e=Math.ceil(t.samplesPerLine/8/t.maxH),i=Math.ceil(t.scanLines/8/t.maxV);for(let n=0;n<t.components.length;n++){I=t.components[n];let r=Math.ceil(Math.ceil(t.samplesPerLine/8)*I.h/t.maxH),a=Math.ceil(Math.ceil(t.scanLines/8)*I.v/t.maxV),s=e*I.h,o=64*(i*I.v)*(s+1);I.blockData=new Int16Array(o),I.blocksPerLine=r,I.blocksPerColumn=a}t.mcusPerLine=e,t.mcusPerColumn=i}var s=0;let o,l,h=null,u=null,c=[],f=[],g=[],b=i();if(65496!==b)throw new r("SOI not found");for(b=i();65497!==b;){var w,y,A;switch(b){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var _=n();65504===b&&74===_[0]&&70===_[1]&&73===_[2]&&70===_[3]&&0===_[4]&&(h={version:{major:_[5],minor:_[6]},densityUnits:_[7],xDensity:_[8]<<8|_[9],yDensity:_[10]<<8|_[11],thumbWidth:_[12],thumbHeight:_[13],thumbData:_.subarray(14,14+3*_[12]*_[13])}),65518===b&&65===_[0]&&100===_[1]&&111===_[2]&&98===_[3]&&101===_[4]&&(u={version:_[5]<<8|_[6],flags0:_[7]<<8|_[8],flags1:_[9]<<8|_[10],transformCode:_[11]});break;case 65499:for(var x=i()+s-2;s<x;){let n=e[s++],a=new Uint16Array(64);if(n>>4==0)for(y=0;y<64;y++)a[t[y]]=e[s++];else{if(n>>4!=1)throw new r("DQT - invalid table spec");for(y=0;y<64;y++)a[t[y]]=i()}c[15&n]=a}break;case 65472:case 65473:case 65474:if(o)throw new r("Only single frame JPEGs supported");i(),(o={}).extended=65473===b,o.progressive=65474===b,o.precision=e[s++],o.scanLines=i(),o.samplesPerLine=i(),o.components=[],o.componentIds={};var T,E=e[s++],S=0,M=0;for(w=0;w<E;w++){T=e[s];let t=e[s+1]>>4,i=15&e[s+1];S<t&&(S=t),M<i&&(M=i);let n=e[s+2];A=o.components.push({h:t,v:i,quantizationId:n,quantizationTable:null}),o.componentIds[T]=A-1,s+=3}o.maxH=S,o.maxV=M,a(o);break;case 65476:var R=i();for(w=2;w<R;){let t=e[s++],i=new Uint8Array(16),n=0;for(y=0;y<16;y++,s++)n+=i[y]=e[s];let r=new Uint8Array(n);for(y=0;y<n;y++,s++)r[y]=e[s];w+=17+n,(t>>4==0?g:f)[15&t]=d(i,r)}break;case 65501:i(),l=i();break;case 65498:i();var I,B=e[s++],C=[];for(w=0;w<B;w++){let t=o.componentIds[e[s++]];I=o.components[t];let i=e[s++];I.huffmanTableDC=g[i>>4],I.huffmanTableAC=f[15&i],C.push(I)}var L=e[s++],U=e[s++],k=e[s++],F=m(e,s,o,C,l,L,U,k>>4,15&k);s+=F;break;case 65535:255!==e[s]&&s--;break;default:if(255===e[s-3]&&e[s-2]>=192&&e[s-2]<=254){s-=3;break}throw new r("unknown marker "+b.toString(16))}b=i()}for(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=h,this.adobe=u,this.components=[],w=0;w<o.components.length;w++){let t=c[(I=o.components[w]).quantizationId];t&&(I.quantizationTable=t),this.components.push({output:p(0,I),scaleX:I.h/o.maxH,scaleY:I.v/o.maxV,blocksPerLine:I.blocksPerLine,blocksPerColumn:I.blocksPerColumn})}this.numComponents=this.components.length},getData:function(t){let e=t.data,i=this.components,n=new Uint8Array((i[0].blocksPerLine<<3)*i[0].blocksPerColumn*8);[i[0],i[2]]=[i[2],i[0]];for(let t=0,o=i.length;t<o;t++){let l=i[t],h=l.blocksPerLine,u=l.blocksPerColumn,c=h<<3;var r,a,s=0;for(let t=0;t<u;t++){let e=t<<3;for(let i=0;i<h;i++){let o=f(l,t,i),h=0,u=i<<3;for(r=0;r<8;r++){s=(e+r)*c;for(a=0;a<8;a++)n[s+u+a]=l.output[o+h++]}}}let d=t;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e[d]=n[t*c+i],d+=o}return e}},c}();e.JpegImage=a},function(t,e,i){(function(i){var n,r,a;!function(s,o){"use strict";r=[],void 0===(a="function"==typeof(n=function(){var t;t="undefined"!=typeof Image?Image:(void 0).Image;var e="undefined"!=typeof window?window.document:{createElement:function(){return new(void 0)}},n={},r=n;var a=function(a){var s=1,o={red:255,green:0,blue:255,alpha:255},l={r:0,g:0,b:0,a:0};function h(t,e){return(Math.abs(t.r-e.r)+Math.abs(t.g-e.g)+Math.abs(t.b-e.b))/3}function u(t,e,i,n,r){return t>(r.left||0)&&t<(r.right||i)&&e>(r.top||0)&&e<(r.bottom||n)}var c,d,f,m={flat:function(t,e){t[e]=o.red,t[e+1]=o.green,t[e+2]=o.blue,t[e+3]=o.alpha},movement:function(t,e,i,n){t[e]=(n.r*(o.red/255)+o.red)/2,t[e+1]=(n.g*(o.green/255)+o.green)/2,t[e+2]=(n.b*(o.blue/255)+o.blue)/2,t[e+3]=n.a},flatDifferenceIntensity:function(t,e,i,n){t[e]=o.red,t[e+1]=o.green,t[e+2]=o.blue,t[e+3]=h(i,n)},movementDifferenceIntensity:function(t,e,i,n){var r=h(i,n)/255*.8;t[e]=(1-r)*(n.r*(o.red/255))+r*o.red,t[e+1]=(1-r)*(n.g*(o.green/255))+r*o.green,t[e+2]=(1-r)*(n.b*(o.blue/255))+r*o.blue,t[e+3]=n.a},diffOnly:function(t,e,i,n){t[e]=n.r,t[e+1]=n.g,t[e+2]=n.b,t[e+3]=n.a}},g=m.flat,p=1200,v=!0,b={},w=[],y=[],A={red:16,green:16,blue:16,alpha:16,minBrightness:16,maxBrightness:240},_=!1,x=!1,T=!1;function E(){var t,e=y.length;for(t=0;t<e;t++)"function"==typeof y[t]&&y[t](b)}function S(t,e,i){var n,r;for(n=0;n<t;n++)for(r=0;r<e;r++)i(n,r)}function M(n,r){var a,s=new t;s.setAttribute||(s.setAttribute=function(){}),v&&s.setAttribute("crossorigin","anonymous"),s.onerror=function(t){s.onload=null,s.onerror=null,w.push({error:t?t+"":"Image load error."}),r()},s.onload=function(){s.onload=null,s.onerror=null;var t,i=e.createElement("canvas"),n=s.width,a=s.height;T&&1===w.length&&(n=w[0].width,a=w[0].height),i.width=n,i.height=a,i.getContext("2d").drawImage(s,0,0,n,a),t=i.getContext("2d").getImageData(0,0,n,a),w.push(t),r(t,n,a)},"string"==typeof n?(s.src=n,s.complete&&s.naturalWidth>0&&s.onload()):void 0!==n.data&&"number"==typeof n.width&&"number"==typeof n.height?(w.push(n),r(n,n.width,n.height)):void 0!==i&&n instanceof i?s.src=n:((a=new FileReader).onload=function(t){s.src=t.target.result},a.readAsDataURL(n))}function R(t,e,i){var n=Math.abs(t-e);return void 0!==t&&(void 0!==e&&(t===e||n<A[i]))}function I(t,e){var i=R(t.a,e.a,"alpha"),n=R(t.brightness,e.brightness,"minBrightness");return n&&i}function B(t,e,i){return.3*t+.59*e+.11*i}function C(t,e){var i=t.r===e.r,n=t.g===e.g,r=t.b===e.b;return i&&n&&r}function L(t,e,i,n,r,a){var s,o,h,u,c=0,d=0,f=0;for(P(t),s=-1;s<=1;s++)for(o=-1;o<=1;o++)if(0===s&&0===o);else{if(!k(l,e,4*((n+o)*a+(r+s))))continue;if(F(l),P(l),h=t,u=l,Math.abs(h.brightness-u.brightness)>A.maxBrightness&&c++,C(t,l)&&f++,Math.abs(l.h-t.h)>.3&&d++,d>1||c>1)return!0}return f<2}function U(t,e,i){"diffOnly"!==c&&(t[e]=i.brightness,t[e+1]=i.brightness,t[e+2]=i.brightness,t[e+3]=i.a*s)}function k(t,e,i){return e.length>i&&(t.r=e[i],t.g=e[i+1],t.b=e[i+2],t.a=e[i+3],!0)}function F(t){t.brightness=B(t.r,t.g,t.b)}function P(t){t.h=function(t,e,i){var n,r,a=t/255,s=e/255,o=i/255,l=Math.max(a,s,o),h=Math.min(a,s,o);if(l===h)n=0;else switch(r=l-h,l){case a:n=(s-o)/r+(s<o?6:0);break;case s:n=(o-a)/r+2;break;case o:n=(a-s)/r+4;break;default:n/=6}return n}(t.r,t.g,t.b)}function D(t,i,n,r){var a=e.createElement("canvas"),o=t.data,l=i.data;a.width=n,a.height=r;var h,m=a.getContext("2d"),v=m.createImageData(n,r),w=v.data,y=0,A={top:r,left:n,bottom:0,right:0},T=function(t,e){A.left=Math.min(t,A.left),A.right=Math.max(t,A.right),A.top=Math.min(e,A.top),A.bottom=Math.max(e,A.bottom)},E=Date.now();p&&_&&(n>p||r>p)&&(h=6);var M={r:0,g:0,b:0,a:0},B={r:0,g:0,b:0,a:0};S(n,r,function(t,e){if(!h||e%h!=0&&t%h!=0){var i,a,m,p,v,b,A=4*(e*n+t),E=function(t,e,i,n){var r=!0;void 0===d||u(t,e,i,n,d)||(r=!1);void 0!==f&&u(t,e,i,n,f)&&(r=!1);return r}(t,e,n,r);if(k(M,o,A)&&k(B,l,A))return x?(F(M),F(B),void(I(M,B)||!E?U(w,A,B):(g(w,A,M,B),y++,T(t,e)))):(m=R((i=M).r,(a=B).r,"red"),p=R(i.g,a.g,"green"),v=R(i.b,a.b,"blue"),b=R(i.a,a.a,"alpha"),void(m&&p&&v&&b||!E?function(t,e,i){if("diffOnly"===c)return;t[e]=i.r,t[e+1]=i.g,t[e+2]=i.b,t[e+3]=i.a*s}(w,A,M):_&&(F(M),F(B),L(M,o,1,e,t,n)||L(B,l,2,e,t,n))&&(I(M,B)||!E)?U(w,A,B):(g(w,A,M,B),y++,T(t,e))))}}),b.rawMisMatchPercentage=y/(r*n)*100,b.misMatchPercentage=b.rawMisMatchPercentage.toFixed(2),b.diffBounds=A,b.analysisTime=Date.now()-E,b.getImageDataUrl=function(t){var e=0;return t&&(e=function(t,e,i){e.font="12px sans-serif";var n=e.measureText(t).width+4;n>i.width&&(i.width=n);return i.height+=22,e.fillStyle="#666",e.fillRect(0,0,i.width,18),e.fillStyle="#fff",e.fillRect(0,18,i.width,4),e.fillStyle="#fff",e.textBaseline="top",e.font="12px sans-serif",e.fillText(t,2,1),22}(t,m,a)),m.putImageData(v,0,e),a.toDataURL("image/png")},a.toBuffer&&(b.getBuffer=function(e){if(e){var n=a.width+2;a.width=3*n,m.putImageData(t,0,0),m.putImageData(i,n,0),m.putImageData(v,2*n,0)}else m.putImageData(v,0,0);return a.toBuffer()})}function O(t,i,n){var r,a;return t.height<n||t.width<i?((r=e.createElement("canvas")).width=i,r.height=n,(a=r.getContext("2d")).putImageData(t,0,0),a.getImageData(0,0,i,n)):t}function N(t){var e;if(t.errorColor)for(e in t.errorColor)t.errorColor.hasOwnProperty(e)&&(o[e]=void 0===t.errorColor[e]?o[e]:t.errorColor[e]);t.errorType&&m[t.errorType]&&(g=m[t.errorType],c=t.errorType),t.errorPixel&&"function"==typeof t.errorPixel&&(g=t.errorPixel),s=isNaN(Number(t.transparency))?s:t.transparency,void 0!==t.largeImageThreshold&&(p=t.largeImageThreshold),void 0!==t.useCrossOrigin&&(v=t.useCrossOrigin),void 0!==t.boundingBox&&(d=t.boundingBox),void 0!==t.ignoredBox&&(f=t.ignoredBox)}function V(t){var e,i="function"==typeof t;i||(e=t);var s={scaleToSameSize:function(){return T=!0,i&&t(),s},useOriginalSize:function(){return T=!1,i&&t(),s},ignoreNothing:function(){return A.red=0,A.green=0,A.blue=0,A.alpha=0,A.minBrightness=0,A.maxBrightness=255,_=!1,x=!1,i&&t(),s},ignoreLess:function(){return A.red=16,A.green=16,A.blue=16,A.alpha=16,A.minBrightness=16,A.maxBrightness=240,_=!1,x=!1,i&&t(),s},ignoreAntialiasing:function(){return A.red=32,A.green=32,A.blue=32,A.alpha=32,A.minBrightness=64,A.maxBrightness=96,_=!0,x=!1,i&&t(),s},ignoreColors:function(){return A.alpha=16,A.minBrightness=16,A.maxBrightness=240,_=!1,x=!0,i&&t(),s},ignoreAlpha:function(){return A.red=16,A.green=16,A.blue=16,A.alpha=255,A.minBrightness=16,A.maxBrightness=240,_=!1,x=!1,i&&t(),s},repaint:function(){return i&&t(),s},outputSettings:function(t){return N(t),s},onComplete:function(t){y.push(t);var i=function(){!function(t,e){r!==n&&N(r);function i(){var t,e;if(2===w.length){if(w[0].error||w[1].error)return(b={}).error=w[0].error?w[0].error:w[1].error,void E();t=w[0].width>w[1].width?w[0].width:w[1].width,e=w[0].height>w[1].height?w[0].height:w[1].height,w[0].width===w[1].width&&w[0].height===w[1].height?b.isSameDimensions=!0:b.isSameDimensions=!1,b.dimensionDifference={width:w[0].width-w[1].width,height:w[0].height-w[1].height},D(O(w[0],t,e),O(w[1],t,e),t,e),E()}}w=[],M(t,i),M(e,i)}(a,e)};return i(),V(i)}};return s}var G={onComplete:function(t){y.push(t),M(a,function(t,e,i){!function(t,e,i){var n=0,r=0,a=0,s=0,o=0,l=0,h=0,u=0;S(e,i,function(i,c){var d=4*(c*e+i),f=t[d],m=t[d+1],g=t[d+2],p=t[d+3],v=B(f,m,g);f===m&&f===g&&p&&(0===f?u++:255===f&&h++),n++,r+=f/255*100,a+=m/255*100,s+=g/255*100,o+=(255-p)/255*100,l+=v/255*100}),b.red=Math.floor(r/n),b.green=Math.floor(a/n),b.blue=Math.floor(s/n),b.alpha=Math.floor(o/n),b.brightness=Math.floor(l/n),b.white=Math.floor(h/n*100),b.black=Math.floor(u/n*100),E()}(t.data,e,i)})},compareTo:function(t){return V(t)},outputSettings:function(t){return N(t),G}};return G};function s(t,e){switch(e){case"nothing":t.ignoreNothing();break;case"less":t.ignoreLess();break;case"antialiasing":t.ignoreAntialiasing();break;case"colors":t.ignoreColors();break;case"alpha":t.ignoreAlpha();break;default:throw new Error("Invalid ignore: "+e)}}return a.compare=function(t,e,i,n){var r,o;"function"==typeof i?(r=i,o={}):(r=n,o=i||{});var l,h=a(t);o.output&&h.outputSettings(o.output),l=h.compareTo(e),o.scaleToSameSize&&l.scaleToSameSize(),"string"==typeof o.ignore?s(l,o.ignore):o.ignore&&o.ignore.forEach&&o.ignore.forEach(function(t){s(l,t)}),l.onComplete(function(t){t.error?r(t.error):r(null,t)})},a.outputSettings=function(t){return console.warn("warning resemble.outputSettings mutates global state, and will be removed in 3.0.0"),r=t,this},a})?n.apply(e,r):n)||(t.exports=a)}()}).call(this,i(35).Buffer)},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i(2);class r extends n.a{constructor(t,e,i){super(t),this.index=e,this.name=`Player ${e}`,this.team=-1,this.startLocation=-1,this.forcedStartLocation=-1,this.color=null,this.racePreference=null,this.raceSelectable=!1,this.controller=null,this.alliances=new Map;for(let t=0;t<i;t++)t!==e&&this.alliances.set(t,{passive:!1,helpRequest:!1,helpResponse:!1,sharedXp:!1,sharedSpells:!1,sharedVision:!1,sharedControl:!1,sharedAdvancedControl:!1,rescuable:!1,sharedVisionForced:!1})}toString(){return`Player(${this.index})`}}},function(t,e,i){"use strict";var n=i(5);class r extends n.a{constructor(t,e){super(t),this.handleId=e}}class a extends r{}class s extends r{}class o extends r{}class l extends r{}class h extends r{}class u extends r{}class c extends r{}class d extends r{}class f extends r{}class m extends r{}class g extends r{}class p extends r{}class v extends r{}class b extends r{}class w extends r{}class y extends r{}class A extends r{}class _ extends r{}class x extends r{}class T extends r{}class E extends r{}class S extends E{}class M extends E{}class R extends r{}class I extends r{}class B extends r{}class C extends r{}class L extends r{}class U extends L{}class k extends L{}class F extends L{}class P extends L{}class D extends L{}class O extends L{}class N extends L{}class V extends r{}class G extends r{}class j extends r{}class H extends r{}class $ extends r{}class q extends r{}class z extends r{}class K extends r{}class W extends r{}function Y(t){let e={playerColors:[],races:[],playerGameResults:[],allianceTypes:[],versions:[],attackTypes:[],damageTypes:[],weaponTypes:[],pathingTypes:[],racePreferences:[],mapControls:[],gameTypes:[],mapFlags:[],placements:[],startLocPrios:[],mapDensities:[],gameDifficulties:[],gameSpeeds:[],playerSlotStates:[],volumeGroups:[],iGameStates:[],fGameStates:[],playerStates:[],unitStates:[],aiDifficulties:[],playerScores:[],events:[],limitOps:[],unitTypes:[],itemTypes:[],cameraFields:[],blendModes:[],rarityControls:[],texMapFlags:[],fogStates:[],effectTypes:[],soundTypes:[]};for(let i=0;i<12;i++)e.playerColors[i]=new a(t,i);for(let i=1;i<8;i++)e.races[i]=new s(t,i);for(let i=0;i<4;i++)e.playerGameResults[i]=new o(t,i);for(let i=0;i<10;i++)e.allianceTypes[i]=new l(t,i);for(let i=0;i<2;i++)e.versions[i]=new h(t,i);for(let i=0;i<7;i++)e.attackTypes[i]=new u(t,i);for(let i=0;i<27;i++)e.damageTypes[i]=new c(t,i);for(let i=0;i<24;i++)e.weaponTypes[i]=new d(t,i);for(let i=0;i<8;i++)e.pathingTypes[i]=new f(t,i);for(let i=0;i<7;i++)e.racePreferences[i]=new m(t,Math.pow(2,i));for(let i=0;i<6;i++)e.mapControls[i]=new g(t,i);for(let i=0;i<8;i++)e.gameTypes[i]=new p(t,Math.pow(2,i));for(let i=0;i<19;i++)e.mapFlags[i]=new v(t,Math.pow(2,i));for(let i=0;i<4;i++)e.placements[i]=new b(t,i);for(let i=0;i<3;i++)e.startLocPrios[i]=new w(t,i);for(let i=0;i<4;i++)e.mapDensities[i]=new y(t,i);for(let i=0;i<4;i++)e.gameDifficulties[i]=new A(t,i);for(let i=0;i<5;i++)e.gameSpeeds[i]=new _(t,i);for(let i=0;i<3;i++)e.playerSlotStates[i]=new x(t,i);for(let i=0;i<8;i++)e.volumeGroups[i]=new T(t,i);for(let i=0;i<2;i++)e.iGameStates[i]=new S(t,i);for(let i=2;i<3;i++)e.fGameStates[i]=new M(t,i);for(let i=0;i<26;i++)e.playerStates[i]=new R(t,i);for(let i=0;i<4;i++)e.unitStates[i]=new I(t,i);for(let i=0;i<3;i++)e.aiDifficulties[i]=new B(t,i);for(let i=0;i<25;i++)e.playerScores[i]=new C(t,i);for(let i=0;i<11;i++)e.events[i]=new U(t,i);for(let i=11;i<18;i++)e.events[i]=new k(t,i);for(let i=18;i<52;i++)e.events[i]=new F(t,i);for(let i=52;i<89;i++)e.events[i]=new P(t,i);for(let i=89;i<90;i++)e.events[i]=new D(t,i);for(let i=90;i<92;i++)e.events[i]=new O(t,i);for(let i=90;i<92;i++)e.events[i]=new O(t,i);for(let i=256;i<260;i++)e.events[i]=new U(t,i);for(let i=261;i<269;i++)e.events[i]=new k(t,i);for(let i=269;i<278;i++)e.events[i]=new F(t,i);for(let i=286;i<295;i++)e.events[i]=new P(t,i);for(let i=0;i<6;i++)e.limitOps[i]=new N(t,i);for(let i=0;i<27;i++)e.unitTypes[i]=new V(t,i);for(let i=0;i<9;i++)e.itemTypes[i]=new G(t,i);for(let i=0;i<7;i++)e.cameraFields[i]=new j(t,i);for(let i=0;i<6;i++)e.blendModes[i]=new H(t,i);for(let i=0;i<1;i++)e.rarityControls[i]=new $(t,i);for(let i=0;i<4;i++)e.texMapFlags[i]=new q(t,i);for(let i=0;i<3;i++)e.fogStates[i]=new z(t,Math.pow(2,i));for(let i=0;i<7;i++)e.effectTypes[i]=new K(t,i);for(let i=0;i<2;i++)e.soundTypes[i]=new W(t,i);return e}i.d(e,"a",function(){return Y})},function(t,e,i){"use strict";var n=i(28),r=i(6),a=i(20),s=i(16),o=i(21),l=Object.prototype.toString,h=0,u=-1,c=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=r.assign({level:u,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==h)throw new Error(s[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var m;if(m="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=n.deflateSetDictionary(this.strm,m))!==h)throw new Error(s[i]);this._dict_set=!0}}function m(t,e){var i=new f(e);if(i.push(t,!0),i.err)throw i.msg||s[i.err];return i.result}f.prototype.push=function(t,e){var i,s,o=this.strm,u=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=a.string2buf(t):"[object ArrayBuffer]"===l.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(u),o.next_out=0,o.avail_out=u),1!==(i=n.deflate(o,s))&&i!==h)return this.onEnd(i),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==i);return 4===s?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==s||(this.onEnd(h),o.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=f,e.deflate=m,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,m(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,m(t,e)}},function(t,e,i){"use strict";var n,r=i(6),a=i(29),s=i(18),o=i(19),l=i(16),h=0,u=1,c=3,d=4,f=5,m=0,g=1,p=-2,v=-3,b=-5,w=-1,y=1,A=2,_=3,x=4,T=0,E=2,S=8,M=9,R=15,I=8,B=286,C=30,L=19,U=2*B+1,k=15,F=3,P=258,D=P+F+1,O=32,N=42,V=69,G=73,j=91,H=103,$=113,q=666,z=1,K=2,W=3,Y=4,X=3;function J(t,e){return t.msg=l[e],e}function Z(t){return(t<<1)-(t>4?9:0)}function Q(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function et(t,e){a._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function nt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function rt(t,e){var i,n,r=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-D?t.strstart-(t.w_size-D):0,h=t.window,u=t.w_mask,c=t.prev,d=t.strstart+P,f=h[a+s-1],m=h[a+s];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+s]===m&&h[i+s-1]===f&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do{}while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<d);if(n=P-(d-a),a=d-P,n>s){if(t.match_start=e,s=n,n>=o)break;f=h[a+s-1],m=h[a+s]}}}while((e=c[e&u])>l&&0!=--r);return s<=t.lookahead?s:t.lookahead}function at(t){var e,i,n,a,l,h,u,c,d,f,m=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=m+(m-D)){r.arraySet(t.window,t.window,m,m,0),t.match_start-=m,t.strstart-=m,t.block_start-=m,e=i=t.hash_size;do{n=t.head[--e],t.head[e]=n>=m?n-m:0}while(--i);e=i=m;do{n=t.prev[--e],t.prev[e]=n>=m?n-m:0}while(--i);a+=m}if(0===t.strm.avail_in)break;if(h=t.strm,u=t.window,c=t.strstart+t.lookahead,d=a,f=void 0,(f=h.avail_in)>d&&(f=d),i=0===f?0:(h.avail_in-=f,r.arraySet(u,h.input,h.next_in,f,c),1===h.state.wrap?h.adler=s(h.adler,u,f,c):2===h.state.wrap&&(h.adler=o(h.adler,u,f,c)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=F)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+F-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<F)););}while(t.lookahead<D&&0!==t.strm.avail_in)}function st(t,e){for(var i,n;;){if(t.lookahead<D){if(at(t),t.lookahead<D&&e===h)return z;if(0===t.lookahead)break}if(i=0,t.lookahead>=F&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-D&&(t.match_length=rt(t,i)),t.match_length>=F)if(n=a._tr_tally(t,t.strstart-t.match_start,t.match_length-F),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=F){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(et(t,!1),0===t.strm.avail_out))return z}return t.insert=t.strstart<F-1?t.strstart:F-1,e===d?(et(t,!0),0===t.strm.avail_out?W:Y):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?z:K}function ot(t,e){for(var i,n,r;;){if(t.lookahead<D){if(at(t),t.lookahead<D&&e===h)return z;if(0===t.lookahead)break}if(i=0,t.lookahead>=F&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=F-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-D&&(t.match_length=rt(t,i),t.match_length<=5&&(t.strategy===y||t.match_length===F&&t.strstart-t.match_start>4096)&&(t.match_length=F-1)),t.prev_length>=F&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-F,n=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-F),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=F-1,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return z}else if(t.match_available){if((n=a._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return z}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<F-1?t.strstart:F-1,e===d?(et(t,!0),0===t.strm.avail_out?W:Y):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?z:K}function lt(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function ht(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*U),this.dyn_dtree=new r.Buf16(2*(2*C+1)),this.bl_tree=new r.Buf16(2*(2*L+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(k+1),this.heap=new r.Buf16(2*B+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*B+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ut(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=E,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?N:$,t.adler=2===e.wrap?0:1,e.last_flush=h,a._tr_init(e),m):J(t,p)}function ct(t){var e,i=ut(t);return i===m&&((e=t.state).window_size=2*e.w_size,Q(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=F-1,e.match_available=0,e.ins_h=0),i}function dt(t,e,i,n,a,s){if(!t)return p;var o=1;if(e===w&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>M||i!==S||n<8||n>15||e<0||e>9||s<0||s>x)return J(t,p);8===n&&(n=9);var l=new ht;return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+F-1)/F),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=i,ct(t)}n=[new lt(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(at(t),0===t.lookahead&&e===h)return z;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,et(t,!1),0===t.strm.avail_out))return z;if(t.strstart-t.block_start>=t.w_size-D&&(et(t,!1),0===t.strm.avail_out))return z}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?W:Y):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),z)}),new lt(4,4,8,4,st),new lt(4,5,16,8,st),new lt(4,6,32,32,st),new lt(4,4,16,16,ot),new lt(8,16,32,32,ot),new lt(8,16,128,128,ot),new lt(8,32,128,256,ot),new lt(32,128,258,1024,ot),new lt(32,258,258,4096,ot)],e.deflateInit=function(t,e){return dt(t,e,S,R,I,T)},e.deflateInit2=dt,e.deflateReset=ct,e.deflateResetKeep=ut,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?p:(t.state.gzhead=e,m):p},e.deflate=function(t,e){var i,r,s,l;if(!t||!t.state||e>f||e<0)return t?J(t,p):p;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===q&&e!==d)return J(t,0===t.avail_out?b:p);if(r.strm=t,i=r.last_flush,r.last_flush=e,r.status===N)if(2===r.wrap)t.adler=0,it(r,31),it(r,139),it(r,8),r.gzhead?(it(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),it(r,255&r.gzhead.time),it(r,r.gzhead.time>>8&255),it(r,r.gzhead.time>>16&255),it(r,r.gzhead.time>>24&255),it(r,9===r.level?2:r.strategy>=A||r.level<2?4:0),it(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(it(r,255&r.gzhead.extra.length),it(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=V):(it(r,0),it(r,0),it(r,0),it(r,0),it(r,0),it(r,9===r.level?2:r.strategy>=A||r.level<2?4:0),it(r,X),r.status=$);else{var v=S+(r.w_bits-8<<4)<<8;v|=(r.strategy>=A||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(v|=O),v+=31-v%31,r.status=$,nt(r,v),0!==r.strstart&&(nt(r,t.adler>>>16),nt(r,65535&t.adler)),t.adler=1}if(r.status===V)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending!==r.pending_buf_size));)it(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=G)}else r.status=G;if(r.status===G)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,it(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.gzindex=0,r.status=j)}else r.status=j;if(r.status===j)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,it(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.status=H)}else r.status=H;if(r.status===H&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&tt(t),r.pending+2<=r.pending_buf_size&&(it(r,255&t.adler),it(r,t.adler>>8&255),t.adler=0,r.status=$)):r.status=$),0!==r.pending){if(tt(t),0===t.avail_out)return r.last_flush=-1,m}else if(0===t.avail_in&&Z(e)<=Z(i)&&e!==d)return J(t,b);if(r.status===q&&0!==t.avail_in)return J(t,b);if(0!==t.avail_in||0!==r.lookahead||e!==h&&r.status!==q){var w=r.strategy===A?function(t,e){for(var i;;){if(0===t.lookahead&&(at(t),0===t.lookahead)){if(e===h)return z;break}if(t.match_length=0,i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(et(t,!1),0===t.strm.avail_out))return z}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?W:Y):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?z:K}(r,e):r.strategy===_?function(t,e){for(var i,n,r,s,o=t.window;;){if(t.lookahead<=P){if(at(t),t.lookahead<=P&&e===h)return z;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=F&&t.strstart>0&&(n=o[r=t.strstart-1])===o[++r]&&n===o[++r]&&n===o[++r]){s=t.strstart+P;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<s);t.match_length=P-(s-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=F?(i=a._tr_tally(t,1,t.match_length-F),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(et(t,!1),0===t.strm.avail_out))return z}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?W:Y):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?z:K}(r,e):n[r.level].func(r,e);if(w!==W&&w!==Y||(r.status=q),w===z||w===W)return 0===t.avail_out&&(r.last_flush=-1),m;if(w===K&&(e===u?a._tr_align(r):e!==f&&(a._tr_stored_block(r,0,0,!1),e===c&&(Q(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),tt(t),0===t.avail_out))return r.last_flush=-1,m}return e!==d?m:r.wrap<=0?g:(2===r.wrap?(it(r,255&t.adler),it(r,t.adler>>8&255),it(r,t.adler>>16&255),it(r,t.adler>>24&255),it(r,255&t.total_in),it(r,t.total_in>>8&255),it(r,t.total_in>>16&255),it(r,t.total_in>>24&255)):(nt(r,t.adler>>>16),nt(r,65535&t.adler)),tt(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?m:g)},e.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==N&&e!==V&&e!==G&&e!==j&&e!==H&&e!==$&&e!==q?J(t,p):(t.state=null,e===$?J(t,v):m):p},e.deflateSetDictionary=function(t,e){var i,n,a,o,l,h,u,c,d=e.length;if(!t||!t.state)return p;if(2===(o=(i=t.state).wrap)||1===o&&i.status!==N||i.lookahead)return p;for(1===o&&(t.adler=s(t.adler,e,d,0)),i.wrap=0,d>=i.w_size&&(0===o&&(Q(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new r.Buf8(i.w_size),r.arraySet(c,e,d-i.w_size,i.w_size,0),e=c,d=i.w_size),l=t.avail_in,h=t.next_in,u=t.input,t.avail_in=d,t.next_in=0,t.input=e,at(i);i.lookahead>=F;){n=i.strstart,a=i.lookahead-(F-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+F-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--a);i.strstart=n,i.lookahead=F-1,at(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=F-1,i.match_available=0,t.next_in=h,t.input=u,t.avail_in=l,i.wrap=o,m},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,i){"use strict";var n=i(6),r=4,a=0,s=1,o=2;function l(t){for(var e=t.length;--e>=0;)t[e]=0}var h=0,u=1,c=2,d=29,f=256,m=f+1+d,g=30,p=19,v=2*m+1,b=15,w=16,y=7,A=256,_=16,x=17,T=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=new Array(2*(m+2));l(I);var B=new Array(2*g);l(B);var C=new Array(512);l(C);var L=new Array(256);l(L);var U=new Array(d);l(U);var k,F,P,D=new Array(g);function O(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function N(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function V(t){return t<256?C[t]:C[256+(t>>>7)]}function G(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function j(t,e,i){t.bi_valid>w-i?(t.bi_buf|=e<<t.bi_valid&65535,G(t,t.bi_buf),t.bi_buf=e>>w-t.bi_valid,t.bi_valid+=i-w):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function H(t,e,i){j(t,i[2*e],i[2*e+1])}function $(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function q(t,e,i){var n,r,a=new Array(b+1),s=0;for(n=1;n<=b;n++)a[n]=s=s+i[n-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=$(a[o]++,o))}}function z(t){var e;for(e=0;e<m;e++)t.dyn_ltree[2*e]=0;for(e=0;e<g;e++)t.dyn_dtree[2*e]=0;for(e=0;e<p;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*A]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function K(t){t.bi_valid>8?G(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function W(t,e,i,n){var r=2*e,a=2*i;return t[r]<t[a]||t[r]===t[a]&&n[e]<=n[i]}function Y(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&W(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!W(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function X(t,e,i){var n,r,a,s,o=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],r=t.pending_buf[t.l_buf+o],o++,0===n?H(t,r,e):(H(t,(a=L[r])+f+1,e),0!==(s=E[a])&&j(t,r-=U[a],s),H(t,a=V(--n),i),0!==(s=S[a])&&j(t,n-=D[a],s))}while(o<t.last_lit);H(t,A,e)}function J(t,e){var i,n,r,a=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=v,i=0;i<l;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=s[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)Y(t,a,i);r=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Y(t,a,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,a[2*r]=a[2*i]+a[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,a[2*i+1]=a[2*n+1]=r,t.heap[1]=r++,Y(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,a,s,o,l=e.dyn_tree,h=e.max_code,u=e.stat_desc.static_tree,c=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,m=e.stat_desc.max_length,g=0;for(a=0;a<=b;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<v;i++)(a=l[2*l[2*(n=t.heap[i])+1]+1]+1)>m&&(a=m,g++),l[2*n+1]=a,n>h||(t.bl_count[a]++,s=0,n>=f&&(s=d[n-f]),o=l[2*n],t.opt_len+=o*(a+s),c&&(t.static_len+=o*(u[2*n+1]+s)));if(0!==g){do{for(a=m-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[m]--,g-=2}while(g>0);for(a=m;0!==a;a--)for(n=t.bl_count[a];0!==n;)(r=t.heap[--i])>h||(l[2*r+1]!==a&&(t.opt_len+=(a-l[2*r+1])*l[2*r],l[2*r+1]=a),n--)}}(t,e),q(a,h,t.bl_count)}function Z(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=s,s=e[2*(n+1)+1],++o<l&&r===s||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*_]++):o<=10?t.bl_tree[2*x]++:t.bl_tree[2*T]++,o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4))}function Q(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=i;n++)if(r=s,s=e[2*(n+1)+1],!(++o<l&&r===s)){if(o<h)do{H(t,r,t.bl_tree)}while(0!=--o);else 0!==r?(r!==a&&(H(t,r,t.bl_tree),o--),H(t,_,t.bl_tree),j(t,o-3,2)):o<=10?(H(t,x,t.bl_tree),j(t,o-3,3)):(H(t,T,t.bl_tree),j(t,o-11,7));o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4)}}l(D);var tt=!1;function et(t,e,i,r){j(t,(h<<1)+(r?1:0),3),function(t,e,i,r){K(t),r&&(G(t,i),G(t,~i)),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}e._tr_init=function(t){tt||(function(){var t,e,i,n,r,a=new Array(b+1);for(i=0,n=0;n<d-1;n++)for(U[n]=i,t=0;t<1<<E[n];t++)L[i++]=n;for(L[i-1]=n,r=0,n=0;n<16;n++)for(D[n]=r,t=0;t<1<<S[n];t++)C[r++]=n;for(r>>=7;n<g;n++)for(D[n]=r<<7,t=0;t<1<<S[n]-7;t++)C[256+r++]=n;for(e=0;e<=b;e++)a[e]=0;for(t=0;t<=143;)I[2*t+1]=8,t++,a[8]++;for(;t<=255;)I[2*t+1]=9,t++,a[9]++;for(;t<=279;)I[2*t+1]=7,t++,a[7]++;for(;t<=287;)I[2*t+1]=8,t++,a[8]++;for(q(I,m+1,a),t=0;t<g;t++)B[2*t+1]=5,B[2*t]=$(t,5);k=new O(I,E,f+1,m,b),F=new O(B,S,0,g,b),P=new O(new Array(0),M,0,p,y)}(),tt=!0),t.l_desc=new N(t.dyn_ltree,k),t.d_desc=new N(t.dyn_dtree,F),t.bl_desc=new N(t.bl_tree,P),t.bi_buf=0,t.bi_valid=0,z(t)},e._tr_stored_block=et,e._tr_flush_block=function(t,e,i,n){var l,h,d=0;t.level>0?(t.strm.data_type===o&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return a;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return s;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return s;return a}(t)),J(t,t.l_desc),J(t,t.d_desc),d=function(t){var e;for(Z(t,t.dyn_ltree,t.l_desc.max_code),Z(t,t.dyn_dtree,t.d_desc.max_code),J(t,t.bl_desc),e=p-1;e>=3&&0===t.bl_tree[2*R[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),l=t.opt_len+3+7>>>3,(h=t.static_len+3+7>>>3)<=l&&(l=h)):l=h=i+5,i+4<=l&&-1!==e?et(t,e,i,n):t.strategy===r||h===l?(j(t,(u<<1)+(n?1:0),3),X(t,I,B)):(j(t,(c<<1)+(n?1:0),3),function(t,e,i,n){var r;for(j(t,e-257,5),j(t,i-1,5),j(t,n-4,4),r=0;r<n;r++)j(t,t.bl_tree[2*R[r]+1],3);Q(t,t.dyn_ltree,e-1),Q(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),X(t,t.dyn_ltree,t.dyn_dtree)),z(t),n&&K(t)},e._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(L[i]+f+1)]++,t.dyn_dtree[2*V(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){j(t,u<<1,3),H(t,A,I),function(t){16===t.bi_valid?(G(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,i){"use strict";var n=i(31),r=i(6),a=i(20),s=i(22),o=i(16),l=i(21),h=i(34),u=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==s.Z_OK)throw new Error(o[i]);if(this.header=new h,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=a.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=n.inflateSetDictionary(this.strm,e.dictionary))!==s.Z_OK))throw new Error(o[i])}function d(t,e){var i=new c(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}c.prototype.push=function(t,e){var i,o,l,h,c,d=this.strm,f=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?d.input=a.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new r.Buf8(f),d.next_out=0,d.avail_out=f),(i=n.inflate(d,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&m&&(i=n.inflateSetDictionary(this.strm,m)),i===s.Z_BUF_ERROR&&!0===g&&(i=s.Z_OK,g=!1),i!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&i!==s.Z_STREAM_END&&(0!==d.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),h=d.next_out-l,c=a.buf2string(d.output,l),d.next_out=h,d.avail_out=f-h,h&&r.arraySet(d.output,d.output,l,h,0),this.onData(c)):this.onData(r.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),d.avail_out=0,!0)},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=c,e.inflate=d,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.ungzip=d},function(t,e,i){"use strict";var n=i(6),r=i(18),a=i(19),s=i(32),o=i(33),l=0,h=1,u=2,c=4,d=5,f=6,m=0,g=1,p=2,v=-2,b=-3,w=-4,y=-5,A=8,_=1,x=2,T=3,E=4,S=5,M=6,R=7,I=8,B=9,C=10,L=11,U=12,k=13,F=14,P=15,D=16,O=17,N=18,V=19,G=20,j=21,H=22,$=23,q=24,z=25,K=26,W=27,Y=28,X=29,J=30,Z=31,Q=32,tt=852,et=592,it=15;function nt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function rt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function at(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=_,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(tt),e.distcode=e.distdyn=new n.Buf32(et),e.sane=1,e.back=-1,m):v}function st(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,at(t)):v}function ot(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?v:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,st(t))):v}function lt(t,e){var i,n;return t?(n=new rt,t.state=n,n.window=null,(i=ot(t,e))!==m&&(t.state=null),i):v}var ht,ut,ct=!0;function dt(t){if(ct){var e;for(ht=new n.Buf32(512),ut=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(h,t.lens,0,288,ht,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(u,t.lens,0,32,ut,0,t.work,{bits:5}),ct=!1}t.lencode=ht,t.lenbits=9,t.distcode=ut,t.distbits=5}function ft(t,e,i,r){var a,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),r>=s.wsize?(n.arraySet(s.window,e,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((a=s.wsize-s.wnext)>r&&(a=r),n.arraySet(s.window,e,i-r,a,s.wnext),(r-=a)?(n.arraySet(s.window,e,i-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}e.inflateReset=st,e.inflateReset2=ot,e.inflateResetKeep=at,e.inflateInit=function(t){return lt(t,it)},e.inflateInit2=lt,e.inflate=function(t,e){var i,tt,et,it,rt,at,st,ot,lt,ht,ut,ct,mt,gt,pt,vt,bt,wt,yt,At,_t,xt,Tt,Et,St=0,Mt=new n.Buf8(4),Rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return v;(i=t.state).mode===U&&(i.mode=k),rt=t.next_out,et=t.output,st=t.avail_out,it=t.next_in,tt=t.input,at=t.avail_in,ot=i.hold,lt=i.bits,ht=at,ut=st,xt=m;t:for(;;)switch(i.mode){case _:if(0===i.wrap){i.mode=k;break}for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(2&i.wrap&&35615===ot){i.check=0,Mt[0]=255&ot,Mt[1]=ot>>>8&255,i.check=a(i.check,Mt,2,0),ot=0,lt=0,i.mode=x;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&ot)<<8)+(ot>>8))%31){t.msg="incorrect header check",i.mode=J;break}if((15&ot)!==A){t.msg="unknown compression method",i.mode=J;break}if(lt-=4,_t=8+(15&(ot>>>=4)),0===i.wbits)i.wbits=_t;else if(_t>i.wbits){t.msg="invalid window size",i.mode=J;break}i.dmax=1<<_t,t.adler=i.check=1,i.mode=512&ot?C:U,ot=0,lt=0;break;case x:for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(i.flags=ot,(255&i.flags)!==A){t.msg="unknown compression method",i.mode=J;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=J;break}i.head&&(i.head.text=ot>>8&1),512&i.flags&&(Mt[0]=255&ot,Mt[1]=ot>>>8&255,i.check=a(i.check,Mt,2,0)),ot=0,lt=0,i.mode=T;case T:for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.head&&(i.head.time=ot),512&i.flags&&(Mt[0]=255&ot,Mt[1]=ot>>>8&255,Mt[2]=ot>>>16&255,Mt[3]=ot>>>24&255,i.check=a(i.check,Mt,4,0)),ot=0,lt=0,i.mode=E;case E:for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.head&&(i.head.xflags=255&ot,i.head.os=ot>>8),512&i.flags&&(Mt[0]=255&ot,Mt[1]=ot>>>8&255,i.check=a(i.check,Mt,2,0)),ot=0,lt=0,i.mode=S;case S:if(1024&i.flags){for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.length=ot,i.head&&(i.head.extra_len=ot),512&i.flags&&(Mt[0]=255&ot,Mt[1]=ot>>>8&255,i.check=a(i.check,Mt,2,0)),ot=0,lt=0}else i.head&&(i.head.extra=null);i.mode=M;case M:if(1024&i.flags&&((ct=i.length)>at&&(ct=at),ct&&(i.head&&(_t=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,tt,it,ct,_t)),512&i.flags&&(i.check=a(i.check,tt,ct,it)),at-=ct,it+=ct,i.length-=ct),i.length))break t;i.length=0,i.mode=R;case R:if(2048&i.flags){if(0===at)break t;ct=0;do{_t=tt[it+ct++],i.head&&_t&&i.length<65536&&(i.head.name+=String.fromCharCode(_t))}while(_t&&ct<at);if(512&i.flags&&(i.check=a(i.check,tt,ct,it)),at-=ct,it+=ct,_t)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=I;case I:if(4096&i.flags){if(0===at)break t;ct=0;do{_t=tt[it+ct++],i.head&&_t&&i.length<65536&&(i.head.comment+=String.fromCharCode(_t))}while(_t&&ct<at);if(512&i.flags&&(i.check=a(i.check,tt,ct,it)),at-=ct,it+=ct,_t)break t}else i.head&&(i.head.comment=null);i.mode=B;case B:if(512&i.flags){for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot!==(65535&i.check)){t.msg="header crc mismatch",i.mode=J;break}ot=0,lt=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=U;break;case C:for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}t.adler=i.check=nt(ot),ot=0,lt=0,i.mode=L;case L:if(0===i.havedict)return t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,p;t.adler=i.check=1,i.mode=U;case U:if(e===d||e===f)break t;case k:if(i.last){ot>>>=7&lt,lt-=7&lt,i.mode=W;break}for(;lt<3;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}switch(i.last=1&ot,lt-=1,3&(ot>>>=1)){case 0:i.mode=F;break;case 1:if(dt(i),i.mode=G,e===f){ot>>>=2,lt-=2;break t}break;case 2:i.mode=O;break;case 3:t.msg="invalid block type",i.mode=J}ot>>>=2,lt-=2;break;case F:for(ot>>>=7&lt,lt-=7&lt;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if((65535&ot)!=(ot>>>16^65535)){t.msg="invalid stored block lengths",i.mode=J;break}if(i.length=65535&ot,ot=0,lt=0,i.mode=P,e===f)break t;case P:i.mode=D;case D:if(ct=i.length){if(ct>at&&(ct=at),ct>st&&(ct=st),0===ct)break t;n.arraySet(et,tt,it,ct,rt),at-=ct,it+=ct,st-=ct,rt+=ct,i.length-=ct;break}i.mode=U;break;case O:for(;lt<14;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(i.nlen=257+(31&ot),ot>>>=5,lt-=5,i.ndist=1+(31&ot),ot>>>=5,lt-=5,i.ncode=4+(15&ot),ot>>>=4,lt-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=J;break}i.have=0,i.mode=N;case N:for(;i.have<i.ncode;){for(;lt<3;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.lens[Rt[i.have++]]=7&ot,ot>>>=3,lt-=3}for(;i.have<19;)i.lens[Rt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Tt={bits:i.lenbits},xt=o(l,i.lens,0,19,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,xt){t.msg="invalid code lengths set",i.mode=J;break}i.have=0,i.mode=V;case V:for(;i.have<i.nlen+i.ndist;){for(;vt=(St=i.lencode[ot&(1<<i.lenbits)-1])>>>16&255,bt=65535&St,!((pt=St>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(bt<16)ot>>>=pt,lt-=pt,i.lens[i.have++]=bt;else{if(16===bt){for(Et=pt+2;lt<Et;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot>>>=pt,lt-=pt,0===i.have){t.msg="invalid bit length repeat",i.mode=J;break}_t=i.lens[i.have-1],ct=3+(3&ot),ot>>>=2,lt-=2}else if(17===bt){for(Et=pt+3;lt<Et;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}lt-=pt,_t=0,ct=3+(7&(ot>>>=pt)),ot>>>=3,lt-=3}else{for(Et=pt+7;lt<Et;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}lt-=pt,_t=0,ct=11+(127&(ot>>>=pt)),ot>>>=7,lt-=7}if(i.have+ct>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=J;break}for(;ct--;)i.lens[i.have++]=_t}}if(i.mode===J)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=J;break}if(i.lenbits=9,Tt={bits:i.lenbits},xt=o(h,i.lens,0,i.nlen,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,xt){t.msg="invalid literal/lengths set",i.mode=J;break}if(i.distbits=6,i.distcode=i.distdyn,Tt={bits:i.distbits},xt=o(u,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Tt),i.distbits=Tt.bits,xt){t.msg="invalid distances set",i.mode=J;break}if(i.mode=G,e===f)break t;case G:i.mode=j;case j:if(at>=6&&st>=258){t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,s(t,ut),rt=t.next_out,et=t.output,st=t.avail_out,it=t.next_in,tt=t.input,at=t.avail_in,ot=i.hold,lt=i.bits,i.mode===U&&(i.back=-1);break}for(i.back=0;vt=(St=i.lencode[ot&(1<<i.lenbits)-1])>>>16&255,bt=65535&St,!((pt=St>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(vt&&0==(240&vt)){for(wt=pt,yt=vt,At=bt;vt=(St=i.lencode[At+((ot&(1<<wt+yt)-1)>>wt)])>>>16&255,bt=65535&St,!(wt+(pt=St>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}ot>>>=wt,lt-=wt,i.back+=wt}if(ot>>>=pt,lt-=pt,i.back+=pt,i.length=bt,0===vt){i.mode=K;break}if(32&vt){i.back=-1,i.mode=U;break}if(64&vt){t.msg="invalid literal/length code",i.mode=J;break}i.extra=15&vt,i.mode=H;case H:if(i.extra){for(Et=i.extra;lt<Et;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.length+=ot&(1<<i.extra)-1,ot>>>=i.extra,lt-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=$;case $:for(;vt=(St=i.distcode[ot&(1<<i.distbits)-1])>>>16&255,bt=65535&St,!((pt=St>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(0==(240&vt)){for(wt=pt,yt=vt,At=bt;vt=(St=i.distcode[At+((ot&(1<<wt+yt)-1)>>wt)])>>>16&255,bt=65535&St,!(wt+(pt=St>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}ot>>>=wt,lt-=wt,i.back+=wt}if(ot>>>=pt,lt-=pt,i.back+=pt,64&vt){t.msg="invalid distance code",i.mode=J;break}i.offset=bt,i.extra=15&vt,i.mode=q;case q:if(i.extra){for(Et=i.extra;lt<Et;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.offset+=ot&(1<<i.extra)-1,ot>>>=i.extra,lt-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=J;break}i.mode=z;case z:if(0===st)break t;if(ct=ut-st,i.offset>ct){if((ct=i.offset-ct)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=J;break}ct>i.wnext?(ct-=i.wnext,mt=i.wsize-ct):mt=i.wnext-ct,ct>i.length&&(ct=i.length),gt=i.window}else gt=et,mt=rt-i.offset,ct=i.length;ct>st&&(ct=st),st-=ct,i.length-=ct;do{et[rt++]=gt[mt++]}while(--ct);0===i.length&&(i.mode=j);break;case K:if(0===st)break t;et[rt++]=i.length,st--,i.mode=j;break;case W:if(i.wrap){for(;lt<32;){if(0===at)break t;at--,ot|=tt[it++]<<lt,lt+=8}if(ut-=st,t.total_out+=ut,i.total+=ut,ut&&(t.adler=i.check=i.flags?a(i.check,et,ut,rt-ut):r(i.check,et,ut,rt-ut)),ut=st,(i.flags?ot:nt(ot))!==i.check){t.msg="incorrect data check",i.mode=J;break}ot=0,lt=0}i.mode=Y;case Y:if(i.wrap&&i.flags){for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=J;break}ot=0,lt=0}i.mode=X;case X:xt=g;break t;case J:xt=b;break t;case Z:return w;case Q:default:return v}return t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,(i.wsize||ut!==t.avail_out&&i.mode<J&&(i.mode<W||e!==c))&&ft(t,t.output,t.next_out,ut-t.avail_out)?(i.mode=Z,w):(ht-=t.avail_in,ut-=t.avail_out,t.total_in+=ht,t.total_out+=ut,i.total+=ut,i.wrap&&ut&&(t.adler=i.check=i.flags?a(i.check,et,ut,t.next_out-ut):r(i.check,et,ut,t.next_out-ut)),t.data_type=i.bits+(i.last?64:0)+(i.mode===U?128:0)+(i.mode===G||i.mode===P?256:0),(0===ht&&0===ut||e===c)&&xt===m&&(xt=y),xt)},e.inflateEnd=function(t){if(!t||!t.state)return v;var e=t.state;return e.window&&(e.window=null),t.state=null,m},e.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?v:(i.head=e,e.done=!1,m):v},e.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&i.mode!==L?v:i.mode===L&&r(1,e,n,0)!==i.check?b:ft(t,e,n,n)?(i.mode=Z,w):(i.havedict=1,m):v},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,i){"use strict";t.exports=function(t,e){var i,n,r,a,s,o,l,h,u,c,d,f,m,g,p,v,b,w,y,A,_,x,T,E,S;i=t.state,n=t.next_in,E=t.input,r=n+(t.avail_in-5),a=t.next_out,S=t.output,s=a-(e-t.avail_out),o=a+(t.avail_out-257),l=i.dmax,h=i.wsize,u=i.whave,c=i.wnext,d=i.window,f=i.hold,m=i.bits,g=i.lencode,p=i.distcode,v=(1<<i.lenbits)-1,b=(1<<i.distbits)-1;t:do{m<15&&(f+=E[n++]<<m,m+=8,f+=E[n++]<<m,m+=8),w=g[f&v];e:for(;;){if(f>>>=y=w>>>24,m-=y,0===(y=w>>>16&255))S[a++]=65535&w;else{if(!(16&y)){if(0==(64&y)){w=g[(65535&w)+(f&(1<<y)-1)];continue e}if(32&y){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}A=65535&w,(y&=15)&&(m<y&&(f+=E[n++]<<m,m+=8),A+=f&(1<<y)-1,f>>>=y,m-=y),m<15&&(f+=E[n++]<<m,m+=8,f+=E[n++]<<m,m+=8),w=p[f&b];i:for(;;){if(f>>>=y=w>>>24,m-=y,!(16&(y=w>>>16&255))){if(0==(64&y)){w=p[(65535&w)+(f&(1<<y)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(_=65535&w,m<(y&=15)&&(f+=E[n++]<<m,(m+=8)<y&&(f+=E[n++]<<m,m+=8)),(_+=f&(1<<y)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(f>>>=y,m-=y,_>(y=a-s)){if((y=_-y)>u&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(x=0,T=d,0===c){if(x+=h-y,y<A){A-=y;do{S[a++]=d[x++]}while(--y);x=a-_,T=S}}else if(c<y){if(x+=h+c-y,(y-=c)<A){A-=y;do{S[a++]=d[x++]}while(--y);if(x=0,c<A){A-=y=c;do{S[a++]=d[x++]}while(--y);x=a-_,T=S}}}else if(x+=c-y,y<A){A-=y;do{S[a++]=d[x++]}while(--y);x=a-_,T=S}for(;A>2;)S[a++]=T[x++],S[a++]=T[x++],S[a++]=T[x++],A-=3;A&&(S[a++]=T[x++],A>1&&(S[a++]=T[x++]))}else{x=a-_;do{S[a++]=S[x++],S[a++]=S[x++],S[a++]=S[x++],A-=3}while(A>2);A&&(S[a++]=S[x++],A>1&&(S[a++]=S[x++]))}break}}break}}while(n<r&&a<o);n-=A=m>>3,f&=(1<<(m-=A<<3))-1,t.next_in=n,t.next_out=a,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=a<o?o-a+257:257-(a-o),i.hold=f,i.bits=m}},function(t,e,i){"use strict";var n=i(6),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,l,h,u,c,d){var f,m,g,p,v,b,w,y,A,_=d.bits,x=0,T=0,E=0,S=0,M=0,R=0,I=0,B=0,C=0,L=0,U=null,k=0,F=new n.Buf16(16),P=new n.Buf16(16),D=null,O=0;for(x=0;x<=15;x++)F[x]=0;for(T=0;T<l;T++)F[e[i+T]]++;for(M=_,S=15;S>=1&&0===F[S];S--);if(M>S&&(M=S),0===S)return h[u++]=20971520,h[u++]=20971520,d.bits=1,0;for(E=1;E<S&&0===F[E];E++);for(M<E&&(M=E),B=1,x=1;x<=15;x++)if(B<<=1,(B-=F[x])<0)return-1;if(B>0&&(0===t||1!==S))return-1;for(P[1]=0,x=1;x<15;x++)P[x+1]=P[x]+F[x];for(T=0;T<l;T++)0!==e[i+T]&&(c[P[e[i+T]]++]=T);if(0===t?(U=D=c,b=19):1===t?(U=r,k-=257,D=a,O-=257,b=256):(U=s,D=o,b=-1),L=0,T=0,x=E,v=u,R=M,I=0,g=-1,p=(C=1<<M)-1,1===t&&C>852||2===t&&C>592)return 1;for(;;){w=x-I,c[T]<b?(y=0,A=c[T]):c[T]>b?(y=D[O+c[T]],A=U[k+c[T]]):(y=96,A=0),f=1<<x-I,E=m=1<<R;do{h[v+(L>>I)+(m-=f)]=w<<24|y<<16|A|0}while(0!==m);for(f=1<<x-1;L&f;)f>>=1;if(0!==f?(L&=f-1,L+=f):L=0,T++,0==--F[x]){if(x===S)break;x=e[i+c[T]]}if(x>M&&(L&p)!==g){for(0===I&&(I=M),v+=E,B=1<<(R=x-I);R+I<S&&!((B-=F[R+I])<=0);)R++,B<<=1;if(C+=1<<R,1===t&&C>852||2===t&&C>592)return 1;h[g=L&p]=M<<24|R<<16|v-u|0}}return 0!==L&&(h[v+L]=x-I<<24|64<<16|0),d.bits=M,0}},function(t,e,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,i){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=i(37),r=i(38),a=i(39);function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=l.prototype:(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,i){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return h(this,t,e,i)}function h(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n);l.TYPED_ARRAY_SUPPORT?(t=e).__proto__=l.prototype:t=d(t,e);return t}(t,e,i,n):"string"==typeof e?function(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!l.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|m(e,i),r=(t=o(t,n)).write(e,i);r!==n&&(t=t.slice(0,r));return t}(t,e,i):function(t,e){if(l.isBuffer(e)){var i=0|f(e.length);return 0===(t=o(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?o(t,0):d(t,e);if("Buffer"===e.type&&a(e.data))return d(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t,e){if(u(e),t=o(t,e<0?0:0|f(e)),!l.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function d(t,e){var i=e.length<0?0:0|f(e.length);t=o(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function f(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function m(t,e){if(l.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return V(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return G(t).length;default:if(n)return V(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function p(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=l.from(e,n)),l.isBuffer(e))return 0===e.length?-1:v(t,e,i,n,r);if("number"==typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):v(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function v(t,e,i,n,r){var a,s=1,o=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,o/=2,l/=2,i/=2}function h(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){var u=-1;for(a=i;a<o;a++)if(h(t,a)===h(e,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*s}else-1!==u&&(a-=a-u),u=-1}else for(i+l>o&&(i=o-l),a=i;a>=0;a--){for(var c=!0,d=0;d<l;d++)if(h(t,a+d)!==h(e,d)){c=!1;break}if(c)return a}return-1}function b(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(e.substr(2*s,2),16);if(isNaN(o))return s;t[i+s]=o}return s}function w(t,e,i,n){return j(V(e,t.length-i),t,i,n)}function y(t,e,i,n){return j(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function A(t,e,i,n){return y(t,e,i,n)}function _(t,e,i,n){return j(G(e),t,i,n)}function x(t,e,i,n){return j(function(t,e){for(var i,n,r,a=[],s=0;s<t.length&&!((e-=2)<0);++s)i=t.charCodeAt(s),n=i>>8,r=i%256,a.push(r),a.push(n);return a}(e,t.length-i),t,i,n)}function T(t,e,i){return 0===e&&i===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,i))}function E(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var a,s,o,l,h=t[r],u=null,c=h>239?4:h>223?3:h>191?2:1;if(r+c<=i)switch(c){case 1:h<128&&(u=h);break;case 2:128==(192&(a=t[r+1]))&&(l=(31&h)<<6|63&a)>127&&(u=l);break;case 3:a=t[r+1],s=t[r+2],128==(192&a)&&128==(192&s)&&(l=(15&h)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=t[r+1],s=t[r+2],o=t[r+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&h)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(u=l)}null===u?(u=65533,c=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),r+=c}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var i="",n=0;for(;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=S));return i}(n)}e.Buffer=l,e.SlowBuffer=function(t){+t!=t&&(t=0);return l.alloc(+t)},e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,i){return h(null,t,e,i)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,i){return function(t,e,i,n){return u(e),e<=0?o(t,e):void 0!==i?"string"==typeof n?o(t,e).fill(i,n):o(t,e).fill(i):o(t,e)}(null,t,e,i)},l.allocUnsafe=function(t){return c(null,t)},l.allocUnsafeSlow=function(t){return c(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,a=Math.min(i,n);r<a;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=l.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var s=t[i];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,r),r+=s.length}return n},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?E(this,0,t):function(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,e,i);case"utf8":case"utf-8":return E(this,e,i);case"ascii":return M(this,e,i);case"latin1":case"binary":return R(this,e,i);case"base64":return T(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,i,n,r){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(this===t)return 0;for(var a=(r>>>=0)-(n>>>=0),s=(i>>>=0)-(e>>>=0),o=Math.min(a,s),h=this.slice(n,r),u=t.slice(e,i),c=0;c<o;++c)if(h[c]!==u[c]){a=h[c],s=u[c];break}return a<s?-1:s<a?1:0},l.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},l.prototype.indexOf=function(t,e,i){return p(this,t,e,i,!0)},l.prototype.lastIndexOf=function(t,e,i){return p(this,t,e,i,!1)},l.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return b(this,t,e,i);case"utf8":case"utf-8":return w(this,t,e,i);case"ascii":return y(this,t,e,i);case"latin1":case"binary":return A(this,t,e,i);case"base64":return _(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,i);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function M(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function R(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function I(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",a=e;a<i;++a)r+=N(t[a]);return r}function B(t,e,i){for(var n=t.slice(e,i),r="",a=0;a<n.length;a+=2)r+=String.fromCharCode(n[a]+256*n[a+1]);return r}function C(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,i,n,r,a){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function U(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,a=Math.min(t.length-i,2);r<a;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function k(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,a=Math.min(t.length-i,4);r<a;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function F(t,e,i,n,r,a){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function P(t,e,i,n,a){return a||F(t,0,i,4),r.write(t,e,i,n,23,4),i+4}function D(t,e,i,n,a){return a||F(t,0,i,8),r.write(t,e,i,n,52,8),i+8}l.prototype.slice=function(t,e){var i,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=l.prototype;else{var r=e-t;i=new l(r,void 0);for(var a=0;a<r;++a)i[a]=this[a+t]}return i},l.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||C(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return n},l.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||C(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},l.prototype.readUInt8=function(t,e){return e||C(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||C(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||C(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||C(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},l.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||C(t,e,this.length);for(var n=e,r=1,a=this[t+--n];n>0&&(r*=256);)a+=this[t+--n]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*e)),a},l.prototype.readInt8=function(t,e){return e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||C(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(t,e){e||C(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(t,e){return e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||C(t,4,this.length),r.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||C(t,4,this.length),r.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||C(t,8,this.length),r.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||C(t,8,this.length),r.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||L(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,a=0;for(this[e]=255&t;++a<i&&(r*=256);)this[e+a]=t/r&255;return e+i},l.prototype.writeUIntBE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||L(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,a=1;for(this[e+r]=255&t;--r>=0&&(a*=256);)this[e+r]=t/a&255;return e+i},l.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):U(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):U(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):k(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):k(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);L(this,t,e,i,r-1,-r)}var a=0,s=1,o=0;for(this[e]=255&t;++a<i&&(s*=256);)t<0&&0===o&&0!==this[e+a-1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+i},l.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);L(this,t,e,i,r-1,-r)}var a=i-1,s=1,o=0;for(this[e+a]=255&t;--a>=0&&(s*=256);)t<0&&0===o&&0!==this[e+a+1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+i},l.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):U(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):U(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):k(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):k(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,i){return P(this,t,e,!0,i)},l.prototype.writeFloatBE=function(t,e,i){return P(this,t,e,!1,i)},l.prototype.writeDoubleLE=function(t,e,i){return D(this,t,e,!0,i)},l.prototype.writeDoubleBE=function(t,e,i){return D(this,t,e,!1,i)},l.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,a=n-i;if(this===t&&i<e&&e<n)for(r=a-1;r>=0;--r)t[r+e]=this[r+i];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+a),e);return a},l.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var a;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(a=e;a<i;++a)this[a]=t;else{var s=l.isBuffer(t)?t:V(new l(t,n).toString()),o=s.length;for(a=0;a<i-e;++a)this[a+e]=s[a%o]}return this};var O=/[^+\/0-9A-Za-z-_]/g;function N(t){return t<16?"0"+t.toString(16):t.toString(16)}function V(t,e){var i;e=e||1/0;for(var n=t.length,r=null,a=[],s=0;s<n;++s){if((i=t.charCodeAt(s))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&a.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&a.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&a.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;a.push(i)}else if(i<2048){if((e-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function G(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(O,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function j(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}}).call(this,i(36))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";e.byteLength=function(t){var e=h(t),i=e[0],n=e[1];return 3*(i+n)/4-n},e.toByteArray=function(t){for(var e,i=h(t),n=i[0],s=i[1],o=new a(function(t,e,i){return 3*(e+i)/4-i}(0,n,s)),l=0,u=s>0?n-4:n,c=0;c<u;c+=4)e=r[t.charCodeAt(c)]<<18|r[t.charCodeAt(c+1)]<<12|r[t.charCodeAt(c+2)]<<6|r[t.charCodeAt(c+3)],o[l++]=e>>16&255,o[l++]=e>>8&255,o[l++]=255&e;2===s&&(e=r[t.charCodeAt(c)]<<2|r[t.charCodeAt(c+1)]>>4,o[l++]=255&e);1===s&&(e=r[t.charCodeAt(c)]<<10|r[t.charCodeAt(c+1)]<<4|r[t.charCodeAt(c+2)]>>2,o[l++]=e>>8&255,o[l++]=255&e);return o},e.fromByteArray=function(t){for(var e,i=t.length,r=i%3,a=[],s=0,o=i-r;s<o;s+=16383)a.push(u(t,s,s+16383>o?o:s+16383));1===r?(e=t[i-1],a.push(n[e>>2]+n[e<<4&63]+"==")):2===r&&(e=(t[i-2]<<8)+t[i-1],a.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return a.join("")};for(var n=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=s.length;o<l;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function u(t,e,i){for(var r,a,s=[],o=e;o<i;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),s.push(n[(a=r)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,i,n,r){var a,s,o=8*r-n-1,l=(1<<o)-1,h=l>>1,u=-7,c=i?r-1:0,d=i?-1:1,f=t[e+c];for(c+=d,a=f&(1<<-u)-1,f>>=-u,u+=o;u>0;a=256*a+t[e+c],c+=d,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=n;u>0;s=256*s+t[e+c],c+=d,u-=8);if(0===a)a=1-h;else{if(a===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),a-=h}return(f?-1:1)*s*Math.pow(2,a-n)},e.write=function(t,e,i,n,r,a){var s,o,l,h=8*a-r-1,u=(1<<h)-1,c=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,m=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(s++,l/=2),s+c>=u?(o=0,s=u):s+c>=1?(o=(e*l-1)*Math.pow(2,r),s+=c):(o=e*Math.pow(2,c-1)*Math.pow(2,r),s=0));r>=8;t[i+f]=255&o,f+=m,o/=256,r-=8);for(s=s<<r|o,h+=r;h>0;t[i+f]=255&s,f+=m,s/=256,h-=8);t[i+f-m]|=128*g}},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e){t.exports={literalValue:function(t){let e=null,i=null;if(t.length>=2&&'"'===t[0]&&'"'===t[t.length-1])e=t.substring(1,t.length-1).replace(/\n/g,"\\n"),i="string";else if(6===t.length&&"'"===t[0]&&"'"===t[5]){let n=t.substring(1,5);e=n.charCodeAt(0)*Math.pow(256,3)+n.charCodeAt(1)*Math.pow(256,2)+n.charCodeAt(2)*Math.pow(256,1)+n.charCodeAt(3)*Math.pow(256,0),i="integer"}else t.length>=1&&"$"===t[0]?(e=parseInt("0x"+t.substring(1)),i="integer"):t.length>=2&&"0x"===t.substring(0,2)?(e=parseInt(t),i="integer"):"false"===t?(e=!1,i="boolean"):"true"===t?(e=!0,i="boolean"):"null"===t?(e=null,i="nullType"):-1!==t.indexOf(".")?(e=parseFloat(t),i="real"):(e=parseInt(t),i="integer");return{value:e,type:i}}}},function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"EPSILON",function(){return y}),i.d(n,"ARRAY_TYPE",function(){return A}),i.d(n,"RANDOM",function(){return _}),i.d(n,"setMatrixArrayType",function(){return x}),i.d(n,"toRadian",function(){return E}),i.d(n,"equals",function(){return S});var r={};i.r(r),i.d(r,"create",function(){return M}),i.d(r,"clone",function(){return R}),i.d(r,"copy",function(){return I}),i.d(r,"identity",function(){return B}),i.d(r,"fromValues",function(){return C}),i.d(r,"set",function(){return L}),i.d(r,"transpose",function(){return U}),i.d(r,"invert",function(){return k}),i.d(r,"adjoint",function(){return F}),i.d(r,"determinant",function(){return P}),i.d(r,"multiply",function(){return D}),i.d(r,"rotate",function(){return O}),i.d(r,"scale",function(){return N}),i.d(r,"fromRotation",function(){return V}),i.d(r,"fromScaling",function(){return G}),i.d(r,"str",function(){return j}),i.d(r,"frob",function(){return H}),i.d(r,"LDU",function(){return $}),i.d(r,"add",function(){return q}),i.d(r,"subtract",function(){return z}),i.d(r,"exactEquals",function(){return K}),i.d(r,"equals",function(){return W}),i.d(r,"multiplyScalar",function(){return Y}),i.d(r,"multiplyScalarAndAdd",function(){return X}),i.d(r,"mul",function(){return J}),i.d(r,"sub",function(){return Z});var a={};i.r(a),i.d(a,"create",function(){return Q}),i.d(a,"clone",function(){return tt}),i.d(a,"copy",function(){return et}),i.d(a,"identity",function(){return it}),i.d(a,"fromValues",function(){return nt}),i.d(a,"set",function(){return rt}),i.d(a,"invert",function(){return at}),i.d(a,"determinant",function(){return st}),i.d(a,"multiply",function(){return ot}),i.d(a,"rotate",function(){return lt}),i.d(a,"scale",function(){return ht}),i.d(a,"translate",function(){return ut}),i.d(a,"fromRotation",function(){return ct}),i.d(a,"fromScaling",function(){return dt}),i.d(a,"fromTranslation",function(){return ft}),i.d(a,"str",function(){return mt}),i.d(a,"frob",function(){return gt}),i.d(a,"add",function(){return pt}),i.d(a,"subtract",function(){return vt}),i.d(a,"multiplyScalar",function(){return bt}),i.d(a,"multiplyScalarAndAdd",function(){return wt}),i.d(a,"exactEquals",function(){return yt}),i.d(a,"equals",function(){return At}),i.d(a,"mul",function(){return _t}),i.d(a,"sub",function(){return xt});var s={};i.r(s),i.d(s,"create",function(){return Tt}),i.d(s,"fromMat4",function(){return Et}),i.d(s,"clone",function(){return St}),i.d(s,"copy",function(){return Mt}),i.d(s,"fromValues",function(){return Rt}),i.d(s,"set",function(){return It}),i.d(s,"identity",function(){return Bt}),i.d(s,"transpose",function(){return Ct}),i.d(s,"invert",function(){return Lt}),i.d(s,"adjoint",function(){return Ut}),i.d(s,"determinant",function(){return kt}),i.d(s,"multiply",function(){return Ft}),i.d(s,"translate",function(){return Pt}),i.d(s,"rotate",function(){return Dt}),i.d(s,"scale",function(){return Ot}),i.d(s,"fromTranslation",function(){return Nt}),i.d(s,"fromRotation",function(){return Vt}),i.d(s,"fromScaling",function(){return Gt}),i.d(s,"fromMat2d",function(){return jt}),i.d(s,"fromQuat",function(){return Ht}),i.d(s,"normalFromMat4",function(){return $t}),i.d(s,"projection",function(){return qt}),i.d(s,"str",function(){return zt}),i.d(s,"frob",function(){return Kt}),i.d(s,"add",function(){return Wt}),i.d(s,"subtract",function(){return Yt}),i.d(s,"multiplyScalar",function(){return Xt}),i.d(s,"multiplyScalarAndAdd",function(){return Jt}),i.d(s,"exactEquals",function(){return Zt}),i.d(s,"equals",function(){return Qt}),i.d(s,"mul",function(){return te}),i.d(s,"sub",function(){return ee});var o={};i.r(o),i.d(o,"create",function(){return ie}),i.d(o,"clone",function(){return ne}),i.d(o,"copy",function(){return re}),i.d(o,"fromValues",function(){return ae}),i.d(o,"set",function(){return se}),i.d(o,"identity",function(){return oe}),i.d(o,"transpose",function(){return le}),i.d(o,"invert",function(){return he}),i.d(o,"adjoint",function(){return ue}),i.d(o,"determinant",function(){return ce}),i.d(o,"multiply",function(){return de}),i.d(o,"translate",function(){return fe}),i.d(o,"scale",function(){return me}),i.d(o,"rotate",function(){return ge}),i.d(o,"rotateX",function(){return pe}),i.d(o,"rotateY",function(){return ve}),i.d(o,"rotateZ",function(){return be}),i.d(o,"fromTranslation",function(){return we}),i.d(o,"fromScaling",function(){return ye}),i.d(o,"fromRotation",function(){return Ae}),i.d(o,"fromXRotation",function(){return _e}),i.d(o,"fromYRotation",function(){return xe}),i.d(o,"fromZRotation",function(){return Te}),i.d(o,"fromRotationTranslation",function(){return Ee}),i.d(o,"fromQuat2",function(){return Se}),i.d(o,"getTranslation",function(){return Me}),i.d(o,"getScaling",function(){return Re}),i.d(o,"getRotation",function(){return Ie}),i.d(o,"fromRotationTranslationScale",function(){return Be}),i.d(o,"fromRotationTranslationScaleOrigin",function(){return Ce}),i.d(o,"fromQuat",function(){return Le}),i.d(o,"frustum",function(){return Ue}),i.d(o,"perspective",function(){return ke}),i.d(o,"perspectiveFromFieldOfView",function(){return Fe}),i.d(o,"ortho",function(){return Pe}),i.d(o,"lookAt",function(){return De}),i.d(o,"targetTo",function(){return Oe}),i.d(o,"str",function(){return Ne}),i.d(o,"frob",function(){return Ve}),i.d(o,"add",function(){return Ge}),i.d(o,"subtract",function(){return je}),i.d(o,"multiplyScalar",function(){return He}),i.d(o,"multiplyScalarAndAdd",function(){return $e}),i.d(o,"exactEquals",function(){return qe}),i.d(o,"equals",function(){return ze}),i.d(o,"mul",function(){return Ke}),i.d(o,"sub",function(){return We});var l={};i.r(l),i.d(l,"create",function(){return Ye}),i.d(l,"clone",function(){return Xe}),i.d(l,"length",function(){return Je}),i.d(l,"fromValues",function(){return Ze}),i.d(l,"copy",function(){return Qe}),i.d(l,"set",function(){return ti}),i.d(l,"add",function(){return ei}),i.d(l,"subtract",function(){return ii}),i.d(l,"multiply",function(){return ni}),i.d(l,"divide",function(){return ri}),i.d(l,"ceil",function(){return ai}),i.d(l,"floor",function(){return si}),i.d(l,"min",function(){return oi}),i.d(l,"max",function(){return li}),i.d(l,"round",function(){return hi}),i.d(l,"scale",function(){return ui}),i.d(l,"scaleAndAdd",function(){return ci}),i.d(l,"distance",function(){return di}),i.d(l,"squaredDistance",function(){return fi}),i.d(l,"squaredLength",function(){return mi}),i.d(l,"negate",function(){return gi}),i.d(l,"inverse",function(){return pi}),i.d(l,"normalize",function(){return vi}),i.d(l,"dot",function(){return bi}),i.d(l,"cross",function(){return wi}),i.d(l,"lerp",function(){return yi}),i.d(l,"hermite",function(){return Ai}),i.d(l,"bezier",function(){return _i}),i.d(l,"random",function(){return xi}),i.d(l,"transformMat4",function(){return Ti}),i.d(l,"transformMat3",function(){return Ei}),i.d(l,"transformQuat",function(){return Si}),i.d(l,"rotateX",function(){return Mi}),i.d(l,"rotateY",function(){return Ri}),i.d(l,"rotateZ",function(){return Ii}),i.d(l,"angle",function(){return Bi}),i.d(l,"str",function(){return Ci}),i.d(l,"exactEquals",function(){return Li}),i.d(l,"equals",function(){return Ui}),i.d(l,"sub",function(){return Fi}),i.d(l,"mul",function(){return Pi}),i.d(l,"div",function(){return Di}),i.d(l,"dist",function(){return Oi}),i.d(l,"sqrDist",function(){return Ni}),i.d(l,"len",function(){return Vi}),i.d(l,"sqrLen",function(){return Gi}),i.d(l,"forEach",function(){return ji});var h={};i.r(h),i.d(h,"create",function(){return Hi}),i.d(h,"clone",function(){return $i}),i.d(h,"fromValues",function(){return qi}),i.d(h,"copy",function(){return zi}),i.d(h,"set",function(){return Ki}),i.d(h,"add",function(){return Wi}),i.d(h,"subtract",function(){return Yi}),i.d(h,"multiply",function(){return Xi}),i.d(h,"divide",function(){return Ji}),i.d(h,"ceil",function(){return Zi}),i.d(h,"floor",function(){return Qi}),i.d(h,"min",function(){return tn}),i.d(h,"max",function(){return en}),i.d(h,"round",function(){return nn}),i.d(h,"scale",function(){return rn}),i.d(h,"scaleAndAdd",function(){return an}),i.d(h,"distance",function(){return sn}),i.d(h,"squaredDistance",function(){return on}),i.d(h,"length",function(){return ln}),i.d(h,"squaredLength",function(){return hn}),i.d(h,"negate",function(){return un}),i.d(h,"inverse",function(){return cn}),i.d(h,"normalize",function(){return dn}),i.d(h,"dot",function(){return fn}),i.d(h,"lerp",function(){return mn}),i.d(h,"random",function(){return gn}),i.d(h,"transformMat4",function(){return pn}),i.d(h,"transformQuat",function(){return vn}),i.d(h,"str",function(){return bn}),i.d(h,"exactEquals",function(){return wn}),i.d(h,"equals",function(){return yn}),i.d(h,"sub",function(){return An}),i.d(h,"mul",function(){return _n}),i.d(h,"div",function(){return xn}),i.d(h,"dist",function(){return Tn}),i.d(h,"sqrDist",function(){return En}),i.d(h,"len",function(){return Sn}),i.d(h,"sqrLen",function(){return Mn}),i.d(h,"forEach",function(){return Rn});var u={};i.r(u),i.d(u,"create",function(){return In}),i.d(u,"identity",function(){return Bn}),i.d(u,"setAxisAngle",function(){return Cn}),i.d(u,"getAxisAngle",function(){return Ln}),i.d(u,"multiply",function(){return Un}),i.d(u,"rotateX",function(){return kn}),i.d(u,"rotateY",function(){return Fn}),i.d(u,"rotateZ",function(){return Pn}),i.d(u,"calculateW",function(){return Dn}),i.d(u,"slerp",function(){return On}),i.d(u,"random",function(){return Nn}),i.d(u,"invert",function(){return Vn}),i.d(u,"conjugate",function(){return Gn}),i.d(u,"fromMat3",function(){return jn}),i.d(u,"fromEuler",function(){return Hn}),i.d(u,"str",function(){return $n}),i.d(u,"clone",function(){return Jn}),i.d(u,"fromValues",function(){return Zn}),i.d(u,"copy",function(){return Qn}),i.d(u,"set",function(){return tr}),i.d(u,"add",function(){return er}),i.d(u,"mul",function(){return ir}),i.d(u,"scale",function(){return nr}),i.d(u,"dot",function(){return rr}),i.d(u,"lerp",function(){return ar}),i.d(u,"length",function(){return sr}),i.d(u,"len",function(){return or}),i.d(u,"squaredLength",function(){return lr}),i.d(u,"sqrLen",function(){return hr}),i.d(u,"normalize",function(){return ur}),i.d(u,"exactEquals",function(){return cr}),i.d(u,"equals",function(){return dr}),i.d(u,"rotationTo",function(){return fr}),i.d(u,"sqlerp",function(){return mr}),i.d(u,"setAxes",function(){return gr});var c={};i.r(c),i.d(c,"create",function(){return pr}),i.d(c,"clone",function(){return vr}),i.d(c,"fromValues",function(){return br}),i.d(c,"fromRotationTranslationValues",function(){return wr}),i.d(c,"fromRotationTranslation",function(){return yr}),i.d(c,"fromTranslation",function(){return Ar}),i.d(c,"fromRotation",function(){return _r}),i.d(c,"fromMat4",function(){return xr}),i.d(c,"copy",function(){return Tr}),i.d(c,"identity",function(){return Er}),i.d(c,"set",function(){return Sr}),i.d(c,"getReal",function(){return Mr}),i.d(c,"getDual",function(){return Rr}),i.d(c,"setReal",function(){return Ir}),i.d(c,"setDual",function(){return Br}),i.d(c,"getTranslation",function(){return Cr}),i.d(c,"translate",function(){return Lr}),i.d(c,"rotateX",function(){return Ur}),i.d(c,"rotateY",function(){return kr}),i.d(c,"rotateZ",function(){return Fr}),i.d(c,"rotateByQuatAppend",function(){return Pr}),i.d(c,"rotateByQuatPrepend",function(){return Dr}),i.d(c,"rotateAroundAxis",function(){return Or}),i.d(c,"add",function(){return Nr}),i.d(c,"multiply",function(){return Vr}),i.d(c,"mul",function(){return Gr}),i.d(c,"scale",function(){return jr}),i.d(c,"dot",function(){return Hr}),i.d(c,"lerp",function(){return $r}),i.d(c,"invert",function(){return qr}),i.d(c,"conjugate",function(){return zr}),i.d(c,"length",function(){return Kr}),i.d(c,"len",function(){return Wr}),i.d(c,"squaredLength",function(){return Yr}),i.d(c,"sqrLen",function(){return Xr}),i.d(c,"normalize",function(){return Jr}),i.d(c,"str",function(){return Zr}),i.d(c,"exactEquals",function(){return Qr}),i.d(c,"equals",function(){return ta});var d={};i.r(d),i.d(d,"create",function(){return ea}),i.d(d,"clone",function(){return ia}),i.d(d,"fromValues",function(){return na}),i.d(d,"copy",function(){return ra}),i.d(d,"set",function(){return aa}),i.d(d,"add",function(){return sa}),i.d(d,"subtract",function(){return oa}),i.d(d,"multiply",function(){return la}),i.d(d,"divide",function(){return ha}),i.d(d,"ceil",function(){return ua}),i.d(d,"floor",function(){return ca}),i.d(d,"min",function(){return da}),i.d(d,"max",function(){return fa}),i.d(d,"round",function(){return ma}),i.d(d,"scale",function(){return ga}),i.d(d,"scaleAndAdd",function(){return pa}),i.d(d,"distance",function(){return va}),i.d(d,"squaredDistance",function(){return ba}),i.d(d,"length",function(){return wa}),i.d(d,"squaredLength",function(){return ya}),i.d(d,"negate",function(){return Aa}),i.d(d,"inverse",function(){return _a}),i.d(d,"normalize",function(){return xa}),i.d(d,"dot",function(){return Ta}),i.d(d,"cross",function(){return Ea}),i.d(d,"lerp",function(){return Sa}),i.d(d,"random",function(){return Ma}),i.d(d,"transformMat2",function(){return Ra}),i.d(d,"transformMat2d",function(){return Ia}),i.d(d,"transformMat3",function(){return Ba}),i.d(d,"transformMat4",function(){return Ca}),i.d(d,"rotate",function(){return La}),i.d(d,"angle",function(){return Ua}),i.d(d,"str",function(){return ka}),i.d(d,"exactEquals",function(){return Fa}),i.d(d,"equals",function(){return Pa}),i.d(d,"len",function(){return Da}),i.d(d,"sub",function(){return Oa}),i.d(d,"mul",function(){return Na}),i.d(d,"div",function(){return Va}),i.d(d,"dist",function(){return Ga}),i.d(d,"sqrDist",function(){return ja}),i.d(d,"sqrLen",function(){return Ha}),i.d(d,"forEach",function(){return $a});var f={};i.r(f),i.d(f,"glMatrix",function(){return n}),i.d(f,"mat2",function(){return r}),i.d(f,"mat2d",function(){return a}),i.d(f,"mat3",function(){return s}),i.d(f,"mat4",function(){return o}),i.d(f,"quat",function(){return u}),i.d(f,"quat2",function(){return c}),i.d(f,"vec2",function(){return d}),i.d(f,"vec3",function(){return l}),i.d(f,"vec4",function(){return h});var m={};i.r(m),i.d(m,"VEC3_UNIT_X",function(){return qa}),i.d(m,"VEC3_UNIT_Y",function(){return za}),i.d(m,"VEC3_UNIT_Z",function(){return Ka}),i.d(m,"VEC3_ZERO",function(){return Wa}),i.d(m,"VEC3_ONE",function(){return Ya}),i.d(m,"QUAT_ZERO",function(){return Xa}),i.d(m,"QUAT_DEFAULT",function(){return Ja}),i.d(m,"unproject",function(){return Qa}),i.d(m,"distanceToPlane",function(){return ts}),i.d(m,"normalizePlane",function(){return es}),i.d(m,"unpackPlanes",function(){return is}),i.d(m,"getRotationX",function(){return rs}),i.d(m,"getRotationY",function(){return as}),i.d(m,"getRotationZ",function(){return ss});var g={};i.r(g),i.d(g,"degToRad",function(){return os}),i.d(g,"radToDeg",function(){return ls}),i.d(g,"randomInRange",function(){return hs}),i.d(g,"clamp",function(){return us}),i.d(g,"lerp",function(){return cs}),i.d(g,"hermite",function(){return ds}),i.d(g,"bezier",function(){return fs}),i.d(g,"copysign",function(){return ms}),i.d(g,"powerOfTwo",function(){return gs}),i.d(g,"isPowerOfTwo",function(){return ps});var p={};i.r(p),i.d(p,"blobToImage",function(){return As}),i.d(p,"blobToImageData",function(){return _s}),i.d(p,"imageDataToBlob",function(){return xs}),i.d(p,"imageDataToDataUrl",function(){return Ts}),i.d(p,"imageDataToImage",function(){return Es}),i.d(p,"imageToImageData",function(){return Ss}),i.d(p,"scaleNPOT",function(){return Ms}),i.d(p,"resizeImageData",function(){return Rs}),i.d(p,"createTextureAtlas",function(){return Is});var v={};i.r(v),i.d(v,"createRectangle",function(){return Bs}),i.d(v,"createUnitRectangle",function(){return Cs}),i.d(v,"createCube",function(){return Ls}),i.d(v,"createUnitCube",function(){return Us}),i.d(v,"createSphere",function(){return Fs}),i.d(v,"createUnitSphere",function(){return Ps}),i.d(v,"createCylinder",function(){return Ds}),i.d(v,"createUnitCylinder",function(){return Os}),i.d(v,"createHeightMap",function(){return Ns}),i.d(v,"createFrustum",function(){return Vs});var b={};i.r(b),i.d(b,"downloadUrl",function(){return Gs}),i.d(b,"downloadBlob",function(){return js}),i.d(b,"downloadBuffer",function(){return Hs});var w={};i.r(w),i.d(w,"extentToSphere",function(){return $s});var y=1e-6,A="undefined"!=typeof Float32Array?Float32Array:Array,_=Math.random;function x(t){A=t}var T=Math.PI/180;function E(t){return t*T}function S(t,e){return Math.abs(t-e)<=y*Math.max(1,Math.abs(t),Math.abs(e))}function M(){var t=new A(4);return A!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function R(t){var e=new A(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function I(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function B(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function C(t,e,i,n){var r=new A(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function L(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}function U(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function k(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i*a-r*n;return s?(s=1/s,t[0]=a*s,t[1]=-n*s,t[2]=-r*s,t[3]=i*s,t):null}function F(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function P(t){return t[0]*t[3]-t[2]*t[1]}function D(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=i[0],l=i[1],h=i[2],u=i[3];return t[0]=n*o+a*l,t[1]=r*o+s*l,t[2]=n*h+a*u,t[3]=r*h+s*u,t}function O(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=n*l+a*o,t[1]=r*l+s*o,t[2]=n*-o+a*l,t[3]=r*-o+s*l,t}function N(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=i[0],l=i[1];return t[0]=n*o,t[1]=r*o,t[2]=a*l,t[3]=s*l,t}function V(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t}function G(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function j(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function H(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function $(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]}function q(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function z(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function K(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function W(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=e[0],o=e[1],l=e[2],h=e[3];return Math.abs(i-s)<=y*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-h)<=y*Math.max(1,Math.abs(a),Math.abs(h))}function Y(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function X(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t}var J=D,Z=z;function Q(){var t=new A(6);return A!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function tt(t){var e=new A(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function et(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function it(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function nt(t,e,i,n,r,a){var s=new A(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=a,s}function rt(t,e,i,n,r,a,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=a,t[5]=s,t}function at(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=i*a-n*r;return l?(l=1/l,t[0]=a*l,t[1]=-n*l,t[2]=-r*l,t[3]=i*l,t[4]=(r*o-a*s)*l,t[5]=(n*s-i*o)*l,t):null}function st(t){return t[0]*t[3]-t[1]*t[2]}function ot(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=i[0],u=i[1],c=i[2],d=i[3],f=i[4],m=i[5];return t[0]=n*h+a*u,t[1]=r*h+s*u,t[2]=n*c+a*d,t[3]=r*c+s*d,t[4]=n*f+a*m+o,t[5]=r*f+s*m+l,t}function lt(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=Math.sin(i),u=Math.cos(i);return t[0]=n*u+a*h,t[1]=r*u+s*h,t[2]=n*-h+a*u,t[3]=r*-h+s*u,t[4]=o,t[5]=l,t}function ht(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=i[0],u=i[1];return t[0]=n*h,t[1]=r*h,t[2]=a*u,t[3]=s*u,t[4]=o,t[5]=l,t}function ut(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=i[0],u=i[1];return t[0]=n,t[1]=r,t[2]=a,t[3]=s,t[4]=n*h+a*u+o,t[5]=r*h+s*u+l,t}function ct(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t}function dt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ft(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function mt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function gt(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)}function pt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function vt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function bt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function wt(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t}function yt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function At(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=e[0],h=e[1],u=e[2],c=e[3],d=e[4],f=e[5];return Math.abs(i-l)<=y*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-h)<=y*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-u)<=y*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-c)<=y*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-d)<=y*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))}var _t=ot,xt=vt;function Tt(){var t=new A(9);return A!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Et(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function St(t){var e=new A(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Mt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Rt(t,e,i,n,r,a,s,o,l){var h=new A(9);return h[0]=t,h[1]=e,h[2]=i,h[3]=n,h[4]=r,h[5]=a,h[6]=s,h[7]=o,h[8]=l,h}function It(t,e,i,n,r,a,s,o,l,h){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=a,t[5]=s,t[6]=o,t[7]=l,t[8]=h,t}function Bt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ct(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Lt(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=u*s-o*h,d=-u*a+o*l,f=h*a-s*l,m=i*c+n*d+r*f;return m?(m=1/m,t[0]=c*m,t[1]=(-u*n+r*h)*m,t[2]=(o*n-r*s)*m,t[3]=d*m,t[4]=(u*i-r*l)*m,t[5]=(-o*i+r*a)*m,t[6]=f*m,t[7]=(-h*i+n*l)*m,t[8]=(s*i-n*a)*m,t):null}function Ut(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],u=e[8];return t[0]=s*u-o*h,t[1]=r*h-n*u,t[2]=n*o-r*s,t[3]=o*l-a*u,t[4]=i*u-r*l,t[5]=r*a-i*o,t[6]=a*h-s*l,t[7]=n*l-i*h,t[8]=i*s-n*a,t}function kt(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*(h*a-s*l)+i*(-h*r+s*o)+n*(l*r-a*o)}function Ft(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=i[0],f=i[1],m=i[2],g=i[3],p=i[4],v=i[5],b=i[6],w=i[7],y=i[8];return t[0]=d*n+f*s+m*h,t[1]=d*r+f*o+m*u,t[2]=d*a+f*l+m*c,t[3]=g*n+p*s+v*h,t[4]=g*r+p*o+v*u,t[5]=g*a+p*l+v*c,t[6]=b*n+w*s+y*h,t[7]=b*r+w*o+y*u,t[8]=b*a+w*l+y*c,t}function Pt(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=i[0],f=i[1];return t[0]=n,t[1]=r,t[2]=a,t[3]=s,t[4]=o,t[5]=l,t[6]=d*n+f*s+h,t[7]=d*r+f*o+u,t[8]=d*a+f*l+c,t}function Dt(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=Math.sin(i),f=Math.cos(i);return t[0]=f*n+d*s,t[1]=f*r+d*o,t[2]=f*a+d*l,t[3]=f*s-d*n,t[4]=f*o-d*r,t[5]=f*l-d*a,t[6]=h,t[7]=u,t[8]=c,t}function Ot(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Nt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Vt(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Gt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function jt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Ht(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i+i,o=n+n,l=r+r,h=i*s,u=n*s,c=n*o,d=r*s,f=r*o,m=r*l,g=a*s,p=a*o,v=a*l;return t[0]=1-c-m,t[3]=u-v,t[6]=d+p,t[1]=u+v,t[4]=1-h-m,t[7]=f-g,t[2]=d-p,t[5]=f+g,t[8]=1-h-c,t}function $t(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],d=e[10],f=e[11],m=e[12],g=e[13],p=e[14],v=e[15],b=i*o-n*s,w=i*l-r*s,y=i*h-a*s,A=n*l-r*o,_=n*h-a*o,x=r*h-a*l,T=u*g-c*m,E=u*p-d*m,S=u*v-f*m,M=c*p-d*g,R=c*v-f*g,I=d*v-f*p,B=b*I-w*R+y*M+A*S-_*E+x*T;return B?(B=1/B,t[0]=(o*I-l*R+h*M)*B,t[1]=(l*S-s*I-h*E)*B,t[2]=(s*R-o*S+h*T)*B,t[3]=(r*R-n*I-a*M)*B,t[4]=(i*I-r*S+a*E)*B,t[5]=(n*S-i*R-a*T)*B,t[6]=(g*x-p*_+v*A)*B,t[7]=(p*y-m*x-v*w)*B,t[8]=(m*_-g*y+v*b)*B,t):null}function qt(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function zt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Kt(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function Wt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function Yt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function Xt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Jt(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t}function Zt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Qt(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],u=t[8],c=e[0],d=e[1],f=e[2],m=e[3],g=e[4],p=e[5],v=e[6],b=e[7],w=e[8];return Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-d)<=y*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-f)<=y*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-g)<=y*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-p)<=y*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-v)<=y*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-b)<=y*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(u-w)<=y*Math.max(1,Math.abs(u),Math.abs(w))}var te=Ft,ee=Yt;function ie(){var t=new A(16);return A!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ne(t){var e=new A(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function re(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ae(t,e,i,n,r,a,s,o,l,h,u,c,d,f,m,g){var p=new A(16);return p[0]=t,p[1]=e,p[2]=i,p[3]=n,p[4]=r,p[5]=a,p[6]=s,p[7]=o,p[8]=l,p[9]=h,p[10]=u,p[11]=c,p[12]=d,p[13]=f,p[14]=m,p[15]=g,p}function se(t,e,i,n,r,a,s,o,l,h,u,c,d,f,m,g,p){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=a,t[5]=s,t[6]=o,t[7]=l,t[8]=h,t[9]=u,t[10]=c,t[11]=d,t[12]=f,t[13]=m,t[14]=g,t[15]=p,t}function oe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function le(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],a=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=r,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function he(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],d=e[10],f=e[11],m=e[12],g=e[13],p=e[14],v=e[15],b=i*o-n*s,w=i*l-r*s,y=i*h-a*s,A=n*l-r*o,_=n*h-a*o,x=r*h-a*l,T=u*g-c*m,E=u*p-d*m,S=u*v-f*m,M=c*p-d*g,R=c*v-f*g,I=d*v-f*p,B=b*I-w*R+y*M+A*S-_*E+x*T;return B?(B=1/B,t[0]=(o*I-l*R+h*M)*B,t[1]=(r*R-n*I-a*M)*B,t[2]=(g*x-p*_+v*A)*B,t[3]=(d*_-c*x-f*A)*B,t[4]=(l*S-s*I-h*E)*B,t[5]=(i*I-r*S+a*E)*B,t[6]=(p*y-m*x-v*w)*B,t[7]=(u*x-d*y+f*w)*B,t[8]=(s*R-o*S+h*T)*B,t[9]=(n*S-i*R-a*T)*B,t[10]=(m*_-g*y+v*b)*B,t[11]=(c*y-u*_-f*b)*B,t[12]=(o*E-s*M-l*T)*B,t[13]=(i*M-n*E+r*T)*B,t[14]=(g*w-m*A-p*b)*B,t[15]=(u*A-c*w+d*b)*B,t):null}function ue(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],d=e[10],f=e[11],m=e[12],g=e[13],p=e[14],v=e[15];return t[0]=o*(d*v-f*p)-c*(l*v-h*p)+g*(l*f-h*d),t[1]=-(n*(d*v-f*p)-c*(r*v-a*p)+g*(r*f-a*d)),t[2]=n*(l*v-h*p)-o*(r*v-a*p)+g*(r*h-a*l),t[3]=-(n*(l*f-h*d)-o*(r*f-a*d)+c*(r*h-a*l)),t[4]=-(s*(d*v-f*p)-u*(l*v-h*p)+m*(l*f-h*d)),t[5]=i*(d*v-f*p)-u*(r*v-a*p)+m*(r*f-a*d),t[6]=-(i*(l*v-h*p)-s*(r*v-a*p)+m*(r*h-a*l)),t[7]=i*(l*f-h*d)-s*(r*f-a*d)+u*(r*h-a*l),t[8]=s*(c*v-f*g)-u*(o*v-h*g)+m*(o*f-h*c),t[9]=-(i*(c*v-f*g)-u*(n*v-a*g)+m*(n*f-a*c)),t[10]=i*(o*v-h*g)-s*(n*v-a*g)+m*(n*h-a*o),t[11]=-(i*(o*f-h*c)-s*(n*f-a*c)+u*(n*h-a*o)),t[12]=-(s*(c*p-d*g)-u*(o*p-l*g)+m*(o*d-l*c)),t[13]=i*(c*p-d*g)-u*(n*p-r*g)+m*(n*d-r*c),t[14]=-(i*(o*p-l*g)-s*(n*p-r*g)+m*(n*l-r*o)),t[15]=i*(o*d-l*c)-s*(n*d-r*c)+u*(n*l-r*o),t}function ce(t){var e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8],u=t[9],c=t[10],d=t[11],f=t[12],m=t[13],g=t[14],p=t[15];return(e*s-i*a)*(c*p-d*g)-(e*o-n*a)*(u*p-d*m)+(e*l-r*a)*(u*g-c*m)+(i*o-n*s)*(h*p-d*f)-(i*l-r*s)*(h*g-c*f)+(n*l-r*o)*(h*m-u*f)}function de(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=e[9],f=e[10],m=e[11],g=e[12],p=e[13],v=e[14],b=e[15],w=i[0],y=i[1],A=i[2],_=i[3];return t[0]=w*n+y*o+A*c+_*g,t[1]=w*r+y*l+A*d+_*p,t[2]=w*a+y*h+A*f+_*v,t[3]=w*s+y*u+A*m+_*b,w=i[4],y=i[5],A=i[6],_=i[7],t[4]=w*n+y*o+A*c+_*g,t[5]=w*r+y*l+A*d+_*p,t[6]=w*a+y*h+A*f+_*v,t[7]=w*s+y*u+A*m+_*b,w=i[8],y=i[9],A=i[10],_=i[11],t[8]=w*n+y*o+A*c+_*g,t[9]=w*r+y*l+A*d+_*p,t[10]=w*a+y*h+A*f+_*v,t[11]=w*s+y*u+A*m+_*b,w=i[12],y=i[13],A=i[14],_=i[15],t[12]=w*n+y*o+A*c+_*g,t[13]=w*r+y*l+A*d+_*p,t[14]=w*a+y*h+A*f+_*v,t[15]=w*s+y*u+A*m+_*b,t}function fe(t,e,i){var n=i[0],r=i[1],a=i[2],s=void 0,o=void 0,l=void 0,h=void 0,u=void 0,c=void 0,d=void 0,f=void 0,m=void 0,g=void 0,p=void 0,v=void 0;return e===t?(t[12]=e[0]*n+e[4]*r+e[8]*a+e[12],t[13]=e[1]*n+e[5]*r+e[9]*a+e[13],t[14]=e[2]*n+e[6]*r+e[10]*a+e[14],t[15]=e[3]*n+e[7]*r+e[11]*a+e[15]):(s=e[0],o=e[1],l=e[2],h=e[3],u=e[4],c=e[5],d=e[6],f=e[7],m=e[8],g=e[9],p=e[10],v=e[11],t[0]=s,t[1]=o,t[2]=l,t[3]=h,t[4]=u,t[5]=c,t[6]=d,t[7]=f,t[8]=m,t[9]=g,t[10]=p,t[11]=v,t[12]=s*n+u*r+m*a+e[12],t[13]=o*n+c*r+g*a+e[13],t[14]=l*n+d*r+p*a+e[14],t[15]=h*n+f*r+v*a+e[15]),t}function me(t,e,i){var n=i[0],r=i[1],a=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ge(t,e,i,n){var r,a,s,o,l,h,u,c,d,f,m,g,p,v,b,w,A,_,x,T,E,S,M,R,I=n[0],B=n[1],C=n[2],L=Math.sqrt(I*I+B*B+C*C);return L<y?null:(I*=L=1/L,B*=L,C*=L,r=Math.sin(i),s=1-(a=Math.cos(i)),o=e[0],l=e[1],h=e[2],u=e[3],c=e[4],d=e[5],f=e[6],m=e[7],g=e[8],p=e[9],v=e[10],b=e[11],w=I*I*s+a,A=B*I*s+C*r,_=C*I*s-B*r,x=I*B*s-C*r,T=B*B*s+a,E=C*B*s+I*r,S=I*C*s+B*r,M=B*C*s-I*r,R=C*C*s+a,t[0]=o*w+c*A+g*_,t[1]=l*w+d*A+p*_,t[2]=h*w+f*A+v*_,t[3]=u*w+m*A+b*_,t[4]=o*x+c*T+g*E,t[5]=l*x+d*T+p*E,t[6]=h*x+f*T+v*E,t[7]=u*x+m*T+b*E,t[8]=o*S+c*M+g*R,t[9]=l*S+d*M+p*R,t[10]=h*S+f*M+v*R,t[11]=u*S+m*M+b*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function pe(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],u=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+h*n,t[5]=s*r+u*n,t[6]=o*r+c*n,t[7]=l*r+d*n,t[8]=h*r-a*n,t[9]=u*r-s*n,t[10]=c*r-o*n,t[11]=d*r-l*n,t}function ve(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[0],s=e[1],o=e[2],l=e[3],h=e[8],u=e[9],c=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-h*n,t[1]=s*r-u*n,t[2]=o*r-c*n,t[3]=l*r-d*n,t[8]=a*n+h*r,t[9]=s*n+u*r,t[10]=o*n+c*r,t[11]=l*n+d*r,t}function be(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[0],s=e[1],o=e[2],l=e[3],h=e[4],u=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+h*n,t[1]=s*r+u*n,t[2]=o*r+c*n,t[3]=l*r+d*n,t[4]=h*r-a*n,t[5]=u*r-s*n,t[6]=c*r-o*n,t[7]=d*r-l*n,t}function we(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ye(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ae(t,e,i){var n,r,a,s=i[0],o=i[1],l=i[2],h=Math.sqrt(s*s+o*o+l*l);return h<y?null:(s*=h=1/h,o*=h,l*=h,n=Math.sin(e),a=1-(r=Math.cos(e)),t[0]=s*s*a+r,t[1]=o*s*a+l*n,t[2]=l*s*a-o*n,t[3]=0,t[4]=s*o*a-l*n,t[5]=o*o*a+r,t[6]=l*o*a+s*n,t[7]=0,t[8]=s*l*a+o*n,t[9]=o*l*a-s*n,t[10]=l*l*a+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function _e(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xe(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Te(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ee(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=n+n,l=r+r,h=a+a,u=n*o,c=n*l,d=n*h,f=r*l,m=r*h,g=a*h,p=s*o,v=s*l,b=s*h;return t[0]=1-(f+g),t[1]=c+b,t[2]=d-v,t[3]=0,t[4]=c-b,t[5]=1-(u+g),t[6]=m+p,t[7]=0,t[8]=d+v,t[9]=m-p,t[10]=1-(u+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Se(t,e){var i=new A(3),n=-e[0],r=-e[1],a=-e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=n*n+r*r+a*a+s*s;return c>0?(i[0]=2*(o*s+u*n+l*a-h*r)/c,i[1]=2*(l*s+u*r+h*n-o*a)/c,i[2]=2*(h*s+u*a+o*r-l*n)/c):(i[0]=2*(o*s+u*n+l*a-h*r),i[1]=2*(l*s+u*r+h*n-o*a),i[2]=2*(h*s+u*a+o*r-l*n)),Ee(t,e,i),t}function Me(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Re(t,e){var i=e[0],n=e[1],r=e[2],a=e[4],s=e[5],o=e[6],l=e[8],h=e[9],u=e[10];return t[0]=Math.sqrt(i*i+n*n+r*r),t[1]=Math.sqrt(a*a+s*s+o*o),t[2]=Math.sqrt(l*l+h*h+u*u),t}function Ie(t,e){var i=e[0]+e[5]+e[10],n=0;return i>0?(n=2*Math.sqrt(i+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t}function Be(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3],l=r+r,h=a+a,u=s+s,c=r*l,d=r*h,f=r*u,m=a*h,g=a*u,p=s*u,v=o*l,b=o*h,w=o*u,y=n[0],A=n[1],_=n[2];return t[0]=(1-(m+p))*y,t[1]=(d+w)*y,t[2]=(f-b)*y,t[3]=0,t[4]=(d-w)*A,t[5]=(1-(c+p))*A,t[6]=(g+v)*A,t[7]=0,t[8]=(f+b)*_,t[9]=(g-v)*_,t[10]=(1-(c+m))*_,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Ce(t,e,i,n,r){var a=e[0],s=e[1],o=e[2],l=e[3],h=a+a,u=s+s,c=o+o,d=a*h,f=a*u,m=a*c,g=s*u,p=s*c,v=o*c,b=l*h,w=l*u,y=l*c,A=n[0],_=n[1],x=n[2],T=r[0],E=r[1],S=r[2],M=(1-(g+v))*A,R=(f+y)*A,I=(m-w)*A,B=(f-y)*_,C=(1-(d+v))*_,L=(p+b)*_,U=(m+w)*x,k=(p-b)*x,F=(1-(d+g))*x;return t[0]=M,t[1]=R,t[2]=I,t[3]=0,t[4]=B,t[5]=C,t[6]=L,t[7]=0,t[8]=U,t[9]=k,t[10]=F,t[11]=0,t[12]=i[0]+T-(M*T+B*E+U*S),t[13]=i[1]+E-(R*T+C*E+k*S),t[14]=i[2]+S-(I*T+L*E+F*S),t[15]=1,t}function Le(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i+i,o=n+n,l=r+r,h=i*s,u=n*s,c=n*o,d=r*s,f=r*o,m=r*l,g=a*s,p=a*o,v=a*l;return t[0]=1-c-m,t[1]=u+v,t[2]=d-p,t[3]=0,t[4]=u-v,t[5]=1-h-m,t[6]=f+g,t[7]=0,t[8]=d+p,t[9]=f-g,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ue(t,e,i,n,r,a,s){var o=1/(i-e),l=1/(r-n),h=1/(a-s);return t[0]=2*a*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*l,t[6]=0,t[7]=0,t[8]=(i+e)*o,t[9]=(r+n)*l,t[10]=(s+a)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*h,t[15]=0,t}function ke(t,e,i,n,r){var a=1/Math.tan(e/2),s=void 0;return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(n-r),t[10]=(r+n)*s,t[14]=2*r*n*s):(t[10]=-1,t[14]=-2*n),t}function Fe(t,e,i,n){var r=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),l=2/(s+o),h=2/(r+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(s-o)*l*.5,t[9]=(r-a)*h*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t}function Pe(t,e,i,n,r,a,s){var o=1/(e-i),l=1/(n-r),h=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*o,t[13]=(r+n)*l,t[14]=(s+a)*h,t[15]=1,t}function De(t,e,i,n){var r=void 0,a=void 0,s=void 0,o=void 0,l=void 0,h=void 0,u=void 0,c=void 0,d=void 0,f=void 0,m=e[0],g=e[1],p=e[2],v=n[0],b=n[1],w=n[2],A=i[0],_=i[1],x=i[2];return Math.abs(m-A)<y&&Math.abs(g-_)<y&&Math.abs(p-x)<y?oe(t):(u=m-A,c=g-_,d=p-x,r=b*(d*=f=1/Math.sqrt(u*u+c*c+d*d))-w*(c*=f),a=w*(u*=f)-v*d,s=v*c-b*u,(f=Math.sqrt(r*r+a*a+s*s))?(r*=f=1/f,a*=f,s*=f):(r=0,a=0,s=0),o=c*s-d*a,l=d*r-u*s,h=u*a-c*r,(f=Math.sqrt(o*o+l*l+h*h))?(o*=f=1/f,l*=f,h*=f):(o=0,l=0,h=0),t[0]=r,t[1]=o,t[2]=u,t[3]=0,t[4]=a,t[5]=l,t[6]=c,t[7]=0,t[8]=s,t[9]=h,t[10]=d,t[11]=0,t[12]=-(r*m+a*g+s*p),t[13]=-(o*m+l*g+h*p),t[14]=-(u*m+c*g+d*p),t[15]=1,t)}function Oe(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=n[0],l=n[1],h=n[2],u=r-i[0],c=a-i[1],d=s-i[2],f=u*u+c*c+d*d;f>0&&(u*=f=1/Math.sqrt(f),c*=f,d*=f);var m=l*d-h*c,g=h*u-o*d,p=o*c-l*u;return(f=m*m+g*g+p*p)>0&&(m*=f=1/Math.sqrt(f),g*=f,p*=f),t[0]=m,t[1]=g,t[2]=p,t[3]=0,t[4]=c*p-d*g,t[5]=d*m-u*p,t[6]=u*g-c*m,t[7]=0,t[8]=u,t[9]=c,t[10]=d,t[11]=0,t[12]=r,t[13]=a,t[14]=s,t[15]=1,t}function Ne(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ve(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function Ge(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function je(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function He(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function $e(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t}function qe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function ze(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],u=t[8],c=t[9],d=t[10],f=t[11],m=t[12],g=t[13],p=t[14],v=t[15],b=e[0],w=e[1],A=e[2],_=e[3],x=e[4],T=e[5],E=e[6],S=e[7],M=e[8],R=e[9],I=e[10],B=e[11],C=e[12],L=e[13],U=e[14],k=e[15];return Math.abs(i-b)<=y*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-w)<=y*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(r-A)<=y*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(a-_)<=y*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-x)<=y*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(o-T)<=y*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-E)<=y*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(h-S)<=y*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(u-M)<=y*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-R)<=y*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(d-I)<=y*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(f-B)<=y*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(m-C)<=y*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(g-L)<=y*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(p-U)<=y*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(v-k)<=y*Math.max(1,Math.abs(v),Math.abs(k))}var Ke=de,We=je;function Ye(){var t=new A(3);return A!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Xe(t){var e=new A(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Je(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function Ze(t,e,i){var n=new A(3);return n[0]=t,n[1]=e,n[2]=i,n}function Qe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ti(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function ei(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ii(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function ni(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function ri(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function ai(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function si(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function oi(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function li(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function hi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ui(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ci(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function di(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(i*i+n*n+r*r)}function fi(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r}function mi(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function gi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function pi(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function vi(t,e){var i=e[0],n=e[1],r=e[2],a=i*i+n*n+r*r;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function bi(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function wi(t,e,i){var n=e[0],r=e[1],a=e[2],s=i[0],o=i[1],l=i[2];return t[0]=r*l-a*o,t[1]=a*s-n*l,t[2]=n*o-r*s,t}function yi(t,e,i,n){var r=e[0],a=e[1],s=e[2];return t[0]=r+n*(i[0]-r),t[1]=a+n*(i[1]-a),t[2]=s+n*(i[2]-s),t}function Ai(t,e,i,n,r,a){var s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,h=s*(a-1),u=s*(3-2*a);return t[0]=e[0]*o+i[0]*l+n[0]*h+r[0]*u,t[1]=e[1]*o+i[1]*l+n[1]*h+r[1]*u,t[2]=e[2]*o+i[2]*l+n[2]*h+r[2]*u,t}function _i(t,e,i,n,r,a){var s=1-a,o=s*s,l=a*a,h=o*s,u=3*a*o,c=3*l*s,d=l*a;return t[0]=e[0]*h+i[0]*u+n[0]*c+r[0]*d,t[1]=e[1]*h+i[1]*u+n[1]*c+r[1]*d,t[2]=e[2]*h+i[2]*u+n[2]*c+r[2]*d,t}function xi(t,e){e=e||1;var i=2*_()*Math.PI,n=2*_()-1,r=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=n*e,t}function Ti(t,e,i){var n=e[0],r=e[1],a=e[2],s=i[3]*n+i[7]*r+i[11]*a+i[15];return s=s||1,t[0]=(i[0]*n+i[4]*r+i[8]*a+i[12])/s,t[1]=(i[1]*n+i[5]*r+i[9]*a+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*a+i[14])/s,t}function Ei(t,e,i){var n=e[0],r=e[1],a=e[2];return t[0]=n*i[0]+r*i[3]+a*i[6],t[1]=n*i[1]+r*i[4]+a*i[7],t[2]=n*i[2]+r*i[5]+a*i[8],t}function Si(t,e,i){var n=i[0],r=i[1],a=i[2],s=i[3],o=e[0],l=e[1],h=e[2],u=r*h-a*l,c=a*o-n*h,d=n*l-r*o,f=r*d-a*c,m=a*u-n*d,g=n*c-r*u,p=2*s;return u*=p,c*=p,d*=p,f*=2,m*=2,g*=2,t[0]=o+u+f,t[1]=l+c+m,t[2]=h+d+g,t}function Mi(t,e,i,n){var r=[],a=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],a[0]=r[0],a[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),a[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function Ri(t,e,i,n){var r=[],a=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],a[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),a[1]=r[1],a[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function Ii(t,e,i,n){var r=[],a=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],a[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),a[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),a[2]=r[2],t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function Bi(t,e){var i=Ze(t[0],t[1],t[2]),n=Ze(e[0],e[1],e[2]);vi(i,i),vi(n,n);var r=bi(i,n);return r>1?0:r<-1?Math.PI:Math.acos(r)}function Ci(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Li(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Ui(t,e){var i=t[0],n=t[1],r=t[2],a=e[0],s=e[1],o=e[2];return Math.abs(i-a)<=y*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=y*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=y*Math.max(1,Math.abs(r),Math.abs(o))}var ki,Fi=ii,Pi=ni,Di=ri,Oi=di,Ni=fi,Vi=Je,Gi=mi,ji=(ki=Ye(),function(t,e,i,n,r,a){var s=void 0,o=void 0;for(e||(e=3),i||(i=0),o=n?Math.min(n*e+i,t.length):t.length,s=i;s<o;s+=e)ki[0]=t[s],ki[1]=t[s+1],ki[2]=t[s+2],r(ki,ki,a),t[s]=ki[0],t[s+1]=ki[1],t[s+2]=ki[2];return t});function Hi(){var t=new A(4);return A!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function $i(t){var e=new A(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function qi(t,e,i,n){var r=new A(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function zi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ki(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}function Wi(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Yi(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Xi(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function Ji(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Zi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Qi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function tn(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function en(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function nn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function rn(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function an(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t}function sn(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(i*i+n*n+r*r+a*a)}function on(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],a=e[3]-t[3];return i*i+n*n+r*r+a*a}function ln(t){var e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)}function hn(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r}function un(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function dn(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i*i+n*n+r*r+a*a;return s>0&&(s=1/Math.sqrt(s),t[0]=i*s,t[1]=n*s,t[2]=r*s,t[3]=a*s),t}function fn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function mn(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3];return t[0]=r+n*(i[0]-r),t[1]=a+n*(i[1]-a),t[2]=s+n*(i[2]-s),t[3]=o+n*(i[3]-o),t}function gn(t,e){var i,n,r,a,s,o;e=e||1;do{s=(i=2*_()-1)*i+(n=2*_()-1)*n}while(s>=1);do{o=(r=2*_()-1)*r+(a=2*_()-1)*a}while(o>=1);var l=Math.sqrt((1-s)/o);return t[0]=e*i,t[1]=e*n,t[2]=e*r*l,t[3]=e*a*l,t}function pn(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*a+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*a+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*a+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*a+i[15]*s,t}function vn(t,e,i){var n=e[0],r=e[1],a=e[2],s=i[0],o=i[1],l=i[2],h=i[3],u=h*n+o*a-l*r,c=h*r+l*n-s*a,d=h*a+s*r-o*n,f=-s*n-o*r-l*a;return t[0]=u*h+f*-s+c*-l-d*-o,t[1]=c*h+f*-o+d*-s-u*-l,t[2]=d*h+f*-l+u*-o-c*-s,t[3]=e[3],t}function bn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function wn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function yn(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=e[0],o=e[1],l=e[2],h=e[3];return Math.abs(i-s)<=y*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-h)<=y*Math.max(1,Math.abs(a),Math.abs(h))}var An=Yi,_n=Xi,xn=Ji,Tn=sn,En=on,Sn=ln,Mn=hn,Rn=function(){var t=Hi();return function(e,i,n,r,a,s){var o=void 0,l=void 0;for(i||(i=4),n||(n=0),l=r?Math.min(r*i+n,e.length):e.length,o=n;o<l;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}();function In(){var t=new A(4);return A!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Bn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Cn(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function Ln(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>y?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i}function Un(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=i[0],l=i[1],h=i[2],u=i[3];return t[0]=n*u+s*o+r*h-a*l,t[1]=r*u+s*l+a*o-n*h,t[2]=a*u+s*h+n*l-r*o,t[3]=s*u-n*o-r*l-a*h,t}function kn(t,e,i){i*=.5;var n=e[0],r=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=n*l+s*o,t[1]=r*l+a*o,t[2]=a*l-r*o,t[3]=s*l-n*o,t}function Fn(t,e,i){i*=.5;var n=e[0],r=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=n*l-a*o,t[1]=r*l+s*o,t[2]=a*l+n*o,t[3]=s*l-r*o,t}function Pn(t,e,i){i*=.5;var n=e[0],r=e[1],a=e[2],s=e[3],o=Math.sin(i),l=Math.cos(i);return t[0]=n*l+r*o,t[1]=r*l-n*o,t[2]=a*l+s*o,t[3]=s*l-a*o,t}function Dn(t,e){var i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t}function On(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3],l=i[0],h=i[1],u=i[2],c=i[3],d=void 0,f=void 0,m=void 0,g=void 0,p=void 0;return(f=r*l+a*h+s*u+o*c)<0&&(f=-f,l=-l,h=-h,u=-u,c=-c),1-f>y?(d=Math.acos(f),m=Math.sin(d),g=Math.sin((1-n)*d)/m,p=Math.sin(n*d)/m):(g=1-n,p=n),t[0]=g*r+p*l,t[1]=g*a+p*h,t[2]=g*s+p*u,t[3]=g*o+p*c,t}function Nn(t){var e=_(),i=_(),n=_(),r=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=r*Math.sin(2*Math.PI*i),t[1]=r*Math.cos(2*Math.PI*i),t[2]=a*Math.sin(2*Math.PI*n),t[3]=a*Math.cos(2*Math.PI*n),t}function Vn(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i*i+n*n+r*r+a*a,o=s?1/s:0;return t[0]=-i*o,t[1]=-n*o,t[2]=-r*o,t[3]=a*o,t}function Gn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function jn(t,e){var i=e[0]+e[4]+e[8],n=void 0;if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var a=(r+1)%3,s=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*a+a]-e[3*s+s]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*a+s]-e[3*s+a])*n,t[a]=(e[3*a+r]+e[3*r+a])*n,t[s]=(e[3*s+r]+e[3*r+s])*n}return t}function Hn(t,e,i,n){var r=.5*Math.PI/180;e*=r,i*=r,n*=r;var a=Math.sin(e),s=Math.cos(e),o=Math.sin(i),l=Math.cos(i),h=Math.sin(n),u=Math.cos(n);return t[0]=a*l*u-s*o*h,t[1]=s*o*u+a*l*h,t[2]=s*l*h-a*o*u,t[3]=s*l*u+a*o*h,t}function $n(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var qn,zn,Kn,Wn,Yn,Xn,Jn=$i,Zn=qi,Qn=zi,tr=Ki,er=Wi,ir=Un,nr=rn,rr=fn,ar=mn,sr=ln,or=sr,lr=hn,hr=lr,ur=dn,cr=wn,dr=yn,fr=(qn=Ye(),zn=Ze(1,0,0),Kn=Ze(0,1,0),function(t,e,i){var n=bi(e,i);return n<-.999999?(wi(qn,zn,e),Vi(qn)<1e-6&&wi(qn,Kn,e),vi(qn,qn),Cn(t,qn,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(wi(qn,e,i),t[0]=qn[0],t[1]=qn[1],t[2]=qn[2],t[3]=1+n,ur(t,t))}),mr=(Wn=In(),Yn=In(),function(t,e,i,n,r,a){return On(Wn,e,r,a),On(Yn,i,n,a),On(t,Wn,Yn,2*a*(1-a)),t}),gr=(Xn=Tt(),function(t,e,i,n){return Xn[0]=i[0],Xn[3]=i[1],Xn[6]=i[2],Xn[1]=n[0],Xn[4]=n[1],Xn[7]=n[2],Xn[2]=-e[0],Xn[5]=-e[1],Xn[8]=-e[2],ur(t,jn(t,Xn))});function pr(){var t=new A(8);return A!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function vr(t){var e=new A(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function br(t,e,i,n,r,a,s,o){var l=new A(8);return l[0]=t,l[1]=e,l[2]=i,l[3]=n,l[4]=r,l[5]=a,l[6]=s,l[7]=o,l}function wr(t,e,i,n,r,a,s){var o=new A(8);o[0]=t,o[1]=e,o[2]=i,o[3]=n;var l=.5*r,h=.5*a,u=.5*s;return o[4]=l*n+h*i-u*e,o[5]=h*n+u*t-l*i,o[6]=u*n+l*e-h*t,o[7]=-l*t-h*e-u*i,o}function yr(t,e,i){var n=.5*i[0],r=.5*i[1],a=.5*i[2],s=e[0],o=e[1],l=e[2],h=e[3];return t[0]=s,t[1]=o,t[2]=l,t[3]=h,t[4]=n*h+r*l-a*o,t[5]=r*h+a*s-n*l,t[6]=a*h+n*o-r*s,t[7]=-n*s-r*o-a*l,t}function Ar(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function _r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function xr(t,e){var i=In();Ie(i,e);var n=new A(3);return Me(n,e),yr(t,i,n),t}function Tr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Er(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Sr(t,e,i,n,r,a,s,o,l){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=a,t[5]=s,t[6]=o,t[7]=l,t}var Mr=Qn;function Rr(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Ir=Qn;function Br(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Cr(t,e){var i=e[4],n=e[5],r=e[6],a=e[7],s=-e[0],o=-e[1],l=-e[2],h=e[3];return t[0]=2*(i*h+a*s+n*l-r*o),t[1]=2*(n*h+a*o+r*s-i*l),t[2]=2*(r*h+a*l+i*o-n*s),t}function Lr(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=.5*i[0],l=.5*i[1],h=.5*i[2],u=e[4],c=e[5],d=e[6],f=e[7];return t[0]=n,t[1]=r,t[2]=a,t[3]=s,t[4]=s*o+r*h-a*l+u,t[5]=s*l+a*o-n*h+c,t[6]=s*h+n*l-r*o+d,t[7]=-n*o-r*l-a*h+f,t}function Ur(t,e,i){var n=-e[0],r=-e[1],a=-e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=o*s+u*n+l*a-h*r,d=l*s+u*r+h*n-o*a,f=h*s+u*a+o*r-l*n,m=u*s-o*n-l*r-h*a;return kn(t,e,i),n=t[0],r=t[1],a=t[2],s=t[3],t[4]=c*s+m*n+d*a-f*r,t[5]=d*s+m*r+f*n-c*a,t[6]=f*s+m*a+c*r-d*n,t[7]=m*s-c*n-d*r-f*a,t}function kr(t,e,i){var n=-e[0],r=-e[1],a=-e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=o*s+u*n+l*a-h*r,d=l*s+u*r+h*n-o*a,f=h*s+u*a+o*r-l*n,m=u*s-o*n-l*r-h*a;return Fn(t,e,i),n=t[0],r=t[1],a=t[2],s=t[3],t[4]=c*s+m*n+d*a-f*r,t[5]=d*s+m*r+f*n-c*a,t[6]=f*s+m*a+c*r-d*n,t[7]=m*s-c*n-d*r-f*a,t}function Fr(t,e,i){var n=-e[0],r=-e[1],a=-e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=o*s+u*n+l*a-h*r,d=l*s+u*r+h*n-o*a,f=h*s+u*a+o*r-l*n,m=u*s-o*n-l*r-h*a;return Pn(t,e,i),n=t[0],r=t[1],a=t[2],s=t[3],t[4]=c*s+m*n+d*a-f*r,t[5]=d*s+m*r+f*n-c*a,t[6]=f*s+m*a+c*r-d*n,t[7]=m*s-c*n-d*r-f*a,t}function Pr(t,e,i){var n=i[0],r=i[1],a=i[2],s=i[3],o=e[0],l=e[1],h=e[2],u=e[3];return t[0]=o*s+u*n+l*a-h*r,t[1]=l*s+u*r+h*n-o*a,t[2]=h*s+u*a+o*r-l*n,t[3]=u*s-o*n-l*r-h*a,o=e[4],l=e[5],h=e[6],u=e[7],t[4]=o*s+u*n+l*a-h*r,t[5]=l*s+u*r+h*n-o*a,t[6]=h*s+u*a+o*r-l*n,t[7]=u*s-o*n-l*r-h*a,t}function Dr(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=i[0],l=i[1],h=i[2],u=i[3];return t[0]=n*u+s*o+r*h-a*l,t[1]=r*u+s*l+a*o-n*h,t[2]=a*u+s*h+n*l-r*o,t[3]=s*u-n*o-r*l-a*h,o=i[4],l=i[5],h=i[6],u=i[7],t[4]=n*u+s*o+r*h-a*l,t[5]=r*u+s*l+a*o-n*h,t[6]=a*u+s*h+n*l-r*o,t[7]=s*u-n*o-r*l-a*h,t}function Or(t,e,i,n){if(Math.abs(n)<y)return Tr(t,e);var r=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);n*=.5;var a=Math.sin(n),s=a*i[0]/r,o=a*i[1]/r,l=a*i[2]/r,h=Math.cos(n),u=e[0],c=e[1],d=e[2],f=e[3];t[0]=u*h+f*s+c*l-d*o,t[1]=c*h+f*o+d*s-u*l,t[2]=d*h+f*l+u*o-c*s,t[3]=f*h-u*s-c*o-d*l;var m=e[4],g=e[5],p=e[6],v=e[7];return t[4]=m*h+v*s+g*l-p*o,t[5]=g*h+v*o+p*s-m*l,t[6]=p*h+v*l+m*o-g*s,t[7]=v*h-m*s-g*o-p*l,t}function Nr(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t}function Vr(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=i[4],l=i[5],h=i[6],u=i[7],c=e[4],d=e[5],f=e[6],m=e[7],g=i[0],p=i[1],v=i[2],b=i[3];return t[0]=n*b+s*g+r*v-a*p,t[1]=r*b+s*p+a*g-n*v,t[2]=a*b+s*v+n*p-r*g,t[3]=s*b-n*g-r*p-a*v,t[4]=n*u+s*o+r*h-a*l+c*b+m*g+d*v-f*p,t[5]=r*u+s*l+a*o-n*h+d*b+m*p+f*g-c*v,t[6]=a*u+s*h+n*l-r*o+f*b+m*v+c*p-d*g,t[7]=s*u-n*o-r*l-a*h+m*b-c*g-d*p-f*v,t}var Gr=Vr;function jr(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t}var Hr=rr;function $r(t,e,i,n){var r=1-n;return Hr(e,i)<0&&(n=-n),t[0]=e[0]*r+i[0]*n,t[1]=e[1]*r+i[1]*n,t[2]=e[2]*r+i[2]*n,t[3]=e[3]*r+i[3]*n,t[4]=e[4]*r+i[4]*n,t[5]=e[5]*r+i[5]*n,t[6]=e[6]*r+i[6]*n,t[7]=e[7]*r+i[7]*n,t}function qr(t,e){var i=Yr(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t}function zr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Kr=sr,Wr=Kr,Yr=lr,Xr=Yr;function Jr(t,e){var i=Yr(e);if(i>0){i=Math.sqrt(i);var n=e[0]/i,r=e[1]/i,a=e[2]/i,s=e[3]/i,o=e[4],l=e[5],h=e[6],u=e[7],c=n*o+r*l+a*h+s*u;t[0]=n,t[1]=r,t[2]=a,t[3]=s,t[4]=(o-n*c)/i,t[5]=(l-r*c)/i,t[6]=(h-a*c)/i,t[7]=(u-s*c)/i}return t}function Zr(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Qr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function ta(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],u=e[0],c=e[1],d=e[2],f=e[3],m=e[4],g=e[5],p=e[6],v=e[7];return Math.abs(i-u)<=y*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-c)<=y*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-d)<=y*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-f)<=y*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-m)<=y*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-g)<=y*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-p)<=y*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(h-v)<=y*Math.max(1,Math.abs(h),Math.abs(v))}function ea(){var t=new A(2);return A!=Float32Array&&(t[0]=0,t[1]=0),t}function ia(t){var e=new A(2);return e[0]=t[0],e[1]=t[1],e}function na(t,e){var i=new A(2);return i[0]=t,i[1]=e,i}function ra(t,e){return t[0]=e[0],t[1]=e[1],t}function aa(t,e,i){return t[0]=e,t[1]=i,t}function sa(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function oa(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function la(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function ha(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function ua(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function ca(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function da(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function fa(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function ma(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function ga(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function pa(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t}function va(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)}function ba(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function wa(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function ya(t){var e=t[0],i=t[1];return e*e+i*i}function Aa(t,e){return t[0]=-e[0],t[1]=-e[1],t}function _a(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function xa(t,e){var i=e[0],n=e[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t}function Ta(t,e){return t[0]*e[0]+t[1]*e[1]}function Ea(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t}function Sa(t,e,i,n){var r=e[0],a=e[1];return t[0]=r+n*(i[0]-r),t[1]=a+n*(i[1]-a),t}function Ma(t,e){e=e||1;var i=2*_()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function Ra(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t}function Ia(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t}function Ba(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t}function Ca(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t}function La(t,e,i,n){var r=e[0]-i[0],a=e[1]-i[1],s=Math.sin(n),o=Math.cos(n);return t[0]=r*o-a*s+i[0],t[1]=r*s+a*o+i[1],t}function Ua(t,e){var i=t[0],n=t[1],r=e[0],a=e[1],s=i*i+n*n;s>0&&(s=1/Math.sqrt(s));var o=r*r+a*a;o>0&&(o=1/Math.sqrt(o));var l=(i*r+n*a)*s*o;return l>1?0:l<-1?Math.PI:Math.acos(l)}function ka(t){return"vec2("+t[0]+", "+t[1]+")"}function Fa(t,e){return t[0]===e[0]&&t[1]===e[1]}function Pa(t,e){var i=t[0],n=t[1],r=e[0],a=e[1];return Math.abs(i-r)<=y*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-a)<=y*Math.max(1,Math.abs(n),Math.abs(a))}var Da=wa,Oa=oa,Na=la,Va=ha,Ga=va,ja=ba,Ha=ya,$a=function(){var t=ea();return function(e,i,n,r,a,s){var o=void 0,l=void 0;for(i||(i=2),n||(n=0),l=r?Math.min(r*i+n,e.length):e.length,o=n;o<l;o+=i)t[0]=e[o],t[1]=e[o+1],a(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}}();let qa=l.fromValues(1,0,0),za=l.fromValues(0,1,0),Ka=l.fromValues(0,0,1),Wa=l.create(),Ya=l.fromValues(1,1,1),Xa=u.fromValues(0,0,0,0),Ja=u.create(),Za=h.create();function Qa(t,e,i,n){let r=2*(e[0]-n[0])/n[2]-1,a=1-2*(e[1]-n[1])/n[3],s=2*e[2]-1;return h.set(Za,r,a,s,1),h.transformMat4(Za,Za,i),l.set(t,Za[0]/Za[3],Za[1]/Za[3],Za[2]/Za[3]),t}function ts(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}function es(t,e){let i=l.len(e);t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i}function is(t,e){let i,n=e[0],r=e[4],a=e[8],s=e[12],o=e[1],l=e[5],h=e[9],u=e[13],c=e[2],d=e[6],f=e[10],m=e[14],g=e[3],p=e[7],v=e[11],b=e[15];(i=t[0])[0]=g+n,i[1]=p+r,i[2]=v+a,i[3]=b+s,(i=t[1])[0]=g-n,i[1]=p-r,i[2]=v-a,i[3]=b-s,(i=t[2])[0]=g-o,i[1]=p-l,i[2]=v-h,i[3]=b-u,(i=t[3])[0]=g+o,i[1]=p+l,i[2]=v+h,i[3]=b+u,(i=t[4])[0]=g+c,i[1]=p+d,i[2]=v+f,i[3]=b+m,(i=t[5])[0]=g-c,i[1]=p-d,i[2]=v-f,i[3]=b-m,es(t[0],t[0]),es(t[1],t[1]),es(t[2],t[2]),es(t[3],t[3]),es(t[4],t[4]),es(t[5],t[5])}let ns=l.create();function rs(t){return l.transformQuat(ns,za,t),Math.atan2(ns[2],ns[1])}function as(t){return l.transformQuat(ns,Ka,t),Math.atan2(ns[0],ns[2])}function ss(t){return l.transformQuat(ns,qa,t),Math.atan2(ns[1],ns[0])}function os(t){return t*(Math.PI/180)}function ls(t){return t*(180/Math.PI)}function hs(t,e){return t+Math.random()*(e-t)}function us(t,e,i){return Math.min(Math.max(t,e),i)}function cs(t,e,i){return t+i*(e-t)}function ds(t,e,i,n,r){let a=r*r;return t*(a*(2*r-3)+1)+e*(a*(r-2)+r)+i*(a*(r-1))+n*(a*(3-2*r))}function fs(t,e,i,n,r){let a=1-r,s=r*r,o=a*a;return t*(o*a)+e*(3*r*o)+i*(3*s*a)+n*(s*r)}function ms(t,e){let i=Math.sign(e);return 0===i?0:Math.sign(t)!==i?-t:t}function gs(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function ps(t){return 0!==t&&0==(t&t-1)}let vs=document.createElement("canvas"),bs=vs.getContext("2d"),ws=document.createElement("canvas"),ys=ws.getContext("2d");function As(t){return new Promise((e,i)=>{let n=URL.createObjectURL(t),r=new Image;r.onload=(()=>{vs.width=r.width,vs.height=r.height,bs.drawImage(r,0,0),e(r)}),r.onerror=(t=>{i(t)}),r.src=n})}function _s(t){return new Promise((e,i)=>{let n=URL.createObjectURL(t),r=new Image;r.onload=(()=>{URL.revokeObjectURL(n),vs.width=r.width,vs.height=r.height,bs.drawImage(r,0,0),e(bs.getImageData(0,0,r.width,r.height))}),r.onerror=(t=>{i(t)}),r.src=n})}function xs(t){return new Promise((e,i)=>{vs.width=t.width,vs.height=t.height,bs.putImageData(t,0,0),vs.toBlob(t=>{e(t)})})}function Ts(t){return vs.width=t.width,vs.height=t.height,bs.putImageData(t,0,0),vs.toDataURL()}function Es(t){let e=new Image;return e.src=Ts(t),e}function Ss(t){let e=t.width,i=t.height;return vs.width=e,vs.height=i,bs.drawImage(t,0,0),bs.getImageData(0,0,e,i)}function Ms(t){let e=t.width,i=t.height,n=gs(e),r=gs(i);return e!==n||i!==r?Rs(t,n,r):t}function Rs(t,e,i){let n=t.width,r=t.height;return t instanceof ImageData?(vs.width=n,vs.height=r,bs.putImageData(t,0,0),ws.width=e,ws.height=i,ys.drawImage(vs,0,0,e,i),ys.getImageData(0,0,e,i)):(vs.width=e,vs.height=i,bs.drawImage(t,0,0,e,i),bs.getImageData(0,0,e,i))}function Is(t){let e=t[0].width,i=t[0].height,n=gs(Math.ceil(Math.sqrt(t.length))),r=gs(Math.ceil(t.length/n));vs.width=e*n,vs.height=i*r;for(let e=0,r=t.length;e<r;e++)bs.putImageData(t[e],e%n*i,Math.floor(e/n)*i);return{imageData:bs.getImageData(0,0,vs.width,vs.height),columns:n,rows:n}}function Bs(t,e){return{vertices:new Float32Array([-t,e,0,-t,-e,0,t,-e,0,t,e,0]),uvs:new Float32Array([0,0,0,1,1,1,1,0]),faces:new Uint8Array([0,1,2,0,2,3]),edges:new Uint8Array([0,1,1,2,2,3,3,0]),boundingRadius:Math.max(t,e)}}function Cs(){return Bs(1,1)}function Ls(t,e,i){return{vertices:new Float32Array([-t,-e,-i,-t,-e,i,-t,e,-i,-t,e,i,t,e,-i,t,e,i,t,-e,-i,t,-e,i]),uvs:new Float32Array([0,0,0,1,.25,0,.25,1,.5,0,.5,1,.75,0,.75,1]),faces:new Uint8Array([0,1,2,1,3,2,2,3,4,3,5,4,4,5,6,5,7,6,6,7,0,7,1,0,0,2,4,0,4,6,1,5,3,1,7,5]),edges:new Uint8Array([0,1,2,3,4,5,6,7,0,2,2,4,4,6,6,0,1,3,3,5,5,7,7,1]),boundingRadius:Math.max(t,e,i)}}function Us(){return Ls(1,1,1)}function ks(t,e){return e<255?new Uint8Array(t):e<65535?new Uint16Array(t):new Uint32Array(t)}function Fs(t,e,i){let n=(e+1)*(i+1),r=new Float32Array(3*n),a=new Float32Array(2*n),s=ks(e*i*6,n),o=ks(e*i*6,n);for(let n=0,s=0,o=0;n<=e;n++){let l=n*Math.PI/e,h=Math.sin(l),u=Math.cos(l);for(let l=0;l<=i;l+=1,s+=3,o+=2){let c=2*l*Math.PI/i,d=Math.sin(c),f=Math.cos(c);r[s+0]=f*h*t,r[s+1]=d*h*t,r[s+2]=u*t,a[o+0]=l/i,a[o+1]=1-n/e}}for(let t=0,n=0;t<e;t++)for(let e=0;e<i;e+=1,n+=6){let r=t*(i+1)+e,a=r+i+1;s[n+0]=r,s[n+1]=a,s[n+2]=r+1,s[n+3]=a,s[n+4]=a+1,s[n+5]=r+1,o[n+0]=r,o[n+1]=a,o[n+2]=r,o[n+3]=r+1,o[n+4]=a,o[n+5]=a+1}return{vertices:r,uvs:a,faces:s,edges:o,boundingRadius:t}}function Ps(t,e){return Fs(1,t,e)}function Ds(t,e,i){let n=2*((i=Math.max(i,3))+1)+2,r=new Float32Array(3*n),a=new Float32Array(2*n),s=ks(12*i,n),o=ks(10*i,n),l=2*Math.PI/i,h=0,u=0;for(let n=0;n<i+1;n+=1,h+=6,u+=4){let s=Math.cos(l*n)*t,o=Math.sin(l*n)*t,c=n/i;r[h+0]=s,r[h+1]=o,r[h+2]=e,r[h+3]=s,r[h+4]=o,r[h+5]=-e,a[u+0]=c,a[u+1]=1,a[u+2]=c,a[u+3]=0}r[h+0]=0,r[h+1]=0,r[h+2]=e,r[h+3]=0,r[h+4]=0,r[h+5]=-e,a[u+0]=0,a[u+1]=1,a[u+2]=0,a[u+3]=0;for(let t=0,e=0,r=0;t<i;t+=1,e+=12,r+=10){let i=2*t;s[e+0]=i+0,s[e+1]=i+1,s[e+2]=(i+3)%(n-2),s[e+3]=i+0,s[e+4]=(i+3)%(n-2),s[e+5]=(i+2)%(n-2),s[e+6]=i+0,s[e+7]=(i+2)%(n-2),s[e+8]=n-2,s[e+9]=i+1,s[e+10]=(i+3)%(n-2),s[e+11]=n-1,o[r+0]=i+0,o[r+1]=i+1,o[r+2]=i+0,o[r+3]=(i+2)%(n-2),o[r+4]=i+1,o[r+5]=(i+3)%(n-2),o[r+6]=i+0,o[r+7]=n-2,o[r+8]=i+1,o[r+9]=n-1}return{vertices:r,uvs:a,faces:s,edges:o,boundingRadius:Math.max(t,e)}}function Os(t){return Ds(1,1,t)}function Ns(t){let e=t[0].length,i=t.length,n=e*i,r=new Float32Array(3*n),a=new Float32Array(2*n),s=new Uint32Array(6*n),o=new Uint32Array((e-1)*(i-1)*4+2*(e-1)+2*(i-1)),l=0,h=0,u=0,c=0;for(let n=0;n<i;n++)for(let s=0;s<e;s+=1,l+=3,h+=2)r[l+0]=s,r[l+1]=n,r[l+2]=t[n][s],a[h+0]=s/(e-1),a[h+1]=n/(i-1);for(let t=0;t<i-1;t++){let i=t*e;for(let t=0;t<e-1;t+=1,u+=6,c+=4)s[u+0]=i+t,s[u+1]=i+t+e,s[u+2]=i+t+e+1,s[u+3]=i+t,s[u+4]=i+t+e+1,s[u+5]=i+t+1,o[c+0]=i+t,o[c+1]=i+t+e,o[c+2]=i+t,o[c+3]=i+t+1}for(let t=0;t<e-1;t+=1,c+=2)o[c+0]=e*(i-1)+t,o[c+1]=e*(i-1)+t+1;for(let t=0;t<i-1;t+=1,c+=2)o[c+0]=e*t+e-1,o[c+1]=e*(t+1)+e-1;return{vertices:r,uvs:a,faces:s,edges:o}}function Vs(t,e,i,n){let r=2*Math.tan(t/2),a=r*i/2,s=i*e/2,o=r*n/2,l=n*e/2;return{vertices:new Float32Array([-s,-a,i,-s,a,i,-l,-o,n,-l,o,n,l,-o,n,l,o,n,s,-a,i,s,a,i]),uvs:new Float32Array([0,0,0,1,.25,0,.25,1,.5,0,.5,1,.75,0,.75,1]),faces:new Uint8Array([0,1,2,1,3,2,2,3,4,3,5,4,4,5,6,5,7,6,6,7,0,7,1,0,0,2,4,0,4,6,1,5,3,1,7,5]),edges:new Uint8Array([0,1,2,3,4,5,6,7,0,2,2,4,4,6,6,0,1,3,3,5,5,7,7,1])}}function Gs(t,e){let i=document.createElement("a");i.href=t,i.download=e,i.dispatchEvent(new MouseEvent("click"))}function js(t,e){let i=URL.createObjectURL(t);Gs(i,e),URL.revokeObjectURL(i)}function Hs(t,e){js(new Blob([t],{type:"application/octet-stream"}),e)}function $s(t,e){let i=t[0],n=t[1],r=t[2],a=e[0],s=e[1],o=e[2],l=a-i,h=s-n,u=o-r;return{center:new Float32Array([(i+a)/2,(n+s)/2,(r+o)/2]),radius:Math.sqrt(l*l+h*h+u*u)/2}}var qs=i(0);let zs=new Uint8Array(8);class Ks{constructor(t,e,i){if(ArrayBuffer.isView(t)&&(e=(t=t.buffer).byteOffset,i=t.byteLength),!(t instanceof ArrayBuffer))throw new TypeError(`BinaryStream: expected ArrayBuffer or ArrayBufferView, got ${t}`);this.buffer=t,this.uint8array=new Uint8Array(t,e,i),this.index=0,this.byteLength=t.byteLength}substream(t){return new Ks(this.buffer,this.index,t)}remaining(){return this.byteLength-this.index}skip(t){this.index+=t}seek(t){this.index=t}tell(){return this.index}peek(t,e){let i=this.uint8array,n=this.index,r="";for(let a=0;a<t;a++){let t=i[n+a];(e||t>0)&&(r+=String.fromCharCode(t))}return r}read(t,e){t=t||this.remaining();let i=this.peek(t,e);return this.index+=t,i}peekUntilNull(){let t=this.uint8array,e=this.index,i="",n=t[e],r=0;for(;0!==n;)i+=String.fromCharCode(n),n=t[e+(r+=1)];return i}readUntilNull(){let t=this.peekUntilNull();return this.index+=t.length+1,t}peekCharArray(t){let e=this.uint8array,i=this.index,n=[];for(let r=0;r<t;r++)n[r]=String.fromCharCode(e[i+r]);return n}readCharArray(t){let e=this.peekCharArray(t);return this.index+=t,e}readInt8(){let t=this.index,e=this.uint8array,i=Object(qs.n)(e[t]);return this.index+=1,i}readInt16(){let t=this.index,e=this.uint8array,i=Object(qs.l)(e[t],e[t+1]);return this.index+=2,i}readInt32(){let t=this.index,e=this.uint8array,i=Object(qs.m)(e[t],e[t+1],e[t+2],e[t+3]);return this.index+=4,i}readUint8(){let t=this.uint8array[this.index];return this.index+=1,t}readUint16(){let t=this.index,e=this.uint8array,i=Object(qs.o)(e[t],e[t+1]);return this.index+=2,i}readUint32(){let t=this.index,e=this.uint8array,i=Object(qs.q)(e[t],e[t+1],e[t+2],e[t+3]);return this.index+=4,i}readFloat32(){let t=this.index,e=this.uint8array,i=Object(qs.j)(e[t],e[t+1],e[t+2],e[t+3]);return this.index+=4,i}readFloat64(){let t=this.index,e=this.uint8array,i=Object(qs.k)(e[t],e[t+1],e[t+2],e[t+3],e[t+4],e[t+5],e[t+6],e[t+7]);return this.index+=8,i}readInt8Array(t){ArrayBuffer.isView(t)||(t=new Int8Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++)t[n]=Object(qs.n)(i[e+n]);return this.index+=t.byteLength,t}readInt16Array(t){ArrayBuffer.isView(t)||(t=new Int16Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+2*n;t[n]=Object(qs.l)(i[r],i[r+1])}return this.index+=t.byteLength,t}readInt32Array(t){ArrayBuffer.isView(t)||(t=new Int32Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+4*n;t[n]=Object(qs.l)(i[r],i[r+1],i[r+2],i[r+3])}return this.index+=t.byteLength,t}readUint8Array(t){ArrayBuffer.isView(t)||(t=new Uint8Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++)t[n]=i[e+n];return this.index+=t.byteLength,t}readUint16Array(t){ArrayBuffer.isView(t)||(t=new Uint16Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+2*n;t[n]=Object(qs.o)(i[r],i[r+1])}return this.index+=t.byteLength,t}readUint32Array(t){ArrayBuffer.isView(t)||(t=new Uint32Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+4*n;t[n]=Object(qs.q)(i[r],i[r+1],i[r+2],i[r+3])}return this.index+=t.byteLength,t}readFloat32Array(t){ArrayBuffer.isView(t)||(t=new Float32Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+4*n;t[n]=Object(qs.j)(i[r],i[r+1],i[r+2],i[r+3])}return this.index+=t.byteLength,t}readFloat64Array(t){ArrayBuffer.isView(t)||(t=new Float64Array(t));let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+8*n;t[n]=Object(qs.k)(i[r],i[r+1],i[r+2],i[r+3],i[r+4],i[r+5],i[r+6],i[r+7])}return this.index+=t.byteLength,t}readTypedArray(t){let e=new Uint8Array(t.buffer),i=this.index,n=this.uint8array;for(let t=0,r=e.length;t<r;t++)e[t]=n[i+t];this.index+=e.length}write(t){let e=this.index,i=this.uint8array,n=t.length;for(let r=0;r<n;r++)i[e+r]=t.charCodeAt(r);this.index+=n}writeInt8(t){this.uint8array[this.index]=Object(qs.f)(t),this.index+=1}writeInt16(t){let e=this.index,i=this.uint8array;Object(qs.d)(zs,t),i[e]=zs[0],i[e+1]=zs[1],this.index+=2}writeInt32(t){let e=this.index,i=this.uint8array;Object(qs.e)(zs,t),i[e]=zs[0],i[e+1]=zs[1],i[e+2]=zs[2],i[e+3]=zs[3],this.index+=4}writeUint8(t){this.uint8array[this.index]=t,this.index+=1}writeUint16(t){let e=this.index,i=this.uint8array;Object(qs.h)(zs,t),i[e]=zs[0],i[e+1]=zs[1],this.index+=2}writeUint32(t){let e=this.index,i=this.uint8array;Object(qs.i)(zs,t),i[e]=zs[0],i[e+1]=zs[1],i[e+2]=zs[2],i[e+3]=zs[3],this.index+=4}writeFloat32(t){let e=this.index,i=this.uint8array;Object(qs.b)(zs,t),i[e]=zs[0],i[e+1]=zs[1],i[e+2]=zs[2],i[e+3]=zs[3],this.index+=4}writeFloat64(t){let e=this.index,i=this.uint8array;Object(qs.c)(zs,t),i[e]=zs[0],i[e+1]=zs[1],i[e+2]=zs[2],i[e+3]=zs[3],i[e+4]=zs[4],i[e+5]=zs[5],i[e+6]=zs[6],i[e+7]=zs[7],this.index+=8}writeInt8Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++)i[e+n]=Object(qs.f)(t[n]);this.index+=t.byteLength}writeInt16Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+2*n;Object(qs.d)(zs,t[n]),i[r]=zs[0],i[r+1]=zs[1]}this.index+=t.byteLength}writeInt32Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+4*n;Object(qs.e)(zs,t[n]),i[r]=zs[0],i[r+1]=zs[1],i[r+2]=zs[2],i[r+3]=zs[3]}this.index+=t.byteLength}writeUint8Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++)i[e+n]=t[n];this.index+=t.byteLength}writeUint16Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+2*n;Object(qs.h)(zs,t[n]),i[r]=zs[0],i[r+1]=zs[1]}this.index+=t.byteLength}writeUint32Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+4*n;Object(qs.i)(zs,t[n]),i[r]=zs[0],i[r+1]=zs[1],i[r+2]=zs[2],i[r+3]=zs[3]}this.index+=t.byteLength}writeFloat32Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+4*n;Object(qs.b)(zs,t[n]),i[r]=zs[0],i[r+1]=zs[1],i[r+2]=zs[2],i[r+3]=zs[3]}this.index+=t.byteLength}writeFloat64Array(t){let e=this.index,i=this.uint8array;for(let n=0,r=t.length;n<r;n++){let r=e+8*n;Object(qs.c)(zs,t[n]),i[r]=zs[0],i[r+1]=zs[1],i[r+2]=zs[2],i[r+3]=zs[3],i[r+4]=zs[4],i[r+5]=zs[5],i[r+6]=zs[6],i[r+7]=zs[7]}this.index+=t.byteLength}writeTypedArray(t){let e=new Uint8Array(t.buffer),i=this.index,n=this.uint8array;for(let t=0,r=e.length;t<r;t++)n[i+t]=e[t]}}class Ws{constructor(t,e,i){if(ArrayBuffer.isView(t)&&(e=(t=t.buffer).byteOffset,i=t.byteLength),!(t instanceof ArrayBuffer))throw new TypeError(`BitStream: expected ArrayBuffer or ArrayBufferView, got ${t}`);this.buffer=t,this.uint8array=new Uint8Array(t,e,i),this.index=0,this.byteLength=t.byteLength,this.bitBuffer=0,this.bits=0}peekBits(t){return this.loadBits(t),this.bitBuffer&(1<<t)-1}readBits(t){let e=this.peekBits(t);return this.bitBuffer>>>=t,this.bits-=t,e}skipBits(t){this.loadBits(t),this.bitBuffer>>>=t,this.bits-=t}loadBits(t){for(;this.bits<t;)this.bitBuffer+=this.uint8array[this.index]<<this.bits,this.bits+=8,this.index+=1}}class Ys{constructor(t){this.buffer=t||"",this.index=0,this.ident=0,this.fractionDigits=6}read(){let t=this.buffer,e=t.length,i=!1,n=!1,r="";for(;this.index<e;){let e=t[this.index++];if(i)"\n"===e&&(i=!1);else if(n){if('"'===e)return r;r+=e}else if(" "===e||","===e||"\t"===e||"\n"===e||":"===e||"\r"===e){if(r.length)return r}else{if("{"===e||"}"===e)return r.length?(this.index--,r):e;if("/"===e&&"/"===t[this.index]){if(r.length)return this.index--,r;i=!0}else if('"'===e){if(r.length)return this.index--,r;n=!0}else r+=e}}}peek(){let t=this.index,e=this.read();return this.index=t,e}readInt(){return parseInt(this.read())}readFloat(){return parseFloat(this.read())}readKeyframe(t){1===t.length?t instanceof Float32Array?t[0]=this.readFloat():t[0]=this.readInt():this.readTypedArray(t)}readIntArray(t){this.read();for(let e=0,i=t.length;e<i;e++)t[e]=this.readInt();return this.read(),t}readFloatArray(t){this.read();for(let e=0,i=t.length;e<i;e++)t[e]=this.readFloat();return this.read(),t}readTypedArray(t){t instanceof Float32Array?this.readFloatArray(t):this.readIntArray(t)}readColor(t){this.read(),t[2]=this.readFloat(),t[1]=this.readFloat(),t[0]=this.readFloat(),this.read()}readVectorArray(t,e){this.read();for(let i=0,n=t.length/e;i<n;i++){this.read();for(let n=0;n<e;n++)t[i*e+n]=this.readFloat();this.read()}return this.read(),t}*readBlock(){this.read();let t=this.read();for(;"}"!==t;)yield t,t=this.read()}writeColor(t,e){this.writeLine(`${t} { ${e[2]}, ${e[1]}, ${e[0]} },`)}writeFlag(t){this.writeLine(`${t},`)}writeAttrib(t,e){this.writeLine(`${t} ${e},`)}writeFloatAttrib(t,e){this.writeLine(`${t} ${this.formatFloat(e)},`)}writeStringAttrib(t,e){this.writeLine(`${t} "${e}",`)}writeArrayAttrib(t,e){this.writeLine(`${t} { ${e.join(", ")} },`)}writeFloatArrayAttrib(t,e){this.writeLine(`${t} { ${this.formatFloatArray(e)} },`)}writeTypedArrayAttrib(t,e){e instanceof Float32Array?this.writeFloatArrayAttrib(t,e):this.writeArrayAttrib(t,e)}writeKeyframe(t,e){1===e.length?e instanceof Float32Array?this.writeFloatAttrib(t,e[0]):this.writeAttrib(t,e[0]):this.writeTypedArrayAttrib(t,e)}writeArray(t){this.writeLine(`{ ${t.join(", ")} },`)}writeFloatArray(t){this.writeLine(`{ ${this.formatFloatArray(t)} },`)}writeVectorArray(t,e,i){this.startBlock(t,e.length/i);for(let t=0,n=e.length;t<n;t+=i)this.writeFloatArray(e.subarray(t,t+i));this.endBlock()}write(t){this.buffer+=t}writeLine(t){this.buffer+=`${"\t".repeat(this.ident)}${t}\n`}startBlock(...t){t.length?this.writeLine(`${t.join(" ")} {`):this.writeLine("{"),this.ident+=1}startObjectBlock(t,e){this.writeLine(`${t} "${e}" {`),this.ident+=1}endBlock(){this.ident-=1,this.writeLine("}")}endBlockComma(){this.ident-=1,this.writeLine("},")}indent(){this.ident+=1}unindent(){this.ident-=1}formatFloat(t){let e=t.toString(),i=t.toFixed(this.fractionDigits);return e.length>i.length?i:e}formatFloatArray(t){let e=[];for(let i=0,n=t.length;i<n;i++)e[i]=this.formatFloat(t[i]);return e.join(", ")}}var Xs={glMatrix:f,glMatrixAddon:m,math:g,canvas:p,geometry:v,download:b,bounds:w,BinaryStream:Ks,BitStream:Ws,TokenStream:Ys},Js=i(9),Zs={IniFile:Js.a},Qs={SlkFile:i(11).a};class to{constructor(t,e){this.index=e,this.entries=t.readUint32(),this.id=t.readUint32(),this.flags=t.readUint32()}getAll(){let t=this.id;return 0===t||0===this.entries?[]:this.index[t].entries}get(){return this.getAll()[0]}}function eo(t){return[...t].reverse().join("")}class io{constructor(t,e,i){this.version=e,this.tag=eo(t.read(4)),this.offset=t.readUint32(),this.entries=t.readUint32(),this.model=new to(t,i)}}class no{constructor(t){this.min=t.readFloat32Array(3),this.max=t.readFloat32Array(3),this.radius=t.readFloat32()}}class ro{constructor(t){this.shape=t.readUint32(),this.bone=t.readInt16(),this.unknown0=t.readUint16(),this.matrix=t.readFloat32Array(16),this.unknown1=t.readUint32(),this.unknown2=t.readUint32(),this.unknown3=t.readUint32(),this.unknown4=t.readUint32(),this.unknown5=t.readUint32(),this.unknown6=t.readUint32(),this.size=t.readFloat32Array(3)}}class ao{constructor(t){this.interpolationType=t.readUint16(),this.animFlags=t.readUint16(),this.animId=t.readUint32(),this.initValue=t.readUint8Array(4),this.nullValue=t.readUint8Array(4),t.skip(4)}}class so{constructor(t){this.interpolationType=t.readUint16(),this.animFlags=t.readUint16(),this.animId=t.readUint32(),this.initValue=t.readUint16(),this.nullValue=t.readUint16(),t.skip(4)}}class oo{constructor(t){this.interpolationType=t.readUint16(),this.animFlags=t.readUint16(),this.animId=t.readUint32(),this.initValue=t.readUint32(),this.nullValue=t.readUint32(),t.skip(4)}}class lo{constructor(t){this.interpolationType=t.readUint16(),this.animFlags=t.readUint16(),this.animId=t.readUint32(),this.initValue=t.readFloat32(),this.nullValue=t.readFloat32(),t.skip(4)}}class ho{constructor(t){this.interpolationType=t.readUint16(),this.animFlags=t.readUint16(),this.animId=t.readUint32(),this.initValue=t.readFloat32Array(2),this.nullValue=t.readFloat32Array(2),t.skip(4)}}class uo{constructor(t){this.interpolationType=t.readUint16(),this.animFlags=t.readUint16(),this.animId=t.readUint32(),this.initValue=t.readFloat32Array(3),this.nullValue=t.readFloat32Array(3),t.skip(4)}}class co{constructor(t){this.interpolationType=t.readUint16(),this.animFlags=t.readUint16(),this.animId=t.readUint32(),this.initValue=t.readFloat32Array(4),this.nullValue=t.readFloat32Array(4),t.skip(4)}}class fo{constructor(t,e,i){this.version=e,this.keys=new to(t,i),this.flags=t.readUint32(),this.biggestKey=t.readUint32(),this.values=new to(t,i)}}class mo{constructor(t,e,i){this.reader=t,this.version=e,this.index=i}}let go={MD34:[io,{11:24}],MODL:[class{constructor(t,e,i){this.version=e,this.modelName=new to(t,i),this.flags=t.readUint32(),this.sequences=new to(t,i),this.stc=new to(t,i),this.stg=new to(t,i),this.unknown0=t.readFloat32(),this.unknown1=t.readFloat32(),this.unknown2=t.readFloat32(),this.unknown3=t.readFloat32(),this.sts=new to(t,i),this.bones=new to(t,i),this.numberOfBonesToCheckForSkin=t.readUint32(),this.vertexFlags=t.readUint32(),this.vertices=new to(t,i),this.divisions=new to(t,i),this.boneLookup=new to(t,i),this.boundings=new no(t),this.unknown4To20=t.readUint32Array(16),this.attachmentPoints=new to(t,i),this.attachmentPointAddons=new to(t,i),this.ligts=new to(t,i),this.shbxData=new to(t,i),this.cameras=new to(t,i),this.unknown21=new to(t,i),this.materialReferences=new to(t,i),this.materials=[new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i)],e>24&&this.materials.push(new to(t,i)),e>25&&this.materials.push(new to(t,i)),e>27&&this.materials.push(new to(t,i)),e>28&&this.materials.push(new to(t,i)),this.particleEmitters=new to(t,i),this.particleEmitterCopies=new to(t,i),this.ribbonEmitters=new to(t,i),this.projections=new to(t,i),this.forces=new to(t,i),this.warps=new to(t,i),this.unknown22=new to(t,i),this.rigidBodies=new to(t,i),this.unknown23=new to(t,i),this.physicsJoints=new to(t,i),e>27&&(this.clothBehavior=new to(t,i)),this.unknown24=new to(t,i),this.ikjtData=new to(t,i),this.unknown25=new to(t,i),e>24&&(this.unknown26=new to(t,i)),this.partsOfTurrentBehaviors=new to(t,i),this.turrentBehaviors=new to(t,i),this.absoluteInverseBoneRestPositions=new to(t,i),this.tightHitTest=new ro(t),this.fuzzyHitTestObjects=new to(t,i),this.attachmentVolumes=new to(t,i),this.attachmentVolumesAddon0=new to(t,i),this.attachmentVolumesAddon1=new to(t,i),this.billboardBehaviors=new to(t,i),this.tmdData=new to(t,i),this.unknown27=t.readUint32(),this.unknown28=new to(t,i)}},{23:784,25:808,26:820,28:844,29:856}],SEQS:[class{constructor(t,e,i){this.version=e,t.skip(8),this.name=new to(t,i),this.interval=t.readUint32Array(2),this.movementSpeed=t.readFloat32(),this.flags=t.readUint32(),this.frequency=t.readUint32(),t.skip(12),e<2&&t.skip(4),this.boundingSphere=new no(t),t.skip(12)}},{1:96,2:92}],STC_:[class{constructor(t,e,i){this.version=e,this.name=new to(t,i),this.runsConcurrent=t.readUint16(),this.priority=t.readUint16(),this.stsIndex=t.readUint16(),this.stsIndexCopy=t.readUint16(),this.animIds=new to(t,i),this.animRefs=new to(t,i),t.skip(4),this.sd=[new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i),new to(t,i)]}},{4:204}],STG_:[class{constructor(t,e,i){this.version=e,this.name=new to(t,i),this.stcIndices=new to(t,i)}},{0:24}],STS_:[class{constructor(t,e,i){this.version=e,this.animIds=new to(t,i),t.skip(16)}},{0:28}],BONE:[class{constructor(t,e,i){this.version=e,this.unknown0=t.readInt32(),this.name=new to(t,i),this.flags=t.readUint32(),this.parent=t.readInt16(),this.unknown1=t.readUint16(),this.location=new uo(t),this.rotation=new co(t),this.scale=new uo(t),this.visibility=new oo(t)}},{1:160}],DIV_:[class{constructor(t,e,i){this.version=e,this.triangles=new to(t,i),this.regions=new to(t,i),this.batches=new to(t,i),this.MSEC=new to(t,i),this.unknown0=t.readUint32()}},{2:52}],REGN:[class{constructor(t,e,i){this.version=e,this.unknown0=t.readUint32(),this.unknown1=t.readUint32(),this.firstVertexIndex=t.readUint32(),this.verticesCount=t.readUint32(),this.firstTriangleIndex=t.readUint32(),this.triangleIndicesCount=t.readUint32(),this.bonesCount=t.readUint16(),this.firstBoneLookupIndex=t.readUint16(),this.boneLookupIndicesCount=t.readUint16(),this.unknown2=t.readUint16(),this.boneWeightPairsCount=t.readUint8(),this.unknown3=t.readUint8(),this.rootBoneIndex=t.readUint16(),e>3&&(this.unknown4=t.readUint32()),e>4&&(this.unknown5=t.read(8))}},{3:36,4:40,5:48}],BAT_:[class{constructor(t,e,i){this.version=e,this.unknown0=t.readUint32(),this.regionIndex=t.readUint16(),this.unknown1=t.readUint32(),this.materialReferenceIndex=t.readUint16(),this.unknown2=t.readUint16()}},{1:14}],MATM:[class{constructor(t,e,i){this.version=e,this.materialType=t.readUint32(),this.materialIndex=t.readUint32()}},{0:8}],MAT_:[class{constructor(t,e,i){this.version=e,this.name=new to(t,i),this.additionalFlags=t.readUint32(),this.flags=t.readUint32(),this.blendMode=t.readUint32(),this.priority=t.readInt32(),this.usedRTTChannels=t.readUint32(),this.specularity=t.readFloat32(),this.depthBlendFalloff=t.readFloat32(),this.cutoutThreshold=t.readUint8(),this.unknown1=t.readUint8(),this.unknown2=t.readUint8(),this.unknown3=t.readUint8(),this.specMult=t.readFloat32(),this.emisMult=t.readFloat32(),this.diffuseLayer=new to(t,i),this.decalLayer=new to(t,i),this.specularLayer=new to(t,i),e>15&&(this.glossLayer=new to(t,i)),this.emissiveLayer=new to(t,i),this.emissive2Layer=new to(t,i),this.evioLayer=new to(t,i),this.evioMaskLayer=new to(t,i),this.alphaMaskLayer=new to(t,i),this.alphaMask2Layer=new to(t,i),this.normalLayer=new to(t,i),this.heightLayer=new to(t,i),this.lightMapLayer=new to(t,i),this.ambientOcclusionLayer=new to(t,i),e>18&&(this.unknown4=new to(t,i),this.unknown5=new to(t,i),this.unknown6=new to(t,i),this.unknown7=new to(t,i)),this.unknown8=t.readUint32(),this.layerBlendType=t.readUint32(),this.emisBlendType=t.readUint32(),this.emisMode=t.readUint32(),this.specType=t.readUint32(),this.unknown9=new lo(t),this.unknown10=new oo(t),e>18&&(this.unknown11=t.read(12))}},{15:268,16:280,17:280,18:280,19:340}],LAYR:[class{constructor(t,e,i){this.version=e,this.unknown0=t.readUint32(),this.imagePath=new to(t,i),this.color=new ao(t),this.flags=t.readUint32(),this.uvSource=t.readUint32(),this.colorChannelSetting=t.readUint32(),this.brightMult=new lo(t),this.midtoneOffset=new lo(t),this.unknown1=t.readUint32(),e>23&&(this.noiseAmp=t.readFloat32(),this.noiseFreq=t.readFloat32()),this.rttChannel=t.readInt32(),this.videoFrameRate=t.readUint32(),this.videoStartFrame=t.readUint32(),this.videoEndFrame=t.readInt32(),this.videoMode=t.readUint32(),this.videoSyncTiming=t.readUint32(),this.videoPlay=new oo(t),this.videoRestart=new oo(t),this.flipBookRows=t.readUint32(),this.flipBookColumns=t.readUint32(),this.flipBookFrame=new so(t),this.uvOffset=new ho(t),this.uvAngle=new uo(t),this.uvTiling=new ho(t),this.unknown2=new oo(t),this.unknown3=new lo(t),this.brightness=new lo(t),e>23&&(this.triPlanarOffset=new uo(t),this.triPlanarScale=new uo(t)),this.unknown4=t.readInt32(),this.fresnelType=t.readUint32(),this.fresnelExponent=t.readFloat32(),this.fresnelMin=t.readFloat32(),this.fresnelMaxOffset=t.readFloat32(),this.unknown5=t.readFloat32(),e>24&&(this.unknown6=t.read(8),this.fresnelInvertedMaskX=t.readFloat32(),this.fresnelInvertedMaskY=t.readFloat32(),this.fresnelInvertedMaskZ=t.readFloat32(),this.fresnelRotationYaw=t.readFloat32(),this.fresnelRotationPitch=t.readFloat32(),this.unknown7=t.readUint32())}},{22:356,24:436,25:468,26:464}],EVNT:[class{constructor(t,e,i){this.version=e,this.name=new to(t,i),this.unknown0=t.readInt32(),this.unknown1=t.readInt16(),this.unknown2=t.readUint16(),this.matrix=t.readFloat32Array(16),this.unknown3=t.readInt32(),this.unknown4=t.readInt32(),this.unknown5=t.readInt32(),e>0&&(this.unknown6=t.readInt32(),this.unknown7=t.readInt32()),e>1&&(this.unknown8=t.readInt32())}},{0:96,1:104,2:108}],BNDS:[no,{0:28}],ATT_:[class{constructor(t,e,i){this.version=e,this.unknown=t.readInt32(),this.name=new to(t,i),this.bone=t.readUint32()}},{1:20}],CAM_:[class{constructor(t,e,i){this.version=e,this.bone=t.readUint32(),this.name=new to(t,i),this.fieldOfView=new lo(t),this.unknown0=t.readUint32(),this.farClip=new lo(t),this.nearClip=new lo(t),this.clip2=new lo(t),this.focalDepth=new lo(t),this.falloffStart=new lo(t),this.falloffEnd=new lo(t),this.depthOfField=new lo(t)}},{3:180,5:264}],SDEV:[fo,{0:32}],SDU6:[fo,{0:32}],SDFG:[fo,{0:32}],SDS6:[fo,{0:32}],SDR3:[fo,{0:32}],SD2V:[fo,{0:32}],SD3V:[fo,{0:32}],SD4Q:[fo,{0:32}],SDCC:[fo,{0:32}],SDMB:[fo,{0:32}],FLAG:[fo,{0:32}],MSEC:[mo,{1:72}],LITE:[mo,{7:212}],ATVL:[mo,{0:116}],PATU:[mo,{4:152}],TRGD:[mo,{0:24}],DIS_:[mo,{4:68}],CMS_:[mo,{0:24}],CMP_:[mo,{2:28}],TER_:[mo,{0:24,1:28}],VOL_:[mo,{0:84}],VON_:[mo,{0:268}],CREP:[mo,{0:24,1:28}],STBM:[mo,{0:48}],LFSB:[mo,{2:56}],LFLR:[mo,{2:80,3:152}],PAR_:[mo,{12:1316,17:1460,18:1464,19:1464,21:1464,22:1484,23:1492,24:1496}],PARC:[mo,{0:40}],PROJ:[mo,{4:388,5:382}],PHYJ:[mo,{0:180}],PHCC:[mo,{0:76}],PHAC:[mo,{0:32}],PHCL:[mo,{2:128}],FOR_:[mo,{1:104,2:104}],DMSE:[mo,{0:4}],PHSH:[mo,{1:132,3:300}],PHRB:[mo,{2:104,4:80}],SSGS:[mo,{1:108}],BBSC:[mo,{0:48}],SRIB:[mo,{0:272}],RIB_:[mo,{6:748,8:756,9:760}],IKJT:[mo,{0:32}],SHBX:[mo,{0:64}],WRP_:[mo,{1:132}]};class po{constructor(t,e){let i=eo(t.read(4)),n=t.readUint32(),r=t.readUint32(),a=t.readUint32();this.index=e,this.tag=i,this.offset=n,this.version=a,this.entries=null;let s=go[i],o=t.tell();if(t.seek(n),s){let n=s[0],o=s[1][a];if(!o)throw new Error(": Unsupported object version - tag "+i+" and version "+a);this.entries=[];for(let i=0,s=r;i<s;i++)this.entries[i]=new n(t.substream(o),a,e),t.skip(o)}else if("CHAR"===i||"SCHR"===i)this.entries=t.readCharArray(r);else if("U8__"===i)this.entries=t.readUint8Array(r);else if("U16_"===i)this.entries=t.readUint16Array(r);else if("U32_"===i)this.entries=t.readUint32Array(r);else if("I32_"===i)this.entries=t.readInt32Array(r);else if("REAL"===i)this.entries=t.readFloat32Array(r);else if("VEC2"===i){this.entries=[];for(let e=0;e<r;e++)this.entries[e]=t.readFloat32Array(2)}else if("VEC3"===i||"SVC3"===i){this.entries=[];for(let e=0;e<r;e++)this.entries[e]=t.readFloat32Array(3)}else if("VEC4"===i||"QUAT"===i){this.entries=[];for(let e=0;e<r;e++)this.entries[e]=t.readFloat32Array(4)}else{if("IREF"!==i)throw new Error(": Unsupported object tag - tag "+i+" and version "+a);this.entries=[];for(let e=0;e<r;e++)this.entries[e]=t.readFloat32Array(16)}t.seek(o)}}class vo{constructor(t){let e=new Ks(t),i=new io(e);if(this.entries=[],this.model=null,"MD34"!==i.tag)throw new Error("WrongMagicNumber");e.seek(i.offset);for(let t=0,n=i.entries;t<n;t++)this.entries[t]=new po(e,this.entries);this.model=this.entries[i.model.id].entries[0]}}var bo={Model:vo};class wo{constructor(){this.boundsRadius=0,this.min=new Float32Array(3),this.max=new Float32Array(3)}readMdx(t){this.boundsRadius=t.readFloat32(),t.readFloat32Array(this.min),t.readFloat32Array(this.max)}writeMdx(t){t.writeFloat32(this.boundsRadius),t.writeFloat32Array(this.min),t.writeFloat32Array(this.max)}writeMdl(t){0===this.min[0]&&0===this.min[1]&&0===this.min[2]||t.writeFloatArrayAttrib("MinimumExtent",this.min),0===this.max[0]&&0===this.max[1]&&0===this.max[2]||t.writeFloatArrayAttrib("MaximumExtent",this.max),0!==this.boundsRadius&&t.writeFloatAttrib("BoundsRadius",this.boundsRadius)}}class yo{constructor(){this.name="",this.interval=new Uint32Array(2),this.moveSpeed=0,this.flags=0,this.rarity=0,this.syncPoint=0,this.extent=new wo}readMdx(t){this.name=t.read(80),t.readUint32Array(this.interval),this.moveSpeed=t.readFloat32(),this.flags=t.readUint32(),this.rarity=t.readFloat32(),this.syncPoint=t.readUint32(),this.extent.readMdx(t)}writeMdx(t){t.write(this.name),t.skip(80-this.name.length),t.writeUint32Array(this.interval),t.writeFloat32(this.moveSpeed),t.writeUint32(this.flags),t.writeFloat32(this.rarity),t.writeUint32(this.syncPoint),this.extent.writeMdx(t)}readMdl(t){this.name=t.read();for(let e of t.readBlock())if("Interval"===e)t.readIntArray(this.interval);else if("NonLooping"===e)this.flags=1;else if("MoveSpeed"===e)this.moveSpeed=t.readFloat();else if("Rarity"===e)this.rarity=t.readFloat();else if("MinimumExtent"===e)t.readFloatArray(this.extent.min);else if("MaximumExtent"===e)t.readFloatArray(this.extent.max);else{if("BoundsRadius"!==e)throw new Error(`Unknown token in Sequence: "${e}"`);this.extent.boundsRadius=t.readFloat()}}writeMdl(t){t.startObjectBlock("Anim",this.name),t.writeArrayAttrib("Interval",this.interval),1===this.flags&&t.writeFlag("NonLooping"),0!==this.moveSpeed&&t.writeFloatAttrib("MoveSpeed",this.moveSpeed),0!==this.rarity&&t.writeFloatAttrib("Rarity",this.rarity),this.extent.writeMdl(t),t.endBlock()}}const Ao=(t,e)=>(class{constructor(){this.frame=0,this.value=new t(e),this.inTan=new t(e),this.outTan=new t(e)}readMdx(t,e){this.frame=t.readUint32(),t.readTypedArray(this.value),e>1&&(t.readTypedArray(this.inTan),t.readTypedArray(this.outTan))}writeMdx(t,e){t.writeUint32(this.frame),t.writeTypedArray(this.value),e>1&&(t.writeTypedArray(this.inTan),t.writeTypedArray(this.outTan))}readMdl(t,e){this.frame=t.readInt(),t.readKeyframe(this.value),e>1&&(t.read(),t.readKeyframe(this.inTan),t.read(),t.readKeyframe(this.outTan))}writeMdl(t,e){t.writeKeyframe(`${this.frame}:`,this.value),e>1&&(t.indent(),t.writeKeyframe("InTan",this.inTan),t.writeKeyframe("OutTan",this.outTan),t.unindent())}getByteLength(t){let e=this.value.byteLength,i=4+e;return t>1&&(i+=2*e),i}}),_o=Ao(Uint32Array,1),xo=Ao(Float32Array,1),To=Ao(Float32Array,3),Eo=Ao(Float32Array,4),So=t=>(class{constructor(){this.name="",this.interpolationType=0,this.globalSequenceId=-1,this.tracks=[]}readMdx(e,i){this.name=i;const n=e.readUint32();this.interpolationType=e.readUint32(),this.globalSequenceId=e.readInt32();for(let i=0;i<n;i++){const i=new t;i.readMdx(e,this.interpolationType),this.tracks.push(i)}}writeMdx(t){t.write(this.name),t.writeUint32(this.tracks.length),t.writeUint32(this.interpolationType),t.writeInt32(this.globalSequenceId);for(const e of this.tracks)e.writeMdx(t,this.interpolationType)}readMdl(e,i){this.name=i;const n=e.readInt();e.read();const r=e.read();"DontInterp"===r?this.interpolationType=0:"Linear"===r?this.interpolationType=1:"Hermite"===r?this.interpolationType=2:"Bezier"===r&&(this.interpolationType=3),"GlobalSeqId"===e.peek()&&(e.read(),this.globalSequenceId=e.readInt());for(let i=0;i<n;i++){const n=new t;n.readMdl(e,this.interpolationType),this.tracks[i]=n}e.read()}writeMdl(t,e){let i;t.startBlock(e,this.tracks.length),0===this.interpolationType?i="DontInterp":1===this.interpolationType?i="Linear":2===this.interpolationType?i="Hermite":3===this.interpolationType&&(i="Bezier"),t.writeFlag(i),-1!==this.globalSequenceId&&t.writeAttrib("GlobalSeqId",this.globalSequenceId);for(const e of this.tracks)e.writeMdl(t,this.interpolationType);t.endBlock()}getByteLength(){let t=this.tracks,e=16;return t.length&&(e+=t[0].getByteLength(this.interpolationType)*t.length),e}}),Mo=So(_o),Ro=So(xo),Io=So(To),Bo=So(Eo);var Co={KMTF:["TextureId",Mo],KMTA:["Alpha",Ro],KTAT:["Translation",Io],KTAR:["Rotation",Bo],KTAS:["Scaling",Io],KGAO:["Alpha",Ro],KGAC:["Color",Io],KLAS:["AttenuationStart",Ro],KLAE:["AttenuationEnd",Ro],KLAC:["Color",Io],KLAI:["Intensity",Ro],KLBI:["AmbIntensity",Ro],KLBC:["AmbColor",Io],KLAV:["Visibility",Ro],KATV:["Visibility",Ro],KPEE:["EmissionRate",Ro],KPEG:["Gravity",Ro],KPLN:["Longitude",Ro],KPLT:["Latitude",Ro],KPEL:["LifeSpan",Ro],KPES:["InitVelocity",Ro],KPEV:["Visibility",Ro],KP2S:["Speed",Ro],KP2R:["Variation",Ro],KP2L:["Latitude",Ro],KP2G:["Gravity",Ro],KP2E:["EmissionRate",Ro],KP2N:["Length",Ro],KP2W:["Width",Ro],KP2V:["Visibility",Ro],KRHA:["HeightAbove",Ro],KRHB:["HeightBelow",Ro],KRAL:["Alpha",Ro],KRCO:["Color",Io],KRTX:["TextureSlot",Mo],KRVS:["Visibility",Ro],KCTR:["Translation",Io],KTTR:["Translation",Io],KCRL:["Rotation",Mo],KGTR:["Translation",Io],KGRT:["Rotation",Bo],KGSC:["Scaling",Io]};class Lo{constructor(){this.animations=[]}readAnimations(t,e){for(;e>0;){let i=t.read(4),n=new Co[i][1];n.readMdx(t,i),e-=n.getByteLength(),this.animations.push(n)}}writeAnimations(t){for(let e of this.animations)e.writeMdx(t)}*readAnimatedBlock(t){for(let e of t.readBlock())"static"===e?yield`static ${t.read()}`:yield e}readAnimation(t,e){let i=new Co[e][1];i.readMdl(t,e),this.animations.push(i)}writeAnimation(t,e){for(let i of this.animations)if(i.name===e)return i.writeMdl(t,Co[e][0]),!0;return!1}getByteLength(){let t=0;for(let e of this.animations)t+=e.getByteLength();return t}}let Uo={None:0,Transparent:1,Blend:2,Additive:3,AddAlpha:4,Modulate:5,Modulate2x:6},ko={0:"None",1:"Transparent",2:"Blend",3:"Additive",4:"AddAlpha",5:"Modulate",6:"Modulate2x"};class Fo extends Lo{constructor(){super(),this.filterMode=0,this.flags=0,this.textureId=-1,this.textureAnimationId=-1,this.coordId=0,this.alpha=1}readMdx(t){let e=t.readUint32();this.filterMode=t.readUint32(),this.flags=t.readUint32(),this.textureId=t.readInt32(),this.textureAnimationId=t.readInt32(),this.coordId=t.readUint32(),this.alpha=t.readFloat32(),this.readAnimations(t,e-28)}writeMdx(t){t.writeUint32(this.getByteLength()),t.writeUint32(this.filterMode),t.writeUint32(this.flags),t.writeInt32(this.textureId),t.writeInt32(this.textureAnimationId),t.writeUint32(this.coordId),t.writeFloat32(this.alpha),this.writeAnimations(t)}readMdl(t){for(let e of this.readAnimatedBlock(t))if("FilterMode"===e)this.filterMode=Uo[t.read()];else if("Unshaded"===e)this.flags|=1;else if("SphereEnvMap"===e)this.flags|=2;else if("TwoSided"===e)this.flags|=16;else if("Unfogged"===e)this.flags|=32;else if("NoDepthTest"===e)this.flags|=64;else if("NoDepthSet"===e)this.flags|=256;else if("static TextureID"===e)this.textureId=t.readInt();else if("TextureID"===e)this.readAnimation(t,"KMTF");else if("TVertexAnimId"===e)this.textureAnimationId=t.readInt();else if("CoordId"===e)this.coordId=t.readInt();else if("static Alpha"===e)this.alpha=t.readFloat();else{if("Alpha"!==e)throw new Error(`Unknown token in Layer: "${e}"`);this.readAnimation(t,"KMTA")}}writeMdl(t){t.startBlock("Layer"),t.writeAttrib("FilterMode",ko[this.filterMode]),1&this.flags&&t.writeFlag("Unshaded"),2&this.flags&&t.writeFlag("SphereEnvMap"),16&this.flags&&t.writeFlag("TwoSided"),32&this.flags&&t.writeFlag("Unfogged"),64&this.flags&&t.writeFlag("NoDepthTest"),256&this.flags&&t.writeFlag("NoDepthSet"),this.writeAnimation(t,"KMTF")||t.writeAttrib("static TextureID",this.textureId),-1!==this.textureAnimationId&&t.writeAttrib("TVertexAnimId",this.textureAnimationId),0!==this.coordId&&t.writeAttrib("CoordId",this.coordId),this.writeAnimation(t,"KMTA")||1===this.alpha||t.writeFloatAttrib("static Alpha",this.alpha),t.endBlock()}getByteLength(){return 28+super.getByteLength()}}class Po{constructor(){this.priorityPlane=0,this.flags=0,this.layers=[]}readMdx(t){t.readUint32(),this.priorityPlane=t.readUint32(),this.flags=t.readUint32(),t.skip(4);for(let e=0,i=t.readUint32();e<i;e++){let e=new Fo;e.readMdx(t),this.layers.push(e)}}writeMdx(t){t.writeUint32(this.getByteLength()),t.writeUint32(this.priorityPlane),t.writeUint32(this.flags),t.write("LAYS"),t.writeUint32(this.layers.length);for(let e of this.layers)e.writeMdx(t)}readMdl(t){for(let e of t.readBlock())if("ConstantColor"===e)this.flags|=1;else if("SortPrimsNearZ"===e)this.flags|=8;else if("SortPrimsFarZ"===e)this.flags|=16;else if("FullResolution"===e)this.flags|=32;else if("PriorityPlane"===e)this.priorityPlane=t.readInt();else{if("Layer"!==e)throw new Error(`Unknown token in Material: "${e}"`);{let e=new Fo;e.readMdl(t),this.layers.push(e)}}}writeMdl(t){t.startBlock("Material"),1&this.flags&&t.writeFlag("ConstantColor"),8&this.flags&&t.writeFlag("SortPrimsNearZ"),16&this.flags&&t.writeFlag("SortPrimsFarZ"),32&this.flags&&t.writeFlag("FullResolution"),0!==this.priorityPlane&&t.writeAttrib("PriorityPlane",this.priorityPlane);for(let e of this.layers)e.writeMdl(t);t.endBlock()}getByteLength(){let t=20;for(let e of this.layers)t+=e.getByteLength();return t}}class Do{constructor(){this.replaceableId=0,this.path="",this.flags=0}readMdx(t){this.replaceableId=t.readUint32(),this.path=t.read(260),this.flags=t.readUint32()}writeMdx(t){t.writeUint32(this.replaceableId),t.write(this.path),t.skip(260-this.path.length),t.writeUint32(this.flags)}readMdl(t){for(let e of t.readBlock())if("Image"===e)this.path=t.read();else if("ReplaceableId"===e)this.replaceableId=t.readInt();else if("WrapWidth"===e)this.flags|=1;else{if("WrapHeight"!==e)throw new Error(`Unknown token in Texture: "${e}"`);this.flags|=2}}writeMdl(t){t.startBlock("Bitmap"),t.writeStringAttrib("Image",this.path),0!==this.replaceableId&&t.writeAttrib("ReplaceableId",this.replaceableId),1&this.flags&&t.writeFlag("WrapWidth"),2&this.flags&&t.writeFlag("WrapHeight"),t.endBlock()}}class Oo extends Lo{readMdx(t){let e=t.readUint32();this.readAnimations(t,e-4)}writeMdx(t){t.writeUint32(this.getByteLength()),this.writeAnimations(t)}readMdl(t){for(let e of t.readBlock())if("Translation"===e)this.readAnimation(t,"KTAT");else if("Rotation"===e)this.readAnimation(t,"KTAR");else{if("Scaling"!==e)throw new Error(`Unknown token in TextureAnimation: "${e}"`);this.readAnimation(t,"KTAS")}}writeMdl(t){t.startBlock("TVertexAnim "),this.writeAnimation(t,"KTAT"),this.writeAnimation(t,"KTAR"),this.writeAnimation(t,"KTAS"),t.endBlock()}getByteLength(){return 4+super.getByteLength()}}class No{constructor(){this.vertices=new Float32Array(0),this.normals=new Float32Array(0),this.faceTypeGroups=new Uint32Array(0),this.faceGroups=new Uint32Array(0),this.faces=new Uint16Array(0),this.vertexGroups=new Uint8Array(0),this.matrixGroups=new Uint32Array(0),this.matrixIndices=new Uint32Array(0),this.materialId=0,this.selectionGroup=0,this.selectionFlags=0,this.extent=new wo,this.sequenceExtents=[],this.uvSets=[]}readMdx(t){t.readUint32(),t.skip(4),this.vertices=t.readFloat32Array(3*t.readUint32()),t.skip(4),this.normals=t.readFloat32Array(3*t.readUint32()),t.skip(4),this.faceTypeGroups=t.readUint32Array(t.readUint32()),t.skip(4),this.faceGroups=t.readUint32Array(t.readUint32()),t.skip(4),this.faces=t.readUint16Array(t.readUint32()),t.skip(4),this.vertexGroups=t.readUint8Array(t.readUint32()),t.skip(4),this.matrixGroups=t.readUint32Array(t.readUint32()),t.skip(4),this.matrixIndices=t.readUint32Array(t.readUint32()),this.materialId=t.readUint32(),this.selectionGroup=t.readUint32(),this.selectionFlags=t.readUint32(),this.extent.readMdx(t);for(let e=0,i=t.readUint32();e<i;e++){let e=new wo;e.readMdx(t),this.sequenceExtents.push(e)}t.skip(4);for(let e=0,i=t.readUint32();e<i;e++)t.skip(4),this.uvSets.push(t.readFloat32Array(2*t.readUint32()))}writeMdx(t){t.writeUint32(this.getByteLength()),t.write("VRTX"),t.writeUint32(this.vertices.length/3),t.writeFloat32Array(this.vertices),t.write("NRMS"),t.writeUint32(this.normals.length/3),t.writeFloat32Array(this.normals),t.write("PTYP"),t.writeUint32(this.faceTypeGroups.length),t.writeUint32Array(this.faceTypeGroups),t.write("PCNT"),t.writeUint32(this.faceGroups.length),t.writeUint32Array(this.faceGroups),t.write("PVTX"),t.writeUint32(this.faces.length),t.writeUint16Array(this.faces),t.write("GNDX"),t.writeUint32(this.vertexGroups.length),t.writeUint8Array(this.vertexGroups),t.write("MTGC"),t.writeUint32(this.matrixGroups.length),t.writeUint32Array(this.matrixGroups),t.write("MATS"),t.writeUint32(this.matrixIndices.length),t.writeUint32Array(this.matrixIndices),t.writeUint32(this.materialId),t.writeUint32(this.selectionGroup),t.writeUint32(this.selectionFlags),this.extent.writeMdx(t),t.writeUint32(this.sequenceExtents.length);for(let e of this.sequenceExtents)e.writeMdx(t);t.write("UVAS"),t.writeUint32(this.uvSets.length);for(let e of this.uvSets)t.write("UVBS"),t.writeUint32(e.length/2),t.writeFloat32Array(e)}readMdl(t){for(let e of t.readBlock())if("Vertices"===e)this.vertices=t.readVectorArray(new Float32Array(3*t.readInt()),3);else if("Normals"===e)this.normals=t.readVectorArray(new Float32Array(3*t.readInt()),3);else if("TVertices"===e)this.uvSets.push(t.readVectorArray(new Float32Array(2*t.readInt()),2));else if("VertexGroup"===e){let e=[];for(let i of t.readBlock())e.push(parseInt(i));this.vertexGroups=new Uint8Array(e)}else if("Faces"===e){this.faceTypeGroups=new Uint32Array([4]),t.readInt();let e=t.readInt();t.read(),t.read(),t.read(),this.faces=t.readIntArray(new Uint16Array(e)),t.read(),t.read()}else if("Groups"===e){let e=[],i=[];t.readInt(),t.readInt();for(let n of t.readBlock()){let n=0;for(let i of t.readBlock())e.push(parseInt(i)),n+=1;i.push(n)}this.matrixIndices=new Uint32Array(e),this.matrixGroups=new Uint32Array(i)}else if("MinimumExtent"===e)t.readFloatArray(this.extent.min);else if("MaximumExtent"===e)t.readFloatArray(this.extent.max);else if("BoundsRadius"===e)this.extent.boundsRadius=t.readFloat();else if("Anim"===e){let i=new wo;for(e of t.readBlock())"MinimumExtent"===e?t.readFloatArray(i.min):"MaximumExtent"===e?t.readFloatArray(i.max):"BoundsRadius"===e&&(i.boundsRadius=t.readFloat());this.sequenceExtents.push(i)}else if("MaterialID"===e)this.materialId=t.readInt();else if("SelectionGroup"===e)this.selectionGroup=t.readInt();else{if("Unselectable"!==e)throw new Error(`Unknown token in Geoset: "${e}"`);this.selectionFlags=4}}writeMdl(t){t.startBlock("Geoset"),t.writeVectorArray("Vertices",this.vertices,3),t.writeVectorArray("Normals",this.normals,3);for(let e of this.uvSets)t.writeVectorArray("TVertices",e,2);t.startBlock("VertexGroup");for(let e=0,i=this.vertexGroups.length;e<i;e++)t.writeLine(`${this.vertexGroups[e]},`);t.endBlock(),t.startBlock("Faces",1,this.faces.length),t.startBlock("Triangles"),t.writeLine(`{ ${this.faces.join(", ")} },`),t.endBlock(),t.endBlock(),t.startBlock("Groups",this.matrixGroups.length,this.matrixIndices.length);let e=0;for(let i of this.matrixGroups)t.writeArrayAttrib("Matrices",this.matrixIndices.subarray(e,e+i)),e+=i;t.endBlock(),this.extent.writeMdl(t);for(let e of this.sequenceExtents)t.startBlock("Anim"),e.writeMdl(t),t.endBlock();t.writeAttrib("MaterialID",this.materialId),t.writeAttrib("SelectionGroup",this.selectionGroup),4===this.selectionFlags&&t.writeFlag("Unselectable"),t.endBlock()}getByteLength(){let t=120+this.vertices.byteLength+this.normals.byteLength+this.faceTypeGroups.byteLength+this.faceGroups.byteLength+this.faces.byteLength+this.vertexGroups.byteLength+this.matrixGroups.byteLength+this.matrixIndices.byteLength+28*this.sequenceExtents.length;for(let e of this.uvSets)t+=8+e.byteLength;return t}}class Vo extends Lo{constructor(){super(),this.alpha=1,this.flags=0,this.color=new Float32Array([1,1,1]),this.geosetId=-1,this.animations=[]}readMdx(t){let e=t.readUint32();this.alpha=t.readFloat32(),this.flags=t.readUint32(),t.readFloat32Array(this.color),this.geosetId=t.readInt32(),this.readAnimations(t,e-28)}writeMdx(t){t.writeUint32(this.getByteLength()),t.writeFloat32(this.alpha),t.writeUint32(this.flags),t.writeFloat32Array(this.color),t.writeInt32(this.geosetId),this.writeAnimations(t)}readMdl(t){for(let e of this.readAnimatedBlock(t))if("DropShadow"===e)this.flags|=1;else if("static Alpha"===e)this.alpha=t.readFloat();else if("Alpha"===e)this.readAnimation(t,"KGAO");else if("static Color"===e)this.flags|=2,t.readColor(this.color);else if("Color"===e)this.flags|=2,this.readAnimation(t,"KGAC");else{if("GeosetId"!==e)throw new Error(`Unknown token in GeosetAnimation: "${e}"`);this.geosetId=t.readInt()}}writeMdl(t){t.startBlock("GeosetAnim"),1&this.flags&&t.writeFlag("DropShadow"),this.writeAnimation(t,"KGAO")||t.writeFloatAttrib("static Alpha",this.alpha),2&this.flags&&(this.writeAnimation(t,"KGAC")||1===this.color[0]&&1===this.color[1]&&1===this.color[2]||t.writeColor("static Color ",this.color)),t.writeAttrib("GeosetId",this.geosetId),t.endBlock()}getByteLength(){return 28+super.getByteLength()}}class Go extends Lo{constructor(t){super(),this.name="",this.objectId=-1,this.parentId=-1,this.flags=t||0}readMdx(t){let e=t.readUint32();this.name=t.read(80),this.objectId=t.readInt32(),this.parentId=t.readInt32(),this.flags=t.readUint32(),this.readAnimations(t,e-96)}writeMdx(t){t.writeUint32(this.getGenericByteLength()),t.write(this.name),t.skip(80-this.name.length),t.writeInt32(this.objectId),t.writeInt32(this.parentId),t.writeUint32(this.flags);for(let e of this.eachAnimation(!0))e.writeMdx(t)}writeNonGenericAnimationChunks(t){for(let e of this.eachAnimation(!1))e.writeMdx(t)}*readMdl(t){this.name=t.read();for(let e of this.readAnimatedBlock(t))if("ObjectId"===e)this.objectId=t.readInt();else if("Parent"===e)this.parentId=t.readInt();else if("BillboardedLockZ"===e)this.flags|=64;else if("BillboardedLockY"===e)this.flags|=32;else if("BillboardedLockX"===e)this.flags|=16;else if("Billboarded"===e)this.flags|=8;else if("CameraAnchored"===e)this.flags|=128;else if("DontInherit"===e)for(e of t.readBlock())"Rotation"===e?this.flags|=2:"Translation"===e?this.flags|=1:"Scaling"===e&&(this.flags|=4);else"Translation"===e?this.readAnimation(t,"KGTR"):"Rotation"===e?this.readAnimation(t,"KGRT"):"Scaling"===e?this.readAnimation(t,"KGSC"):yield e}writeGenericHeader(t){t.writeAttrib("ObjectId",this.objectId),-1!==this.parentId&&t.writeAttrib("Parent",this.parentId),64&this.flags&&t.writeFlag("BillboardedLockZ"),32&this.flags&&t.writeFlag("BillboardedLockY"),16&this.flags&&t.writeFlag("BillboardedLockX"),8&this.flags&&t.writeFlag("Billboarded"),128&this.flags&&t.writeFlag("CameraAnchored"),2&this.flags&&t.writeFlag("DontInherit { Rotation }"),1&this.flags&&t.writeFlag("DontInherit { Translation }"),4&this.flags&&t.writeFlag("DontInherit { Scaling }")}writeGenericAnimations(t){this.writeAnimation(t,"KGTR"),this.writeAnimation(t,"KGRT"),this.writeAnimation(t,"KGSC")}*eachAnimation(t){for(let e of this.animations){let i=e.name,n="KGTR"===i||"KGRT"===i||"KGSC"===i;(t&&n||!t&&!n)&&(yield e)}}getGenericByteLength(){let t=96;for(let e of this.eachAnimation(!0))t+=e.getByteLength();return t}getByteLength(){return 96+super.getByteLength()}}class jo extends Go{constructor(){super(256),this.geosetId=-1,this.geosetAnimationId=-1}readMdx(t){super.readMdx(t),this.geosetId=t.readInt32(),this.geosetAnimationId=t.readInt32()}writeMdx(t){super.writeMdx(t),t.writeInt32(this.geosetId),t.writeInt32(this.geosetAnimationId)}readMdl(t){for(let e of super.readMdl(t))if("GeosetId"===e)e=t.read(),this.geosetId="Multiple"===e?-1:parseInt(e);else{if("GeosetAnimId"!==e)throw new Error(`Unknown token in Bone ${this.name}: "${e}"`);e=t.read(),this.geosetAnimationId="None"===e?-1:parseInt(e)}}writeMdl(t){t.startObjectBlock("Bone",this.name),this.writeGenericHeader(t);let e=this.geosetId,i=this.geosetAnimationId;-1===e&&(e="Multiple"),-1===i&&(i="None"),t.writeAttrib("GeosetId",e),t.writeAttrib("GeosetAnimId",i),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){return 8+super.getByteLength()}}class Ho extends Go{constructor(){super(512),this.type=-1,this.attenuation=new Float32Array(2),this.color=new Float32Array(3),this.intensity=0,this.ambientColor=new Float32Array(3),this.ambientIntensity=0}readMdx(t){let e=t.readUint32();super.readMdx(t),this.type=t.readUint32(),t.readFloat32Array(this.attenuation),t.readFloat32Array(this.color),this.intensity=t.readFloat32(),t.readFloat32Array(this.ambientColor),this.ambientIntensity=t.readFloat32(),this.readAnimations(t,e-this.getByteLength())}writeMdx(t){t.writeUint32(this.getByteLength()),super.writeMdx(t),t.writeUint32(this.type),t.writeFloat32Array(this.attenuation),t.writeFloat32Array(this.color),t.writeFloat32(this.intensity),t.writeFloat32Array(this.ambientColor),t.writeFloat32(this.ambientIntensity),this.writeNonGenericAnimationChunks(t)}readMdl(t){for(let e of super.readMdl(t))if("Omnidirectional"===e)this.type=0;else if("Directional"===e)this.type=1;else if("Ambient"===e)this.type=2;else if("static AttenuationStart"===e)this.attenuation[0]=t.readFloat();else if("AttenuationStart"===e)this.readAnimation(t,"KLAS");else if("static AttenuationEnd"===e)this.attenuation[1]=t.readFloat();else if("AttenuationEnd"===e)this.readAnimation(t,"KLAE");else if("static Intensity"===e)this.intensity=t.readFloat();else if("Intensity"===e)this.readAnimation(t,"KLAI");else if("static Color"===e)t.readColor(this.color);else if("Color"===e)this.readAnimation(t,"KLAC");else if("static AmbIntensity"===e)this.ambientIntensity=t.readFloat();else if("AmbIntensity"===e)this.readAnimation(t,"KLBI");else if("static AmbColor"===e)t.readColor(this.ambientColor);else if("AmbColor"===e)this.readAnimation(t,"KLBC");else{if("Visibility"!==e)throw new Error(`Unknown token in Light: "${e}"`);this.readAnimation(t,"KLAV")}}writeMdl(t){t.startObjectBlock("Light",this.name),this.writeGenericHeader(t),0===this.type?t.writeFlag("Omnidirectional"):1===this.type?t.writeFlag("Directional"):2===this.type&&t.writeFlag("Ambient"),this.writeAnimation(t,"KLAS")||t.writeFloatAttrib("static AttenuationStart",this.attenuation[0]),this.writeAnimation(t,"KLAE")||t.writeFloatAttrib("static AttenuationEnd",this.attenuation[1]),this.writeAnimation(t,"KLAI")||t.writeFloatAttrib("static Intensity",this.intensity),this.writeAnimation(t,"KLAC")||t.writeColor("static Color",this.color),this.writeAnimation(t,"KLBI")||t.writeFloatAttrib("static AmbIntensity",this.ambientIntensity),this.writeAnimation(t,"KLBC")||t.writeColor("static AmbColor",this.ambientColor),this.writeAnimation(t,"KLAV"),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){return 48+super.getByteLength()}}class $o extends Go{readMdl(t){for(let e of super.readMdl(t))throw new Error(`Unknown token in Helper: "${e}"`)}writeMdl(t){t.startObjectBlock("Helper",this.name),this.writeGenericHeader(t),this.writeGenericAnimations(t),t.endBlock()}}class qo extends Go{constructor(){super(2048),this.path="",this.attachmentId=0}readMdx(t){let e=t.readUint32();super.readMdx(t),this.path=t.read(260),this.attachmentId=t.readInt32(),this.readAnimations(t,e-this.getByteLength())}writeMdx(t){t.writeUint32(this.getByteLength()),super.writeMdx(t),t.write(this.path),t.skip(260-this.path.length),t.writeInt32(this.attachmentId),this.writeNonGenericAnimationChunks(t)}readMdl(t){for(let e of super.readMdl(t))if("AttachmentID"===e)this.attachmentId=t.readInt();else if("Path"===e)this.path=t.read();else{if("Visibility"!==e)throw new Error(`Unknown token in Attachment ${this.name}: "${e}"`);this.readAnimation(t,"KATV")}}writeMdl(t){t.startObjectBlock("Attachment",this.name),this.writeGenericHeader(t),t.writeAttrib("AttachmentID",this.attachmentId),this.path.length&&t.writeStringAttrib("Path",this.path),this.writeAnimation(t,"KATV"),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){return 268+super.getByteLength()}}class zo extends Go{constructor(){super(4096),this.emissionRate=0,this.gravity=0,this.longitude=0,this.latitude=0,this.path="",this.lifeSpan=0,this.speed=0}readMdx(t){let e=t.readUint32();super.readMdx(t),this.emissionRate=t.readFloat32(),this.gravity=t.readFloat32(),this.longitude=t.readFloat32(),this.latitude=t.readFloat32(),this.path=t.read(260),this.lifeSpan=t.readFloat32(),this.speed=t.readFloat32(),this.readAnimations(t,e-this.getByteLength())}writeMdx(t){t.writeUint32(this.getByteLength()),super.writeMdx(t),t.writeFloat32(this.emissionRate),t.writeFloat32(this.gravity),t.writeFloat32(this.longitude),t.writeFloat32(this.latitude),t.write(this.path),t.skip(260-this.path.length),t.writeFloat32(this.lifeSpan),t.writeFloat32(this.speed),this.writeNonGenericAnimationChunks(t)}readMdl(t){for(let e of super.readMdl(t))if("EmitterUsesMDL"===e)this.flags|=32768;else if("EmitterUsesTGA"===e)this.flags|=65536;else if("static EmissionRate"===e)this.emissionRate=t.readFloat();else if("EmissionRate"===e)this.readAnimation(t,"KPEE");else if("static Gravity"===e)this.gravity=t.readFloat();else if("Gravity"===e)this.readAnimation(t,"KPEG");else if("static Longitude"===e)this.longitude=t.readFloat();else if("Longitude"===e)this.readAnimation(t,"KPLN");else if("static Latitude"===e)this.latitude=t.readFloat();else if("Latitude"===e)this.readAnimation(t,"KPLT");else if("Visibility"===e)this.readAnimation(t,"KPEV");else{if("Particle"!==e)throw new Error(`Unknown token in ParticleEmitter: "${e}"`);for(e of this.readAnimatedBlock(t))"static LifeSpan"===e?this.lifeSpan=t.readFloat():"LifeSpan"===e?this.readAnimation(t,"KPEL"):"static InitVelocity"===e?this.speed=t.readFloat():"InitVelocity"===e?this.readAnimation(t,"KPES"):"Path"===e&&(this.path=t.read())}}writeMdl(t){t.startObjectBlock("ParticleEmitter",this.name),this.writeGenericHeader(t),32768&this.flags&&t.writeFlag("EmitterUsesMDL"),65536&this.flags&&t.writeFlag("EmitterUsesTGA"),this.writeAnimation(t,"KPEE")||t.writeFloatAttrib("static EmissionRate",this.emissionRate),this.writeAnimation(t,"KPEG")||t.writeFloatAttrib("static Gravity",this.gravity),this.writeAnimation(t,"KPLN")||t.writeFloatAttrib("static Longitude",this.longitude),this.writeAnimation(t,"KPLT")||t.writeFloatAttrib("static Latitude",this.latitude),this.writeAnimation(t,"KPEV"),t.startBlock("Particle"),this.writeAnimation(t,"KPEL")||t.writeFloatAttrib("static LifeSpan",this.lifeSpan),this.writeAnimation(t,"KPES")||t.writeFloatAttrib("static InitVelocity",this.speed),(32768&this.flags||65536&this.flags)&&t.writeAttrib("Path",this.path),t.endBlock(),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){return 288+super.getByteLength()}}class Ko extends Go{constructor(){super(),this.speed=0,this.variation=0,this.latitude=0,this.gravity=0,this.lifeSpan=0,this.emissionRate=0,this.length=0,this.width=0,this.filterMode=0,this.rows=0,this.columns=0,this.headOrTail=0,this.tailLength=0,this.timeMiddle=0,this.segmentColors=[new Float32Array(3),new Float32Array(3),new Float32Array(3)],this.segmentAlphas=new Uint8Array(3),this.segmentScaling=new Float32Array(3),this.headIntervals=[new Uint32Array(3),new Uint32Array(3)],this.tailIntervals=[new Uint32Array(3),new Uint32Array(3)],this.textureId=-1,this.squirt=0,this.priorityPlane=0,this.replaceableId=0}readMdx(t){const e=t.readUint32();super.readMdx(t),this.speed=t.readFloat32(),this.variation=t.readFloat32(),this.latitude=t.readFloat32(),this.gravity=t.readFloat32(),this.lifeSpan=t.readFloat32(),this.emissionRate=t.readFloat32(),this.length=t.readFloat32(),this.width=t.readFloat32(),this.filterMode=t.readUint32(),this.rows=t.readUint32(),this.columns=t.readUint32(),this.headOrTail=t.readUint32(),this.tailLength=t.readFloat32(),this.timeMiddle=t.readFloat32(),t.readFloat32Array(this.segmentColors[0]),t.readFloat32Array(this.segmentColors[1]),t.readFloat32Array(this.segmentColors[2]),t.readUint8Array(this.segmentAlphas),t.readFloat32Array(this.segmentScaling),t.readUint32Array(this.headIntervals[0]),t.readUint32Array(this.headIntervals[1]),t.readUint32Array(this.tailIntervals[0]),t.readUint32Array(this.tailIntervals[1]),this.textureId=t.readInt32(),this.squirt=t.readUint32(),this.priorityPlane=t.readInt32(),this.replaceableId=t.readUint32(),this.readAnimations(t,e-this.getByteLength())}writeMdx(t){t.writeUint32(this.getByteLength()),super.writeMdx(t),t.writeFloat32(this.speed),t.writeFloat32(this.variation),t.writeFloat32(this.latitude),t.writeFloat32(this.gravity),t.writeFloat32(this.lifeSpan),t.writeFloat32(this.emissionRate),t.writeFloat32(this.length),t.writeFloat32(this.width),t.writeUint32(this.filterMode),t.writeUint32(this.rows),t.writeUint32(this.columns),t.writeUint32(this.headOrTail),t.writeFloat32(this.tailLength),t.writeFloat32(this.timeMiddle),t.writeFloat32Array(this.segmentColors[0]),t.writeFloat32Array(this.segmentColors[1]),t.writeFloat32Array(this.segmentColors[2]),t.writeUint8Array(this.segmentAlphas),t.writeFloat32Array(this.segmentScaling),t.writeUint32Array(this.headIntervals[0]),t.writeUint32Array(this.headIntervals[1]),t.writeUint32Array(this.tailIntervals[0]),t.writeUint32Array(this.tailIntervals[1]),t.writeInt32(this.textureId),t.writeUint32(this.squirt),t.writeInt32(this.priorityPlane),t.writeUint32(this.replaceableId),this.writeNonGenericAnimationChunks(t)}readMdl(t){for(const e of super.readMdl(t))if("SortPrimsFarZ"===e)this.flags|=65536;else if("Unshaded"===e)this.flags|=32768;else if("LineEmitter"===e)this.flags|=131072;else if("Unfogged"===e)this.flags|=262144;else if("ModelSpace"===e)this.flags|=524288;else if("XYQuad"===e)this.flags|=1048576;else if("static Speed"===e)this.speed=t.readFloat();else if("Speed"===e)this.readAnimation(t,"KP2S");else if("static Variation"===e)this.variation=t.readFloat();else if("Variation"===e)this.readAnimation(t,"KP2R");else if("static Latitude"===e)this.latitude=t.readFloat();else if("Latitude"===e)this.readAnimation(t,"KP2L");else if("static Gravity"===e)this.gravity=t.readFloat();else if("Gravity"===e)this.readAnimation(t,"KP2G");else if("Visibility"===e)this.readAnimation(t,"KP2V");else if("Squirt"===e)this.squirt=1;else if("LifeSpan"===e)this.lifeSpan=t.readFloat();else if("static EmissionRate"===e)this.emissionRate=t.readFloat();else if("EmissionRate"===e)this.readAnimation(t,"KP2E");else if("static Width"===e)this.width=t.readFloat();else if("Width"===e)this.readAnimation(t,"KP2W");else if("static Length"===e)this.length=t.readFloat();else if("Length"===e)this.readAnimation(t,"KP2N");else if("Blend"===e)this.filterMode=0;else if("Additive"===e)this.filterMode=1;else if("Modulate"===e)this.filterMode=2;else if("Modulate2x"===e)this.filterMode=3;else if("AlphaKey"===e)this.filterMode=4;else if("Rows"===e)this.rows=t.readInt();else if("Columns"===e)this.columns=t.readInt();else if("Head"===e)this.headOrTail=0;else if("Tail"===e)this.headOrTail=1;else if("Both"===e)this.headOrTail=2;else if("TailLength"===e)this.tailLength=t.readFloat();else if("Time"===e)this.timeMiddle=t.readFloat();else if("SegmentColor"===e){t.read();for(let e=0;e<3;e++)t.read(),t.readColor(this.segmentColors[e]);t.read()}else if("Alpha"===e)t.readIntArray(this.segmentAlphas);else if("ParticleScaling"===e)t.readFloatArray(this.segmentScaling);else if("LifeSpanUVAnim"===e)t.readIntArray(this.headIntervals[0]);else if("DecayUVAnim"===e)t.readIntArray(this.headIntervals[1]);else if("TailUVAnim"===e)t.readIntArray(this.tailIntervals[0]);else if("TailDecayUVAnim"===e)t.readIntArray(this.tailIntervals[1]);else if("TextureID"===e)this.textureId=t.readInt();else if("ReplaceableId"===e)this.replaceableId=t.readInt();else{if("PriorityPlane"!==e)throw new Error(`Unknown token in ParticleEmitter2: "${e}"`);this.priorityPlane=t.readInt()}}writeMdl(t){t.startObjectBlock("ParticleEmitter2",this.name),this.writeGenericHeader(t),65536&this.flags&&t.writeFlag("SortPrimsFarZ"),32768&this.flags&&t.writeFlag("Unshaded"),131072&this.flags&&t.writeFlag("LineEmitter"),262144&this.flags&&t.writeFlag("Unfogged"),524288&this.flags&&t.writeFlag("ModelSpace"),1048576&this.flags&&t.writeFlag("XYQuad"),this.writeAnimation(t,"KP2S")||t.writeFloatAttrib("static Speed",this.speed),this.writeAnimation(t,"KP2R")||t.writeFloatAttrib("static Variation",this.variation),this.writeAnimation(t,"KP2L")||t.writeFloatAttrib("static Latitude",this.latitude),this.writeAnimation(t,"KP2G")||t.writeFloatAttrib("static Gravity",this.gravity),this.writeAnimation(t,"KP2V"),this.squirt&&t.writeFlag("Squirt"),t.writeFloatAttrib("LifeSpan",this.lifeSpan),this.writeAnimation(t,"KP2E")||t.writeFloatAttrib("static EmissionRate",this.emissionRate),this.writeAnimation(t,"KP2W")||t.writeFloatAttrib("static Width",this.width),this.writeAnimation(t,"KP2N")||t.writeFloatAttrib("static Length",this.length),0===this.filterMode?t.writeFlag("Blend"):1===this.filterMode?t.writeFlag("Additive"):2===this.filterMode?t.writeFlag("Modulate"):3===this.filterMode?t.writeFlag("Modulate2x"):4===this.filterMode&&t.writeFlag("AlphaKey"),t.writeAttrib("Rows",this.rows),t.writeAttrib("Columns",this.columns),0===this.headOrTail?t.writeFlag("Head"):1===this.headOrTail?t.writeFlag("Tail"):2===this.headOrTail&&t.writeFlag("Both"),t.writeFloatAttrib("TailLength",this.tailLength),t.writeFloatAttrib("Time",this.timeMiddle),t.startBlock("SegmentColor"),t.writeColor("Color",this.segmentColors[0]),t.writeColor("Color",this.segmentColors[1]),t.writeColor("Color",this.segmentColors[2]),t.endBlockComma(),t.writeArrayAttrib("Alpha",this.segmentAlphas),t.writeFloatArrayAttrib("ParticleScaling",this.segmentScaling),t.writeArrayAttrib("LifeSpanUVAnim",this.headIntervals[0]),t.writeArrayAttrib("DecayUVAnim",this.headIntervals[1]),t.writeArrayAttrib("TailUVAnim",this.tailIntervals[0]),t.writeArrayAttrib("TailDecayUVAnim",this.tailIntervals[1]),t.writeAttrib("TextureID",this.textureId),0!==this.replaceableId&&t.writeAttrib("ReplaceableId",this.replaceableId),0!==this.priorityPlane&&t.writeAttrib("PriorityPlane",this.priorityPlane),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){return 175+super.getByteLength()}}class Wo extends Go{constructor(){super(16384),this.heightAbove=0,this.heightBelow=0,this.alpha=0,this.color=new Float32Array(3),this.lifeSpan=0,this.textureSlot=0,this.emissionRate=0,this.rows=0,this.columns=0,this.materialId=0,this.gravity=0}readMdx(t){let e=t.readUint32();super.readMdx(t),this.heightAbove=t.readFloat32(),this.heightBelow=t.readFloat32(),this.alpha=t.readFloat32(),t.readFloat32Array(this.color),this.lifeSpan=t.readFloat32(),this.textureSlot=t.readUint32(),this.emissionRate=t.readUint32(),this.rows=t.readUint32(),this.columns=t.readUint32(),this.materialId=t.readInt32(),this.gravity=t.readFloat32(),this.readAnimations(t,e-this.getByteLength())}writeMdx(t){t.writeUint32(this.getByteLength()),super.writeMdx(t),t.writeFloat32(this.heightAbove),t.writeFloat32(this.heightBelow),t.writeFloat32(this.alpha),t.writeFloat32Array(this.color),t.writeFloat32(this.lifeSpan),t.writeUint32(this.textureSlot),t.writeUint32(this.emissionRate),t.writeUint32(this.rows),t.writeUint32(this.columns),t.writeInt32(this.materialId),t.writeFloat32(this.gravity),this.writeNonGenericAnimationChunks(t)}readMdl(t){for(let e of super.readMdl(t))if("static HeightAbove"===e)this.heightAbove=t.readFloat();else if("HeightAbove"===e)this.readAnimation(t,"KRHA");else if("static HeightBelow"===e)this.heightBelow=t.readFloat();else if("HeightBelow"===e)this.readAnimation(t,"KRHB");else if("static Alpha"===e)this.alpha=t.readFloat();else if("Alpha"===e)this.readAnimation(t,"KRAL");else if("static Color"===e)t.readColor(this.color);else if("Color"===e)this.readAnimation(t,"KRCO");else if("static TextureSlot"===e)this.textureSlot=t.readInt();else if("TextureSlot"===e)this.readAnimation(t,"KRTX");else if("Visibility"===e)this.readAnimation(t,"KRVS");else if("EmissionRate"===e)this.emissionRate=t.readInt();else if("LifeSpan"===e)this.lifeSpan=t.readFloat();else if("Gravity"===e)this.gravity=t.readFloat();else if("Rows"===e)this.rows=t.readInt();else if("Columns"===e)this.columns=t.readInt();else{if("MaterialID"!==e)throw new Error(`Unknown token in RibbonEmitter: "${e}"`);this.materialId=t.readInt()}}writeMdl(t){t.startObjectBlock("RibbonEmitter",this.name),this.writeGenericHeader(t),this.writeAnimation(t,"KRHA")||t.writeFloatAttrib("static HeightAbove",this.heightAbove),this.writeAnimation(t,"KRHB")||t.writeFloatAttrib("static HeightBelow",this.heightBelow),this.writeAnimation(t,"KRAL")||t.writeFloatAttrib("static Alpha",this.alpha),this.writeAnimation(t,"KRCO")||t.writeColor("static Color",this.color),this.writeAnimation(t,"KRTX")||t.writeAttrib("static TextureSlot",this.textureSlot),this.writeAnimation(t,"KRVS"),t.writeAttrib("EmissionRate",this.emissionRate),t.writeFloatAttrib("LifeSpan",this.lifeSpan),0!==this.gravity&&t.writeFloatAttrib("Gravity",this.gravity),t.writeAttrib("Rows",this.rows),t.writeAttrib("Columns",this.columns),t.writeAttrib("MaterialID",this.materialId),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){return 56+super.getByteLength()}}class Yo extends Lo{constructor(){super(),this.name="",this.position=new Float32Array(3),this.fieldOfView=0,this.farClippingPlane=0,this.nearClippingPlane=0,this.targetPosition=new Float32Array(3)}readMdx(t){let e=t.readUint32();this.name=t.read(80),t.readFloat32Array(this.position),this.fieldOfView=t.readFloat32(),this.farClippingPlane=t.readFloat32(),this.nearClippingPlane=t.readFloat32(),t.readFloat32Array(this.targetPosition),this.readAnimations(t,e-120)}writeMdx(t){t.writeUint32(this.getByteLength()),t.write(this.name),t.skip(80-this.name.length),t.writeFloat32Array(this.position),t.writeFloat32(this.fieldOfView),t.writeFloat32(this.farClippingPlane),t.writeFloat32(this.nearClippingPlane),t.writeFloat32Array(this.targetPosition),this.writeAnimations(t)}readMdl(t){this.name=t.read();for(let e of t.readBlock())if("Position"===e)t.readFloatArray(this.position);else if("Translation"===e)this.readAnimation(t,"KCTR");else if("Rotation"===e)this.readAnimation(t,"KCRL");else if("FieldOfView"===e)this.fieldOfView=t.readFloat();else if("FarClip"===e)this.farClippingPlane=t.readFloat();else if("NearClip"===e)this.nearClippingPlane=t.readFloat();else{if("Target"!==e)throw new Error(`Unknown token in Camera ${this.name}: "${e}"`);for(e of t.readBlock())if("Position"===e)t.readFloatArray(this.targetPosition);else{if("Translation"!==e)throw new Error(`Unknown token in Camera ${this.name}'s Target: "${e}"`);this.readAnimation(t,"KTTR")}}}writeMdl(t){t.startObjectBlock("Camera",this.name),t.writeFloatArrayAttrib("Position",this.position),this.writeAnimation(t,"KCTR"),this.writeAnimation(t,"KCRL"),t.writeFloatAttrib("FieldOfView",this.fieldOfView),t.writeFloatAttrib("FarClip",this.farClippingPlane),t.writeFloatAttrib("NearClip",this.nearClippingPlane),t.startBlock("Target"),t.writeFloatArrayAttrib("Position",this.targetPosition),this.writeAnimation(t,"KTTR"),t.endBlock(),t.endBlock()}getByteLength(){return 120+super.getByteLength()}}class Xo extends Go{constructor(){super(1024),this.globalSequenceId=-1,this.tracks=new Uint32Array(1)}readMdx(t){super.readMdx(t),t.skip(4);let e=t.readUint32();this.globalSequenceId=t.readInt32(),this.tracks=t.readUint32Array(e)}writeMdx(t){super.writeMdx(t),t.write("KEVT"),t.writeUint32(this.tracks.length),t.writeInt32(this.globalSequenceId),t.writeUint32Array(this.tracks)}readMdl(t){for(let e of super.readMdl(t)){if("EventTrack"!==e)throw new Error(`Unknown token in EventObject: "${e}"`);this.tracks=t.readIntArray(new Uint32Array(t.readInt()))}}writeMdl(t){t.startObjectBlock("EventObject",this.name),this.writeGenericHeader(t),t.startBlock("EventTrack",this.tracks.length);for(let e of this.tracks)t.writeFlag(e);t.endBlock(),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){return 12+this.tracks.byteLength+super.getByteLength()}}class Jo extends Go{constructor(){super(8192),this.type=-1,this.vertices=[new Float32Array(3),new Float32Array(3)],this.boundsRadius=0}readMdx(t){super.readMdx(t),this.type=t.readUint32(),t.readFloat32Array(this.vertices[0]),2!==this.type&&t.readFloat32Array(this.vertices[1]),2!==this.type&&3!==this.type||(this.boundsRadius=t.readFloat32())}writeMdx(t){super.writeMdx(t),t.writeUint32(this.type),t.writeFloat32Array(this.vertices[0]),2!==this.type&&t.writeFloat32Array(this.vertices[1]),2!==this.type&&3!==this.type||t.writeFloat32(this.boundsRadius)}readMdl(t){for(let e of super.readMdl(t))if("Plane"===e)this.type=0;else if("Box"===e)this.type=1;else if("Sphere"===e)this.type=2;else if("Cylinder"===e)this.type=3;else if("Vertices"===e){let e=t.readInt();t.read(),t.readFloatArray(this.vertices[0]),2===e&&t.readFloatArray(this.vertices[1]),t.read()}else{if("BoundsRadius"!==e)throw new Error(`Unknown token in CollisionShape: "${e}"`);this.boundsRadius=t.readFloat()}}writeMdl(t){let e;t.startObjectBlock("CollisionShape",this.name),this.writeGenericHeader(t);let i=2,n=!1;0===this.type?e="Plane":1===this.type?e="Box":2===this.type?(e="Sphere",i=1,n=!0):3===this.type&&(e="Cylinder",n=!0),t.writeFlag(e),t.startBlock("Vertices",i),t.writeFloatArray(this.vertices[0]),2===i&&t.writeFloatArray(this.vertices[1]),t.endBlock(),n&&t.writeFloatAttrib("BoundsRadius",this.boundsRadius),this.writeGenericAnimations(t),t.endBlock()}getByteLength(){let t=16+super.getByteLength();return 2!==this.type&&(t+=12),2!==this.type&&3!==this.type||(t+=4),t}}class Zo{constructor(t,e,i){this.chunk=t.readUint8Array(new Uint8Array(e)),this.tag=i}writeMdx(t){t.write(this.tag),t.writeUint32(this.chunk.byteLength),t.writeUint8Array(this.chunk)}getByteLength(){return 8+this.chunk.byteLength}}class Qo{constructor(t){this.version=800,this.name="",this.animationFile="",this.extent=new wo,this.blendTime=0,this.sequences=[],this.globalSequences=[],this.materials=[],this.textures=[],this.textureAnimations=[],this.geosets=[],this.geosetAnimations=[],this.bones=[],this.lights=[],this.helpers=[],this.attachments=[],this.pivotPoints=[],this.particleEmitters=[],this.particleEmitters2=[],this.ribbonEmitters=[],this.cameras=[],this.eventObjects=[],this.collisionShapes=[],this.unknownChunks=[],t&&this.load(t)}load(t){t instanceof ArrayBuffer?this.loadMdx(t):this.loadMdl(t)}loadMdx(t){let e=new Ks(t);if("MDLX"!==e.read(4))throw new Error("WrongMagicNumber");for(;e.remaining()>0;){let t=e.read(4),i=e.readUint32();"VERS"===t?this.loadVersionChunk(e):"MODL"===t?this.loadModelChunk(e):"SEQS"===t?this.loadStaticObjects(this.sequences,yo,e,i/132):"GLBS"===t?this.loadGlobalSequenceChunk(e,i):"MTLS"===t?this.loadDynamicObjects(this.materials,Po,e,i):"TEXS"===t?this.loadStaticObjects(this.textures,Do,e,i/268):"TXAN"===t?this.loadDynamicObjects(this.textureAnimations,Oo,e,i):"GEOS"===t?this.loadDynamicObjects(this.geosets,No,e,i):"GEOA"===t?this.loadDynamicObjects(this.geosetAnimations,Vo,e,i):"BONE"===t?this.loadDynamicObjects(this.bones,jo,e,i):"LITE"===t?this.loadDynamicObjects(this.lights,Ho,e,i):"HELP"===t?this.loadDynamicObjects(this.helpers,$o,e,i):"ATCH"===t?this.loadDynamicObjects(this.attachments,qo,e,i):"PIVT"===t?this.loadPivotPointChunk(e,i):"PREM"===t?this.loadDynamicObjects(this.particleEmitters,zo,e,i):"PRE2"===t?this.loadDynamicObjects(this.particleEmitters2,Ko,e,i):"RIBB"===t?this.loadDynamicObjects(this.ribbonEmitters,Wo,e,i):"CAMS"===t?this.loadDynamicObjects(this.cameras,Yo,e,i):"EVTS"===t?this.loadDynamicObjects(this.eventObjects,Xo,e,i):"CLID"===t?this.loadDynamicObjects(this.collisionShapes,Jo,e,i):this.unknownChunks.push(new Zo(e,i,t))}}loadVersionChunk(t){this.version=t.readUint32()}loadModelChunk(t){this.name=t.read(80),this.animationFile=t.read(260),this.extent.readMdx(t),this.blendTime=t.readUint32()}loadStaticObjects(t,e,i,n){for(let r=0;r<n;r++){let n=new e;n.readMdx(i),t.push(n)}}loadGlobalSequenceChunk(t,e){for(let i=0,n=e/4;i<n;i++)this.globalSequences.push(t.readUint32())}loadDynamicObjects(t,e,i,n){let r=0;for(;r<n;){let n=new e;n.readMdx(i),r+=n.getByteLength(),t.push(n)}}loadPivotPointChunk(t,e){for(let i=0,n=e/12;i<n;i++)this.pivotPoints.push(t.readFloat32Array(new Float32Array(3)))}saveMdx(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.write("MDLX"),this.saveVersionChunk(e),this.saveModelChunk(e),this.saveStaticObjectChunk(e,"SEQS",this.sequences,132),this.saveGlobalSequenceChunk(e),this.saveDynamicObjectChunk(e,"MTLS",this.materials),this.saveStaticObjectChunk(e,"TEXS",this.textures,268),this.saveDynamicObjectChunk(e,"TXAN",this.textureAnimations),this.saveDynamicObjectChunk(e,"GEOS",this.geosets),this.saveDynamicObjectChunk(e,"GEOA",this.geosetAnimations),this.saveDynamicObjectChunk(e,"BONE",this.bones),this.saveDynamicObjectChunk(e,"LITE",this.lights),this.saveDynamicObjectChunk(e,"HELP",this.helpers),this.saveDynamicObjectChunk(e,"ATCH",this.attachments),this.savePivotPointChunk(e),this.saveDynamicObjectChunk(e,"PREM",this.particleEmitters),this.saveDynamicObjectChunk(e,"PRE2",this.particleEmitters2),this.saveDynamicObjectChunk(e,"RIBB",this.ribbonEmitters),this.saveDynamicObjectChunk(e,"CAMS",this.cameras),this.saveDynamicObjectChunk(e,"EVTS",this.eventObjects),this.saveDynamicObjectChunk(e,"CLID",this.collisionShapes);for(let t of this.unknownChunks)t.saveMdx(e);return t}saveVersionChunk(t){t.write("VERS"),t.writeUint32(4),t.writeUint32(this.version)}saveModelChunk(t){t.write("MODL"),t.writeUint32(372),t.write(this.name),t.skip(80-this.name.length),t.write(this.animationFile),t.skip(260-this.animationFile.length),this.extent.writeMdx(t),t.writeUint32(this.blendTime)}saveStaticObjectChunk(t,e,i,n){if(i.length){t.write(e),t.writeUint32(i.length*n);for(let e of i)e.writeMdx(t)}}saveGlobalSequenceChunk(t){if(this.globalSequences.length){t.write("GLBS"),t.writeUint32(4*this.globalSequences.length);for(let e of this.globalSequences)t.writeUint32(e)}}saveDynamicObjectChunk(t,e,i){if(i.length){t.write(e),t.writeUint32(this.getObjectsByteLength(i));for(let e of i)e.writeMdx(t)}}savePivotPointChunk(t){if(this.pivotPoints.length){t.write("PIVT"),t.writeUint32(12*this.pivotPoints.length);for(let e of this.pivotPoints)t.writeFloat32Array(e)}}loadMdl(t){let e,i=new Ys(t);for(;e=i.read();)if("Version"===e)this.loadVersionBlock(i);else if("Model"===e)this.loadModelBlock(i);else if("Sequences"===e)this.loadNumberedObjectBlock(this.sequences,yo,"Anim",i);else if("GlobalSequences"===e)this.loadGlobalSequenceBlock(i);else if("Textures"===e)this.loadNumberedObjectBlock(this.textures,Do,"Bitmap",i);else if("Materials"===e)this.loadNumberedObjectBlock(this.materials,Po,"Material",i);else if("TextureAnims"===e)this.loadNumberedObjectBlock(this.textureAnimations,Oo,"TVertexAnim",i);else if("Geoset"===e)this.loadObject(this.geosets,No,i);else if("GeosetAnim"===e)this.loadObject(this.geosetAnimations,Vo,i);else if("Bone"===e)this.loadObject(this.bones,jo,i);else if("Light"===e)this.loadObject(this.lights,Ho,i);else if("Helper"===e)this.loadObject(this.helpers,$o,i);else if("Attachment"===e)this.loadObject(this.attachments,qo,i);else if("PivotPoints"===e)this.loadPivotPointBlock(i);else if("ParticleEmitter"===e)this.loadObject(this.particleEmitters,zo,i);else if("ParticleEmitter2"===e)this.loadObject(this.particleEmitters2,Ko,i);else if("RibbonEmitter"===e)this.loadObject(this.ribbonEmitters,Wo,i);else if("Camera"===e)this.loadObject(this.cameras,Yo,i);else if("EventObject"===e)this.loadObject(this.eventObjects,Xo,i);else{if("CollisionShape"!==e)throw new Error(`Unsupported block: ${e}`);this.loadObject(this.collisionShapes,Jo,i)}}loadVersionBlock(t){for(let e of t.readBlock()){if("FormatVersion"!==e)throw new Error(`Unknown token in Version: "${e}"`);this.version=t.readInt()}}loadModelBlock(t){this.name=t.read();for(let e of t.readBlock())if(e.startsWith("Num"))t.read();else if("BlendTime"===e)this.blendTime=t.readInt();else if("MinimumExtent"===e)t.readFloatArray(this.extent.min);else if("MaximumExtent"===e)t.readFloatArray(this.extent.max);else{if("BoundsRadius"!==e)throw new Error(`Unknown token in Model: "${e}"`);this.extent.boundsRadius=t.readFloat()}}loadNumberedObjectBlock(t,e,i,n){n.read();for(let r of n.readBlock()){if(r!==i)throw new Error(`Unknown token in ${i}: "${r}"`);{let i=new e;i.readMdl(n),t.push(i)}}}loadGlobalSequenceBlock(t){t.read();for(let e of t.readBlock()){if("Duration"!==e)throw new Error(`Unknown token in GlobalSequences: "${e}"`);this.globalSequences.push(t.readInt())}}loadObject(t,e,i){let n=new e;n.readMdl(i),t.push(n)}loadPivotPointBlock(t){let e=t.readInt();t.read();for(let i=0;i<e;i++)this.pivotPoints.push(t.readFloatArray(new Float32Array(3)));t.read()}saveMdl(){let t=new Ys;return this.saveVersionBlock(t),this.saveModelBlock(t),this.saveStaticObjectsBlock(t,"Sequences",this.sequences),this.saveGlobalSequenceBlock(t),this.saveStaticObjectsBlock(t,"Textures",this.textures),this.saveStaticObjectsBlock(t,"Materials",this.materials),this.saveStaticObjectsBlock(t,"TextureAnims",this.textureAnimations),this.saveObjects(t,this.geosets),this.saveObjects(t,this.geosetAnimations),this.saveObjects(t,this.bones),this.saveObjects(t,this.lights),this.saveObjects(t,this.helpers),this.saveObjects(t,this.attachments),this.savePivotPointBlock(t),this.saveObjects(t,this.particleEmitters),this.saveObjects(t,this.particleEmitters2),this.saveObjects(t,this.ribbonEmitters),this.saveObjects(t,this.cameras),this.saveObjects(t,this.eventObjects),this.saveObjects(t,this.collisionShapes),t.buffer}saveVersionBlock(t){t.startBlock("Version"),t.writeAttrib("FormatVersion",this.version),t.endBlock()}saveModelBlock(t){t.startObjectBlock("Model",this.name),t.writeAttrib("BlendTime",this.blendTime),this.extent.writeMdl(t),t.endBlock()}saveStaticObjectsBlock(t,e,i){if(i.length){t.startBlock(e,i.length);for(let e of i)e.writeMdl(t);t.endBlock()}}saveGlobalSequenceBlock(t){if(this.globalSequences.length){t.startBlock("GlobalSequences",this.globalSequences.length);for(let e of this.globalSequences)t.writeAttrib("Duration",e);t.endBlock()}}saveObjects(t,e){for(let i of e)i.writeMdl(t)}savePivotPointBlock(t){if(this.pivotPoints.length){t.startBlock("PivotPoints",this.pivotPoints.length);for(let e of this.pivotPoints)t.writeFloatArray(e);t.endBlock()}}getByteLength(){let t=396;return t+=this.getStaticObjectsChunkByteLength(this.sequences,132),t+=this.getStaticObjectsChunkByteLength(this.globalSequences,4),t+=this.getDynamicObjectsChunkByteLength(this.materials),t+=this.getStaticObjectsChunkByteLength(this.textures,268),t+=this.getDynamicObjectsChunkByteLength(this.textureAnimations),t+=this.getDynamicObjectsChunkByteLength(this.geosets),t+=this.getDynamicObjectsChunkByteLength(this.geosetAnimations),t+=this.getDynamicObjectsChunkByteLength(this.bones),t+=this.getDynamicObjectsChunkByteLength(this.lights),t+=this.getDynamicObjectsChunkByteLength(this.helpers),t+=this.getDynamicObjectsChunkByteLength(this.attachments),t+=this.getStaticObjectsChunkByteLength(this.pivotPoints,12),t+=this.getDynamicObjectsChunkByteLength(this.particleEmitters),t+=this.getDynamicObjectsChunkByteLength(this.particleEmitters2),t+=this.getDynamicObjectsChunkByteLength(this.ribbonEmitters),t+=this.getDynamicObjectsChunkByteLength(this.cameras),t+=this.getDynamicObjectsChunkByteLength(this.eventObjects),t+=this.getDynamicObjectsChunkByteLength(this.collisionShapes),t+=this.getObjectsByteLength(this.unknownChunks)}getObjectsByteLength(t){let e=0;for(let i of t)e+=i.getByteLength();return e}getDynamicObjectsChunkByteLength(t){return t.length?8+this.getObjectsByteLength(t):0}getStaticObjectsChunkByteLength(t,e){return t.length?8+t.length*e:0}}var tl={Model:Qo};function el(t){let e=-1;for(let i=0,n=Math.ceil(t.byteLength/512);i<n;i++){let n=512*i;77===t[n]&&80===t[n+1]&&81===t[n+2]&&26===t[n+3]&&(e=n)}return e}let il=441536589,nl=3283040112,rl=0,al=1,sl=2,ol=3,ll=4294967294,hl=4294967295,ul=3968054179,cl=512,dl=65536,fl=131072,ml=16777216,gl=2147483648,pl=1,vl=2,bl=8,wl=16,yl=64,Al=128,_l=new Uint8Array(4),xl=new Uint32Array(_l.buffer);class Tl{constructor(){let t,e,i=new Uint32Array(1280),n=1048577;for(let r=0;r<256;r++)for(let a=r,s=0;s<5;s+=1,a+=256)t=(65535&(n=(125*n+3)%2796203))<<16,e=65535&(n=(125*n+3)%2796203),i[a]=t|e;this.cryptTable=i}hash(t,e){let i=this.cryptTable,n=2146271213,r=4008636142;t=t.toUpperCase();for(let a=0;a<t.length;a++){let s=t.charCodeAt(a);r=s+(n=i[(e<<8)+s]^n+r)+r+(r<<5)+3}return n>>>0}decryptBlock(t,e){let i,n=this.cryptTable,r=4008636142;i=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(let a=0,s=t.byteLength>>>2;a<s;a++)r+=n[1024+(255&e)],_l[0]=i[4*a],_l[1]=i[4*a+1],_l[2]=i[4*a+2],_l[3]=i[4*a+3],xl[0]^=e+r,e=286331153+(~e<<21)|e>>>11,r=xl[0]+r+(r<<5)+3,i[4*a]=_l[0],i[4*a+1]=_l[1],i[4*a+2]=_l[2],i[4*a+3]=_l[3];return t}encryptBlock(t,e){let i,n=this.cryptTable,r=4008636142;i=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(let a=0,s=t.byteLength>>>2;a<s;a++){r+=n[1024+(255&e)],_l[0]=i[4*a],_l[1]=i[4*a+1],_l[2]=i[4*a+2],_l[3]=i[4*a+3];let t=xl[0];xl[0]^=e+r,e=286331153+(~e<<21)|e>>>11,r=t+r+(r<<5)+3,i[4*a]=_l[0],i[4*a+1]=_l[1],i[4*a+2]=_l[2],i[4*a+3]=_l[3]}return t}computeFileKey(t,e){let i=t.lastIndexOf("\\"),n=t.substring(i+1),r=this.hash(n,ol);return e.flags&fl&&(r=r+e.offset^e.normalSize),r}}class El{constructor(){this.nameA=4294967295,this.nameB=4294967295,this.locale=65535,this.platform=65535,this.blockIndex=hl}load(t){let e=t[2];this.nameA=t[0],this.nameB=t[1],this.locale=65535&e,this.platform=e>>>16,this.blockIndex=t[3]}copy(t){this.nameA=t.nameA,this.nameB=t.nameB,this.locale=t.locale,this.platform=t.platform,this.blockIndex=t.blockIndex}save(t){t[0]=this.nameA,t[1]=this.nameB,t[2]=this.locale<<16|this.platform,t[3]=this.blockIndex}delete(){this.nameA=4294967295,this.nameB=4294967295,this.locale=65535,this.platform=65535,this.blockIndex=ll}}class Sl{constructor(t){this.c=t,this.entries=[],this.addEmpties(4)}clear(){this.entries.length=0}addEmpties(t){for(let e=0;e<t;e++)this.entries.push(new El)}getInsertionIndex(t){let e=this.entries,i=this.c.hash(t,rl)&e.length-1;for(let t=0,n=e.length;t<n;t++){let r=(t+i)%n;if(65535===e[r].platform)return r}return-1}add(t,e){let i=this.getInsertionIndex(t);if(-1!==i){let n=this.entries[i];return n.nameA=this.c.hash(t,al),n.nameB=this.c.hash(t,sl),n.locale=0,n.platform=0,n.blockIndex=e,n}}load(t){let e=t.byteLength/16,i=new Uint32Array(this.c.decryptBlock(t,nl).buffer),n=0;this.clear(),this.addEmpties(e);for(let t of this.entries)t.load(i.subarray(n,n+4)),n+=4}save(t){let e=new Uint32Array(4*this.entries.length),i=0;for(let t of this.entries)t.save(e.subarray(i,i+4)),i+=4;let n=new Uint8Array(e.buffer);this.c.encryptBlock(n,nl),t.set(n)}get(t){let e=this.c,i=this.entries,n=e.hash(t,rl)&i.length-1,r=e.hash(t,al),a=e.hash(t,sl);for(let t=0,e=i.length;t<e;t++){let s=i[(t+n)%e];if(r===s.nameA&&a===s.nameB)return s;if(4294967295===s.blockIndex)return null}return null}}class Ml{constructor(){this.offset=0,this.compressedSize=0,this.normalSize=0,this.flags=0}load(t){this.offset=t[0],this.compressedSize=t[1],this.normalSize=t[2],this.flags=t[3]}save(t){t[0]=this.offset,t[1]=this.compressedSize,t[2]=this.normalSize,t[3]=this.flags}}class Rl{constructor(t){this.c=t,this.entries=[]}add(t){let e=new Ml;return e.normalSize=t.byteLength,this.entries.push(e),e}clear(){this.entries.length=0}addEmpties(t){for(let e=0;e<t;e++)this.entries.push(new Ml)}load(t){let e=t.byteLength/16,i=new Uint32Array(this.c.decryptBlock(t,ul).buffer),n=0;this.clear(),this.addEmpties(e);for(let t of this.entries)t.load(i.subarray(n,n+4)),n+=4}save(t){let e=new Uint32Array(4*this.entries.length),i=0;for(let t of this.entries)t.save(e.subarray(i,i+4)),i+=4;let n=new Uint8Array(e.buffer);this.c.encryptBlock(n,ul),t.set(n)}}var Il=i(17);class Bl{constructor(t){this.archive=t,this.c=t.c,this.name="",this.nameResolved=!1,this.hash=null,this.block=null,this.rawBuffer=null,this.buffer=null}arrayBuffer(){return null===this.buffer&&this.decode(),this.buffer}text(){let t=this.arrayBuffer();return t?function(t){let e=new Uint8Array(t),i="";for(let t=0,n=e.length;t<n;t++)i+=String.fromCharCode(e[t]);return i}(t):null}load(t,e,i){let n=this.archive.headerOffset;this.name=`File${`${t.blockIndex}`.padStart(8,"0")}`,this.hash=t,this.block=e,this.rawBuffer=i.slice(n+e.offset,n+e.offset+e.compressedSize).buffer}save(t){t.set(new Uint8Array(this.rawBuffer))}set(t){if(this.archive.readonly)return!1;let e=this.hash;e.locale=0,e.platform=0;let i=this.block;return i.compressedSize=0,i.normalSize=t.byteLength,i.flags=0,this.buffer=t,this.rawBuffer=null,!0}delete(){if(this.archive.readonly)return!1;let t=this.archive,e=this.hash,i=e.blockIndex;e.delete();for(let e of t.hashTable.entries)e.blockIndex<ll&&e.blockIndex>i&&(e.blockIndex-=1);return t.blockTable.entries.splice(i,1),t.files.splice(i,1),!0}rename(t){if(this.archive.readonly)return!1;let e=this.hash,i=e.locale,n=e.platform,r=e.blockIndex;e.delete();let a=this.archive.hashTable.add(t,r);return a.locale=i,a.platform=n,this.name=t,this.nameResolved=!0,this.hash=a,!0}decode(){let t=this.archive,e=this.block,i=t.c,n=i.computeFileKey(this.name,e),r=new Uint8Array(this.rawBuffer),a=e.flags;if(a===gl)this.buffer=r.slice(0,e.normalSize).buffer;else if(a&ml){let t;t=a&dl?i.decryptBlock(r.slice(0,e.compressedSize),n):r.subarray(0,e.compressedSize),t=a&cl?this.decompressSector(t,e.normalSize):t.slice(),this.buffer=t.buffer}else{let s=Math.ceil(e.normalSize/t.sectorSize),o=new Uint8Array(e.normalSize),l=new Uint32Array(r.buffer,0,s+1);a&dl&&(l=i.decryptBlock(l.slice(),n-1));let h=l[0],u=l[1],c=0;for(let d=0;d<s;d++){let f;if(f=a&dl?i.decryptBlock(r.slice(h,u),n+d):r.subarray(h,u),a&cl){let i=t.sectorSize;e.normalSize-c<i&&(i=e.normalSize-c),f=this.decompressSector(f,i)}if(!f)return!1;o.set(f,c),c+=f.byteLength,d<s&&(h=u,u=l[d+2])}this.buffer=o.buffer}return t.readonly&&(this.rawBuffer=null),!0}decompressSector(t,e){if(t.byteLength===e)return t;{let e=t[0];if(e&wl)return console.warn(`File ${this.name}, compression type 'bzip2' not supported`),null;if(e&bl)return console.warn(`File ${this.name}, compression type 'implode' not supported`),null;if(e&vl)try{t=Object(Il.inflate)(t.subarray(1))}catch(t){return console.warn(`File ${this.name}, failed to decompress with 'zlib': ${t}`),null}return e&pl?(console.warn(`File ${this.name}, compression type 'huffman' not supported`),null):e&Al?(console.warn(`File ${this.name}, compression type 'adpcm stereo' not supported`),null):e&yl?(console.warn(`File ${this.name}, compression type 'adpcm mono' not supported`),null):t}}encode(){if(null!==this.buffer&&null===this.rawBuffer){let e=new Uint8Array(this.buffer);if(72===(t=e)[0]&&77===t[1]&&51===t[2]&&87===t[3]||-1!==el(t))this.rawBuffer=this.buffer,this.block.compressedSize=this.buffer.byteLength,this.block.flags=gl;else{let t=this.archive.sectorSize,i=Math.ceil(e.byteLength/t),n=new Uint32Array(i+1),r=n.byteLength,a=[];n[0]=n.byteLength;for(let s=0;s<i;s++){let i=s*t,o=e.subarray(i,i+t),l=Object(Il.deflate)(o),h=l.byteLength+1;h>t&&(l=o),r+=h,n[s+1]=r,a[s]=l}let s=n[n.length-1],o=new Uint8Array(s);o.set(new Uint8Array(n.buffer)),r=n.byteLength;for(let e of a)e.byteLength<t&&(o[r]=2,r+=1),o.set(e,r),r+=e.byteLength;o.byteLength<e.byteLength?(this.rawBuffer=o.buffer,this.block.compressedSize=o.byteLength,this.block.flags=(gl|cl)>>>0):(this.rawBuffer=this.buffer,this.block.compressedSize=this.buffer.byteLength,this.block.flags=gl)}}var t}reEncrypt(t){let e=this.archive,i=this.block,n=e.c,r=new Uint8Array(this.rawBuffer),a=i.flags,s=n.computeFileKey(this.name,i);i.offset=t;let o=n.computeFileKey(this.name,i);if(a&ml)n.decryptBlock(r,s),n.encryptBlock(r,o);else{let t=Math.ceil(i.normalSize/e.sectorSize),a=new Uint32Array(r.buffer,0,t+1);n.decryptBlock(a,s-1);let l=a[0],h=a[1];for(let e=0;e<t;e++){let i=r.subarray(l,h);n.decryptBlock(i,s+e),n.encryptBlock(i,o+e),e<t&&(l=h,h=a[e+2])}n.encryptBlock(a,o-1)}}offsetChanged(t){let e=this.block;return e.offset!==t&&e.flags&fl?!!this.nameResolved&&(this.reEncrypt(t),!0):(e.offset=t,!0)}}class Cl{constructor(t,e){this.headerOffset=0,this.sectorSize=4096,this.c=new Tl,this.hashTable=new Sl(this.c),this.blockTable=new Rl(this.c),this.files=[],this.readonly=!!e,t&&this.load(t)}load(t){let e=new Uint8Array(t),i=el(e);if(-1===i)return!1;let n=new Uint32Array(t,i,8),r=n[3],a=Object(qs.g)(n[4]+i),s=Object(qs.g)(n[5]+i),o=n[6],l=n[7];l>o&&(l=o),this.headerOffset=i,this.sectorSize=512*(1<<(r>>>16)),this.hashTable.load(e.slice(a,a+16*o)),this.blockTable.load(e.slice(s,s+16*l)),this.files.length=0;for(let t of this.hashTable.entries){let i=t.blockIndex;if(i<ll){let n=new Bl(this);n.load(t,this.blockTable.entries[i],e),this.files[i]=n}}let h=this.get("(listfile)");if(this.get("(attributes)"),this.get("(signature)"),h){let t=h.text();if(t)for(let e of t.split("\r\n"))this.get(e)}return!0}save(){if(this.readonly)return null;this.delete("(attributes)"),this.saveMemory(),this.setListFile();let t=32;for(let e of this.files){if(!e.offsetChanged(t))return null;e.encode(),t+=e.block.compressedSize}let e=this.hashTable,i=this.blockTable,n=e.entries.length,r=i.entries.length,a=t-32,s=32+a+16*n+16*r,o=32+a,l=o+16*n,h=new Uint8Array(s),u=new Uint32Array(h.buffer,0,8);u[0]=il,u[1]=32,u[2]=s,u[3]=Math.log2(this.sectorSize/512)<<16,u[4]=o,u[5]=l,u[6]=n,u[7]=r,t=32;for(let e of this.files)e.save(h.subarray(t,t+e.block.compressedSize)),t+=e.block.compressedSize;return e.save(h.subarray(t,t+16*e.entries.length)),t+=16*e.entries.length,i.save(h.subarray(t,t+16*i.entries.length)),h.buffer}saveMemory(){if(this.readonly)return 0;let t=this.blockTable.entries,e=this.hashTable.entries,i=t.length,n=0;for(;i--;){let r=t[i];if(0===r.normalSize)this.removeBlock(i),n+=r.compressedSize;else{let t=!1;for(let n of e)n.blockIndex===i&&(t=!0);t||(this.removeBlock(i),n+=r.compressedSize)}}return n}removeBlock(t){for(let e of this.hashTable.entries)e.blockIndex<ll&&e.blockIndex>t&&(e.blockIndex-=1);this.blockTable.entries.splice(t,1)}getFileNames(){let t=[];for(let e of this.files)e&&""!==e.name&&t.push(e.name);return t}setListFile(){return!this.readonly&&this.set("(listfile)",function(t){let e=new Uint8Array(t.length);for(let i=0,n=e.length;i<n;i++)e[i]=t.charCodeAt(i);return e.buffer}(this.getFileNames().join("\r\n")))}set(t,e){if(this.readonly)return!1;let i=this.get(t);if(i)i.set(e);else{let n=this.blockTable.entries.length;(i=new Bl(this)).name=t,i.nameResolved=!0,i.hash=this.hashTable.add(t,n),i.block=this.blockTable.add(e),i.buffer=e,this.files[n]=i}return!0}get(t){let e=this.hashTable.get(t);if(e){let i=e.blockIndex;if(i<ll){let e=this.files[i];if(e)return e.name=t,e.nameResolved=!0,e}}return null}has(t){return!!this.get(t)}delete(t){if(this.readonly)return!1;let e=this.get(t);return!!e&&(e.delete(),!0)}rename(t,e){if(this.readonly)return!1;let i=this.get(t);return!!i&&(i.rename(e),!0)}resizeHashtable(t){if(this.readonly)return!1;t=Math.max(4,gs(t));let e=this.files;if(e.length>t)return!1;for(let t of e)if(!t.nameResolved)return!1;let i=this.hashTable,n=i.entries,r=n.slice();i.clear(),i.addEmpties(t);for(let t of r)if(t.blockIndex!==hl){let r=e[t.blockIndex];n[i.getInsertionIndex(r.name)].copy(t)}return!0}}var Ll={Archive:Cl,Block:Ml,BlockTable:Rl,Crypto:Tl,File:Bl,Hash:El,HashTable:Sl};class Ul{constructor(){this.id="\0\0\0\0",this.chance=0}load(t){this.id=t.read(4),this.chance=t.readInt32()}save(t){t.write(this.id),t.writeInt32(this.chance)}}class kl{constructor(){this.items=[]}load(t){for(let e=0,i=t.readUint32();e<i;e++){let e=new Ul;e.load(t),this.items.push(e)}}save(t){t.writeUint32(this.items.length);for(let e of this.items)e.save(t)}getByteLength(){return 4+8*this.items.length}}class Fl{constructor(){this.id="\0\0\0\0",this.variation=0,this.location=new Float32Array(3),this.angle=0,this.scale=new Float32Array([1,1,1]),this.flags=0,this.life=0,this.itemTable=-1,this.itemSets=[],this.editorId=0,this.u1=new Uint8Array(8)}load(t,e){if(this.id=t.read(4),this.variation=t.readInt32(),this.location=t.readFloat32Array(3),this.angle=t.readFloat32(),this.scale=t.readFloat32Array(3),this.flags=t.readUint8(),this.life=t.readUint8(),e>7){this.itemTable=t.readUint32();for(let e=0,i=t.readUint32();e<i;e++){let e=new kl;e.load(t),this.itemSets.push(e)}}this.editorId=t.readInt32()}save(t,e){if(t.write(this.id),t.writeInt32(this.variation),t.writeFloat32Array(this.location),t.writeFloat32(this.angle),t.writeFloat32Array(this.scale),t.writeUint8(this.flags),t.writeUint8(this.life),e>7){t.writeUint32(this.itemTable),t.writeUint32(this.itemSets.length);for(let e of this.itemSets)e.save(t)}t.writeInt32(this.editorId)}getByteLength(t){let e=42;if(t>7){e+=8;for(let t of this.itemSets)e+=t.getByteLength()}return e}}class Pl{constructor(){this.id="\0\0\0\0",this.u1=0,this.location=new Uint32Array(2)}load(t,e){this.id=t.read(4),this.u1=t.readUint32(),this.location=t.readUint32Array(2)}save(t,e){t.write(this.id),t.writeUint32(this.u1),t.writeUint32Array(this.location)}}class Dl{constructor(t){this.version=0,this.u1=new Uint8Array(4),this.doodads=[],this.u2=new Uint8Array(4),this.terrainDoodads=[],t&&this.load(t)}load(t){let e=new Ks(t);if("W3do"!==e.read(4))return!1;this.version=e.readInt32(),this.u1=e.readUint8Array(4);for(let t=0,i=e.readInt32();t<i;t++){let t=new Fl;t.load(e,this.version),this.doodads.push(t)}this.u2=e.readUint8Array(4);for(let t=0,i=e.readInt32();t<i;t++){let t=new Pl;t.load(e,this.version),this.terrainDoodads.push(t)}return!0}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.write("W3do"),e.writeInt32(this.version),e.writeUint8Array(this.u1),e.writeUint32(this.doodads.length);for(let t of this.doodads)t.save(e,this.version);e.writeUint8Array(this.u2),e.writeUint32(this.terrainDoodads.length);for(let t of this.terrainDoodads)t.save(e,this.version);return t}getByteLength(){let t=24+16*this.terrainDoodads.length;for(let e of this.doodads)t+=e.getByteLength(this.version);return t}}class Ol{constructor(){this.isCustom=0,this.name=""}load(t){this.isCustom=t.readUint8(),this.name=t.readUntilNull()}save(t){t.writeUint8(this.isCustom),t.write(`${this.name}\0`)}getByteLength(){return 2+this.name.length}}class Nl{constructor(){this.version=1,this.entries=new Map}load(t){let e=new Ks(t);this.version=e.readUint32();for(let t=0,i=e.readUint32();t<i;t++){let t=new Ol;t.load(e),t.isCustom?this.entries.set(t.name,t):this.entries.set(`war3mapimported\\${t.name}`,t)}}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.writeUint32(this.version),e.writeUint32(this.entries.size);for(let t of this.entries.values())t.save(e);return t}getByteLength(){let t=8;for(let e of this.entries.values())t+=e.getByteLength();return t}set(t){if(!this.entries.has(t)){let e=new Ol;return e.isCustom=10,e.path=t,this.entries.set(t,e),!0}return!1}has(t){return this.entries.has(t)}delete(t){return this.entries.delete(t)}rename(t,e){let i=this.entries.get(t);return!!i&&(i.isCustom=10,i.path=e,!0)}}class Vl{constructor(){this.id="\0\0\0\0",this.variableType=0,this.levelOrVariation=0,this.dataPointer=0,this.value=0,this.u1=0}load(t,e){if(this.id=t.read(4),this.variableType=t.readInt32(),e&&(this.levelOrVariation=t.readInt32(),this.dataPointer=t.readInt32()),0===this.variableType)this.value=t.readInt32();else if(1===this.variableType||2===this.variableType)this.value=t.readFloat32();else{if(3!==this.variableType)throw new Error(`Modification: unknown variable type ${variableType}`);this.value=t.readUntilNull()}this.u1=t.readInt32()}save(t,e){if(t.write(this.id),t.writeInt32(this.variableType),e&&(t.writeInt32(this.levelOrVariation),t.writeInt32(this.dataPointer)),0===this.variableType)t.writeInt32(this.value);else if(1===this.variableType||2===this.variableType)t.writeFloat32(this.value);else{if(3!==this.variableType)throw new Error(`Modification: unknown variable type ${variableType}`);t.write(`${this.value}\0`)}t.writeInt32(this.u1)}getByteLength(t){let e=12;return t&&(e+=8),3===this.variableType?e+=1+this.value.length:e+=4,e}}class Gl{constructor(){this.oldId="\0\0\0\0",this.newId="\0\0\0\0",this.modifications=[]}load(t,e){this.oldId=t.read(4),this.newId=t.read(4);for(let i=0,n=t.readUint32();i<n;i++){let n=new Vl;n.load(t,e),this.modifications[i]=n}}save(t,e){this.oldId?t.write(this.oldId):t.writeUint32(0),this.newId?t.write(this.newId):t.writeUint32(0),t.writeUint32(this.modifications.length);for(let i of this.modifications)i.save(t,e)}getByteLength(t){let e=12;for(let i of this.modifications)e+=i.getByteLength(t);return e}}class jl{constructor(){this.objects=[]}load(t,e){for(let i=0,n=t.readUint32();i<n;i++){let n=new Gl;n.load(t,e),this.objects[i]=n}}save(t,e){t.writeUint32(this.objects.length);for(let i of this.objects)i.save(t,e)}getByteLength(t){let e=4;for(let i of this.objects)e+=i.getByteLength(t);return e}}class Hl{constructor(t){this.version=0,this.originalTable=new jl,this.customTable=new jl,t&&this.load(t)}load(t){let e=new Ks(t);this.version=e.readInt32(),this.originalTable.load(e,!0),this.customTable.load(e,!0)}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);return e.writeInt32(this.version),this.originalTable.save(e,!0),this.customTable.save(e,!0),t}getByteLength(){return 4+this.originalTable.getByteLength(!0)+this.customTable.getByteLength(!0)}}class $l{constructor(){this.groundHeight=0,this.waterHeight=0,this.mapEdge=0,this.ramp=0,this.blight=0,this.water=0,this.boundary=0,this.groundTexture=0,this.cliffVariation=0,this.groundVariation=0,this.cliffTexture=0,this.layerHeight=0}load(t){this.groundHeight=(t.readInt16()-8192)/512;let e=t.readInt16();this.waterHeight=((16383&e)-8192)/512,this.mapEdge=16384&e;let i=t.readUint8();this.ramp=16&i,this.blight=32&i,this.water=64&i,this.boundary=128&i,this.groundTexture=15&i;let n=t.readUint8();this.cliffVariation=(224&n)>>>5,this.groundVariation=31&n;let r=t.readUint8();this.cliffTexture=(240&r)>>>4,this.layerHeight=15&r}save(t){t.writeInt16(512*this.groundHeight+8192),t.writeInt16(512*this.waterHeight+8192+this.mapEdge<<14),t.writeUint8(this.ramp<<4|this.blight<<5|this.water<<6|this.boundary<<7|this.groundTexture),t.writeUint8(this.cliffVariation<<5|this.groundVariation),t.writeUint8((this.cliffTexture<<4)+this.layerHeight)}}class ql{constructor(t){this.version=0,this.tileset="A",this.haveCustomTileset=0,this.groundTilesets=[],this.cliffTilesets=[],this.mapSize=new Int32Array(2),this.centerOffset=new Float32Array(2),this.corners=[],t instanceof ArrayBuffer&&this.load(t)}load(t){let e=new Ks(t);if("W3E!"!==e.read(4))return!1;this.version=e.readInt32(),this.tileset=e.read(1),this.haveCustomTileset=e.readInt32();for(let t=0,i=e.readInt32();t<i;t++)this.groundTilesets[t]=e.read(4);for(let t=0,i=e.readInt32();t<i;t++)this.cliffTilesets[t]=e.read(4);this.mapSize=e.readInt32Array(2),this.centerOffset=e.readFloat32Array(2);let[i,n]=this.mapSize;for(let t=0;t<n;t++){this.corners[t]=[];for(let n=0;n<i;n++){let i=new $l;i.load(e),this.corners[t][n]=i}}return!0}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.write("W3E!"),e.writeInt32(this.version),e.write(this.tileset),e.writeInt32(this.haveCustomTileset),e.writeUint32(this.groundTilesets.length);for(let t of this.groundTilesets)e.write(t);e.writeUint32(this.cliffTilesets.length);for(let t of this.cliffTilesets)e.write(t);e.writeInt32Array(this.mapSize),e.writeFloat32Array(this.centerOffset);for(let t of this.corners)for(let i of t)i.save(e);return t}getByteLength(){return 37+4*this.groundTilesets.length+4*this.cliffTilesets.length+this.mapSize[0]*this.mapSize[1]*7}}class zl{constructor(){this.id=0,this.type=0,this.race=0,this.isFixedStartPosition=0,this.name="",this.startLocation=new Float32Array(2),this.allyLowPriorities=0,this.allyHighPriorities=0}load(t){this.id=t.readInt32(),this.type=t.readInt32(),this.race=t.readInt32(),this.isFixedStartPosition=t.readInt32(),this.name=t.readUntilNull(),this.startLocation=t.readFloat32Array(2),this.allyLowPriorities=t.readUint32(),this.allyHighPriorities=t.readUint32()}save(t){t.writeInt32(this.id),t.writeInt32(this.type),t.writeInt32(this.race),t.writeInt32(this.isFixedStartPosition),t.write(`${this.name}\0`),t.writeFloat32Array(this.startLocation),t.writeUint32(this.allyLowPriorities),t.writeUint32(this.allyHighPriorities)}getByteLength(){return 33+this.name.length}}class Kl{constructor(){this.flags=0,this.playerMasks=0,this.name=""}load(t){this.flags=t.readUint32(),this.playerMasks=t.readUint32(),this.name=t.readUntilNull()}save(t){t.writeUint32(this.flags),t.writeUint32(this.playerMasks),t.write(`${this.name}\0`)}getByteLength(){return 9+this.name.length}}class Wl{constructor(){this.playerFlags=0,this.id="\0\0\0\0",this.levelAffected=0,this.availability=0}load(t){this.playerFlags=t.readUint32(),this.id=t.read(4),this.levelAffected=t.readInt32(),this.availability=t.readInt32()}save(t){t.writeUint32(this.playerFlags),t.write(this.id),t.writeInt32(this.levelAffected),t.writeInt32(this.availability)}}class Yl{constructor(){this.playerFlags=0,this.id="\0\0\0\0"}load(t){this.playerFlags=t.readUint32(),this.id=t.read(4)}save(t){t.writeUint32(this.playerFlags),t.write(this.id)}}class Xl{constructor(){this.chance=0,this.ids=[]}load(t,e){this.chance=t.readInt32();for(let i=0;i<e;i++)this.ids[i]=t.read(4,!0)}save(t){t.writeInt32(this.chance);for(let e of this.ids)t.write(e)}}class Jl{constructor(){this.id=0,this.name="",this.positions=0,this.columnTypes=new Int32Array(1),this.units=[]}load(t){this.id=t.readInt32(),this.name=t.readUntilNull(),this.positions=t.readInt32(),this.columnTypes=t.readInt32Array(this.positions);for(let e=0,i=t.readUint32();e<i;e++){let i=new Xl;i.load(t,this.positions),this.units[e]=i}}save(t){t.writeInt32(this.id),t.write(`${this.name}\0`),t.writeInt32(this.positions),t.writeInt32Array(this.columnTypes),t.writeUint32(this.units.length);for(let e of this.units)e.save(t)}getByteLength(){return 13+this.name.length+this.columnTypes.byteLength+this.units.length*(4+4*this.positions)}}class Zl{constructor(){this.chance=0,this.id="\0\0\0\0"}load(t){this.chance=t.readInt32(),this.id=t.read(4)}save(t){t.writeInt32(this.chance),t.write(this.id)}}class Ql{constructor(){this.items=[]}load(t){for(let e=0,i=t.readUint32();e<i;e++){let i=new Zl;i.load(t),this.items[e]=i}}save(t){t.writeUint32(this.items.length);for(let e of this.items)e.save(t)}getByteLength(){return 4+8*this.items.length}}class th{constructor(){this.id=0,this.name="",this.sets=[]}load(t){this.id=t.readInt32(),this.name=t.readUntilNull();for(let e=0,i=t.readUint32();e<i;e++){let i=new Ql;i.load(t),this.sets[e]=i}}save(t){t.writeInt32(this.id),t.write(`${this.name}\0`),t.writeUint32(this.sets.length);for(let e of this.sets)e.save(t)}getByteLength(){let t=9+this.name.length;for(let e of this.sets)t+=e.getByteLength();return t}}class eh{constructor(t){this.version=0,this.saves=0,this.editorVersion=0,this.name="",this.author="",this.description="",this.recommendedPlayers="",this.cameraBounds=new Float32Array(8),this.cameraBoundsComplements=new Int32Array(4),this.playableSize=new Int32Array(2),this.flags=0,this.tileset="\0",this.campaignBackground=0,this.loadingScreenModel="",this.loadingScreenText="",this.loadingScreenTitle="",this.loadingScreenSubtitle="",this.loadingScreen=0,this.prologueScreenModel="",this.prologueScreenText="",this.prologueScreenTitle="",this.prologueScreenSubtitle="",this.useTerrainFog=0,this.fogHeight=new Float32Array(2),this.fogDensity=0,this.fogColor=new Uint8Array(4),this.globalWeather=0,this.soundEnvironment="",this.lightEnvironmentTileset="\0",this.waterVertexColor=new Uint8Array(4),this.players=[],this.forces=[],this.upgradeAvailabilityChanges=[],this.techAvailabilityChanges=[],this.randomUnitTables=[],this.randomItemTables=[],t&&this.load(t)}load(t){let e=new Ks(t);this.version=e.readInt32(),this.saves=e.readInt32(),this.editorVersion=e.readInt32(),this.name=e.readUntilNull(),this.author=e.readUntilNull(),this.description=e.readUntilNull(),this.recommendedPlayers=e.readUntilNull(),this.cameraBounds=e.readFloat32Array(8),this.cameraBoundsComplements=e.readInt32Array(4),this.playableSize=e.readInt32Array(2),this.flags=e.readUint32(),this.tileset=e.read(1),this.campaignBackground=e.readInt32(),this.version>24&&(this.loadingScreenModel=e.readUntilNull()),this.loadingScreenText=e.readUntilNull(),this.loadingScreenTitle=e.readUntilNull(),this.loadingScreenSubtitle=e.readUntilNull(),this.loadingScreen=e.readInt32(),this.version>24&&(this.prologueScreenModel=e.readUntilNull()),this.prologueScreenText=e.readUntilNull(),this.prologueScreenTitle=e.readUntilNull(),this.prologueScreenSubtitle=e.readUntilNull(),this.version>24&&(this.useTerrainFog=e.readInt32(),this.fogHeight=e.readFloat32Array(2),this.fogDensity=e.readFloat32(),this.fogColor=e.readUint8Array(4),this.globalWeather=e.readInt32(),this.soundEnvironment=e.readUntilNull(),this.lightEnvironmentTileset=e.read(1,!0),this.waterVertexColor=e.readUint8Array(4));for(let t=0,i=e.readInt32();t<i;t++){let i=new zl;i.load(e),this.players[t]=i}for(let t=0,i=e.readInt32();t<i;t++){let i=new Kl;i.load(e),this.forces[t]=i}for(let t=0,i=e.readInt32();t<i;t++){let i=new Wl;i.load(e),this.upgradeAvailabilityChanges[t]=i}for(let t=0,i=e.readInt32();t<i;t++){let i=new Yl;i.load(e),this.techAvailabilityChanges[t]=i}for(let t=0,i=e.readInt32();t<i;t++){let i=new Jl;i.load(e),this.randomUnitTables[t]=i}if(this.version>24)for(let t=0,i=e.readInt32();t<i;t++){let i=new th;i.load(e),this.randomItemTables[t]=i}}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.writeInt32(this.version),e.writeInt32(this.saves),e.writeInt32(this.editorVersion),e.write(`${this.name}\0`),e.write(`${this.author}\0`),e.write(`${this.description}\0`),e.write(`${this.recommendedPlayers}\0`),e.writeFloat32Array(this.cameraBounds),e.writeInt32Array(this.cameraBoundsComplements),e.writeInt32Array(this.playableSize),e.writeUint32(this.flags),e.write(this.tileset),e.writeInt32(this.campaignBackground),this.version>24&&e.write(`${this.loadingScreenModel}\0`),e.write(`${this.loadingScreenText}\0`),e.write(`${this.loadingScreenTitle}\0`),e.write(`${this.loadingScreenSubtitle}\0`),e.writeInt32(this.loadingScreen),this.version>24&&e.write(`${this.prologueScreenModel}\0`),e.write(`${this.prologueScreenText}\0`),e.write(`${this.prologueScreenTitle}\0`),e.write(`${this.prologueScreenSubtitle}\0`),this.version>24&&(e.writeInt32(this.useTerrainFog),e.writeFloat32Array(this.fogHeight),e.writeFloat32(this.fogDensity),e.writeUint8Array(this.fogColor),e.writeInt32(this.globalWeather),e.write(`${this.soundEnvironment}\0`),e.write(this.lightEnvironmentTileset),e.writeUint8Array(this.waterVertexColor)),e.writeUint32(this.players.length);for(let t of this.players)t.save(e);e.writeUint32(this.forces.length);for(let t of this.forces)t.save(e);e.writeUint32(this.upgradeAvailabilityChanges.length);for(let t of this.upgradeAvailabilityChanges)t.save(e);e.writeUint32(this.techAvailabilityChanges.length);for(let t of this.techAvailabilityChanges)t.save(e);e.writeUint32(this.randomUnitTables.length);for(let t of this.randomUnitTables)t.save(e);if(this.version>24){e.writeUint32(this.randomItemTables.length);for(let t of this.randomItemTables)t.save(e)}return t}getByteLength(){let t=111+this.name.length+this.author.length+this.description.length+this.recommendedPlayers.length+this.loadingScreenText.length+this.loadingScreenTitle.length+this.loadingScreenSubtitle.length+this.prologueScreenText.length+this.prologueScreenTitle.length+this.prologueScreenSubtitle.length;for(let e of this.players)t+=e.getByteLength();for(let e of this.forces)t+=e.getByteLength();t+=16*this.upgradeAvailabilityChanges.length,t+=8*this.techAvailabilityChanges.length;for(let e of this.randomUnitTables)t+=e.getByteLength();if(this.version>24){t+=36+this.loadingScreenModel.length+this.prologueScreenModel.length+this.soundEnvironment.length;for(let e of this.randomItemTables)t+=e.getByteLength()}return t}}class ih{constructor(t){this.version=0,this.originalTable=new jl,this.customTable=new jl,t&&this.load(t)}load(t){let e=new Ks(t);this.version=e.readInt32(),this.originalTable.load(e,!1),this.customTable.load(e,!1)}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);return e.writeInt32(this.version),this.originalTable.save(e,!1),this.customTable.save(e,!1),t}getByteLength(){return 4+this.originalTable.getByteLength(!1)+this.customTable.getByteLength(!1)}}class nh{constructor(){this.text=""}load(t){let e=t.readInt32();e&&(this.text=t.read(e-1),t.skip(1))}save(t){this.text.length?(t.writeInt32(this.text.length+1),t.write(`${this.text}\0`)):t.writeInt32(0)}getByteLength(){let t=4;return this.text.length&&(t+=this.text.length+1),t}}class rh{constructor(t){this.version=0,this.comment="",this.trigger=null,this.triggers=[],t&&this.load(t)}load(t){let e=new Ks(t);if(this.version=e.readInt32(),1===this.version){this.comment=e.readUntilNull();let t=new nh;t.load(e),this.trigger=t}for(let t=0,i=e.readUint32();t<i;t++){let i=new nh;i.load(e),this.triggers[t]=i}}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.writeInt32(this.version),1===this.version&&(e.write(`${this.comment}\0`),this.trigger.save(e)),e.writeUint32(this.triggers.length);for(let t of this.triggers)t.save(e);return t}getByteLength(){let t=8;1===this.version&&(t+=this.comment.length+1+this.trigger.getByteLength());for(let e of this.triggers)t+=e.getByteLength();return t}}class ah{constructor(){this.id=0,this.name="",this.isComment=0}load(t,e){this.id=t.readInt32(),this.name=t.readUntilNull(),7===e&&(this.isComment=t.readInt32())}save(t,e){t.writeInt32(this.id),t.write(`${this.name}\0`),7===e&&t.writeInt32(this.isComment)}getByteLength(t){let e=5+this.name.length;return 7===t&&(e+=4),e}}class sh{constructor(){this.name="",this.type="",this.u1=0,this.isArray=0,this.arraySize=0,this.isInitialized=0,this.initialValue=""}load(t,e){this.name=t.readUntilNull(),this.type=t.readUntilNull(),this.u1=t.readInt32(),this.isArray=t.readInt32(),7===e&&(this.arraySize=t.readInt32()),this.isInitialized=t.readInt32(),this.initialValue=t.readUntilNull()}save(t,e){t.write(`${this.name}\0`),t.write(`${this.type}\0`),t.writeInt32(this.u1),t.writeInt32(this.isArray),7===e&&t.writeInt32(this.arraySize),t.writeInt32(this.isInitialized),t.write(`${this.initialValue}\0`)}getByteLength(t){let e=15+this.name.length+this.type.length+this.initialValue.length;return 7===t&&(e+=4),e}}class oh{constructor(){this.type=0,this.name="",this.beginParameters=0,this.parameters=[]}load(t,e,i){if(this.type=t.readInt32(),this.name=t.readUntilNull(),this.beginParameters=t.readInt32(),this.beginParameters){for(let n=0,r=i.getFunction(this.type,this.name).args.length;n<r;n++){let r=new lh;r.load(t,e,i),this.parameters[n]=r}}}save(t,e){t.writeInt32(this.type),t.write(`${this.name}\0`),t.writeInt32(this.beginParameters);for(let i of this.parameters)i.save(t,e)}getByteLength(t){let e=9+this.name.length;if(this.parameters.length)for(let i of this.parameters)e+=i.getByteLength(t);return e}}class lh{constructor(){this.type=0,this.value="",this.subParameters=null,this.u1=0,this.isArray=0,this.arrayIndex=null}load(t,e,i){if(this.type=t.readInt32(),this.value=t.readUntilNull(),t.readInt32()){let n=new oh;n.load(t,e,i),this.subParameters=n}if((4===e&&2===this.type||7===e&&this.subParameters)&&(this.u1=t.readInt32()),(4===e&&2!==this.type||7===e)&&(this.isArray=t.readInt32()),this.isArray){let n=new lh;n.load(t,e,i),this.arrayIndex=n}}save(t,e){t.writeInt32(this.type),t.write(`${this.value}\0`),this.subParameters?(t.writeInt32(1),this.subParameters.save(t,e)):t.writeInt32(0),(4===e&&2===this.type||7===e&&this.subParameters)&&t.writeInt32(this.u1),(4===e&&2!==this.type||7===e)&&t.writeInt32(this.isArray),this.isArray&&this.arrayIndex.save(t,e)}getByteLength(t){let e=9+this.value.length;return this.subParameters&&(e+=this.subParameters.getByteLength(t)),(4===t&&2===this.type||7===t&&this.subParameters)&&(e+=4),(4===t&&2!==this.type||7===t)&&(e+=4),this.isArray&&(e+=this.arrayIndex.getByteLength(t)),e}}class hh{constructor(){this.type=-1,this.group=-1,this.name="",this.isEnabled=0,this.parameters=[],this.ecas=[]}load(t,e,i,n){this.type=t.readInt32(),i&&(this.group=t.readUint32()),this.name=t.readUntilNull(),this.isEnabled=t.readInt32();for(let i=0,r=n.getFunction(this.type,this.name).args.length;i<r;i++){let r=new lh;r.load(t,e,n),this.parameters[i]=r}if(7===e)for(let i=0,r=t.readUint32();i<r;i++){let r=new hh;r.load(t,e,!0,n),this.ecas[i]=r}}save(t,e){t.writeInt32(this.type),-1!==this.group&&t.writeInt32(this.group),t.write(`${this.name}\0`),t.writeInt32(this.isEnabled);for(let i of this.parameters)i.save(t,e);if(7===e){t.writeUint32(this.ecas.length);for(let i of this.ecas)i.save(t,e)}}getByteLength(t){let e=9+this.name.length;-1!==this.group&&(e+=4);for(let i of this.parameters)e+=i.getByteLength(t);if(7===t){e+=4;for(let i of this.ecas)e+=i.getByteLength(t)}return e}}class uh{constructor(){this.name="",this.description="",this.isComment=0,this.isEnabled=0,this.isCustom=0,this.isInitiallyOff=0,this.runOnInitialization=0,this.category=0,this.ecas=[]}load(t,e,i){this.name=t.readUntilNull(),this.description=t.readUntilNull(),7===e&&(this.isComment=t.readInt32()),this.isEnabled=t.readInt32(),this.isCustomText=t.readInt32(),this.isInitiallyOff=t.readInt32(),this.runOnInitialization=t.readInt32(),this.category=t.readInt32();for(let n=0,r=t.readUint32();n<r;n++){let r=new hh;r.load(t,e,!1,i),this.ecas[n]=r}}save(t,e){t.write(`${this.name}\0`),t.write(`${this.description}\0`),7===e&&t.writeInt32(this.isComment),t.writeInt32(this.isEnabled),t.writeInt32(this.isCustomText),t.writeInt32(this.isInitiallyOff),t.writeInt32(this.runOnInitialization),t.writeInt32(this.category),t.writeUint32(this.ecas.length);for(let i of this.ecas)i.save(t,e)}getByteLength(t){let e=26+this.name.length+this.description.length;7===t&&(e+=4);for(let i of this.ecas)e+=i.getByteLength(t);return e}}class ch{constructor(t,e){this.version=0,this.categories=[],this.u1=0,this.variables=[],this.triggers=[],t&&this.load(t,e)}load(t,e){let i=new Ks(t);if("WTG!"!==i.read(4))throw new Error("Not a WTG file");this.version=i.readInt32();for(let t=0,e=i.readUint32();t<e;t++){let e=new ah;e.load(i,this.version),this.categories[t]=e}this.u1=i.readInt32();for(let t=0,e=i.readUint32();t<e;t++){let e=new sh;e.load(i,this.version),this.variables[t]=e}for(let t=0,n=i.readUint32();t<n;t++){let n=new uh;n.load(i,this.version,e),this.triggers[t]=n}}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.write("WTG!"),e.writeInt32(this.version),e.writeUint32(this.categories.length);for(let t of this.categories)t.save(e,this.version);e.writeInt32(this.u1),e.writeUint32(this.variables.length);for(let t of this.variables)t.save(e,this.version);e.writeUint32(this.triggers.length);for(let t of this.triggers)t.save(e,this.version);return t}getByteLength(){let t=24;for(let e of this.categories)t+=e.getByteLength(this.version);for(let e of this.variables)t+=e.getByteLength(this.version);for(let e of this.triggers)t+=e.getByteLength(this.version);return t}}class dh{constructor(t){this.stringMap=new Map,t&&this.load(t)}load(t){let e,i=new Ys(t);for(i.index+=3;e=i.read();)if("STRING"===e){let e=i.readInt();i.read();let n=t.indexOf("}",i.index);this.stringMap.set(e,t.slice(i.index,n).trim()),i.index=n}}save(){let t="ï»¿";for(let[e,i]of this.stringMap)t+=`STRING ${e}\n{\n${i}\n}\n`;return t}}class fh{constructor(){this.id="\0\0\0\0",this.chance=0}load(t){this.id=t.read(4),this.chance=t.readInt32()}save(t){t.write(this.id),t.writeInt32(this.chance)}}class mh{constructor(){this.items=[]}load(t){for(let e=0,i=t.readInt32();e<i;e++){let i=new fh;i.load(t),this.items[e]=i}}save(t){t.writeInt32(this.items.length);for(let e of this.items)e.save(t)}getByteLength(){return 4+8*this.items.length}}class gh{constructor(){this.slot=0,this.id="\0\0\0\0"}load(t){this.slot=t.readInt32(),this.id=t.read(4)}save(t){t.writeInt32(this.slot),t.write(this.id)}}class ph{constructor(){this.id="\0\0\0\0",this.activeForAutocast=0,this.heroLevel=1}load(t){this.id=t.read(4),this.activeForAutocast=t.readInt32(),this.heroLevel=t.readInt32()}save(t){t.write(this.id),t.writeInt32(this.activeForAutocast),t.writeInt32(this.heroLevel)}}class vh{constructor(){this.id="\0\0\0\0",this.chance=0}load(t){this.id=t.read(4),this.chance=t.readInt32()}save(t){t.write(this.id),t.writeInt32(this.chance)}}class bh{constructor(){this.id="\0\0\0\0",this.variation=0,this.location=new Float32Array(3),this.angle=0,this.scale=new Float32Array([1,1,1]),this.flags=0,this.player=0,this.unknown=0,this.hitpoints=-1,this.mana=-1,this.droppedItemTable=0,this.droppedItemSets=[],this.goldAmount=0,this.targetAcquisition=0,this.heroLevel=0,this.heroStrength=0,this.heroAgility=0,this.heroIntelligence=0,this.itemsInInventory=[],this.modifiedAbilities=[],this.randomFlag=0,this.level=new Uint8Array(3),this.itemClass=0,this.unitGroup=0,this.positionInGroup=0,this.randomUnitTables=[],this.customTeamColor=0,this.waygate=0,this.creationNumber=0}load(t,e){this.id=t.read(4),this.variation=t.readInt32(),this.location=t.readFloat32Array(3),this.angle=t.readFloat32(),this.scale=t.readFloat32Array(3),this.flags=t.readUint8(),this.player=t.readInt32(),this.unknown=t.readUint16(),this.hitpoints=t.readInt32(),this.mana=t.readInt32(),e>7&&(this.droppedItemTable=t.readInt32());for(let e=0,i=t.readInt32();e<i;e++){let i=new mh;i.load(t),this.droppedItemSets[e]=i}this.goldAmount=t.readInt32(),this.targetAcquisition=t.readFloat32(),this.heroLevel=t.readInt32(),e>7&&(this.heroStrength=t.readInt32(),this.heroAgility=t.readInt32(),this.heroIntelligence=t.readInt32());for(let e=0,i=t.readInt32();e<i;e++){let i=new gh;i.load(t),this.itemsInInventory[e]=i}for(let e=0,i=t.readInt32();e<i;e++){let i=new ph;i.load(t),this.modifiedAbilities[e]=i}if(this.randomFlag=t.readInt32(),0===this.randomFlag)this.level=t.readUint8Array(3),this.itemClass=t.readUint8();else if(1===this.randomFlag)this.unitGroup=t.readUint32(),this.positionInGroup=t.readUint32();else if(2===this.randomFlag)for(let e=0,i=t.readInt32();e<i;e++){let i=new vh;i.load(t),this.randomUnitTables[e]=i}this.customTeamColor=t.readInt32(),this.waygate=t.readInt32(),this.creationNumber=t.readInt32()}save(t,e){t.write(this.id),t.writeInt32(this.variation),t.writeFloat32Array(this.location),t.writeFloat32(this.angle),t.writeFloat32Array(this.scale),t.writeUint8(this.flags),t.writeInt32(this.player),t.writeUint16(this.unknown),t.writeInt32(this.hitpoints),t.writeInt32(this.mana),e>7&&t.writeInt32(this.droppedItemTable),t.writeInt32(this.droppedItemSets.length);for(let e of this.droppedItemSets)e.save(t);t.writeInt32(this.goldAmount),t.writeFloat32(this.targetAcquisition),t.writeInt32(this.heroLevel),e>7&&(t.writeInt32(this.heroStrength),t.writeInt32(this.heroAgility),t.writeInt32(this.heroIntelligence)),t.writeInt32(this.itemsInInventory.length);for(let e of this.itemsInInventory)e.save(t);t.writeInt32(this.modifiedAbilities.length);for(let e of this.modifiedAbilities)e.save(t);if(t.writeInt32(this.randomFlag),0===this.randomFlag)t.writeUint8Array(this.level),t.writeUint8(this.itemClass);else if(1===this.randomFlag)t.writeUint32(this.unitGroup),t.writeUint32(this.positionInGroup);else if(2===this.randomFlag){t.writeInt32(this.randomUnitTables.length);for(let e of this.randomUnitTables)e.save(t)}t.writeInt32(this.customTeamColor),t.writeInt32(this.waygate),t.writeInt32(this.creationNumber)}getByteLength(t){let e=91;t>7&&(e+=16);for(let t of this.droppedItemSets)e+=t.getByteLength();return e+=8*this.itemsInInventory.length,e+=12*this.modifiedAbilities.length,0===this.randomFlag?e+=4:1===this.randomFlag?e+=8:2===this.randomFlag&&(e+=4+8*this.randomUnitTables.length),e}}class wh{constructor(t){this.version=8,this.unknown=11,this.units=[],t&&this.load(t)}load(t){let e=new Ks(t);if("W3do"!==e.read(4))return!1;this.version=e.readInt32(),this.unknown=e.readUint32();for(let t=0,i=e.readInt32();t<i;t++){let i=new bh;i.load(e,this.version),this.units[t]=i}return!0}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.write("W3do"),e.writeInt32(this.version),e.writeUint32(this.unknown),e.writeInt32(this.units.length);for(let t of this.units)t.save(e,this.version);return t}getByteLength(){let t=16;for(let e of this.units)t+=e.getByteLength(this.version);return t}}class yh{constructor(t,e){this.unknown=0,this.name="",this.flags=0,this.maxPlayers=0,this.archive=new Cl(null,e),this.imports=new Nl,this.readonly=!!e,t&&this.load(t)}load(t){let e=new Ks(t);return"HM3W"===e.read(4)&&(this.u1=e.readUint32(),this.name=e.readUntilNull(),this.flags=e.readUint32(),this.maxPlayers=e.readUint32(),!!this.archive.load(t)&&(this.readImports(),!0))}save(){if(this.readonly)return null;this.setImportsFile();let t=this.archive.save(),e=new ArrayBuffer(512+t.byteLength),i=new Uint8Array(e),n=new Ks(e);return n.write("HM3W"),n.writeUint32(this.u1),n.write(`${this.name}\0`),n.writeUint32(this.flags),n.writeUint32(this.maxPlayers),i.set(new Uint8Array(t),512),e}getFileNames(){return this.archive.getFileNames()}getImportNames(){let t=[];for(let e of this.imports.entries.values()){let i=e.isCustom;10===i||13===i?t.push(e.name):t.push(`war3mapImported\\${e.name}`)}return t}setImportsFile(){return!this.readonly&&(this.imports.entries.size>0&&this.set("war3map.imp",this.imports.save()))}import(t,e){return!this.readonly&&(!!this.archive.set(t,e)&&(this.imports.set(t),!0))}set(t,e){return!this.readonly&&this.archive.set(t,e)}get(t){return this.archive.get(t)}getScript(){return(this.get("war3map.j")||this.get("scripts\\war3map.j")).text()}has(t){return this.archive.has(t)}delete(t){return!this.readonly&&(this.imports.delete(t),this.archive.delete(t))}rename(t,e){return!this.readonly&&(!!this.archive.rename(t,e)&&(this.imports.rename(t,e),!0))}readHelper(t,e){let i=this.archive.get(t);if(i){let t=i.arrayBuffer();return t?new e(t):null}}readImports(){let t=this.archive.get("war3map.imp");if(t){let e=t.arrayBuffer();e&&this.imports.load(e)}}readMapInformation(){return this.readHelper("war3map.w3i",eh)}readEnvironment(){return this.readHelper("war3map.w3e",ql)}readDoodads(){let t=this.archive.get("war3map.doo");if(t)return new Dl(t.arrayBuffer())}readUnits(){let t=this.archive.get("war3mapUnits.doo");if(t)return new wh(t.arrayBuffer())}readTriggers(t){let e=this.archive.get("war3map.wtg");if(e)return new ch(e.arrayBuffer(),t)}readCustomTextTriggers(){let t=this.archive.get("war3map.wct");if(t)return new rh(t.arrayBuffer())}readStringTable(){let t=this.archive.get("war3map.wts");if(t)return new dh(t.text())}readModifications(){let t={},e=["w3u","w3t","w3b","w3d","w3a","w3h","w3q"],i=[!1,!1,!1,!0,!0,!1,!0];for(let n=0,r=e.length;n<r;n++){let r=this.archive.get(`war3map.${e[n]}`);if(r){let a,s=r.arrayBuffer();a=i[n]?new Hl(s):new ih(s),t[e[n]]=a}}return t}}class Ah{constructor(){this.type=0,this.location=new Int32Array(2),this.color=new Uint8Array(4)}load(t){this.type=t.readInt32(),this.location=t.readInt32Array(2),this.color=t.readUint8Array(4)}save(t){t.writeInt32(this.type),t.writeInt32Array(this.location),t.writeUint8Array(this.color)}}class _h{constructor(){this.targetLocation=new Float32Array(3),this.rotation=0,this.angleOfAttack=0,this.distance=0,this.roll=0,this.fieldOfView=0,this.farClippingPlane=0,this.nearClippingPlane=0,this.cinematicName=""}load(t){this.targetLocation=t.readFloat32Array(3),this.rotation=t.readFloat32(),this.angleOfAttack=t.readFloat32(),this.distance=t.readFloat32(),this.roll=t.readFloat32(),this.fieldOfView=t.readFloat32(),this.farClippingPlane=t.readFloat32(),this.nearClippingPlane=t.readFloat32(),this.cinematicName=t.readUntilNull()}save(t){t.writeFloat32Array(this.targetLocation),t.writeFloat32(this.rotation),t.writeFloat32(this.angleOfAttack),t.writeFloat32(this.distance),t.writeFloat32(this.roll),t.writeFloat32(this.fieldOfView),t.writeFloat32(this.farClippingPlane),t.writeFloat32(this.nearClippingPlane),t.write(`${this.cinematicName}\0`)}getByteLength(){return 41+this.cinematicName.length}}class xh{constructor(){this.left=0,this.right=0,this.bottom=0,this.top=0,this.name="",this.creationNumber=0,this.weatherEffectId="\0\0\0\0",this.ambientSound="",this.color=new Uint8Array(4)}load(t){this.left=t.readFloat32(),this.right=t.readFloat32(),this.bottom=t.readFloat32(),this.top=t.readFloat32(),this.name=t.readUntilNull(),this.creationNumber=t.readUint32(),this.weatherEffectId=t.read(4),this.ambientSound=t.readUntilNull(),this.color=t.readUint8Array(4)}save(t){t.writeFloat32(this.left),t.writeFloat32(this.right),t.writeFloat32(this.bottom),t.writeFloat32(this.top),t.write(`${this.name}\0`),t.writeUint32(this.creationNumber),this.weatherEffectId?t.write(this.weatherEffectId):t.writeUint32(0),t.write(`${this.ambientSound}\0`),t.writeUint8Array(this.color)}getByteLength(){return 30+this.name.length+this.ambientSound.length}}class Th{constructor(){this.name="",this.file="",this.eaxEffect="",this.flags=0,this.fadeInRate=0,this.fadeOutRate=0,this.volume=0,this.pitch=0,this.u1=0,this.u2=0,this.channel=0,this.minDistance=0,this.maxDistance=0,this.distanceCutoff=0,this.u3=0,this.u4=0,this.u5=0,this.u6=0,this.u7=0,this.u8=0}load(t){this.name=t.readUntilNull(),this.file=t.readUntilNull(),this.eaxEffect=t.readUntilNull(),this.flags=t.readUint32(),this.fadeInRate=t.readInt32(),this.fadeOutRate=t.readInt32(),this.volume=t.readInt32(),this.pitch=t.readFloat32(),this.u1=t.readFloat32(),this.u2=t.readInt32(),this.channel=t.readInt32(),this.minDistance=t.readFloat32(),this.maxDistance=t.readFloat32(),this.distanceCutoff=t.readFloat32(),this.u3=t.readFloat32(),this.u4=t.readFloat32(),this.u5=t.readInt32(),this.u6=t.readFloat32(),this.u7=t.readFloat32(),this.u8=t.readFloat32()}save(t){t.write(`${this.name}\0`),t.write(`${this.file}\0`),t.write(`${this.eaxEffect}\0`),t.writeUint32(this.flags),t.writeUint32(this.fadeInRate),t.writeUint32(this.fadeOutRate),t.writeUint32(this.volume),t.writeFloat32(this.pitch),t.writeFloat32(this.u1),t.writeInt32(this.u2),t.writeInt32(this.channel),t.writeFloat32(this.minDistance),t.writeFloat32(this.maxDistance),t.writeFloat32(this.distanceCutoff),t.writeFloat32(this.u3),t.writeFloat32(this.u4),t.writeInt32(this.u5),t.writeFloat32(this.u6),t.writeFloat32(this.u7),t.writeFloat32(this.u8)}getByteLength(){return 71+this.name.length+this.file.length+this.eaxEffect.length}}class Eh{constructor(){this.visible=0,this.chapterTitle="",this.mapTitle="",this.path=""}load(t){this.visible=t.readInt32(),this.chapterTitle=t.readUntilNull(),this.mapTitle=t.readUntilNull(),this.path=t.readUntilNull()}save(t){t.writeInt32(this.visible),t.write(`${this.chapterTitle}\0`),t.write(`${this.mapTitle}\0`),t.write(`${this.path}\0`)}getByteLength(){return 7+this.chapterTitle.length+this.mapTitle.length+this.path.length}}class Sh{constructor(){this.u1=0,this.path=""}load(t){this.u1=t.readInt8(),this.path=t.readUntilNull()}save(t){t.writeInt8(this.u1),t.write(`${this.path}\0`)}getByteLength(){return 2+this.path.length}}var Mh={Map:yh,doo:{Doodad:Fl,TerrainDoodad:Pl,File:Dl},imp:{Import:Ol,File:Nl},mmp:{MinimapIcon:Ah,File:class{constructor(t){this.u1=0,this.icons=[],t&&this.load(t)}load(t){let e=new Ks(t);this.u1=e.readInt32();for(let t=0,i=e.readInt32();t<i;t++){let i=new Ah;i.load(e),this.icons[t]=i}}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.writeInt32(this.u1),e.writeUint32(this.icons.length);for(let t of this.icons)t.save(e);return t}getByteLength(){return 8+16*this.icons.length}}},shd:{File:class{constructor(t,e,i){this.shadows=new Uint8Array(0),t&&this.load(t,e,i)}load(t,e,i){this.shadows=new Uint8Array(t.slice(0,e*i*16))}save(){return this.shadows.slice().buffer}getByteLength(){return this.shadows.length}}},w3c:{Camera:_h,File:class{constructor(t){this.version=0,this.cameras=[],t&&this.load(t)}load(t){let e=new Ks(t);this.version=e.readInt32();for(let t=0,i=e.readUint32();t<i;t++){let i=new _h;i.load(e),this.cameras[t]=i}}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.writeInt32(this.version),e.writeUint32(this.cameras.length);for(let t of this.cameras)t.save(e);return t}getByteLength(){let t=8;for(let e of this.cameras)t+=e.getByteLength();return t}}},w3d:{File:Hl},w3e:{Corner:$l,File:ql},w3i:{Player:zl,Force:Kl,UpgradeAvailabilityChange:Wl,TechAvailabilityChange:Yl,RandomUnitTable:Jl,RandomUnit:Xl,RandomItemTable:th,RandomItemSet:Ql,RandomItem:Zl,File:eh},w3o:{File:class{constructor(t){this.version=0,this.units=null,this.items=null,this.destructables=null,this.doodads=null,this.abilities=null,this.buffs=null,this.upgrades=null,t&&this.load(t)}load(t){let e=new Ks(t);this.version=e.readInt32(),e.readInt32()&&(this.units=new ih(e)),e.readInt32()&&(this.items=new ih(e)),e.readInt32()&&(this.destructables=new ih(e)),e.readInt32()&&(this.doodads=new Hl(e)),e.readInt32()&&(this.abilities=new Hl(e)),e.readInt32()&&(this.buffs=new ih(e)),e.readInt32()&&(this.upgrades=new Hl(e))}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);return e.writeInt32(this.version),this.units?(e.writeInt32(1),this.units.save(e)):e.writeInt32(0),this.items?(e.writeInt32(1),this.items.save(e)):e.writeInt32(0),this.destructables?(e.writeInt32(1),this.destructables.save(e)):e.writeInt32(0),this.doodads?(e.writeInt32(1),this.doodads.save(e)):e.writeInt32(0),this.abilities?(e.writeInt32(1),this.abilities.save(e)):e.writeInt32(0),this.buffs?(e.writeInt32(1),this.buffs.save(e)):e.writeInt32(0),this.upgrades?(e.writeInt32(1),this.upgrades.save(e)):e.writeInt32(0),t}getByteLength(){let t=32;return this.units&&(t+=this.units.getByteLength()),this.items&&(t+=this.items.getByteLength()),this.destructables&&(t+=this.destructables.getByteLength()),this.doodads&&(t+=this.doodads.getByteLength()),this.abilities&&(t+=this.abilities.getByteLength()),this.buffs&&(t+=this.buffs.getByteLength()),this.upgrades&&(t+=this.upgrades.getByteLength()),t}}},w3r:{Region:xh,File:class{constructor(t){this.version=0,this.regions=[],t&&this.load(t)}load(t){let e=new Ks(t);this.version=e.readInt32();for(let t=0,i=e.readUint32();t<i;t++)this.regions[t]=new xh(e)}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.writeInt32(this.version),e.writeUint32(this.regions.length);for(let t of this.regions)t.save(e);return t}getByteLength(){let t=8;for(let e of this.regions)t+=e.calcSize();return t}}},w3s:{Sound:Th,File:class{constructor(t){this.version=0,this.sounds=[],t&&this.load(t)}load(t){let e=new Ks(t);this.version=e.readInt32();for(let t=0,i=e.readUint32();t<i;t++){let i=new Th;i.load(e),this.sounds[t]=i}}save(){let t=new ArrayBuffer(this.calcSize()),e=new Ks(t);e.writeInt32(this.version),e.writeUint32(this.sounds.length);for(let t of this.sounds)t.save(e);return t}getByteLength(){let t=8;for(let e of this.sounds)t+=e.getByteLength();return t}}},w3u:{Modification:Vl,ModifiedObject:Gl,ModificationTable:jl,File:ih},wct:{CustomTextTrigger:nh,File:rh},wpm:{File:class{constructor(t){this.version=0,this.size=new Int32Array(2),this.pathing=new Uint8Array(1),t&&this.load(t)}load(t){let e=new Ks(t);return"MP3W"===e.read(4)&&(this.version=e.readInt32(),this.size=e.readInt32Array(2),this.pathing=e.readUint8Array(this.size[0]*this.size[1]),!0)}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);return e.write("MP3W"),e.writeInt32(this.version),e.writeInt32Array(this.size),e.writeUint8Array(this.pathing),t}getByteLength(){return 16+this.size[0]*this.size[1]}}},wtg:{ECA:hh,Parameter:lh,SubParameters:oh,Trigger:uh,TriggerCategory:ah,Variable:sh,File:ch,TriggerData:class{constructor(){this.types={},this.functions=[{},{},{},{}],this.presets={},this.externalTypes={},this.externalFunctions=[{},{},{},{}],this.externalPresets={}}addTriggerData(t,e){let i=this.types,n=this.functions,r=this.presets;e&&(i=this.externalTypes,n=this.externalFunctions,r=this.externalPresets);let a=new Js.a;a.load(t),this.addTriggerTypes(i,a.getSection("TriggerTypes")),this.addTriggerDataFunctions(n[0],a.getSection("TriggerEvents"),1),this.addTriggerDataFunctions(n[1],a.getSection("TriggerConditions"),1),this.addTriggerDataFunctions(n[2],a.getSection("TriggerActions"),1),this.addTriggerDataFunctions(n[3],a.getSection("TriggerCalls"),3),this.addTriggerDataPresets(r,a.getSection("TriggerParams"))}addTriggerTypes(t,e){for(let[i,n]of e){let e=n.split(",");t[i]=e[4]||""}}addTriggerDataFunctions(t,e,i){for(let[n,r]of e)if("_"!==n[0]){let a=r.split(",").slice(i),s=[],o=e.get(`_${n}_scriptname`)||null;for(let t of a)isNaN(t)&&"nothing"!==t&&""!==t&&s.push(t);t[n]={args:s,scriptName:o}}}addTriggerDataPresets(t,e){for(let[i,n]of e){let e=n.split(",");t[i]=e[2].replace(/"/g,"").replace(/`/g,'"')}}getBaseType(t){t=t.toLowerCase();let e=this.types[t];return void 0===e&&(e=this.externalTypes[t]),""===e||void 0===e?t:e}isBaseFunction(t,e){return e=e.toLowerCase(),!!this.functions[t][e]}getFunction(t,e){e=e.toLowerCase();let i=this.functions[t][e];if(!i&&!(i=this.externalFunctions[t][e]))throw new Error(`Tried to get signature for unknown function "${e}"`);return i}getPreset(t){t=t.toLowerCase();let e=this.presets[t];if(void 0===e&&void 0===(e=this.externalPresets[t]))throw new Error(`Failed to find a preset: ${t}`);return e}isCustomPreset(t){if(t=t.toLowerCase(),void 0!==this.presets[t])return!1;if(void 0!==this.externalPresets[t])return!0;throw new Error(`Failed to find a preset: ${t}`)}}},wts:{File:dh},unitsdoo:{DroppedItem:fh,DroppedItemSet:mh,InventoryItem:gh,ModifiedAbility:ph,RandomUnit:vh,Unit:bh,File:wh},w3f:{File:class{constructor(){this.version=0,this.campaignVersion=0,this.editorVersion=0,this.name="",this.difficulty="",this.author="",this.description="",this.mode=-1,this.backgroundScreen=-1,this.backgroundScreenPath="",this.minimapImagePath="",this.ambientSound=0,this.ambientSoundPath="",this.terrainFog=0,this.fogStartZ=0,this.fogEndZ=0,this.fogDensity=0,this.fogColor=new Uint8Array(4),this.userInterface=-1,this.mapTitles=[],this.mapOrders=[]}load(t){let e=new Ks(t);this.version=e.readInt32(),this.campaignVersion=e.readInt32(),this.editorVersion=e.readInt32(),this.name=e.readUntilNull(),this.difficulty=e.readUntilNull(),this.author=e.readUntilNull(),this.description=e.readUntilNull(),this.mode=e.readInt32(),this.backgroundScreen=e.readInt32(),this.backgroundScreenPath=e.readUntilNull(),this.minimapImagePath=e.readUntilNull(),this.ambientSound=e.readInt32(),this.ambientSoundPath=e.readUntilNull(),this.terrainFog=e.readInt32(),this.fogStartZ=e.readFloat32(),this.fogEndZ=e.readFloat32(),this.fogDensity=e.readFloat32(),e.readUint8Array(this.fogColor),this.userInterface=e.readInt32();for(let t=0,i=e.readUint32();t<i;t++){let i=new Eh;i.load(e),this.mapTitles[t]=i}for(let t=0,i=e.readUint32();t<i;t++){let i=new Sh;i.load(e),this.mapOrders[t]=i}}save(){let t=new ArrayBuffer(this.getByteLength()),e=new Ks(t);e.writeInt32(this.version),e.writeInt32(this.campaignVersion),e.writeInt32(this.editorVersion),e.write(`${this.name}\0`),e.write(`${this.difficulty}\0`),e.write(`${this.author}\0`),e.write(`${this.description}\0`),e.writeInt32(this.mode),e.writeInt32(this.backgroundScreen),e.write(`${this.backgroundScreenPath}\0`),e.write(`${this.minimapImagePath}\0`),e.writeInt32(this.ambientSound),e.write(`${this.ambientSoundPath}\0`),e.writeInt32(this.terrainFog),e.writeFloat32(this.fogStartZ),e.writeFloat32(this.fogEndZ),e.writeFloat32(this.fogDensity),e.writeUint8Array(this.fogColor),e.writeInt32(this.userInterface),e.writeUint32(this.mapTitles.length);for(let t of this.mapTitles)t.save(e);e.writeUint32(this.mapOrders.length);for(let t of this.mapOrders)t.save(e);return t}getByteLength(){let t=63+this.name.length+this.difficulty.length+this.author.length+this.description.length+this.backgroundScreenPath.length+this.minimapImagePath.length+this.ambientSoundPath.length;for(let e of this.mapTitles)t+=e.getByteLength();for(let e of this.mapOrders)t+=e.getByteLength();return t}}}},Rh=i(23);function Ih(t,e){return((1<<e)-1)/((1<<t)-1)}let Bh=827345986,Ch=0;class Lh{constructor(){this.content=0,this.alphaBits=0,this.width=0,this.height=0,this.type=0,this.hasMipmaps=!1,this.mipmapOffsets=new Uint32Array(16),this.mipmapSizes=new Uint32Array(16),this.uint8array=null,this.jpgHeader=null,this.pallete=null}load(t){let e=new Int32Array(t,0,40);if(e[0]!==Bh)throw new Error("WrongMagicNumber");this.content=e[1],this.alphaBits=e[2],this.width=e[3],this.height=e[4],this.type=e[5],this.hasMipmaps=e[6];for(let t=0;t<16;t++)this.mipmapOffsets[t]=e[7+t],this.mipmapSizes[t]=e[23+t];this.uint8array=new Uint8Array(t),this.content===Ch?this.jpgHeader=new Uint8Array(t,160,e[39]):this.pallete=new Uint8Array(t,156,1024)}getMipmap(t){let e,i=this.uint8array,n=this.mipmapOffsets[t],r=this.mipmapSizes[t];if(this.content===Ch){let t=this.jpgHeader,a=new Uint8Array(t.length+r),s=new Rh.JpegImage;a.set(t),a.set(i.subarray(n,n+r),t.length),s.parse(a),e=new ImageData(s.width,s.height),s.getData(e)}else{let r,a,s=this.pallete,o=this.width/(1<<t),l=this.height/(1<<t),h=o*l,u=this.alphaBits;e=new ImageData(o,l),u>0&&(r=new Ws(i.buffer,n+h,Math.ceil(h*u/8)),a=Ih(u,8));let c=e.data;for(let t=0;t<h;t++){let e=4*t,o=4*i[n+t];c[e]=s[o],c[e+1]=s[o+1],c[e+2]=s[o+2],c[e+3]=u>0?r.readBits(u)*a:255}}return e}mipmaps(){return this.hasMipmaps?Math.log2(Math.max(this.width,this.height)):1}}var Uh={ini:Zs,slk:Qs,m3:bo,mdlx:tl,mpq:Ll,w3x:Mh,blp:{Texture:Lh}},kh=i(4),Fh=i.n(kh);async function Ph(t,e){if("image"===e)return new Promise(e=>{let i=new Image;i.onload=(()=>{e({ok:!0,data:i})}),i.onerror=(t=>{e({ok:!1,error:"ImageError",data:t})}),i.src=t});{let i,n;try{i=await fetch(t)}catch(t){return{ok:!1,error:"NetworkError",data:t}}if(!i.ok)return{ok:!1,error:"HttpError",data:i};try{"text"===e?n=await i.text():"arrayBuffer"===e?n=await i.arrayBuffer():"blob"===e&&(n=await i.blob())}catch(t){return{ok:!1,error:"DataError",data:t}}return{ok:!0,data:n}}}function Dh(t){let e=0;for(let i=0,n=t.length;i<n;i++)e=31*e+t.charCodeAt(i),e&=e;return e}let Oh=/:(\d+):/g;class Nh{constructor(t,e,i){let n=t.createShader(i);if(this.ok=!1,this.webglResource=n,this.src=e,this.shaderType=i,t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))this.ok=!0;else{let i=t.getShaderInfoLog(n),r=e.split("\n");console.error("Shader unit failed to compile!"),console.error(i);let a=Oh.exec(i);for(;a;){let t=parseInt(a[1]);console.error(t+": "+r[t-1]),a=Oh.exec(i)}}}}class Vh{constructor(t,e,i){let n=t.createProgram(),r={},a={};if(this.ok=!1,this.webglResource=n,this.shaders=[e,i],this.uniforms=r,this.attribs=a,this.attribsCount=0,t.attachShader(n,e.webglResource),t.attachShader(n,i.webglResource),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)){for(let e=0,i=t.getProgramParameter(n,t.ACTIVE_UNIFORMS);e<i;e++){let i=t.getActiveUniform(n,e);if(1===i.size)r[i.name]=t.getUniformLocation(n,i.name);else{let e=i.name.substr(0,i.name.length-3);for(let a=0;a<i.size;a++){let i=e+"["+a+"]";r[i]=t.getUniformLocation(n,i)}}}for(let e=0,i=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES);e<i;e++){let i=t.getActiveAttrib(n,e);if(this.attribsCount+=i.size,1===i.size)a[i.name]=t.getAttribLocation(n,i.name);else{let e=i.name.substr(0,i.name.length-3);for(let r=0;r<i.size;r++){let i=e+"["+r+"]";a[i]=t.getAttribLocation(n,i)}}}this.ok=!0}else console.error("Shader program failed to link!"),console.error(t.getProgramInfoLog(n))}}function Gh(t){let e=t.split("_"),i=e[1];for(let t=2,n=e.length;t<n;t++)i+=e[t][0].toUpperCase()+e[t].substr(1);return i}class jh{constructor(t,e){let i=t.getContext("webgl",e||{alpha:!1});if(i||(i=t.getContext("experimental-webgl",e||{alpha:!1})),!i)throw new Error("WebGL: Failed to create a WebGL context!");let n={};for(let t of i.getSupportedExtensions())t.startsWith("MOZ_")||(n[Gh(t)]=i.getExtension(t));if(!i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS))throw new Error("WebGL: No vertex shader texture support!");if(!n.textureFloat)throw new Error("WebGL: No floating point texture support!");if(!n.instancedArrays)throw new Error("WebGL: No instanced rendering support!");n.compressedTextureS3tc||console.warn("WebGL: No compressed textures support! This might reduce performance."),i.extensions=n,i.depthFunc(i.LEQUAL),i.enable(i.DEPTH_TEST),this.gl=i,this.extensions=n,this.shaderUnits=new Map,this.shaderPrograms=new Map,this.currentShaderProgram=null,this.floatPrecision="precision mediump float;\n";let r=new ImageData(2,2);for(let t=0;t<4;t++)r.data[4*t+3]=255;let a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r),this.emptyTexture=a}createShaderUnit(t,e){let i=Dh(t),n=this.shaderUnits;return n.has(i)||n.set(i,new Nh(this.gl,t,e)),n.get(i)}createShaderProgram(t,e){let i=this.gl,n=this.createShaderUnit(t,i.VERTEX_SHADER),r=this.createShaderUnit(this.floatPrecision+e,i.FRAGMENT_SHADER),a=this.shaderPrograms;if(n.ok&&r.ok){let s=Dh(t+e);a.has(s)||a.set(s,new Vh(i,n,r));let o=a.get(s);if(o.ok)return o}}enableVertexAttribs(t,e){let i=this.gl;for(let n=t;n<e;n++)i.enableVertexAttribArray(n)}disableVertexAttribs(t,e){let i=this.gl;for(let n=t;n<e;n++)i.disableVertexAttribArray(n)}useShaderProgram(t){let e=this.currentShaderProgram;if(t&&t.ok&&t!==e){let i=0,n=t.attribsCount;e&&(i=e.attribsCount),this.gl.useProgram(t.webglResource),n>i?this.enableVertexAttribs(i,n):n<i&&this.disableVertexAttribs(n,i),this.currentShaderProgram=t}}bindTexture(t,e){let i=this.gl;i.activeTexture(i.TEXTURE0+e),t&&t.ok?i.bindTexture(i.TEXTURE_2D,t.webglResource):i.bindTexture(i.TEXTURE_2D,this.emptyTexture)}}class Hh extends Fh.a{promise(){this.emit("loadstart",this)}resolve(){this.emit("loadend",this)}}let $h=l.create(),qh=l.create(),zh=l.create(),Kh=u.create(),Wh=o.create();class Yh{constructor(){this.rect=h.create(),this.isPerspective=!0,this.fov=0,this.aspect=0,this.isOrtho=!1,this.leftClipPlane=0,this.rightClipPlane=0,this.bottomClipPlane=0,this.topClipPlane=0,this.nearClipPlane=0,this.farClipPlane=0,this.location=l.create(),this.rotation=u.create(),this.inverseRotation=u.create(),this.worldMatrix=o.create(),this.projectionMatrix=o.create(),this.worldProjectionMatrix=o.create(),this.inverseWorldMatrix=o.create(),this.inverseRotationMatrix=o.create(),this.inverseWorldProjectionMatrix=o.create(),this.directionX=l.create(),this.directionY=l.create(),this.directionZ=l.create(),this.vectors=[l.fromValues(-1,-1,0),l.fromValues(-1,1,0),l.fromValues(1,1,0),l.fromValues(1,-1,0),l.fromValues(1,0,0),l.fromValues(0,1,0),l.fromValues(0,0,1)],this.billboardedVectors=[l.create(),l.create(),l.create(),l.create(),l.create(),l.create(),l.create()],this.planes=[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()],this.dirty=!0}perspective(t,e,i,n){this.isPerspective=!0,this.isOrtho=!1,this.fov=t,this.aspect=e,this.nearClipPlane=i,this.farClipPlane=n,this.dirty=!0}ortho(t,e,i,n,r,a){this.isPerspective=!1,this.isOrtho=!0,this.leftClipPlane=t,this.rightClipPlane=e,this.bottomClipPlane=i,this.topClipPlane=n,this.nearClipPlane=r,this.farClipPlane=a,this.dirty=!0}viewport(t){h.copy(this.rect,t),this.aspect=t[2]/t[3],this.dirty=!0}setLocation(t){l.copy(this.location,t),this.dirty=!0}move(t){l.add(this.location,this.location,t),this.dirty=!0}setRotation(t){u.copy(this.rotation,t),this.dirty=!0}rotate(t){u.mul(this.rotation,this.rotation,t),this.dirty=!0}setRotationAngles(t,e){u.identity(this.rotation),this.rotateAngles(t,e)}rotateAround(t,e){this.rotate(t),u.conjugate(Kh,Kh),l.sub($h,this.location,e),l.transformQuat($h,$h,t),l.add(this.location,$h,e)}setRotationAround(t,e){this.setRotation(t);let i=l.len(l.sub($h,this.location,e));u.conjugate(Kh,Kh),l.copy($h,Ka),l.transformQuat($h,$h,Kh),l.scale($h,$h,i),l.add(this.location,$h,e)}setRotationAroundAngles(t,e,i){u.identity(Kh),u.rotateX(Kh,Kh,e),u.rotateZ(Kh,Kh,t),this.setRotationAround(Kh,i)}face(t,e){o.lookAt(Wh,this.location,t,e),o.getRotation(this.rotation,Wh),this.dirty=!0}moveToAndFace(t,e,i){l.copy(this.location,t),this.face(e,i)}reset(){l.set(this.location,0,0,0),u.identity(this.rotation),this.dirty=!0}update(){if(this.dirty){this.dirty=!1;let t=this.location,e=this.rotation,i=this.inverseRotation,n=this.worldMatrix,r=this.projectionMatrix,a=this.worldProjectionMatrix,s=this.vectors,h=this.billboardedVectors;this.isPerspective?o.perspective(r,this.fov,this.aspect,this.nearClipPlane,this.farClipPlane):o.ortho(r,this.leftClipPlane,this.rightClipPlane,this.bottomClipPlane,this.topClipPlane,this.nearClipPlane,this.farClipPlane),o.fromQuat(n,e),o.translate(n,n,l.negate($h,t)),u.conjugate(i,e),o.mul(a,r,n),is(this.planes,a),o.invert(this.inverseWorldMatrix,n),l.transformQuat(this.directionX,qa,i),l.transformQuat(this.directionY,za,i),l.transformQuat(this.directionZ,Ka,i),o.invert(this.inverseWorldProjectionMatrix,a);for(let t=0;t<7;t++)l.transformQuat(h[t],s[t],i)}}testSphere(t,e){for(let i of this.planes)if(ts(i,t)<=-e)return!1;return!0}cameraToWorld(t,e){return l.transformMat4(t,e,this.inverseWorldMatrix)}worldToCamera(t,e){return l.transformMat4(t,e,this.worldMatrix)}worldToScreen(t,e){let i=this.rect;return l.transformMat4($h,e,this.worldProjectionMatrix),t[0]=Math.round(($h[0]+1)/2*i[2]),t[1]=Math.round(($h[1]+1)/2*i[3]),t}screenToWorldRay(t,e){let i=$h,n=qh,r=zh,a=e[0],s=e[1],o=this.inverseWorldProjectionMatrix,h=this.rect;return Qa(i,l.set(r,a,s,0),o,h),Qa(n,l.set(r,a,s,1),o,h),t.set(i,0),t.set(n,3),t}}let Xh=l.create(),Jh=u.create(),Zh=l.create(),Qh=t=>(class extends t{constructor(){super(),this.pivot=l.create(),this.localLocation=l.create(),this.localRotation=u.create(),this.localScale=l.fromValues(1,1,1),this.worldLocation=l.create(),this.worldRotation=u.create(),this.worldScale=l.create(),this.inverseWorldLocation=l.create(),this.inverseWorldRotation=u.create(),this.inverseWorldScale=l.create(),this.localMatrix=o.create(),this.worldMatrix=o.create(),this.parent=null,this.children=[],this.dontInheritTranslation=!1,this.dontInheritRotation=!1,this.dontInheritScaling=!0,this.visible=!0,this.wasDirty=!1,this.dirty=!0}setPivot(t){return l.copy(this.pivot,t),this.dirty=!0,this}setLocation(t){return l.copy(this.localLocation,t),this.dirty=!0,this}setRotation(t){return u.copy(this.localRotation,t),this.dirty=!0,this}setScale(t){return l.copy(this.localScale,t),this.dirty=!0,this}setUniformScale(t){return l.set(this.localScale,t,t,t),this.dirty=!0,this}setTransformation(t,e,i){let n=this.localLocation,r=this.localRotation,a=this.localScale;return n[0]=t[0],n[1]=t[1],n[2]=t[2],r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],a[0]=i[0],a[1]=i[1],a[2]=i[2],this.dirty=!0,this}resetTransformation(){return l.copy(this.pivot,Wa),l.copy(this.localLocation,Wa),u.copy(this.localRotation,Ja),l.copy(this.localScale,Ya),this.dirty=!0,this}movePivot(t){return l.add(this.pivot,this.pivot,t),this.dirty=!0,this}move(t){return l.add(this.localLocation,this.localLocation,t),this.dirty=!0,this}rotate(t){return u.mul(this.localRotation,this.localRotation,t),this.dirty=!0,this}rotateLocal(t){return u.mul(this.localRotation,t,this.localRotation),this.dirty=!0,this}scale(t){return l.mul(this.localScale,this.localScale,t),this.dirty=!0,this}uniformScale(t){return l.scale(this.localScale,this.localScale,t),this.dirty=!0,this}setParent(t){if(this.parent){let t=this.parent.children,e=t.indexOf(this);-1!==e&&t.splice(e,1)}return this.parent=t,t&&t.children.push(this),this.dirty=!0,this}recalculateTransformation(){let t=this.dirty,e=this.parent;if(this.wasDirty=this.dirty,e&&(t=t||e.wasDirty),this.wasDirty=t,t){this.dirty=!1;let t=this.localMatrix,i=this.localLocation,n=this.localRotation,r=this.localScale,a=this.worldMatrix,s=this.worldLocation,l=this.worldRotation,h=this.worldScale,c=this.inverseWorldLocation,d=this.inverseWorldRotation,f=this.inverseWorldScale;if(e){let s,c,d=e.pivot;if((s=Xh)[0]=i[0]+d[0],s[1]=i[1]+d[1],s[2]=i[2]+d[2],this.dontInheritScaling){c=Zh;let t=e.inverseWorldScale;c[0]=t[0]*r[0],c[1]=t[1]*r[1],c[2]=t[2]*r[2],h[0]=r[0],h[1]=r[1],h[2]=r[2]}else{c=r;let t=e.worldScale;h[0]=t[0]*r[0],h[1]=t[1]*r[1],h[2]=t[2]*r[2]}o.fromRotationTranslationScale(t,n,s,c),o.mul(a,e.worldMatrix,t),u.mul(l,e.worldRotation,n)}else o.fromRotationTranslationScale(t,n,i,r),a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],h[0]=r[0],h[1]=r[1],h[2]=r[2];d[0]=-l[0],d[1]=-l[1],d[2]=-l[2],d[3]=l[3],f[0]=1/h[0],f[1]=1/h[1],f[2]=1/h[2],s[0]=a[12],s[1]=a[13],s[2]=a[14],c[0]=-s[0],c[1]=-s[1],c[2]=-s[2]}}update(t){this.dirty||this.parent&&this.parent.wasDirty?(this.dirty=!0,this.wasDirty=!0,this.recalculateTransformation()):this.wasDirty=!1,this.updateObject(t),this.updateChildren(t)}updateObject(t){}updateChildren(t){let e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].update(t)}});class tu extends(Qh(Object)){}class eu extends(Qh(Fh.a)){}class iu{constructor(t){this.pivot=t[0],this.localLocation=t[1],this.localRotation=t[2],this.localScale=t[3],this.worldLocation=t[4],this.worldRotation=t[5],this.worldScale=t[6],this.inverseWorldLocation=t[7],this.inverseWorldRotation=t[8],this.inverseWorldScale=t[9],this.localMatrix=t[10],this.worldMatrix=t[11],this.dontInheritTranslation=!1,this.dontInheritRotation=!1,this.dontInheritScaling=!1,this.children=[],this.visible=!0,this.wasDirty=!1,this.object=null,this.localRotation[3]=1,this.localScale.fill(1),this.localMatrix[0]=1,this.localMatrix[5]=1,this.localMatrix[10]=1,this.localMatrix[15]=1,this.dirty=!0,this.billboarded=!1,this.billboardedX=!1,this.billboardedY=!1,this.billboardedZ=!1}recalculateTransformation(t){let e,i,n=this.localMatrix,r=this.localRotation,a=this.localScale,s=this.worldMatrix,l=this.worldLocation,h=this.worldRotation,c=this.worldScale,d=this.pivot,f=this.inverseWorldLocation,m=this.inverseWorldRotation,g=this.inverseWorldScale,p=this.parent;if(this.dontInheritScaling){i=Zh;let t=p.inverseWorldScale;i[0]=t[0]*a[0],i[1]=t[1]*a[1],i[2]=t[2]*a[2],c[0]=a[0],c[1]=a[1],c[2]=a[2]}else{i=a;let t=p.worldScale;c[0]=t[0]*a[0],c[1]=t[1]*a[1],c[2]=t[2]*a[2]}this.billboarded?(e=Jh,u.copy(e,p.inverseWorldRotation),u.mul(e,e,t.camera.inverseRotation),this.convertBasis(e)):e=r,o.fromRotationTranslationScaleOrigin(n,e,this.localLocation,i,d),o.mul(s,p.worldMatrix,n),u.mul(h,p.worldRotation,e),m[0]=-h[0],m[1]=-h[1],m[2]=-h[2],m[3]=h[3],g[0]=1/c[0],g[1]=1/c[1],g[2]=1/c[2];let v=d[0],b=d[1],w=d[2];l[0]=s[0]*v+s[4]*b+s[8]*w+s[12],l[1]=s[1]*v+s[5]*b+s[9]*w+s[13],l[2]=s[2]*v+s[6]*b+s[10]*w+s[14],f[0]=-l[0],f[1]=-l[1],f[2]=-l[2]}updateChildren(t){let e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].update(t)}convertBasis(t){}}const nu=65;function ru(t,e){let i=new Float32Array(t*nu),n=[],r=0,a=3*t,s=4*t,o=16*t;e=e||iu;let l=i.subarray(r,r+a);r+=a;let h=i.subarray(r,r+a);r+=a;let u=i.subarray(r,r+s);r+=s;let c=i.subarray(r,r+a);r+=a;let d=i.subarray(r,r+a);r+=a;let f=i.subarray(r,r+s);r+=s;let m=i.subarray(r,r+a);r+=a;let g=i.subarray(r,r+a);r+=a;let p=i.subarray(r,r+s);r+=s;let v=i.subarray(r,r+a);r+=a;let b=i.subarray(r,r+o);r+=o;let w=i.subarray(r,r+o);for(let i=0;i<t;i++){let t=3*i,r=t+3,a=4*i,s=a+4,o=16*i,y=o+16;n[i]=new e([l.subarray(t,r),h.subarray(t,r),u.subarray(a,s),c.subarray(t,r),d.subarray(t,r),f.subarray(a,s),m.subarray(t,r),g.subarray(t,r),p.subarray(a,s),v.subarray(t,r),b.subarray(o,y),w.subarray(o,y)])}return{data:i,nodes:n,pivots:l,localLocations:h,localRotations:u,localScales:c,worldLocations:d,worldRotations:f,worldScales:m,inverseWorldLocations:g,invereseWorldRotations:p,inverseWorldScales:v,localMatrices:b,worldMatrices:w}}let au=new Float32Array(3);class su{constructor(t){let e=t.canvas;this.viewer=t,this.camera=new Yh,this.instances=[],this.instanceSet=new Set,this.modelViews=[],this.modelViewSet=new Set,this.node=new tu,this.rendered=!0,this.renderedInstances=0,this.renderedParticles=0,this.renderedBuckets=0,this.renderCalls=0,this.audioEnabled=!1,this.audioContext=null,this.node.recalculateTransformation(this),this.node.wasDirty=!1,this.camera.viewport([0,0,e.width,e.height]),this.camera.perspective(Math.PI/4,e.width/e.height,8,1e4)}async enableAudio(){return this.audioContext||(this.audioContext=new AudioContext),"suspended"!==this.audioContext.state&&await this.audioContext.resume(),this.audioEnabled="running"===this.audioContext.state,this.audioEnabled}disableAudio(){this.audioContext&&this.audioContext.suspend(),this.audioEnabled=!1}addInstance(t){let e=this.instanceSet;return!e.has(t)&&(e.add(t),this.instances.push(t),t.scene&&t.scene.removeInstance(t),t.modelView.sceneChanged(t,this),t.scene=this,t.parent||t.setParent(this.node),this.addView(t.modelView),!0)}addView(t){let e=this.modelViewSet;e.has(t)||(e.add(t),this.modelViews.push(t))}removeInstance(t){if(this.instanceSet.delete(t)){let e=this.instances;e.splice(e.indexOf(t),1);let i=t.modelView;return i.sceneChanged(t,null),t.scene=null,t.parent===this.node&&t.setParent(null),i.hasInstances(this)||(this.modelViewSet.delete(i),this.modelViews.splice(this.modelViews.indexOf(i),1)),!0}return!1}clear(){this.instances.length=0,this.instanceSet.clear(),this.modelViews.length=0,this.modelViewSet.clear()}detach(){return!!this.viewer&&this.viewer.removeScene(this)}update(){if(this.rendered){this.node.updateChildren(this),this.renderedInstances=0,this.renderedParticles=0,this.renderedBuckets=0,this.renderCalls=0;for(let t of this.modelViews)t.update(this),this.renderedInstances+=t.renderedInstances,this.renderedParticles+=t.renderedParticles,this.renderedBuckets+=t.renderedBuckets,this.renderCalls+=t.renderCalls;if(this.audioContext){let[t,e,i]=this.camera.location;this.audioContext.listener.setPosition(-t,-e,-i)}this.camera.update()}}isVisible(t){let e=t.model.bounds;if(e){let i=e.center,n=t.worldLocation;return au[0]=n[0]+i[0],au[1]=n[1]+i[1],au[2]=n[2]+i[2],this.camera.testSphere(au,e.radius)}{let e=this.camera.worldProjectionMatrix;return l.transformMat4(au,t.worldLocation,e),au[0]>=-1&&au[0]<=1&&au[1]>=-1&&au[1]<=1&&au[2]>=-1&&au[2]<=1}}renderOpaque(){if(this.rendered){this.viewport();for(let t of this.modelViews)t.renderOpaque(this)}}renderTranslucent(){if(this.rendered){this.viewport();for(let t of this.modelViews)t.renderTranslucent(this)}}viewport(){let t=this.camera.rect;this.viewer.gl.viewport(t[0],t[1],t[2],t[3])}clearEmittedObjects(){for(let t of this.instances)t.clearEmittedObjects()}}class ou extends Fh.a{constructor({viewer:t,handler:e,extension:i,pathSolver:n,fetchUrl:r=""}){super(),this.viewer=t,this.handler=e||null,this.extension=i||"",this.pathSolver=n||null,this.fetchUrl=r,this.ok=!1,this.loaded=!1,this.setMaxListeners(0)}loadData(t){this.loaded=!0;try{this.load(t),this.ok=!0,this.lateLoad(),this.emit("load",this),this.emit("loadend",this)}catch(t){this.error("InvalidData",t)}}load(t){}detach(){return this.viewer.unload(this)}lateLoad(){}error(t,e){this.loaded=!0,this.emit("error",this,t,e),this.emit("loadend",this)}whenLoaded(){return new Promise((t,e)=>{this.loaded?t(this):this.once("loadend",()=>t(this))})}}class lu extends ou{constructor(t){super(t),this.width=0,this.height=0,this.wrapS=!1,this.wrapT=!1}setParameters(t,e,i,n){const r=this.viewer.gl;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n)}bind(t){let e=this.viewer,i=this.viewer.gl;e.webgl.bindTexture(this,t),this.wrapS?i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),this.wrapT?i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)}}class hu extends lu{load(t){if(t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t instanceof ImageData){let e=this.viewer.gl;t instanceof ImageData||(t=Ss(t)),t=Ms(t);let i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),this.setParameters(e.REPEAT,e.REPEAT,e.LINEAR,e.LINEAR_MIPMAP_LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),this.imageData=t,this.width=t.width,this.height=t.height,this.webglResource=i}else t instanceof WebGLTexture&&(this.webglResource=t)}}var uu={extensions:[[".png","image"],[".jpg","image"],[".gif","image"]],Constructor:hu};class cu extends ou{constructor(t){super(t),this.data=null}load(t){this.data=t}}class du extends Fh.a{constructor(t,e){super(),this.resourcesMap=new Map,this.resources=[],this.frameTime=1e3/60,this.canvas=t,this.webgl=new jh(t,e),this.gl=this.webgl.gl,this.shaderMap=new Map,this.handlers=new Set,this.scenes=[],this.resourcesLoading=new Set,this.on("loadstart",t=>{this.resourcesLoading.add(t)}),this.on("loadend",t=>{this.resourcesLoading.delete(t),0===this.resourcesLoading.size&&setTimeout(()=>this.emit("idle"),0)}),this.noCulling=!1,this.noUpdating=!1,this.textureAtlases={},this.batchSize=8,this.renderedInstances=0,this.renderedParticles=0,this.renderedBuckets=0,this.renderedScenes=0,this.renderCalls=0,this.enableAudio=!1,this.addHandler(uu)}addHandler(t){if(t){let e=this.handlers;if(t.handler&&(t=t.handler),!e.has(t))return t.load&&!t.load(this)?(this.emit("error",this,"InvalidHandler","FailedToLoad"),!1):(e.add(t),!0)}return!1}addScene(){let t=new su(this);return this.scenes.push(t),t}removeScene(t){let e=this.scenes,i=e.indexOf(t);return-1!==i&&(e.splice(i,1),!0)}clear(){let t=this.scenes;for(let e=t.length;e--;)this.removeScene(t[e])}findHandler(t){for(let e of this.handlers)for(let i of e.extensions)if(t===i[0])return[e,i[1]]}load(t,e){if(t){let i,n;t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof WebGLTexture?(i=".png",n=!1,e=null):[t,i,n]=e(t);let r=this.findHandler(i.toLowerCase());if(r){let a=this.resourcesMap.get(t);if(a)return a;let s=r[0];if(a=new s.Constructor({viewer:this,handler:s,extension:i,pathSolver:e,fetchUrl:n?t:""}),this.resources.push(a),this.resourcesMap.set(t,a),this.registerEvents(a),a.emit("loadstart",a),n){let e=r[1];t instanceof Promise?t.then(t=>{"object"==typeof t&&t.hasOwnProperty("data")?a.loadData(t.data):a.loadData(t)}).catch(t=>{a.error("FailedToResolve"),this.emit("error",a,t,null)}):Ph(t,e).then(t=>{let e=t.data;t.ok?a.loadData(e):(a.error("FailedToFetch"),this.emit("error",a,t.error,e))})}else a.loadData(t);return a}return this.emit("error",this,"MissingHandler",[t,i,n]),null}}exists(t){return this.resourcesMap.has(t)}loadGeneric(t,e,i){let n=this.resourcesMap.get(t);return n||(n=new cu({viewer:this,handler:i,fetchUrl:t}),this.resources.push(n),this.resourcesMap.set(t,n),this.registerEvents(n),n.emit("loadstart",n),Ph(t,e).then(t=>{let e=t.data;t.ok?i&&(e=i(e))instanceof Promise?e.then(t=>n.loadData(t)):n.loadData(e):(n.error("FailedToFetch"),this.emit("error",n,t.error,e))}),n)}unload(t){for(let[e,i]of this.resourcesMap)if(i===t)return this.resourcesMap.delete(e),this.resources.splice(this.resources.indexOf(t),1),!0;return!1}loadShader(t,e,i){let n=this.shaderMap;return n.has(t)||n.set(t,this.webgl.createShaderProgram(e,i)),n.get(t)}loadTextureAtlas(t,e){let i=this.textureAtlases;if(!i[t]){let n={texture:new hu({viewer:this}),columns:0,rows:0},r=this.promise();this.whenLoaded(e).then(t=>{for(let e of t)if(!e.ok)return void r.resolve();let e=Is(t.map(t=>t.imageData));n.texture.loadData(e.imageData),n.columns=e.columns,n.rows=e.rows,r.resolve()}),i[t]=n}return i[t]}getTextureAtlas(t){let e=this.textureAtlases[t];return e?e.texture:null}promise(){let t=new Hh;return this.registerEvents(t),t.promise(),t}whenLoaded(t){let e=[];for(let i of t)i&&i.whenLoaded&&e.push(i.whenLoaded());return Promise.all(e)}whenAllLoaded(){return new Promise((t,e)=>{0===this.resourcesLoading.size?t(this):this.once("idle",()=>t(this))})}toBlob(){return new Promise(t=>this.canvas.toBlob(e=>t(e)))}updateAndRender(){this.update(),this.startFrame(),this.render()}update(){let t=this.scenes;this.renderedInstances=0,this.renderedParticles=0,this.renderedBuckets=0,this.renderedScenes=0,this.renderCalls=0;for(let e=0,i=t.length;e<i;e++){let i=t[e];i.rendered&&(i.update(),this.renderedInstances+=i.renderedInstances,this.renderedParticles+=i.renderedParticles,this.renderedBuckets+=i.renderedBuckets,this.renderedScenes+=1,this.renderCalls+=i.renderCalls)}}startFrame(){let t=this.gl;t.depthMask(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}render(){this.renderOpaque(),this.renderTranslucent()}renderOpaque(){for(let t of this.scenes)t.renderOpaque()}renderTranslucent(){for(let t of this.scenes)t.renderTranslucent()}registerEvents(t){["loadstart","load","error","loadend"].map(e=>t.on(e,(...t)=>this.emit(e,...t)))}clearEmittedObjects(){for(let t of this.scenes)t.clearEmittedObjects()}}class fu extends lu{load(t){let e=new Lh;e.load(t);let i=this.viewer.gl,n=Ms(e.getMipmap(0)),r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r),this.setParameters(i.REPEAT,i.REPEAT,i.LINEAR,i.LINEAR_MIPMAP_LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n),i.generateMipmap(i.TEXTURE_2D),this.parser=e,this.imageData=n,this.width=n.width,this.height=n.height,this.webglResource=r}}var mu={extensions:[[".blp","arrayBuffer"]],Constructor:fu},gu={handler:mu,Texture:fu};class pu extends lu{load(t){let e=new Ks(t);if("BM"!==e.read(2))throw new Error("Wrong magic number");e.skip(8);let i=e.readUint32();e.skip(4);let n=e.readUint32(),r=e.readUint32();if(e.skip(2),24!==e.readUint16())throw new Error("Unsupported BPP");if(0!==e.readUint32())throw new Error("Unsupported compression type");e.seek(i);let a=new ImageData(n,r),s=a.data;for(let t=0,i=n*r,a=0;t<i;t+=1,a+=4){let t=e.readUint8Array(3);s[a]=t[0],s[a+1]=t[1],s[a+2]=t[2],s[a+3]=255}a=Ms(a);let o=this.viewer.gl,l=o.createTexture();o.bindTexture(o.TEXTURE_2D,l),this.setParameters(o.REPEAT,o.REPEAT,o.LINEAR,o.LINEAR_MIPMAP_LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a),o.generateMipmap(o.TEXTURE_2D),this.imageData=a,this.width=a.width,this.height=a.height,this.webglResource=l}}var vu={handler:{extensions:[[".bmp","arrayBuffer"]],Constructor:pu},Texture:pu};let bu=Ih(4,8),wu=Ih(5,8),yu=Ih(6,8);function Au(t,e,i,n){t[e]=(i>>11&31)*wu|0,t[e+1]=(i>>5&63)*yu|0,t[e+2]=(31&i)*wu|0,t[e+3]=n*bu}function _u(t,e,i,n){t[e]=(i>>11&31)*wu|0,t[e+1]=(i>>5&63)*yu|0,t[e+2]=(31&i)*wu|0,t[e+3]=n}function xu(t,e,i){let n=new Uint16Array(4),r=new Uint16Array(e*i);for(let a=0,s=i/4;a<s;a++)for(let i=0,s=e/4;i<s;i++){let o=4*(a*s+i);n[0]=t[o],n[1]=t[o+1];let l=31&n[0],h=2016&n[0],u=63488&n[0],c=31&n[1],d=2016&n[1],f=63488&n[1];n[0]>n[1]?(n[2]=5*l+3*c>>3|5*h+3*d>>3&2016|5*u+3*f>>3&63488,n[3]=5*c+3*l>>3|5*d+3*h>>3&2016|5*f+3*u>>3&63488):(n[2]=n[0]+n[1]>>1,n[3]=0);let m=t[o+2],g=4*a*e+4*i;r[g]=n[3&m],r[g+1]=n[m>>2&3],r[g+2]=n[m>>4&3],r[g+3]=n[m>>6&3],r[g+=e]=n[m>>8&3],r[g+1]=n[m>>10&3],r[g+2]=n[m>>12&3],r[g+3]=n[m>>14],m=t[o+3],r[g+=e]=n[3&m],r[g+1]=n[m>>2&3],r[g+2]=n[m>>4&3],r[g+3]=n[m>>6&3],r[g+=e]=n[m>>8&3],r[g+1]=n[m>>10&3],r[g+2]=n[m>>12&3],r[g+3]=n[m>>14]}return r}function Tu(t,e,i){let n=new Uint16Array(4),r=new Uint8Array(e*i*4),a=4*e;for(let s=0,o=e/4;s<o;s++)for(let o=0,l=i/4;o<l;o++){let i=8*(s*l+o);n[0]=t[i+4],n[1]=t[i+5];let h=31&n[0],u=2016&n[0],c=63488&n[0],d=31&n[1],f=2016&n[1],m=63488&n[1];n[2]=5*h+3*d>>3|5*u+3*f>>3&2016|5*c+3*m>>3&63488,n[3]=5*d+3*h>>3|5*f+3*u>>3&2016|5*m+3*c>>3&63488;let g=t[i+6],p=t[i],v=16*s*e+16*o;Au(r,v,n[3&g],15&p),Au(r,v+4,n[g>>2&3],p>>4&15),Au(r,v+8,n[g>>4&3],p>>8&15),Au(r,v+12,n[g>>6&3],p>>12&15),p=t[i+1],Au(r,v+=a,n[g>>8&3],15&p),Au(r,v+4,n[g>>10&3],p>>4&15),Au(r,v+8,n[g>>12&3],p>>8&15),Au(r,v+12,n[g>>14],p>>12&15),g=t[i+7],p=t[i+2],Au(r,v+=a,n[3&g],15&p),Au(r,v+4,n[g>>2&3],p>>4&15),Au(r,v+8,n[g>>4&3],p>>8&15),Au(r,v+12,n[g>>6&3],p>>12&15),p=t[i+3],Au(r,v+=a,n[g>>8&3],15&p),Au(r,v+4,n[g>>10&3],p>>4&15),Au(r,v+8,n[g>>12&3],p>>8&15),Au(r,v+12,n[g>>14],p>>12&15)}return r}function Eu(t,e,i){let n=new Uint16Array(4),r=new Uint8Array(8),a=new Uint8Array(e*i*4),s=4*e;for(let o=0,l=i/4;o<l;o++)for(let i=0,l=e/4;i<l;i++){let h=8*(o*l+i);n[0]=t[h+4],n[1]=t[h+5];let u=31&n[0],c=2016&n[0],d=63488&n[0],f=31&n[1],m=2016&n[1],g=63488&n[1];n[2]=5*u+3*f>>3|5*c+3*m>>3&2016|5*d+3*g>>3&63488,n[3]=5*f+3*u>>3|5*m+3*c>>3&2016|5*g+3*d>>3&63488;let p=t[h+1]+65536*(t[h+2]+65536*t[h+3]);r[0]=255&t[h],r[1]=t[h]>>8,r[0]>r[1]?(r[2]=54*r[0]+9*r[1]>>6,r[3]=45*r[0]+18*r[1]>>6,r[4]=36*r[0]+27*r[1]>>6,r[5]=27*r[0]+36*r[1]>>6,r[6]=18*r[0]+45*r[1]>>6,r[7]=9*r[0]+54*r[1]>>6):(r[2]=12*r[0]+3*r[1]>>4,r[3]=9*r[0]+6*r[1]>>4,r[4]=6*r[0]+9*r[1]>>4,r[5]=3*r[0]+12*r[1]>>4,r[6]=0,r[7]=1);let v=t[h+6],b=16*o*e+16*i;_u(a,b,n[3&v],r[7&p]),_u(a,b+4,n[v>>2&3],r[p>>3&7]),_u(a,b+8,n[v>>4&3],r[p>>6&7]),_u(a,b+12,n[v>>6&3],r[p>>9&7]),_u(a,b+=s,n[v>>8&3],r[p>>12&7]),_u(a,b+4,n[v>>10&3],r[p>>15&7]),_u(a,b+8,n[v>>12&3],r[p>>18&7]),_u(a,b+12,n[v>>14],r[p>>21&7]),v=t[h+7],_u(a,b+=s,n[3&v],r[p>>24&7]),_u(a,b+4,n[v>>2&3],r[p>>27&7]),_u(a,b+8,n[v>>4&3],r[p>>30&7]),_u(a,b+12,n[v>>6&3],r[p>>33&7]),_u(a,b+=s,n[v>>8&3],r[p>>36&7]),_u(a,b+4,n[v>>10&3],r[p>>39&7]),_u(a,b+8,n[v>>12&3],r[p>>42&7]),_u(a,b+12,n[v>>14],r[p>>45&7])}return a}let Su=542327876,Mu=131072,Ru=4,Iu=827611204,Bu=861165636,Cu=894720068;class Lu extends lu{load(t){let e=this.viewer.gl,i=this.viewer.webgl.extensions.compressedTextureS3tc,n=new Int32Array(t,0,31);if(n[0]!==Su)throw new Error("Wrong magic number");if(!(n[20]&Ru))throw new Error("Not DXT");let r,a,s=n[21];if(s===Iu)r=8,a=i?i.COMPRESSED_RGBA_S3TC_DXT1_EXT:null;else if(s===Bu)r=16,a=i?i.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;else{if(s!==Cu)throw new Error(`Unsupported FourCC: ${Object(qs.a)(s)}`);r=16,a=i?i.COMPRESSED_RGBA_S3TC_DXT5_EXT:null}let o=1;n[2]&Mu&&(o=Math.max(1,n[7]));let l,h,u=n[4],c=n[3],d=n[1]+4;const f=e.createTexture();this.width=u,this.height=c,this.webglResource=f,e.bindTexture(e.TEXTURE_2D,f);for(let i=0;i<o;i++)l=Math.max(4,u)/4*Math.max(4,c)/4*r,a?(h=new Uint8Array(t,d,l),e.compressedTexImage2D(e.TEXTURE_2D,i,a,u,c,0,h)):(h=new Uint16Array(t,d,l/2),s===Iu?e.texImage2D(e.TEXTURE_2D,i,e.RGB,u,c,0,e.RGB,e.UNSIGNED_SHORT_5_6_5,xu(h,u,c)):s===Bu?e.texImage2D(e.TEXTURE_2D,i,e.RGBA,u,c,0,e.RGBA,e.UNSIGNED_BYTE,Tu(h,u,c)):e.texImage2D(e.TEXTURE_2D,i,e.RGBA,u,c,0,e.RGBA,e.UNSIGNED_BYTE,Eu(h,u,c))),d+=l,u*=.5,c*=.5;this.setParameters(e.REPEAT,e.REPEAT,e.LINEAR,o>1?e.LINEAR_MIPMAP_LINEAR:e.LINEAR)}}var Uu={extensions:[[".dds","arrayBuffer"]],Constructor:Lu},ku={handler:Uu,Texture:Lu};class Fu{constructor(t){this.model=t,this.instanceSet=new Set,this.sceneData=new Map,this.renderedInstances=0,this.renderedParticles=0,this.renderedBuckets=0,this.renderCalls=0}getShallowCopy(){return null}applyShallowCopy(t){}equals(t){return!0}lateLoad(){for(let t of this.instanceSet)this.addSceneData(t,t.scene)}addSceneData(t,e){if(this.model.ok&&e){let i=this.sceneData,n=i.get(e);n||(n=this.createSceneData(e),i.set(e,n)),n.instances.push(t)}}hasInstances(t){for(let[e,i]of this.sceneData)if(e===t&&i.instances.length>0)return!0;return!1}addInstance(t){let e=this.instanceSet;if(!e.has(t)){let i=t.modelView;return i&&i.removeInstance(t),e.add(t),t.modelView=this,this.addSceneData(t,t.scene),!0}return!1}createSceneData(t){return{scene:t,modelView:this,baseIndex:0,instances:[],buckets:[],usedBuckets:0}}removeInstance(t){let e=this.instanceSet;if(e.delete(t)){let i=this.sceneData,n=t.scene;if(n){let e=i.get(n),r=e.instances,a=e.buckets;r.splice(r.indexOf(t),1);let s=Math.ceil(r.length/this.model.batchSize);s<a.length&&(a.length=s)}return t.modelView=null,0===e.size&&this.model.removeView(this),!0}return!1}sceneChanged(t,e){if(this.model.ok){let i=this.sceneData,n=t.scene;if(n){let e=i.get(n),r=e.instances,a=e.buckets;r.splice(r.indexOf(t),1);let s=Math.ceil(r.length/this.model.batchSize);s<a.length&&(a.length=s)}e&&this.addSceneData(t,e)}}clear(){}detach(){}update(t){if(this.model.ok){let e=this.sceneData.get(t);if(e){let t=e.instances.length,i=e.buckets;for(e.baseIndex=0,e.usedBuckets=0;e.baseIndex<t;)e.usedBuckets===i.length&&(i[e.usedBuckets]=new this.model.handler.Bucket(this)),e.baseIndex=i[e.usedBuckets].fill(e),e.usedBuckets+=1;return e}}return null}renderOpaque(t){let e=this.sceneData.get(t);e&&e.baseIndex&&this.model.renderOpaque(e)}renderTranslucent(t){let e=this.sceneData.get(t);e&&e.baseIndex&&this.model.renderTranslucent(e)}}class Pu extends Fu{constructor(t){super(t),this.textures=new Map}getShallowCopy(){return{textures:new Map(this.textures)}}applyShallowCopy(t){let e=this.textures;for(let[i,n]of t.textures)e.set(i,n)}equals(t){let e=this.textures,i=t.textures;if(e.length!==i.length)return!1;for(let[t,n]of i)if(e.get(t)!==n)return!1;return!0}}class Du extends ou{constructor(t){super(t),this.batchSize=t.viewer.batchSize,this.instances=[],this.views=[]}addInstance(){let t=this.views,e=new this.handler.Instance(this);return this.instances.push(e),0===t.length&&this.addView(),t[0].addInstance(e),this.ok&&e.load(),e}renderOpaque(t,e,i){}renderTranslucent(t,e,i){}addView(){let t=new this.handler.View(this);return this.views.push(t),t}removeView(t){let e=this.views;e.splice(e.indexOf(t),1)}viewChanged(t,e){for(let i of this.views)if(i.equals(e))return void i.addInstance(t);let i=this.addView();i.applyShallowCopy(e),i.addInstance(t),t.scene&&t.scene.addView(i)}lateLoad(){for(let t of this.instances)t.load();for(let t of this.views)t.lateLoad()}}class Ou extends Du{bindTexture(t,e,i){let n=this.viewer,r=i.textures;r.has(t)&&(t=r.get(t)),t?t.bind(e):n.webgl.bindTexture(null,e)}}class Nu extends Ou{load(t){const e=this.viewer.gl;let i=t.geometry,n=t.material,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,i.vertices,e.STATIC_DRAW);let a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,i.uvs,e.STATIC_DRAW);let s=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.faces,e.STATIC_DRAW);let o=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.edges,e.STATIC_DRAW),this.boundingRadius=i.boundingRadius,this.vertexArray=i.vertices,this.uvArray=i.uvs,this.faceArray=i.faces,this.edgeArray=i.edges,this.vertexBuffer=r,this.uvBuffer=a,this.faceBuffer=s,this.edgeBuffer=o;let l=i.faces.BYTES_PER_ELEMENT;this.faceIndexType=1===l?e.UNSIGNED_BYTE:2===l?e.UNSIGNED_SHORT:e.UNSIGNED_INT,l=i.edges.BYTES_PER_ELEMENT,this.edgeIndexType=1===l?e.UNSIGNED_BYTE:2===l?e.UNSIGNED_SHORT:e.UNSIGNED_INT,this.texture=n.texture,this.twoSided=n.twoSided||!1,this.noDepthTest=n.noDepthSet||!1,this.noDepthSet=n.noDepthSet||!1,this.uvScale=n.uvScale||new Float32Array([1,1]),this.uvOffset=n.uvOffset||new Float32Array(2),this.vertexColor=n.vertexColor||new Float32Array([255,255,255,255]),this.edgeColor=n.edgeColor||new Float32Array([255,255,255,255]),this.renderMode=0,n.renderMode>0&&(this.renderMode=n.renderMode),this.isBGR=n.isBGR||!1,this.isBlended=n.isBlended||!1,this.isBlended?this.translucent=!0:this.opaque=!0}render(t,e,i){let n=this.viewer.webgl,r=this.viewer.gl,a=n.extensions.instancedArrays,s=this.viewer.shaderMap.get("GeoStandardShader"),o=s.uniforms,l=s.attribs;n.useShaderProgram(s),r.uniformMatrix4fv(o.u_mvp,!1,e.camera.worldProjectionMatrix),r.activeTexture(r.TEXTURE15),r.bindTexture(r.TEXTURE_2D,t.boneTexture),r.uniform1i(o.u_boneMap,15),r.uniform1f(o.u_vectorSize,t.vectorSize),r.uniform1f(o.u_rowSize,t.rowSize);let h=l.a_InstanceID;r.bindBuffer(r.ARRAY_BUFFER,t.instanceIdBuffer),r.vertexAttribPointer(h,1,r.UNSIGNED_SHORT,!1,2,0),a.vertexAttribDivisorANGLE(h,1),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(l.a_position,3,r.FLOAT,!1,12,0),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.vertexAttribPointer(l.a_uv,2,r.FLOAT,!1,8,0),this.twoSided?r.disable(r.CULL_FACE):r.enable(r.CULL_FACE),this.noDepthTest?r.disable(r.DEPTH_TEST):r.enable(r.DEPTH_TEST),this.noDepthSet?r.depthMask(0):r.depthMask(1),this.isBlended?(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)):r.disable(r.BLEND),r.uniform1i(o.u_texture,0);let u=l.a_color;if(a.vertexAttribDivisorANGLE(u,1),0===this.renderMode||2===this.renderMode){let e=i.textures.get(null)||this.texture;n.bindTexture(e,0);let s=o.u_hasTexture;e?r.uniform1f(s,1):r.uniform1f(s,0),r.uniform1f(o.u_isEdge,0),r.uniform2fv(o.u_uvScale,this.uvScale),r.uniform2fv(o.u_uvOffset,this.uvOffset),r.uniform1f(o.u_isBGR,this.isBGR),r.uniform1f(o.u_alphaMod,this.alpha),r.bindBuffer(r.ARRAY_BUFFER,t.vertexColorBuffer),r.vertexAttribPointer(u,4,r.UNSIGNED_BYTE,!0,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.faceBuffer),a.drawElementsInstancedANGLE(r.TRIANGLES,this.faceArray.length,this.faceIndexType,0,t.count)}1!==this.renderMode&&2!==this.renderMode||(r.uniform1f(o.u_isEdge,1),r.bindBuffer(r.ARRAY_BUFFER,t.edgeColorBuffer),r.vertexAttribPointer(u,4,r.UNSIGNED_BYTE,!0,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.edgeBuffer),a.drawElementsInstancedANGLE(r.LINES,this.edgeArray.length,this.edgeIndexType,0,t.count)),a.vertexAttribDivisorANGLE(h,0),a.vertexAttribDivisorANGLE(u,0)}renderBuckets(t){let e=t.scene,i=t.buckets,n=t.modelView;for(let r=0,a=t.usedBuckets;r<a;r++)this.render(i[r],e,n)}renderOpaque(t){this.opaque&&this.renderBuckets(t)}renderTranslucent(t){this.translucent&&this.renderBuckets(t)}}class Vu{constructor(t){let e=t.model,i=e.viewer.gl;this.modelView=t,this.model=e,this.count=0,this.instanceIdBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.instanceIdBuffer),i.bufferData(i.ARRAY_BUFFER,new Uint16Array(e.batchSize).map((t,e,i)=>e),i.STATIC_DRAW)}fill(t,e,i){return t.instances.length}}class Gu extends Vu{constructor(t){super(t);const e=this.model.viewer.gl;this.gl=e;let i=this.model.batchSize;this.boneArrayInstanceSize=16,this.boneArray=new Float32Array(this.boneArrayInstanceSize*i),this.boneTexture=e.createTexture(),this.boneTextureWidth=4,this.boneTextureHeight=i,this.vectorSize=1/this.boneTextureWidth,this.rowSize=1/this.boneTextureHeight,e.activeTexture(e.TEXTURE15),e.bindTexture(e.TEXTURE_2D,this.boneTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.boneTextureWidth,this.boneTextureHeight,0,e.RGBA,e.FLOAT,this.boneArray),this.vertexColorArray=new Uint8Array(4*i),this.vertexColorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexColorBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexColorArray,e.DYNAMIC_DRAW),this.edgeColorArray=new Uint8Array(4*i),this.edgeColorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.edgeColorBuffer),e.bufferData(e.ARRAY_BUFFER,this.edgeColorArray,e.DYNAMIC_DRAW)}fill(t){let e=t.baseIndex,i=this.model,n=i.viewer.gl,r=i.batchSize,a=this.boneArray,s=this.vertexColorArray,o=this.edgeColorArray,l=0,h=t.instances;for(let t=h.length;e<t&&l<r;e++){let t=h[e];if(t.rendered&&!t.culled){let e=t.worldMatrix,i=t.vertexColor,n=t.edgeColor,r=16*l;a[r]=e[0],a[r+1]=e[1],a[r+2]=e[2],a[r+3]=e[3],a[r+4]=e[4],a[r+5]=e[5],a[r+6]=e[6],a[r+7]=e[7],a[r+8]=e[8],a[r+9]=e[9],a[r+10]=e[10],a[r+11]=e[11],a[r+12]=e[12],a[r+13]=e[13],a[r+14]=e[14],a[r+15]=e[15],s[4*l]=i[0],s[4*l+1]=i[1],s[4*l+2]=i[2],s[4*l+3]=i[3],o[4*l]=n[0],o[4*l+1]=n[1],o[4*l+2]=n[2],o[4*l+3]=n[3],l+=1}}return this.count=l,l&&(n.activeTexture(n.TEXTURE15),n.bindTexture(n.TEXTURE_2D,this.boneTexture),n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.boneTextureWidth,l,n.RGBA,n.FLOAT,a),n.bindBuffer(n.ARRAY_BUFFER,this.vertexColorBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexColorArray),n.bindBuffer(n.ARRAY_BUFFER,this.edgeColorBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.edgeColorArray)),e}}class ju extends eu{constructor(t){super(),this.modelView=null,this.model=t,this.paused=!1,this.rendered=!0,this.culled=!1,this.noCulling=!1,this.bounds=null}show(){this.rendered=!0}hide(){this.rendered=!1}shown(){return this.rendered}hidden(){return!this.rendered}detach(){return!!this.scene&&this.scene.removeInstance(this)}load(t){}updateTimers(){}updateAnimations(){}clearEmittedObjects(){}updateObject(t){if(!this.paused&&this.model.ok&&(this.updateTimers(),this.rendered)){let e=t.isVisible(this)||this.noCulling||this.model.viewer.noCulling;this.culled=!e,e&&this.updateAnimations()}}setScene(t){return t.addInstance(this)}}class Hu extends ju{setTexture(t,e){let i=this.modelView.getShallowCopy();i.textures.set(t,e),this.model.viewChanged(this,i)}}class $u extends Hu{constructor(t){super(t),this.vertexColor=new Uint8Array(4),this.edgeColor=new Uint8Array(4)}load(){this.setVertexColor(this.model.vertexColor),this.setEdgeColor(this.model.edgeColor)}setVertexColor(t){return this.vertexColor.set(t),this}setEdgeColor(t){return this.edgeColor.set(t),this}}var qu="\n    attribute float a_InstanceID;\n  ",zu="\n    uniform sampler2D u_boneMap;\n    uniform float u_vectorSize;\n    uniform float u_rowSize;\n\n    mat4 fetchMatrix(float column, float row) {\n      column *= u_vectorSize * 4.0;\n      row *= u_rowSize;\n      // Add in half texel to sample in the middle of the texel.\n      // Otherwise, since the sample is directly on the boundry, small floating point errors can cause the sample to get the wrong pixel.\n      // This is mostly noticable with NPOT textures, which the bone maps are.\n      column += 0.5 * u_vectorSize;\n      row += 0.5 * u_rowSize;\n\n      return mat4(texture2D(u_boneMap, vec2(column, row)),\n                  texture2D(u_boneMap, vec2(column + u_vectorSize, row)),\n                  texture2D(u_boneMap, vec2(column + u_vectorSize * 2.0, row)),\n                  texture2D(u_boneMap, vec2(column + u_vectorSize * 3.0, row)));\n    }\n  ",Ku="\n    vec2 decodeFloat2(float f) {\n      vec2 v;\n\n      v[1] = floor(f / 256.0);\n      v[0] = floor(f - v[1] * 256.0);\n\n      return v;\n    }\n\n    vec3 decodeFloat3(float f) {\n      vec3 v;\n\n      v[2] = floor(f / 65536.0);\n      v[1] = floor((f - v[2] * 65536.0) / 256.0);\n      v[0] = floor(f - v[2] * 65536.0 - v[1] * 256.0);\n\n      return v;\n    }\n\n    vec4 decodeFloat4(float v) {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      return enc;\n    }\n  ",Wu="\n    // A 2D quaternion*vector.\n    // q is the zw components of the original quaternion.\n    vec2 quat_transform(vec2 q, vec2 v) {\n      vec2 uv = vec2(-q.x * v.y, q.x * v.x);\n      vec2 uuv = vec2(-q.x * uv.y, q.x * uv.x);\n\n      return v + 2.0 * (uv * q.y + uuv);\n    }\n\n    // A 2D quaternion*vector.\n    // q is the zw components of the original quaternion.\n    vec3 quat_transform(vec2 q, vec3 v) {\n      return vec3(quat_transform(q, v.xy), v.z);\n    }\n  ",Yu={vs:`\n    ${qu}\n    ${zu}\n    uniform mat4 u_mvp;\n    uniform vec2 u_uvOffset;\n    uniform vec2 u_uvScale;\n\n    attribute vec3 a_position;\n    attribute vec2 a_uv;\n    attribute vec2 a_uvScale;\n    attribute vec4 a_color;\n\n    varying vec2 v_uv;\n    varying vec4 v_color;\n\n    void main() {\n      v_uv = a_uv * u_uvScale + u_uvOffset;\n      v_color = a_color;\n\n      gl_Position = u_mvp * fetchMatrix(0.0, a_InstanceID) * vec4(a_position, 1.0);\n    }\n  `,ps:"\n    uniform sampler2D u_diffuseMap;\n    uniform float u_alphaMod;\n    uniform bool u_isEdge;\n    uniform bool u_hasTexture;\n    uniform bool u_isBGR;\n\n    varying vec2 v_uv;\n    varying vec4 v_color;\n\n    void main() {\n      gl_FragColor = v_color;\n\n      if (u_hasTexture && !u_isEdge) {\n        vec4 texel = texture2D(u_diffuseMap, v_uv);\n\n        if (u_isBGR) {\n          texel = texel.bgra;\n        }\n\n        gl_FragColor *= texel;\n      } \n    }\n  "},Xu={load:t=>t.loadShader("GeoStandardShader",Yu.vs,Yu.ps).ok,extensions:[[".geo"]],Constructor:Nu,View:class extends Pu{update(t){let e=super.update(t);if(e){let t=2===this.model.renderMode?2:1,i=e.buckets,n=0,r=0,a=0;for(let s=0,o=e.usedBuckets;s<o;s++)n+=i[s].count,r+=1,a+=t;this.renderedInstances=n,this.renderedBuckets=r,this.renderCalls=a}}},Bucket:Gu,Instance:$u},Ju={handler:Xu,Model:Nu,ModelInstance:$u,Bucket:Gu};class Zu extends lu{load(t){let e=this.viewer.gl,i=new DataView(t);if(2!==i.getUint8(2))throw new Error("Unsupported image type");let n=i.getUint16(12,!0),r=i.getUint16(14,!0);if(32!==i.getUint8(16))throw new Error("Unsupported bits per pixel");let a=Ms(new ImageData(new Uint8ClampedArray(t,18,n*r*4),n,r)),s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s),this.setParameters(e.REPEAT,e.REPEAT,e.LINEAR,e.LINEAR_MIPMAP_LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.generateMipmap(e.TEXTURE_2D),this.imageData=a,this.width=a.width,this.height=a.height,this.webglResource=s}}var Qu={extensions:[[".tga","arrayBuffer"]],Constructor:Zu};let tc={diffuse:1,decal:2,specular:3,gloss:4,emissive:5,emissive2:6,evio:7,evioMask:8,alphaMask:9,alphaMask2:10,normal:11,heightMap:12,lightMap:13,ao:14};class ec{constructor(t,e,i,n){if(e){e=e.get();let r=t.model,a=r.pathSolver;this.active=!1,this.layer=e,this.gl=t.gl;let s="u_"+i,o=s+"LayerSettings.";this.uniformMap={map:s+"Map",enabled:o+"enabled",op:o+"op",channels:o+"channels",teamColorMode:o+"teamColorMode",invert:o+"invert",clampResult:o+"clampResult",uvCoordinate:o+"uvCoordinate"};let l=e.imagePath.getAll().join("");if(0!==l.length){l=l.replace("\0","").toLowerCase(),this.source=l,this.texture=r.viewer.load(l,a),this.active=!0;let t=e.uvSource,s=e.flags;this.flags=s,this.colorChannels=e.colorChannelSetting,this.model=r,this.type=i,this.op=n;let o=0;1===t?o=1:9===t?o=2:10===t&&(o=3),this.uvCoordinate=o,this.textureUnit=tc[i],this.invert=16&s,this.clampResult=32&s,this.teamColorMode="diffuse"===i&1}}}bind(t,e){let i=this.gl,n=this.uniformMap,r=e.uniforms,a=this.active;i.uniform1f(r[n.enabled],a),a&&(i.uniform1i(r[n.map],this.textureUnit),this.model.bindTexture(this.texture,this.textureUnit,t.modelView),i.uniform1f(r[n.op],this.op),i.uniform1f(r[n.channels],this.colorChannels),i.uniform1f(r[n.teamColorMode],this.teamColorMode),i.uniform1f(r[n.invert],this.invert),i.uniform1f(r[n.clampResult],this.clampResult),i.uniform1f(r[n.uvCoordinate],this.uvCoordinate))}unbind(t){this.active&&this.gl.uniform1f(t.uniforms[this.uniformMap.enabled],0)}}class ic{constructor(t,e){this.model=t,this.gl=t.viewer.gl,this.name=e.name.getAll().join(""),this.flags=e.flags,this.blendMode=e.blendMode,this.priority=e.priority,this.specularity=e.specularity,this.specMult=e.specMult,this.emisMult=e.emisMult,this.layerBlendType=e.layerBlendType,this.emisBlendType=e.emisBlendType,this.emisMode=e.emisMode,this.doubleSided=8&e.flags,this.layers=[new ec(this,e.diffuseLayer,"diffuse",2),new ec(this,e.decalLayer,"decal",2),new ec(this,e.specularLayer,"specular",2),new ec(this,e.glossLayer,"gloss",2),new ec(this,e.emissiveLayer,"emissive",e.emisBlendType),new ec(this,e.emissive2Layer,"emissive2",e.emisMode),new ec(this,e.evioLayer,"evio",2),new ec(this,e.evioMaskLayer,"evioMask",2),new ec(this,e.alphaMaskLayer,"alphaMask",2),new ec(this,e.alphaMask2Layer,"alphaMask2",2),new ec(this,e.normalLayer,"normal",2),new ec(this,e.heightLayer,"heightMap",2),new ec(this,e.lightMapLayer,"lightMap",2),new ec(this,e.ambientOcclusionLayer,"ao",2)]}bindCommon(){const t=this.gl;1===this.blendMode?(t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE)):2===this.blendMode?(t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE)):t.disable(t.BLEND),this.doubleSided?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(1)}bind(t,e){const i=this.gl;this.bindCommon(),i.uniform1f(e.uniforms.u_specularity,this.specularity),i.uniform1f(e.uniforms.u_specMult,this.specMult),i.uniform1f(e.uniforms.u_emisMult,this.emisMult),i.uniform4fv(e.uniforms.u_lightAmbient,[.02,.02,.02,0]);const n=this.layers;n[0].bind(t,e),n[1].bind(t,e),n[2].bind(t,e),n[4].bind(t,e),n[5].bind(t,e),n[10].bind(t,e),n[12].bind(t,e)}unbind(t){const e=this.gl;e.disable(e.BLEND),e.enable(e.CULL_FACE);const i=this.layers;i[0].unbind(t),i[1].unbind(t),i[2].unbind(t),i[4].unbind(t),i[5].unbind(t),i[10].unbind(t),i[12].unbind(t)}bindDiffuse(t){this.bindCommon(),this.layers[0].bind(t)}bindSpecular(t){const e=this.gl;this.bindCommon(),e.uniform1f(t.uniforms.u_specularity,this.specularity),e.uniform1f(t.uniforms.u_specMult,this.specMult),this.layers[2].bind(t)}bindNormalMap(t){this.bindCommon(),this.layers[10].bind(t)}bindEmissive(t){this.bindCommon(),this.gl.uniform1f(t.uniforms.u_emisMult,this.emisMult),this.layers[4].bind(t),this.layers[5].bind(t)}bindDecal(t){this.bindCommon(),this.layers[1].bind(t)}}class nc{constructor(t,e){let i=e.flags;this.name=e.name,this.parent=e.parent,this.location=e.location,this.rotation=e.rotation,this.scale=e.scale,this.visibility=e.visibility,this.inhertTranslation=1&i,this.inheritScale=2&i,this.inheritRotation=4&i,this.billboard1=16&i,this.billboard2=64&i,this.twoDProjection=256&i,this.animated=512&i,this.inverseKinematics=1024&i,this.skinned=2048&i,this.real=8192&i}}class rc{constructor(t){this.name=t.name.getAll().join(""),this.interval=t.interval,this.movementSpeed=t.movementSpeed,this.frequency=t.frequency,this.boundingSphere=t.boundingSphere}}class ac{constructor(t){const e=t.animIds.getAll();this.animIds={};for(let t=0,i=e.length;t<i;t++)this.animIds[e[t]]=t}hasData(t){return!!this.animIds[t.animId]}}function sc(t,e,i,n,r,a,s){return 0===s?t[0]=e[0]:1===s?t[0]=cs(e[0],r[0],a):2===s?t[0]=ds(e[0],i[0],n[0],r[0],a):3===s&&(t[0]=fs(e[0],i[0],n[0],r[0],a)),t}function oc(t,e,i,n,r,a,s){return 0===s?l.copy(t,e):1===s?l.lerp(t,e,r,a):2===s?l.hermite(t,e,i,n,r,a):3===s&&l.bezier(t,e,i,n,r,a),t}function lc(t,e,i,n,r,a,s){return 0===s?u.copy(t,e):1===s?u.slerp(t,e,r,a):2!==s&&3!==s||u.sqlerp(t,e,i,n,r,a),t}let hc=new Float32Array(1),uc=new Float32Array(1),cc=new Float32Array(1),dc=new Float32Array(3),fc=new Float32Array(4);class mc{constructor(t){this.keys=t.keys.getAll(),this.values=t.values.getAll(),this.biggestKey=t.biggestKey}}class gc{constructor(t){this.sd=t.map(t=>new mc(t))}getValueUnsafe(t,e,i,n){let r=this.sd[t];n&&(i%=r.biggestKey);let a=r.keys,s=r.values,o=a.length,l=0;for(;l!==a.length&&i>a[l];)o=l,l++;let h=a.length;if(o===h)return l===h?e.initValue:s[l];if(l===h||o>=l)return s[o];let u=us((i-a[o])/(a[l]-a[o]),0,1),c=s[o],d=s[l];return 4===c.length?(lc(fc,c,0,0,d,u,e.interpolationType),fc):3===c.length?(oc(dc,c,0,0,d,u,e.interpolationType),dc):(hc[0]=c,uc[0]=d,sc(cc,hc,0,0,uc,u,e.interpolationType),cc[0])}}class pc{constructor(t){const e=t.animIds.getAll();this.name=t.name.getAll().join(""),this.runsConcurrent=t.runsConcurrent,this.priority=t.priority,this.stsIndex=t.stsIndex;const i=new Uint16Array(t.animRefs.getAll().buffer);this.animRefs=[];for(let t=0,n=e.length;t<n;t++)this.animRefs[e[t]]=[i[2*t+1],i[2*t]];this.sd=t.sd.map(t=>new gc(t.getAll()))}getValueUnsafe(t,e){const i=this.animRefs[t.animId];return i?this.sd[i[0]].getValueUnsafe(i[1],t,e.frame,this.runsConcurrent):t.initValue}}class vc{constructor(t,e,i){this.name=t.name.getAll().join(""),this.stcIndices=t.stcIndices.getAll(),this.sts=e,this.stc=i}getValueUnsafe(t,e){let i=this.stcIndices,n=this.stc,r=this.sts;for(let a=0,s=i.length;a<s;a++){let s=n[i[a]];if(r[s.stsIndex].hasData(t))return s.getValueUnsafe(t,e)}return t.initValue}}class bc{constructor(t){this.name=t.name.getAll().join(""),this.bone=t.bone}}class wc{constructor(t){this.bone=t.bone,this.name=t.name.getAll().join("")}}class yc{constructor(t,e,i,n,r){let a=e.firstVertexIndex,s=e.triangleIndicesCount,o=e.firstTriangleIndex;for(let t=0;t<s;t++)n[r+t]=i[o+t]+a;this.gl=t.viewer.gl,this.firstBoneLookupIndex=e.firstBoneLookupIndex,this.boneWeightPairsCount=e.boneWeightPairsCount,this.offset=2*r,this.verticesCount=e.verticesCount,this.elements=s}render(t,e){let i=this.gl;i.uniform1f(t.uniforms.u_firstBoneLookupIndex,this.firstBoneLookupIndex),i.uniform1f(t.uniforms.u_boneWeightPairsCount,this.boneWeightPairsCount),i.extensions.instancedArrays.drawElementsInstancedANGLE(i.TRIANGLES,this.elements,i.UNSIGNED_SHORT,this.offset,e)}getPolygonCount(){return this.elements/3}}class Ac extends Ou{constructor(t){super(t),this.parser=null,this.name="",this.batches=[],this.materials=[[],[]],this.materialMaps=[],this.bones=[],this.boneLookup=[],this.sequences=[],this.sts=[],this.stc=[],this.stg=[],this.attachments=[],this.cameras=[],this.regions=[]}load(t){let e=new vo(t),i=e.model,n=i.divisions.get();this.parser=e,this.name=i.modelName.getAll().join(""),this.setupGeometry(i,n);let r=i.materialReferences.getAll();this.materialMaps=r;for(let t of i.materials[0].getAll())this.materials[1].push(new ic(this,t));for(let t of n.batches.getAll()){let e=t.regionIndex,i=r[t.materialReferenceIndex];1===i.materialType&&this.batches.push({regionId:e,region:this.regions[e],material:this.materials[1][i.materialIndex]})}this.initialReference=i.absoluteInverseBoneRestPositions.getAll();for(let t of i.bones.getAll())this.bones.push(new nc(this,t));this.boneLookup=i.boneLookup.getAll();for(let t of i.sequences.getAll())this.sequences.push(new rc(t));for(let t of i.sts.getAll())this.sts.push(new ac(t));for(let t of i.stc.getAll())this.stc.push(new pc(t));for(let t of i.stg.getAll())this.stg.push(new vc(t,this.sts,this.stc));this.addGlobalAnims();for(let t of i.attachmentPoints.getAll())this.attachments.push(new bc(t));for(let t of i.cameras.getAll())this.cameras.push(new wc(t))}setupGeometry(t,e){let i=this.viewer.gl,n=1,r=t.vertexFlags;262144&r?n=2:524288&r?n=3:1048576&r&&(n=4);let a=e.regions.getAll(),s=0,o=[];for(let t=0,e=a.length;t<e;t++)o[t]=s,s+=a[t].triangleIndicesCount;let l=new Uint16Array(s);const h=e.triangles.getAll();for(let t=0,e=a.length;t<e;t++)this.regions.push(new yc(this,a[t],h,l,o[t]));this.elementBuffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.elementBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,l,i.STATIC_DRAW);let u=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,u),i.bufferData(i.ARRAY_BUFFER,t.vertices.getAll(),i.STATIC_DRAW),this.arrayBuffer=u,this.vertexSize=4*(7+n),this.uvSetCount=n}mapMaterial(t){let e=this.materialMaps[t];return this.materials[e.materialType][e.materialIndex]}addGlobalAnims(){}getValue(t,e,i){return-1!==e?this.stg[e].getValue(t,i):t.initValue}bindShared(t){let e=this.viewer.gl,i=this.shader,n=this.vertexSize,r=e.extensions.instancedArrays,a=i.attribs,s=i.uniforms,o=a.a_teamColor;e.bindBuffer(e.ARRAY_BUFFER,t.teamColorBuffer),e.vertexAttribPointer(o,1,e.UNSIGNED_BYTE,!1,1,0),r.vertexAttribDivisorANGLE(o,1);let l=a.a_vertexColor;e.bindBuffer(e.ARRAY_BUFFER,t.vertexColorBuffer),e.vertexAttribPointer(l,4,e.UNSIGNED_BYTE,!0,4,0),r.vertexAttribDivisorANGLE(l,1);let h=a.a_InstanceID;e.bindBuffer(e.ARRAY_BUFFER,t.instanceIdBuffer),e.vertexAttribPointer(h,1,e.UNSIGNED_SHORT,!1,2,0),r.vertexAttribDivisorANGLE(h,1),e.activeTexture(e.TEXTURE15),e.bindTexture(e.TEXTURE_2D,t.boneTexture),e.uniform1i(s.u_boneMap,15),e.uniform1f(s.u_vectorSize,t.vectorSize),e.uniform1f(s.u_rowSize,t.rowSize),e.bindBuffer(e.ARRAY_BUFFER,this.arrayBuffer),e.vertexAttribPointer(a.a_position,3,e.FLOAT,!1,n,0),e.vertexAttribPointer(a.a_weights,4,e.UNSIGNED_BYTE,!1,n,12),e.vertexAttribPointer(a.a_bones,4,e.UNSIGNED_BYTE,!1,n,16)}bind(t,e){let i=this.viewer.gl,n=this.viewer.webgl,r=this.vertexSize,a=this.uvSetCount,s=this.viewer.shaderMap.get("M3StandardShader"+(a-1));n.useShaderProgram(s),this.shader=s,this.bindShared(t);let o=s.attribs,l=s.uniforms;i.vertexAttribPointer(o.a_normal,4,i.UNSIGNED_BYTE,!1,r,20);for(let t=0;t<a;t++)i.vertexAttribPointer(o["a_uv"+t],2,i.SHORT,!1,r,24+4*t);i.vertexAttribPointer(o.a_tangent,4,i.UNSIGNED_BYTE,!1,r,24+4*a),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.elementBuffer);let h=e.camera;i.uniformMatrix4fv(l.u_mvp,!1,h.worldProjectionMatrix),i.uniformMatrix4fv(l.u_mv,!1,h.worldMatrix),i.uniform3fv(l.u_eyePos,h.location),i.uniform3fv(l.u_lightPos,this.handler.lightPosition)}unbind(){let t=this.viewer.gl.extensions.instancedArrays,e=this.shader.attribs;t.vertexAttribDivisorANGLE(e.a_teamColor,0),t.vertexAttribDivisorANGLE(e.a_vertexColor,0),t.vertexAttribDivisorANGLE(e.a_InstanceID,0)}renderBatch(t,e){let i=this.shader,n=e.region,r=e.material;r.bind(t,i),n.render(i,t.count),r.unbind(i)}renderBatches(t,e,i){if(i&&i.length){this.bind(t,e);for(let e=0,n=i.length;e<n;e++)this.renderBatch(t,i[e]);this.unbind()}}renderOpaque(t){let e=t.scene,i=t.buckets;for(let n=0,r=t.usedBuckets;n<r;n++)this.renderBatches(i[n],e,this.batches)}renderTranslucent(t){}}let _c=o.create();class xc extends Vu{constructor(t){super(t);const e=this.model,i=e.viewer.gl;this.gl=i;let n=e.initialReference.length,r=e.batchSize;this.boneArrayInstanceSize=16*n,this.boneArray=new Float32Array(this.boneArrayInstanceSize*r),this.boneTexture=i.createTexture(),this.boneTextureWidth=4*n,this.boneTextureHeight=r,this.vectorSize=1/this.boneTextureWidth,this.rowSize=1/this.boneTextureHeight,i.activeTexture(i.TEXTURE15),i.bindTexture(i.TEXTURE_2D,this.boneTexture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.boneTextureWidth,this.boneTextureHeight,0,i.RGBA,i.FLOAT,this.boneArray),this.teamColorArray=new Uint8Array(r),this.teamColorBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.teamColorBuffer),i.bufferData(i.ARRAY_BUFFER,this.teamColorArray,i.DYNAMIC_DRAW),this.vertexColorArray=new Uint8Array(4*r).fill(255),this.vertexColorBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexColorBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertexColorArray,i.DYNAMIC_DRAW)}fill(t){let e=t.baseIndex,i=this.model,n=i.viewer.gl,r=i.batchSize,a=i.initialReference,s=i.boneLookup,l=this.boneArray,h=this.teamColorArray,u=this.vertexColorArray,c=0,d=t.instances;for(let t=d.length;e<t&&c<r;e++){let t=d[e];if(t.rendered&&!t.culled){let e,i=t.vertexColor,n=c*this.boneArrayInstanceSize,r=t.sequence,d=t.skeleton.nodes;-1===r?e=t.worldMatrix:(e=_c,o.identity(e));for(let t=0,i=s.length;t<i;t++){let i=n+16*t;if(-1!==r){let i=s[t];o.multiply(e,d[i].worldMatrix,a[i])}l[i]=e[0],l[i+1]=e[1],l[i+2]=e[2],l[i+3]=e[3],l[i+4]=e[4],l[i+5]=e[5],l[i+6]=e[6],l[i+7]=e[7],l[i+8]=e[8],l[i+9]=e[9],l[i+10]=e[10],l[i+11]=e[11],l[i+12]=e[12],l[i+13]=e[13],l[i+14]=e[14],l[i+15]=e[15]}h[c]=t.teamColor,u[4*c]=i[0],u[4*c+1]=i[1],u[4*c+2]=i[2],u[4*c+3]=i[3],c+=1}}return this.count=c,c&&(n.activeTexture(n.TEXTURE15),n.bindTexture(n.TEXTURE_2D,this.boneTexture),n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.boneTextureWidth,c,n.RGBA,n.FLOAT,this.boneArray),n.bindBuffer(n.ARRAY_BUFFER,this.teamColorBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.teamColorArray),n.bindBuffer(n.ARRAY_BUFFER,this.vertexColorBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexColorArray)),e}}class Tc extends iu{convertBasis(t){let e=Math.PI/2;u.rotateZ(t,t,e),u.rotateY(t,t,-e)}}class Ec{constructor(t){let e=t.model,i=e.bones,n=e.boneLookup,r=ru(i.length,Tc).nodes;this.nodes=r,this.instance=t,this.modelNodes=i,this.initialReference=e.initialReference,this.sts=e.sts,this.stc=e.stc,this.stg=e.stg,this.boneLookup=n;for(let e=0,n=i.length;e<n;e++){let n=i[e];-1===n.parent?r[e].parent=t:r[e].parent=r[n.parent],n.billboard1&&(r[e].billboarded=!0)}}update(){let t=this.instance,e=this.nodes,i=this.modelNodes;for(let n=0,r=e.length;n<r;n++){let r=e[n],a=i[n];this.getValue4(r.localRotation,a.rotation,t),this.getValue3(r.localLocation,a.location,t),this.getValue3(r.localScale,a.scale,t),r.recalculateTransformation(),r.updateChildren(t.scene)}}getValueUnsafe(t,e){let i=e.sequence;return-1!==i?this.stg[i].getValueUnsafe(t,e):t.initValue}getValue(t,e){return this.getValueUnsafe(t,e)}getValue2(t,e,i){let n=this.getValueUnsafe(e,i);return t[0]=n[0],t[1]=n[1],t}getValue3(t,e,i){let n=this.getValueUnsafe(e,i);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}getValue4(t,e,i){let n=this.getValueUnsafe(e,i);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}}class Sc extends Hu{constructor(t){super(t),this.skeleton=null,this.teamColor=0,this.vertexColor=new Uint8Array([255,255,255,255]),this.sequence=-1,this.frame=0,this.sequenceLoopMode=0,this.forced=!0}load(){this.skeleton=new Ec(this),-1!==this.sequence&&this.setSequence(this.sequence)}updateTimers(){let t=this.sequence;if(-1!==t){let e=this.model.sequences[t],i=e.interval;this.frame+=this.model.viewer.frameTime,this.frame>i[1]&&((0!==this.sequenceLoopMode||1&e.flags)&&2!==this.sequenceLoopMode?this.frame=i[1]:this.frame=i[0],this.emit("seqend",this))}}updateAnimations(){(this.forced||-1!==this.sequence)&&(this.forced=!1,this.skeleton.update())}setTeamColor(t){return this.teamColor=t,this}setVertexColor(t){return this.vertexColor.set(t),this}setSequence(t){if(this.sequence=t,this.frame=0,this.model.ok){let e=this.model.sequences.length;(t<-1||t>e-1)&&(t=-1,this.sequence=t),this.forced=!0}return this}setSequenceLoopMode(t){return this.sequenceLoopMode=t,this}getAttachment(t){let e=this.model.attachments[t];if(e)return this.skeleton.nodes[e.bone]}}var Mc={vs:`\n    ${qu}\n    ${zu}\n    \n  vec3 TBN(vec3 vector, vec3 tangent, vec3 binormal, vec3 normal) {\n    return vec3(dot(vector, tangent), dot(vector, binormal), dot(vector, normal));\n  }\n\n  vec4 decodeVector(vec4 v) {\n    return ((v / 255.0) * 2.0) - 1.0;\n  }\n\n    uniform mat4 u_mvp;\n    uniform mat4 u_mv;\n    uniform vec3 u_eyePos;\n    uniform vec3 u_lightPos;\n    uniform float u_firstBoneLookupIndex;\n    uniform float u_boneWeightPairsCount;\n    uniform vec3 u_teamColors[14];\n\n    attribute vec3 a_position;\n    attribute vec4 a_normal;\n    attribute vec2 a_uv0;\n\n    #ifdef EXPLICITUV1\n    attribute vec2 a_uv1;\n    #endif\n    #ifdef EXPLICITUV2\n    attribute vec2 a_uv1, a_uv2;\n    #endif\n    #ifdef EXPLICITUV3\n    attribute vec2 a_uv1, a_uv2, a_uv3;\n    #endif\n\n    attribute vec4 a_tangent;\n    attribute vec4 a_bones;\n    attribute vec4 a_weights;\n    attribute float a_teamColor;\n    attribute vec4 a_vertexColor;\n\n    varying vec3 v_normal;\n    varying vec4 v_uv[2]; // Pack 4 vec2 in 2 vec4, to reduce the varyings count\n    varying vec3 v_lightDir;\n    // varying vec3 v_eyeVec;\n    varying vec3 v_halfVec;\n    varying vec3 v_teamColor;\n    varying vec4 v_vertexColor;\n\n    void transform(inout vec3 position, inout vec3 normal, inout vec3 tangent, inout vec3 binormal, vec4 bones, vec4 weights) {\n      if (u_boneWeightPairsCount > 0.0) {\n        mat4 bone;\n\n        if (u_boneWeightPairsCount == 1.0) {\n          bone = fetchMatrix(bones[0], a_InstanceID);\n        } else {\n          bone += fetchMatrix(bones[0], a_InstanceID) * weights[0];\n          bone += fetchMatrix(bones[1], a_InstanceID) * weights[1];\n          bone += fetchMatrix(bones[2], a_InstanceID) * weights[2];\n          bone += fetchMatrix(bones[3], a_InstanceID) * weights[3];\n        }\n\n        position = vec3(bone * vec4(position, 1.0));\n        normal = mat3(bone) * normal;\n        tangent = vec3(bone * vec4(tangent, 0.0));\n        binormal = vec3(bone * vec4(binormal, 0.0));\n      }\n    }\n\n    void main() {\n      vec4 decodedNormal = decodeVector(a_normal);\n\n      vec3 position = a_position;\n      vec3 normal = decodedNormal.xyz;\n      vec3 tangent = vec3(decodeVector(a_tangent));\n      vec3 binormal = cross(normal, tangent) * decodedNormal.w;\n\n      transform(position, normal, tangent, binormal, a_bones + u_firstBoneLookupIndex, a_weights / 255.0);\n\n      vec3 position_mv = vec3(u_mv * vec4(position, 1));\n\n      mat3 mv = mat3(u_mv);\n      vec3 t = normalize(mv * tangent);\n      vec3 b = normalize(mv * binormal);\n      vec3 n = normalize(mv * normal);\n\n      vec3 lightDir = normalize(u_lightPos - position_mv);\n\n      v_lightDir = normalize(TBN(lightDir, t, b, n));\n\n      vec3 eyeVec = normalize(u_eyePos - position_mv);\n      vec3 halfVec = normalize(eyeVec - u_lightPos);\n\n      // v_eyeVec = TBN(eyeVec, t, b, n);\n      v_halfVec = TBN(halfVec, t, b, n);\n\n      v_normal = n;\n\n      vec4 uv0, uv1;\n\n      uv0.xy = a_uv0 / 2048.0;\n\n      #ifdef EXPLICITUV1\n      uv0.zw = a_uv1 / 2048.0;\n      #endif\n\n      #ifdef EXPLICITUV2\n      uv1.xy = a_uv2 / 2048.0;\n      #endif\n\n      #ifdef EXPLICITUV3\n      uv1.zw = a_uv3 / 2048.0;\n      #endif\n\n      v_uv[0] = uv0;\n      v_uv[1] = uv1;\n\n      v_teamColor = u_teamColors[int(a_teamColor)];\n      v_vertexColor = a_vertexColor;\n\n      gl_Position = u_mvp * vec4(position, 1.0);\n    }\n  `,fs:"\n    \n  varying vec3 v_normal;\n  varying vec4 v_uv[2];\n  varying vec3 v_lightDir;\n  // varying vec3 v_eyeVec;\n  varying vec3 v_halfVec;\n  varying vec3 v_teamColor;\n  varying vec4 v_vertexColor;\n\n  struct LayerSettings {\n    bool enabled;\n    float op;\n    float channels;\n    float teamColorMode;\n    // vec3 multAddAlpha;\n    // bool useAlphaFactor;\n    bool invert;\n    // bool multColor;\n    // bool addColor;\n    bool clampResult;\n    // bool useConstantColor;\n    // vec4 constantColor;\n    // float uvSource;\n    float uvCoordinate;\n    // float fresnelMode;\n    // float fresnelTransformMode;\n    // mat4 fresnelTransform;\n    // bool fresnelClamp;\n    // vec3 fresnelExponentBiasScale;\n  };\n\n  #define SPECULAR_RGB 0.0\n  #define SPECULAR_A_ONLY 1.0\n\n  #define FRESNELMODE_NONE 0.0\n  #define FRESNELMODE_STANDARD 1.0\n  #define FRESNELMODE_INVERTED 2.0\n\n  #define FRESNELTRANSFORM_NONE 0.0\n  #define FRESNELTRANSFORM_SIMPLE 1.0\n  #define FRESNELTRANSFORM_NORMALIZED 2.0\n\n  #define UVMAP_EXPLICITUV0 0.0\n  #define UVMAP_EXPLICITUV1 1.0\n  #define UVMAP_REFLECT_CUBICENVIO 2.0\n  #define UVMAP_REFLECT_SPHERICALENVIO 3.0\n  #define UVMAP_PLANARLOCALZ 4.0\n  #define UVMAP_PLANARWORLDZ 5.0\n  #define UVMAP_PARTICLE_FLIPBOOK 6.0\n  #define UVMAP_CUBICENVIO 7.0\n  #define UVMAP_SPHERICALENVIO 8.0\n  #define UVMAP_EXPLICITUV2 9.0\n  #define UVMAP_EXPLICITUV3 10.0\n  #define UVMAP_PLANARLOCALX 11.0\n  #define UVMAP_PLANARLOCALY 12.0\n  #define UVMAP_PLANARWORLDX 13.0\n  #define UVMAP_PLANARWORLDY 14.0\n  #define UVMAP_SCREENSPACE 15.0\n  #define UVMAP_TRIPLANAR_LOCAL 16.0\n  #define UVMAP_TRIPLANAR_WORLD 17.0\n  #define UVMAP_TRIPLANAR_WORLD_LOCAL_Z 18.0\n\n  #define CHANNELSELECT_RGB 0.0\n  #define CHANNELSELECT_RGBA 1.0\n  #define CHANNELSELECT_A 2.0\n  #define CHANNELSELECT_R 3.0\n  #define CHANNELSELECT_G 4.0\n  #define CHANNELSELECT_B 5.0\n\n  #define TEAMCOLOR_NONE 0.0\n  #define TEAMCOLOR_DIFFUSE 1.0\n  #define TEAMCOLOR_EMISSIVE 2.0\n\n  #define LAYEROP_MOD 0.0\n  #define LAYEROP_MOD2X 1.0\n  #define LAYEROP_ADD 2.0\n  #define LAYEROP_LERP 3.0\n  #define LAYEROP_TEAMCOLOR_EMISSIVE_ADD 4.0\n  #define LAYEROP_TEAMCOLOR_DIFFUSE_ADD 5.0\n  #define LAYEROP_ADD_NO_ALPHA 6.0\n\n  // float calculateFresnelTerm(vec3 normal, vec3 eyeToVertex, float exponent, mat4 fresnelTransform, float fresnelTransformMode, bool fresnelClamp) {\n  //   vec3 fresnelDir = eyeToVertex;\n  //   float result;\n\n  //   if (fresnelTransformMode != FRESNELTRANSFORM_NONE) {\n  //     fresnelDir = (fresnelTransform * vec4(fresnelDir, 1.0)).xyz;\n\n  //     if (fresnelTransformMode == FRESNELTRANSFORM_NORMALIZED) {\n  //       fresnelDir = normalize(fresnelDir);\n  //     }\n  //   }\n\n  //   if (fresnelClamp) {\n  //     result = 1.0 - clamp(-dot(normal, fresnelDir), 0.0, 1.0);\n  //   } else {\n  //     result = 1.0 - abs(dot(normal, fresnelDir));\n  //   }\n\n  //   result = max(result, 0.0000001);\n\n  //   return pow(result, exponent);\n  // }\n\n  vec3 combineLayerColor(vec4 color, vec3 result, LayerSettings layerSettings) {\n    if (layerSettings.op == LAYEROP_MOD) {\n      result *= color.rgb;\n    } else if (layerSettings.op == LAYEROP_MOD2X) {\n      result *= color.rgb * 2.0;\n    } else if (layerSettings.op == LAYEROP_ADD) {\n      result += color.rgb * color.a;\n    } else if (layerSettings.op == LAYEROP_ADD_NO_ALPHA) {\n      result += color.rgb;\n    } else if (layerSettings.op == LAYEROP_LERP) {\n      result = mix(result, color.rgb, color.a);\n    } else if (layerSettings.op == LAYEROP_TEAMCOLOR_EMISSIVE_ADD) {\n      result += color.a * v_teamColor;\n    } else if (layerSettings.op == LAYEROP_TEAMCOLOR_DIFFUSE_ADD) {\n      result += color.a * v_teamColor;\n    }\n\n    return result;\n  }\n\n  vec4 chooseChannel(float channel, vec4 texel) {\n    if (channel == CHANNELSELECT_R) {\n      texel = texel.rrrr;\n    } else if (channel == CHANNELSELECT_G) {\n      texel = texel.gggg;\n    } else if (channel == CHANNELSELECT_B) {\n      texel = texel.bbbb;\n    } else if (channel == CHANNELSELECT_A) {\n      texel = texel.aaaa;\n    } else if (channel == CHANNELSELECT_RGB) {\n      texel.a = 1.0;\n    }\n\n    return texel;\n  }\n\n  vec2 getUV(LayerSettings layerSettings) {\n    if (layerSettings.uvCoordinate == 1.0) {\n      return v_uv[0].zw;\n    } else if (layerSettings.uvCoordinate == 2.0) {\n      return v_uv[1].xy;\n    } else if (layerSettings.uvCoordinate == 3.0) {\n      return v_uv[1].zw;\n    }\n\n    return v_uv[0].xy;\n  }\n\n  vec4 sampleLayer(sampler2D layer, LayerSettings layerSettings) {\n    // if (layerSettings.useConstantColor) {\n    //   return layerSettings.constantColor;\n    // }\n\n    return texture2D(layer, getUV(layerSettings));\n  }\n\n  vec4 computeLayerColor(sampler2D layer, LayerSettings layerSettings) {\n    vec4 color = sampleLayer(layer, layerSettings);\n\n    // if (layerSettings.useMask) {\n    //   result *= mask;\n    // }\n\n    vec4 result = chooseChannel(layerSettings.channels, color);\n\n    // if (layerSettings.useAlphaFactor) {\n    //   result.a *= layerSettings.multiplyAddAlpha.z;\n    // }\n\n    if (layerSettings.teamColorMode == TEAMCOLOR_DIFFUSE) {\n      result = vec4(mix(v_teamColor, result.rgb, color.a), 1.0);\n    } else if (layerSettings.teamColorMode == TEAMCOLOR_EMISSIVE) {\n      result = vec4(mix(v_teamColor, result.rgb, color.a), 1.0);\n    }\n\n    if (layerSettings.invert) {\n      result = vec4(1.0) - result;\n    }\n\n    // if (layerSettings.multiplyEnable) {\n    //   result *= layerSettings.multiplyAddAlpha.x;\n    // }\n\n    // if (layerSettings.addEnable) {\n    //   result += layerSettings.multiplyAddAlpha.y;\n    // }\n\n    if (layerSettings.clampResult) {\n      result = clamp(result, 0.0, 1.0);\n    }\n\n    // if (layerSettings.fresnelMode != FRESNELMODE_NONE) {\n    //   float fresnelTerm = calculateFresnelTerm(v_normal, v_eyeVec, layerSettings.fresnelExponentBiasScale.x, layerSettings.fresnelTransform, layerSettings.fresnelTransformMode, layerSettings.fresnelClamp);\n      \n    //   if (layerSettings.fresnelMode == FRESNELMODE_INVERTED) {\n    //     fresnelTerm = 1.0 - fresnelTerm;\n    //   }\n      \n    //   fresnelTerm = clamp(fresnelTerm * layerSettings.fresnelExponentBiasScale.z + layerSettings.fresnelExponentBiasScale.y, 0.0, 1.0);\n      \n    //   result *= fresnelTerm;\n    // }\n\n    return result;\n  }\n\n  vec3 decodeNormal(sampler2D map) {\n    vec4 texel = texture2D(map, v_uv[0].xy);\n    vec3 normal;\n\n    normal.xy = 2.0 * texel.wy - 1.0;\n    normal.z = sqrt(max(0.0, 1.0 - dot(normal.xy, normal.xy)));\n\n    return normal;\n  }\n\n  vec4 computeSpecular(sampler2D specularMap, LayerSettings layerSettings, float specularity, float specMult, vec3 normal) {\n    vec4 color;\n\n    if (layerSettings.enabled) {\n      color = computeLayerColor(specularMap, layerSettings);\n    } else {\n      color = vec4(0);\n    }\n\n    float factor = pow(max(-dot(v_halfVec, normal), 0.0), specularity) * specMult;\n\n    return color * factor;\n  }\n\n    uniform float u_specularity;\n    uniform float u_specMult;\n    uniform float u_emisMult;\n    uniform vec4 u_lightAmbient;\n\n    uniform LayerSettings u_diffuseLayerSettings;\n    uniform sampler2D u_diffuseMap;\n    uniform LayerSettings u_decalLayerSettings;\n    uniform sampler2D u_decalMap;\n    uniform LayerSettings u_specularLayerSettings;\n    uniform sampler2D u_specularMap;\n    uniform LayerSettings u_glossLayerSettings;\n    uniform sampler2D u_glossMap;\n    uniform LayerSettings u_emissiveLayerSettings;\n    uniform sampler2D u_emissiveMap;\n    uniform LayerSettings u_emissive2LayerSettings;\n    uniform sampler2D u_emissive2Map;\n    uniform LayerSettings u_evioLayerSettings;\n    uniform sampler2D u_evioMap;\n    uniform LayerSettings u_evioMaskLayerSettings;\n    uniform sampler2D u_evioMaskMap;\n    uniform LayerSettings u_alphaLayerSettings;\n    uniform sampler2D u_alphaMap;\n    uniform LayerSettings u_alphaMaskLayerSettings;\n    uniform sampler2D u_alphaMaskMap;\n    uniform LayerSettings u_normalLayerSettings;\n    uniform sampler2D u_normalMap;\n    uniform LayerSettings u_heightLayerSettings;\n    uniform sampler2D u_heightMap;\n    uniform LayerSettings u_lightMapLayerSettings;\n    uniform sampler2D u_lightMapMap;\n    uniform LayerSettings u_aoLayerSettings;\n    uniform sampler2D u_aoMap;\n\n    void main() {\n      vec3 color;\n      vec4 final = u_lightAmbient;\n      vec3 normal;\n      vec3 lightMapDiffuse;\n\n      if (u_normalLayerSettings.enabled) {\n        normal = decodeNormal(u_normalMap);\n      } else {\n        normal = v_normal;\n      }\n\n      float lambertFactor = max(dot(normal, v_lightDir), 0.0);\n\n      if (lambertFactor > 0.0) {\n        if (u_diffuseLayerSettings.enabled) {\n          vec4 diffuseColor = computeLayerColor(u_diffuseMap, u_diffuseLayerSettings);\n\n          color = combineLayerColor(diffuseColor, color, u_diffuseLayerSettings);\n        }\n\n        if (u_decalLayerSettings.enabled) {\n          vec4 decalColor = computeLayerColor(u_decalMap, u_decalLayerSettings);\n\n          color = combineLayerColor(decalColor, color, u_decalLayerSettings);\n        }\n\n        vec4 specularColor = computeSpecular(u_specularMap, u_specularLayerSettings, u_specularity, u_specMult, normal);\n\n        if (u_lightMapLayerSettings.enabled) {\n          vec4 lightMapColor = computeLayerColor(u_lightMapMap, u_lightMapLayerSettings) * 2.0;\n\n          lightMapDiffuse = lightMapColor.rgb;\n        }\n\n        // final.rgb = color * lightMapDiffuse + specularColor.rgb;\n        final.rgb = (color + specularColor.rgb) * lambertFactor;\n\n        bool addEmissive = false;\n        vec3 emissiveColor;\n        vec4 tempColor;\n\n        if (u_emissiveLayerSettings.enabled) {\n          tempColor = computeLayerColor(u_emissiveMap, u_emissiveLayerSettings);\n\n          if (u_emissiveLayerSettings.op == LAYEROP_MOD || u_emissiveLayerSettings.op == LAYEROP_MOD2X || u_emissiveLayerSettings.op == LAYEROP_LERP) {\n            final.rgb = combineLayerColor(tempColor, final.rgb, u_emissiveLayerSettings);\n          } else {\n            emissiveColor = combineLayerColor(tempColor, emissiveColor, u_emissiveLayerSettings);\n            addEmissive = true;\n          }\n        }\n\n        if (u_emissive2LayerSettings.enabled) {\n          tempColor = computeLayerColor(u_emissive2Map, u_emissive2LayerSettings);\n\n          if (!addEmissive && (u_emissive2LayerSettings.op == LAYEROP_MOD || u_emissive2LayerSettings.op == LAYEROP_MOD2X || u_emissive2LayerSettings.op == LAYEROP_LERP)) {\n            final.rgb = combineLayerColor(tempColor, final.rgb, u_emissive2LayerSettings);\n          } else {\n            emissiveColor = combineLayerColor(tempColor, emissiveColor, u_emissive2LayerSettings);\n            addEmissive = true;\n          }\n        }\n\n        if (addEmissive) {\n          final.rgb += emissiveColor * u_emisMult;\n        }\n      }\n\n      gl_FragColor = final * v_vertexColor;\n    }\n  "};function Rc(t,e){let i=t.webgl,n=t.gl,r=[[255,3,3],[0,66,255],[28,230,185],[84,0,129],[255,252,1],[254,138,14],[32,192,0],[229,91,176],[149,150,151],[126,191,241],[16,98,70],[78,42,4],[40,40,40],[0,0,0]];i.useShaderProgram(e);for(let t=0;t<14;t++){let i=r[t];n.uniform3fv(e.uniforms["u_teamColors["+t+"]"],[i[0]/255,i[1]/255,i[2]/255])}}var Ic={load(t){t.addHandler(Uu),t.addHandler(Qu);for(let e=0;e<4;e++){let i=t.loadShader(`M3StandardShader${e}`,`#define EXPLICITUV${e}\n${Mc.vs}`,Mc.fs);if(!i.ok)return!1;Rc(t,i)}return!0},extensions:[[".m3","arrayBuffer"]],Constructor:Ac,View:class extends Pu{update(t){let e=super.update(t);if(e){let t=this.model.batches.length,i=e.buckets,n=0,r=0,a=0;for(let s=0,o=e.usedBuckets;s<o;s++)n+=i[s].count,r+=1,a+=t;this.renderedInstances=n,this.renderedBuckets=r,this.renderCalls=a}}},Bucket:xc,Instance:Sc,lightPosition:new Float32Array([0,0,1e4])},Bc={handler:Ic,Model:Ac,ModelInstance:Sc,Bucket:xc};const Cc=t=>(class{constructor(t,e,i,n,r){let a=t.defval;this.sd=t,this.start=e,this.end=i,this.keyframes=[],r&&n[0].frame>i&&this.keyframes.push(n[0]);for(let t=0,r=n.length;t<r;t++){let r=n[t],a=r.frame;a>=e&&a<=i&&this.keyframes.push(r)}let s=this.keyframes.length;if(0===s)this.constant=!0,this.keyframes.push({frame:e,value:a,inTan:a,outTan:a});else if(1===s)this.constant=!0;else{let t=!0,n=this.keyframes[0].value;for(let e=1,i=this.keyframes.length;e<i;e++){let i=this.keyframes[e].value;if(i.length>0){for(let e=0,r=i.length;e<r;e++)if(n[e]!==i[e]){t=!1;break}}else if(i!==n){t=!1;break}}t?this.constant=!0:(this.constant=!1,this.keyframes[0].frame!==e&&this.keyframes.unshift({frame:e,value:a,inTan:a,outTan:a}),this.keyframes[this.keyframes.length-1].frame!==i&&this.keyframes.push({frame:i,value:this.keyframes[0].value,inTan:this.keyframes[0].outTan,outTan:this.keyframes[0].inTan}))}}getValue(e,i){let n=this.keyframes,r=this.getKeyframe(i),a=n.length;if(-1===r)return e.set(n[0].value),0;if(r===a)return e.set(n[a-1].value),a-1;{let a=n[r-1],s=n[r],o=us((i-a.frame)/(s.frame-a.frame),0,1);return t(e,a.value,a.outTan,s.inTan,s.value,o,this.sd.interpolationType),r}}getKeyframe(t){if(this.constant)return-1;{let e=this.keyframes,i=e.length;if(t<this.start)return-1;if(t>=this.end)return i;for(let n=1;n<i;n++){if(e[n].frame>t)return n}}}}),Lc={KLAV:0,KATV:0,KPEV:0,KP2V:0,KRVS:0},Uc={KMTF:[0],KMTA:[1],KTAT:[0,0,0],KTAR:[0,0,0,1],KTAS:[1,1,1],KGAO:[1],KGAC:[0,0,0],KLAS:[0],KLAE:[0],KLAC:[0,0,0],KLAI:[0],KLBI:[0],KLBC:[0,0,0],KLAV:[1],KATV:[1],KPEE:[0],KPEG:[0],KPLN:[0],KPLT:[0],KPEL:[0],KPES:[0],KPEV:[1],KP2S:[0],KP2R:[0],KP2L:[0],KP2G:[0],KP2E:[0],KP2N:[0],KP2W:[0],KP2V:[1],KRHA:[0],KRHB:[0],KRAL:[1],KRCO:[0,0,0],KRTX:[0],KRVS:[1],KCTR:[0,0,0],KTTR:[0,0,0],KCRL:[0],KGTR:[0,0,0],KGRT:[0,0,0,1],KGSC:[1,1,1]},kc=t=>(class{constructor(e,i){let n=e.globalSequences,r=i.globalSequenceId,a=i.tracks,s=Lc[i.name];if(this.model=e,this.name=i.name,this.defval=Uc[i.name],this.globalSequence=null,this.sequences=[],this.interpolationType=void 0!==s?s:i.interpolationType,-1!==r&&n)this.globalSequence=new t(this,0,n[r],a,!0);else for(let i of e.sequences)this.sequences.push(new t(this,...i.interval,a,!1))}getValue(t,e){return this.globalSequence?this.globalSequence.getValue(t,e.counter%this.globalSequence.end):-1!==e.sequence?this.sequences[e.sequence].getValue(t,e.frame):(t.set(this.defval),-1)}isVariant(t){return this.globalSequence?!this.globalSequence.constant:!this.sequences[t].constant}getValues(){if(this.globalSequence)return this.globalSequence.keyframes.map(t=>t.value);{let t=[];for(let e of this.sequences)t.push(...e.keyframes.map(t=>t.value));return t}}}),Fc=kc(Cc(sc)),Pc=kc(Cc(oc)),Dc=kc(Cc(lc));function Oc(t,e){let i;return e instanceof Mo||e instanceof Ro?i=Fc:e instanceof Io?i=Pc:e instanceof Bo&&(i=Dc),new i(t,e)}class Nc{constructor(t,e){this.model=t,this.animations={};for(let i of e.animations)this.animations[i.name]=Oc(t,i)}getValues(t){let e=this.animations[t];return e?e.getValues():[]}getUintValue(t,e,i,n){let r=this.animations[e];return r?r.getValue(t,i):(t[0]=n,-1)}getFloatValue(t,e,i,n){let r=this.animations[e];return r?r.getValue(t,i):(t[0]=n,-1)}getVector3Value(t,e,i,n){let r=this.animations[e];return r?r.getValue(t,i):(l.copy(t,n),-1)}getVector4Value(t,e,i,n){let r=this.animations[e];return r?r.getValue(t,i):(u.copy(t,n),-1)}isVariant(t,e){let i=this.animations[t];return!!i&&i.isVariant(e)}}class Vc extends Nc{getTranslation(t,e){return this.getVector3Value(t,"KTAT",e,Wa)}getRotation(t,e){return this.getVector4Value(t,"KTAR",e,Ja)}getScale(t,e){return this.getVector3Value(t,"KTAS",e,Ya)}isTranslationVariant(t){return this.isVariant("KTAT",t)}isRotationVariant(t){return this.isVariant("KTAR",t)}isScaleVariant(t){return this.isVariant("KTAS",t)}}function Gc(t){return t.reverse().filter((t,e,i)=>-1===i.indexOf(t,e+1)).reverse()}function jc(t,e){return 0===t?[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]:1===t?[e.SRC_ALPHA,e.ONE]:2===t?[e.ZERO,e.SRC_COLOR]:3===t?[e.DEST_COLOR,e.SRC_COLOR]:4===t?[e.SRC_ALPHA,e.ONE]:void 0}class Hc extends Nc{constructor(t,e,i,n){let r=e.filterMode,a=e.textureAnimationId,s=t.viewer.gl;super(t,e),this.index=i,this.priorityPlane=n,this.filterMode=r,this.textureId=e.textureId,this.coordId=e.coordId,this.alpha=e.alpha;let o=e.flags;if(this.unshaded=1&o,this.sphereEnvironmentMap=2&o,this.twoSided=16&o,this.unfogged=32&o,this.noDepthTest=64&o,this.noDepthSet=128&o,this.depthMaskValue=0===r||1===r?1:0,this.alphaTestValue=1===r?1:0,this.blendSrc=0,this.blendDst=0,this.blended=r>1,this.blended&&([this.blendSrc,this.blendDst]=function(t,e){return 2===t?[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]:3===t?[e.ONE,e.ONE]:4===t?[e.SRC_ALPHA,e.ONE]:5===t?[e.ZERO,e.SRC_COLOR]:6===t?[e.DST_COLOR,e.SRC_COLOR]:[0,0]}(r,s)),this.uvDivisor=new Float32Array([1,1]),-1!==a){let e=t.textureAnimations[a];e&&(this.textureAnimation=e)}let l={alpha:[],slot:[],translation:[],rotation:[],scale:[]},h=!1,u=!1,c=!1,d=!1;for(let e=0,i=t.sequences.length;e<i;e++){let t=this.isAlphaVariant(e),i=this.isTextureIdVariant(e),n=this.isTranslationVariant(e),r=this.isRotationVariant(e),a=this.isScaleVariant(e);l.alpha[e]=t,l.slot[e]=i,l.translation[e]=n,l.rotation[e]=r,l.scale[e]=a,h=h||i,u=u||n,c=c||r,d=d||a}if(this.variants=l,this.hasSlotAnim=h,this.hasTranslationAnim=u,this.hasRotationAnim=c,this.hasScaleAnim=d,this.animations.KMTF){let e=Gc(this.animations.KMTF.getValues());if(e.length>1){let i=Dh(e.join("")),n=[];for(let i=0,r=e.length;i<r;i++)n[i]=t.textures[e[i]];let r=t.viewer.loadTextureAtlas(i,n);r.texture.whenLoaded().then(()=>{let e=r.texture;e.wrapS=!0,e.wrapT=!0,t.textures.push(e),this.textureId=t.textures.length-1,this.uvDivisor.set([r.columns,r.rows])})}}}bind(t){let e=this.model.viewer.gl;e.uniform1f(t.uniforms.u_alphaTest,this.alphaTestValue),this.blended?(e.enable(e.BLEND),e.blendFunc(this.blendSrc,this.blendDst)):e.disable(e.BLEND),this.twoSided?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),this.noDepthTest?e.disable(e.DEPTH_TEST):e.enable(e.DEPTH_TEST),this.noDepthSet?e.depthMask(0):e.depthMask(this.depthMaskValue)}getAlpha(t,e){return this.getFloatValue(t,"KMTA",e,this.alpha)}getTextureId(t,e){return this.getUintValue(t,"KMTF",e,this.textureId)}getTranslation(t,e){return this.textureAnimation?this.textureAnimation.getTranslation(t,e):(l.copy(t,Wa),-1)}getRotation(t,e){return this.textureAnimation?this.textureAnimation.getRotation(t,e):(u.copy(t,Ja),-1)}getScale(t,e){return this.textureAnimation?this.textureAnimation.getScale(t,e):(l.copy(t,Ya),-1)}isAlphaVariant(t){return this.isVariant("KMTA",t)}isTextureIdVariant(t){return this.isVariant("KMTF",t)}isTranslationVariant(t){return this.textureAnimation&&this.textureAnimation.isTranslationVariant(t)}isRotationVariant(t){return this.textureAnimation&&this.textureAnimation.isRotationVariant(t)}isScaleVariant(t){return this.textureAnimation&&this.textureAnimation.isScaleVariant(t)}}class $c extends Nc{constructor(t,e){super(t,e),this.alpha=e.alpha,this.color=[...e.color].reverse(),this.geosetId=e.geosetId}getAlpha(t,e){return this.getFloatValue(t,"KGAO",e,1)}getColor(t,e){return this.getVector3Value(t,"KGAC",e,this.color)}isAlphaVariant(t){return this.isVariant("KGAO",t)}isColorVariant(t){return this.isVariant("KGAC",t)}}class qc{constructor(t,e,i,n){this.model=t,this.offsets=e,this.uvSetSize=i,this.elements=n}bind(t,e){let i=this.model.viewer.gl,n=this.offsets,r=t.attribs;i.vertexAttribPointer(r.a_position,3,i.FLOAT,!1,12,n[0]),i.vertexAttribPointer(r.a_normal,3,i.FLOAT,!1,12,n[1]),i.vertexAttribPointer(r.a_uv,2,i.FLOAT,!1,8,n[2]+e*this.uvSetSize),i.vertexAttribPointer(r.a_bones,4,i.UNSIGNED_BYTE,!1,4,n[3]),i.vertexAttribPointer(r.a_boneNumber,1,i.UNSIGNED_BYTE,!1,4,n[4])}render(t){let e=this.model.viewer.gl;e.extensions.instancedArrays.drawElementsInstancedANGLE(e.TRIANGLES,this.elements,e.UNSIGNED_SHORT,this.offsets[5],t)}}class zc{constructor(t,e,i){let n,r=e.vertices,a=e.normals,s=e.uvSets,o=s[0].length,l=r.length/3,h=new Uint8Array(4*l),u=new Uint32Array(l),c=e.vertexGroups,d=e.matrixGroups,f=e.matrixIndices,m=[];if(s.length>1){n=new Float32Array(s.length*o);for(let t=0,e=s.length;t<e;t++)n.set(s[t],t*o)}else n=s[0];for(let t=0,e=d.length,i=0;t<e;t++)m.push(f.subarray(i,i+d[t])),i+=d[t];for(let t=0;t<l;t++){if(m[c[t]]){let e=m[c[t]],i=Math.min(e.length,4);for(let n=0;n<i;n++)h[4*t+n]=e[n]+1;u[t]=i}}this.index=i,this.materialId=e.materialId,this.locationArray=r,this.normalArray=a,this.uvsArray=n,this.boneIndexArray=h,this.boneNumberArray=u,this.faceArray=e.faces,this.uvSetSize=4*o;let g=t.geosetAnimations;for(let t=0,e=g.length;t<e;t++)g[t].geosetId===i&&(this.geosetAnimation=g[t]);let p={alpha:[],color:[]},v=!1;for(let e=0,i=t.sequences.length;e<i;e++){let t=this.isAlphaVariant(e),i=this.isColorVariant(e);(t||i)&&(v=!0),p.alpha[e]=t,p.color[e]=i}this.variants=p,this.hasAnim=v}getAlpha(t,e){return this.geosetAnimation?this.geosetAnimation.getAlpha(t,e):(t[0]=1,-1)}getColor(t,e){return this.geosetAnimation?this.geosetAnimation.getColor(t,e):(l.copy(t,Ya),-1)}isAlphaVariant(t){return this.geosetAnimation&&this.geosetAnimation.isAlphaVariant(t)}isColorVariant(t){return this.geosetAnimation&&this.geosetAnimation.isColorVariant(t)}}class Kc{constructor(t,e,i){this.index=t,this.layer=e,this.geoset=i}}var Wc={1:"TeamColor/TeamColor00",2:"TeamGlow/TeamGlow00",11:"Cliff/Cliff0",21:"",31:"LordaeronTree/LordaeronSummerTree",32:"AshenvaleTree/AshenTree",33:"BarrensTree/BarrensTree",34:"NorthrendTree/NorthTree",35:"Mushroom/MushroomTree",36:"RuinsTree/RuinsTree",37:"OutlandMushroomTree/MushroomTree"};class Yc extends Nc{constructor(t,e,i){super(t,e),this.index=i,this.name=e.name,this.objectId=e.objectId,this.parentId=e.parentId,this.pivot=t.pivotPoints[e.objectId]||l.create();let n=e.flags;this.dontInheritTranslation=1&n,this.dontInheritRotation=2&n,this.dontInheritScaling=4&n,this.billboarded=8&n,this.billboardedX=16&n,this.billboardedY=32&n,this.billboardedZ=64&n,this.cameraAnchored=128&n,this.bone=256&n,this.light=512&n,this.eventObject=1024&n,this.attachment=2048&n,this.particleEmitter=4096&n,this.collisionShape=8192&n,this.ribbonEmitter=16384&n,this.emitterUsesMdlOrUnshaded=32768&n,this.emitterUsesTgaOrSortPrimitivesFarZ=65536&n,this.lineEmitter=131072&n,this.unfogged=262144&n,this.modelSpace=524288&n,this.xYQuad=1048576&n,this.anyBillboarding=this.billboarded||this.billboardedX||this.billboardedY||this.billboardedZ,e.objectId===e.parentId&&(this.parentId=-1);let r={translation:[],rotation:[],scale:[],generic:[]};for(let e=0,i=t.sequences.length;e<i;e++){let t=this.isTranslationVariant(e),i=this.isRotationVariant(e),n=this.isScaleVariant(e);r.translation[e]=t,r.rotation[e]=i,r.scale[e]=n,r.generic[e]=t||i||n}this.variants=r}getVisibility(t,e){return t[0]=1,-1}getTranslation(t,e){return this.getVector3Value(t,"KGTR",e,Wa)}getRotation(t,e){return this.getVector4Value(t,"KGRT",e,Ja)}getScale(t,e){return this.getVector3Value(t,"KGSC",e,Ya)}isTranslationVariant(t){return this.isVariant("KGTR",t)}isRotationVariant(t){return this.isVariant("KGRT",t)}isScaleVariant(t){return this.isVariant("KGSC",t)}}class Xc extends Yc{constructor(t,e,i){super(t,e,i),this.geosetAnimation=t.geosetAnimations[e.geosetAnimationId]}getVisibility(t,e){return this.geosetAnimation?this.geosetAnimation.getAlpha(t,e):(t[0]=1,-1)}}class Jc extends Yc{constructor(t,e,i){super(t,e,i),this.type=e.type,this.attenuation=e.attenuation,this.color=e.color,this.intensity=e.intensity,this.ambientColor=e.ambientColor,this.ambientIntensity=e.ambientIntensity}getAttenuationStart(t,e){return this.getFloatValue(t,"KLAS",e,this.attenuation[0])}getAttenuationEnd(t,e){return this.getFloatValue(t,"KLAE",e,this.attenuation[1])}getIntensity(t,e){return this.getFloatValue(t,"KLAI",e,this.intensity)}getColor(t,e){return this.getVector3Value(t,"KLAC",e,this.color)}getAmbientIntensity(t,e){return this.getFloatValue(t,"KLBI",e,this.ambientIntensity)}getAmbientColor(t,e){return this.getVector3Value(t,"KLBC",e,this.ambientColor)}}class Zc extends Yc{}class Qc extends Yc{constructor(t,e,i){super(t,e,i);let n=e.path.replace(/\\/g,"/").toLowerCase().replace(".mdl",".mdx");this.path=n,this.attachmentId=e.attachmentId,""!==n&&-1!=n.indexOf(".mdx")&&(this.internalModel=t.viewer.load(n,t.pathSolver))}getVisibility(t,e){return this.getFloatValue(t,"KATV",e,1)}}class td extends Yc{constructor(t,e,i){super(t,e,i),this.internalResource=t.viewer.load(e.path.replace(/\\/g,"/").toLowerCase().replace(".mdl",".mdx"),t.pathSolver),this.speed=e.speed,this.latitude=e.latitude,this.longitude=e.longitude,this.lifeSpan=e.lifeSpan,this.gravity=e.gravity,this.emissionRate=e.emissionRate}getSpeed(t,e){return this.getFloatValue(t,"KPES",e,this.speed)}getLatitude(t,e){return this.getFloatValue(t,"KPLTV",e,this.latitude)}getLongitude(t,e){return this.getFloatValue(t,"KPLN",e,this.longitude)}getLifeSpan(t,e){return this.getFloatValue(t,"KPEL",e,this.lifeSpan)}getGravity(t,e){return this.getFloatValue(t,"KPEG",e,this.gravity)}getEmissionRate(t,e){return this.getFloatValue(t,"KPEE",e,this.emissionRate)}getVisibility(t,e){return this.getFloatValue(t,"KPEV",e,1)}}class ed extends Yc{constructor(t,e,i){super(t,e,i),this.width=e.width,this.length=e.length,this.speed=e.speed,this.latitude=e.latitude,this.gravity=e.gravity,this.emissionRate=e.emissionRate,this.squirt=e.squirt,this.lifeSpan=e.lifeSpan,this.variation=e.variation,this.tailLength=e.tailLength,this.timeMiddle=e.timeMiddle;let n=e.replaceableId;this.dimensions=[e.columns,e.rows],this.teamColored=!1,0===n?this.internalResource=t.textures[e.textureId]:1===n?(this.internalResource=t.viewer.getTextureAtlas("teamColors"),this.dimensions.fill(4),this.teamColored=!0):2===n?(this.internalResource=t.viewer.getTextureAtlas("teamGlows"),this.dimensions.fill(4),this.teamColored=!0):this.internalResource=t.viewer.load("ReplaceableTextures\\"+Wc[n]+".blp",t.pathSolver),this.replaceableId=e.replaceableId;let r=e.headOrTail;this.head=0===r||2===r,this.tail=1===r||2===r,this.cellWidth=1/e.columns,this.cellHeight=1/e.rows,this.colors=[];let a=e.segmentColors,s=e.segmentAlphas;for(let t=0;t<3;t++)this.colors[t]=new Uint8Array([255*Math.min(a[t][0],1),255*Math.min(a[t][1],1),255*Math.min(a[t][2],1),s[t]]);this.scaling=e.segmentScaling,this.intervals=[...e.headIntervals,...e.tailIntervals],this.lineEmitter=131072&e.flags,this.modelSpace=524288&e.flags,this.xYQuad=1048576&e.flags,[this.blendSrc,this.blendDst]=jc(e.filterMode,this.model.viewer.gl),this.priorityPlane=e.priorityPlane}getWidth(t,e){return this.getFloatValue(t,"KP2W",e,this.width)}getLength(t,e){return this.getFloatValue(t,"KP2N",e,this.length)}getSpeed(t,e){return this.getFloatValue(t,"KP2S",e,this.speed)}getLatitude(t,e){return this.getFloatValue(t,"KP2L",e,this.latitude)}getGravity(t,e){return this.getFloatValue(t,"KP2G",e,this.gravity)}getEmissionRate(t,e){return this.getFloatValue(t,"KP2E",e,this.emissionRate)}getVisibility(t,e){return this.getFloatValue(t,"KP2V",e,1)}getVariation(t,e){return this.getFloatValue(t,"KP2R",e,this.variation)}}class id extends Yc{constructor(t,e,i){super(t,e,i),this.layer=t.materials[e.materialId][0],this.texture=t.textures[this.layer.textureId],this.heightAbove=e.heightAbove,this.heightBelow=e.heightBelow,this.alpha=e.alpha,this.color=e.color,this.lifeSpan=e.lifeSpan,this.textureSlot=e.textureSlot,this.emissionRate=e.emissionRate,this.gravity=e.gravity,this.dimensions=[e.columns,e.rows],this.cellWidth=1/e.columns,this.cellHeight=1/e.rows}getHeightBelow(t,e){return this.getFloatValue(t,"KRHB",e,this.heightBelow)}getHeightAbove(t,e){return this.getFloatValue(t,"KRHA",e,this.heightAbove)}getTextureSlot(t,e){return this.getUintValue(t,"KRTX",e,0)}getColor(t,e){return this.getVector3Value(t,"KRCO",e,this.color)}getAlpha(t,e){return this.getFloatValue(t,"KRAL",e,this.alpha)}getVisibility(t,e){return this.getFloatValue(t,"KRVS",e,1)}}class nd extends Yc{constructor(t,e,i){super(t,e,i),this.name=e.name,this.position=e.position,this.fieldOfView=e.fieldOfView,this.farClippingPlane=e.farClippingPlane,this.nearClippingPlane=e.nearClippingPlane,this.targetPosition=e.targetPosition}getPositionTranslation(t,e){return this.getVector3Value(t,"KCTR",e,this.position)}getTargetTranslation(t,e){return this.getVector3Value(t,"KTTR",e,this.targetPosition)}getRotation(t,e){return this.getUintValue(t,"KCRL",e,0)}}var rd=i(3);let ad=new OfflineAudioContext(1,1,48e3);let sd=t=>new rd.a(t),od=t=>(function(t){return ad.decodeAudioData(t)})(t);class ld extends Yc{constructor(t,e,i){super(t,e,i);let n=t.viewer,r=e.name,a=r.substring(0,3),s=r.substring(4);"FPT"===a&&(a="SPL"),this.ok=!1,this.type=a,this.id=s,this.internalResource=null,this.decodedBuffers=[],this.tracks=e.tracks,this.ok=!1,this.globalSequence=null,this.defval=d.create();let o=e.globalSequenceId;-1!==o&&(this.globalSequence=t.globalSequences[o]);let l=[],h=t.pathSolver;if("SPN"===a)l[0]=n.loadGeneric(h("Splats\\SpawnData.slk")[0],"text",sd);else if("SPL"===a)l[0]=n.loadGeneric(h("Splats\\SplatData.slk")[0],"text",sd);else if("UBR"===a)l[0]=n.loadGeneric(h("Splats\\UberSplatData.slk")[0],"text",sd);else{if("SND"!==a)return;l[0]=n.loadGeneric(h("UI\\SoundInfo\\AnimLookups.slk")[0],"text",sd),l[1]=n.loadGeneric(h("UI\\SoundInfo\\AnimSounds.slk")[0],"text",sd)}let u=n.promise();n.whenLoaded(l).then(t=>{this.load(t),u.resolve()})}load(t){if(!t[0].ok)return;let e=this.type,i=this.model,n=i.viewer,r=i.pathSolver,a=t[0].data.getRow(this.id);if(a){if("SPN"===e)this.internalResource=n.load(a.Model.replace(".mdl",".mdx"),r);else if("SPL"===e||"UBR"===e)this.internalResource=n.load("replaceabletextures/splats/"+a.file+".blp",r),this.colors=[[a.StartR,a.StartG,a.StartB,a.StartA],[a.MiddleR,a.MiddleG,a.MiddleB,a.MiddleA],[a.EndR,a.EndG,a.EndB,a.EndA]],this.scale=a.Scale,"SPL"===e?(this.dimensions=[a.Columns,a.Rows],this.intervals=[[a.UVLifespanStart,a.UVLifespanEnd,a.LifespanRepeat],[a.UVDecayStart,a.UVDecayEnd,a.DecayRepeat]],this.intervalTimes=[a.Lifespan,a.Decay],this.lifespan=a.Lifespan+a.Decay):(this.dimensions=[1,1],this.intervalTimes=[a.BirthTime,a.PauseTime,a.Decay],this.lifespan=a.BirthTime+a.PauseTime+a.Decay),[this.blendSrc,this.blendDst]=jc(a.BlendMode,n.gl);else if("SND"===e&&n.enableAudio){if(!t[1].ok)return;if(a=t[1].data.getRow(a.SoundLabel)){this.distanceCutoff=a.DistanceCutoff,this.maxDistance=a.MaxDistance,this.minDistance=a.MinDistance,this.pitch=a.Pitch,this.pitchVariance=a.PitchVariance,this.volume=a.Volume;let t=a.FileNames.split(",");n.whenLoaded(t.map(t=>n.loadGeneric(r(a.DirectoryBase+t)[0],"arrayBuffer",od))).then(t=>{for(let e of t)this.decodedBuffers.push(e.data);this.ok=!0})}}this.internalResource&&this.internalResource.whenLoaded().then(()=>this.ok=!0)}else console.warn("Unknown event object ID",e,this.id)}getValue(t,e){if(this.globalSequence){let i=this.globalSequence;return this.getValueAtTime(t,e.counter%i,0,i)}if(-1!==e.sequence){let i=this.model.sequences[e.sequence].interval;return this.getValueAtTime(t,e.frame,i[0],i[1])}{let e=this.defval;return t[0]=e[0],t[1]=e[1],t}}getValueAtTime(t,e,i,n){let r=this.tracks;if(e<i||e>n)return t[0]=0,t[1]=0,t;for(let n=r.length-1;n>-1;n--){if(r[n]<i)return t[0]=0,t[1]=n,t;if(r[n]<=e)return t[0]=1,t[1]=n,t}return t[0]=0,t[1]=0,t}}class hd extends Yc{}class ud extends Ou{constructor(t){super(t),this.parser=null,this.name="",this.extent=null,this.bounds=null,this.sequences=[],this.globalSequences=[],this.materials=[],this.layers=[],this.textures=[],this.textureAnimations=[],this.geosets=[],this.geosetAnimations=[],this.bones=[],this.lights=[],this.helpers=[],this.attachments=[],this.pivotPoints=[],this.particleEmitters=[],this.particleEmitters2=[],this.ribbonEmitters=[],this.cameras=[],this.eventObjects=[],this.collisionShapes=[],this.hasLayerAnims=!1,this.hasGeosetAnims=!1,this.batches=[],this.opaqueBatches=[],this.translucentBatches=[],this.genericObjects=[],this.sortedGenericObjects=[],this.hierarchy=[],this.replaceables=[]}load(t){let e=new Qo;e.load(t),this.parser=e,this.name=e.name;let i=e.extent;this.bounds=$s(i.min,i.max),this.extent=i;for(let t of e.sequences)this.sequences.push(t);for(let t of e.globalSequences)this.globalSequences.push(t);let n=!1;for(let t of e.textures){let e=t.path,i=t.replaceableId,r=t.flags;if(0!==i&&(e=`ReplaceableTextures\\${Wc[i]}.blp`,1!==i&&2!==i||(n=!0)),!e.endsWith(".blp")&&!e.endsWith(".tga")){let t=e.indexOf(".blp");-1===t&&(t=e.indexOf(".tga")),-1!==t&&(e=e.slice(0,t+4))}this.replaceables.push(i);let a=this.viewer.load(e,this.pathSolver);a.wrapS=!!(1&r),a.wrapT=!!(2&r),this.textures.push(a)}n&&this.loadTeamTextures();for(let t of e.textureAnimations)this.textureAnimations.push(new Vc(this,t));let r=0;for(let t of e.materials){let e=[];for(let i of t.layers){let n=new Hc(this,i,r++,t.priorityPlane);e.push(n),this.layers.push(n),n.hasAnim&&(this.hasLayerAnims=!0)}this.materials.push(e)}for(let t of e.geosetAnimations)this.geosetAnimations.push(new $c(this,t));if(e.geosets.length){let t=0,i=0,n=[],r=[];for(let a of e.geosets){let e=new zc(this,a,t++);e.hasAnim&&(this.hasGeosetAnims=!0),this.geosets.push(e);for(let t of this.materials[a.materialId]){let a=new Kc(i++,t,e);t.filterMode<2?n.push(a):r.push(a)}}r.sort((t,e)=>t.layer.priorityPlane-e.layer.priorityPlane),this.opaqueBatches.push(...n),this.translucentBatches.push(...r),this.batches.push(...n,...r),this.setupGeosets()}this.pivotPoints=e.pivotPoints;let a=0;for(let t of e.bones)this.bones.push(new Xc(this,t,a++));for(let t of e.lights)this.lights.push(new Jc(this,t,a++));for(let t of e.helpers)this.helpers.push(new Zc(this,t,a++));for(let t of e.attachments)this.attachments.push(new Qc(this,t,a++));for(let t of e.particleEmitters)this.particleEmitters.push(new td(this,t,a++));for(let t of e.particleEmitters2)this.particleEmitters2.push(new ed(this,t,a++));this.particleEmitters2.sort((t,e)=>t.priorityPlane-e.priorityPlane);for(let t of e.ribbonEmitters)this.ribbonEmitters.push(new id(this,t,a++));for(let t of e.cameras)this.cameras.push(new nd(this,t,a++));for(let t of e.eventObjects)this.eventObjects.push(new ld(this,t,a++));for(let t of e.collisionShapes)this.collisionShapes.push(new hd(this,t,a++));this.genericObjects.push(...this.bones,...this.lights,...this.helpers,...this.attachments,...this.particleEmitters,...this.particleEmitters2,...this.ribbonEmitters,...this.cameras,...this.eventObjects,...this.collisionShapes),this.setupHierarchy(-1);for(let t=0,e=this.genericObjects.length;t<e;t++)this.sortedGenericObjects[t]=this.genericObjects[this.hierarchy[t]];this.setupVariants()}loadTeamTextures(){let t=this.viewer;if(!t.getTextureAtlas("teamColors")){let e=this.pathSolver,i=[],n=[];for(let r=0;r<14;r++){let a=(""+r).padStart(2,"0");i[r]=t.load(`ReplaceableTextures\\TeamColor\\TeamColor${a}.blp`,e),n[r]=t.load(`ReplaceableTextures\\TeamGlow\\TeamGlow${a}.blp`,e)}t.loadTextureAtlas("teamColors",i),t.loadTextureAtlas("teamGlows",n)}}isVariant(t){let e=this.genericObjects;for(let i=0,n=e.length;i<n;i++)if(e[i].variants.generic[t])return!0;return!1}setupVariants(){let t=[];for(let e=0,i=this.sequences.length;e<i;e++)t[e]=this.isVariant(e);this.variants=t}setupGeosets(){let t=this.geosets;if(t.length>0){let e=this.viewer.gl,i=[],n=[],r=0,a=[],s=0;for(let e=0,o=t.length;e<o;e++){let o=t[e],l=o.locationArray,h=o.normalArray,u=o.uvsArray,c=o.boneIndexArray,d=o.boneNumberArray,f=o.faceArray,m=r,g=m+l.byteLength,p=g+h.byteLength,v=p+u.byteLength,b=v+c.byteLength;i[e]=new qc(this,[m,g,p,v,b,s],o.uvSetSize,f.length),n.push([m,l]),n.push([g,h]),n.push([p,u]),n.push([v,c]),n.push([b,d]),a.push([s,f]),r=b+d.byteLength,s+=f.byteLength}let o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);for(let t=0,i=n.length;t<i;t++)e.bufferSubData(e.ARRAY_BUFFER,n[t][0],n[t][1]);let l=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l),e.bufferData(e.ELEMENT_ARRAY_BUFFER,s,e.STATIC_DRAW);for(let t=0,i=a.length;t<i;t++)e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,a[t][0],a[t][1]);this.__webglArrayBuffer=o,this.__webglElementBuffer=l,this.shallowGeosets=i}}setupHierarchy(t){for(let e=0,i=this.genericObjects.length;e<i;e++){let i=this.genericObjects[e];i.parentId===t&&(this.hierarchy.push(e),this.setupHierarchy(i.objectId))}}bind(t,e){const i=this.viewer.webgl;let n=this.viewer.gl,r=this.viewer.shaderMap.get("MdxStandardShader");i.useShaderProgram(r),this.shader=r;const a=n.extensions.instancedArrays,s=r.attribs,o=r.uniforms;n.uniformMatrix4fv(o.u_mvp,!1,e.camera.worldProjectionMatrix),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.__webglElementBuffer),n.uniform1i(o.u_texture,0);let l=s.a_teamColor,h=s.a_vertexColor;n.bindBuffer(n.ARRAY_BUFFER,t.colorBuffer),n.vertexAttribPointer(l,1,n.UNSIGNED_BYTE,!1,5,0),n.vertexAttribPointer(h,4,n.UNSIGNED_BYTE,!0,5,1),n.activeTexture(n.TEXTURE15),n.bindTexture(n.TEXTURE_2D,t.boneTexture),n.uniform1i(o.u_boneMap,15),n.uniform1f(o.u_vectorSize,t.vectorSize),n.uniform1f(o.u_rowSize,t.rowSize);let u=s.a_InstanceID;n.bindBuffer(n.ARRAY_BUFFER,t.instanceIdBuffer),n.vertexAttribPointer(u,1,n.UNSIGNED_SHORT,!1,0,0),a.vertexAttribDivisorANGLE(l,1),a.vertexAttribDivisorANGLE(h,1),a.vertexAttribDivisorANGLE(u,1)}unbind(){let t=this.viewer.gl,e=t.extensions.instancedArrays,i=this.shader.attribs;t.depthMask(1),t.disable(t.BLEND),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),e.vertexAttribDivisorANGLE(i.a_teamColor,0),e.vertexAttribDivisorANGLE(i.a_vertexColor,0),e.vertexAttribDivisorANGLE(i.a_InstanceID,0),e.vertexAttribDivisorANGLE(i.a_geosetColor,0),e.vertexAttribDivisorANGLE(i.a_layerAlpha,0),e.vertexAttribDivisorANGLE(i.uvTransRot,0),e.vertexAttribDivisorANGLE(i.uvScaleSprite,0)}renderBatch(t,e){let i,n=this.viewer.gl,r=n.extensions.instancedArrays,a=this.shader,s=this.shader.attribs,o=a.uniforms,l=e.geoset,h=e.layer,u=this.shallowGeosets[l.index],c=this.replaceables[h.textureId];h.bind(a);let d=!1;1===c?(i=this.viewer.getTextureAtlas("teamColors"),d=!0):2===c?(i=this.viewer.getTextureAtlas("teamGlows"),d=!0):i=this.textures[h.textureId],n.uniform1f(o.u_isTeamColor,d),n.uniform1f(o.u_hasSlotAnim,h.hasSlotAnim),n.uniform1f(o.u_hasTranslationAnim,h.hasTranslationAnim),n.uniform1f(o.u_hasRotationAnim,h.hasRotationAnim),n.uniform1f(o.u_hasScaleAnim,h.hasScaleAnim),n.uniform2f(o.u_uvScale,1/h.uvDivisor[0],1/h.uvDivisor[1]),this.bindTexture(i,0,t.modelView);let f=s.a_geosetColor,m=s.a_uvTransRot,g=s.a_uvScaleSprite,p=s.a_layerAlpha;r.vertexAttribDivisorANGLE(f,1),r.vertexAttribDivisorANGLE(m,1),r.vertexAttribDivisorANGLE(g,1),r.vertexAttribDivisorANGLE(p,1),n.bindBuffer(n.ARRAY_BUFFER,t.geosetColorsBuffer),n.vertexAttribPointer(f,4,n.UNSIGNED_BYTE,!0,4,this.batchSize*l.index*4),n.bindBuffer(n.ARRAY_BUFFER,t.layersBuffer),n.vertexAttribPointer(m,4,n.FLOAT,!1,28,7*this.batchSize*h.index*4),n.vertexAttribPointer(g,3,n.FLOAT,!1,28,7*this.batchSize*h.index*4+16),n.vertexAttribPointer(p,1,n.UNSIGNED_BYTE,!0,1,t.layerAlphasData.byteOffset+this.batchSize*h.index),n.bindBuffer(n.ARRAY_BUFFER,this.__webglArrayBuffer),u.bind(a,h.coordId),u.render(t.count)}renderBatches(t,e,i){if(i&&i.length){this.bind(t,e);for(let e=0,n=i.length;e<n;e++)this.renderBatch(t,i[e]);this.unbind()}}renderOpaque(t){let e=t.scene,i=t.buckets;for(let n=0,r=t.usedBuckets;n<r;n++)this.renderBatches(i[n],e,this.opaqueBatches)}renderTranslucent(t){let e=t.scene,i=t.modelView,n=t.buckets,r=t.particleEmitters2,a=t.ribbonEmitters,s=t.eventObjectEmitters;for(let i=0,r=t.usedBuckets;i<r;i++)this.renderBatches(n[i],e,this.translucentBatches);if(r.length||s.length||a.length){let t=this.viewer.webgl,n=this.viewer.gl;n.depthMask(0),n.enable(n.BLEND),n.disable(n.CULL_FACE),n.enable(n.DEPTH_TEST);let o=this.viewer.shaderMap.get("MdxParticleShader");t.useShaderProgram(o),n.uniformMatrix4fv(o.uniforms.u_mvp,!1,e.camera.worldProjectionMatrix),n.uniform1i(o.uniforms.u_texture,0),n.uniform1f(o.uniforms.u_isRibbonEmitter,!1);for(let t=0,e=r.length;t<e;t++)r[t].render(i,o);for(let t=0,e=s.length;t<e;t++)s[t].render(i,o);n.uniform1f(o.uniforms.u_isRibbonEmitter,!0);for(let t=0,e=a.length;t<e;t++)a[t].render(i,o)}}}class cd{constructor(t){this.modelObject=t,this.objects=[],this.alive=0}emitObject(t,e){let i=this.objects;this.alive===i.length&&i.push(this.createObject());let n=i[this.alive];return this.alive+=1,n.reset(t,e),n}update(){let t=this.objects;for(let e=0;e<this.alive;e++){let i=t[e];i.update(),i.health<=0&&(this.alive-=1,e!==this.alive&&(t[e]=t[this.alive],t[this.alive]=i,e-=1))}this.updateData()}fill(t){let e=t.currentEmission;if(e>=1)for(let i=0;i<e;i+=1,t.currentEmission--)this.emit(t)}updateData(){}render(t,e){}clear(t){for(let e of this.objects)t===e.emitterView.instance&&(e.health=0)}}let dd=u.create(),fd=l.create(),md=new Float32Array(1),gd=new Float32Array(1),pd=new Float32Array(1),vd=new Float32Array(1);class bd{constructor(t){this.emitter=t,this.emitterView=null,this.internalInstance=t.modelObject.internalResource.addInstance(),this.velocity=l.create(),this.gravity=0}reset(t){let e=t.instance,i=e.nodes[this.emitter.modelObject.index],n=this.internalInstance,r=i.worldScale,a=this.velocity;t.getLatitude(md),t.getLifeSpan(gd),t.getGravity(pd),t.getSpeed(vd),this.emitterView=t,this.node=i,this.health=gd[0],this.gravity=pd[0]*r[2],u.identity(dd),u.rotateZ(dd,dd,hs(-Math.PI,Math.PI)),u.rotateY(dd,dd,hs(-md[0],md[0])),l.transformQuat(a,Ka,dd),l.transformQuat(a,a,i.worldRotation),l.scale(a,a,vd[0]),l.mul(a,a,r),e.scene.addInstance(n),n.setTransformation(i.worldLocation,u.setAxisAngle(dd,Ka,hs(0,2*Math.PI)),i.worldScale),n.setSequence(0),n.show()}update(){let t=this.internalInstance,e=this.velocity,i=.001*t.model.viewer.frameTime;t.paused=!1,this.health-=i,e[2]-=this.gravity*i,t.move(l.scale(fd,e,i)),this.health<=0&&this.internalInstance.hide()}}class wd extends cd{emit(t){this.emitObject(t)}createObject(){return new bd(this)}}class yd extends cd{constructor(t){super(t),this.data=new Float32Array(0),this.buffer=t.model.viewer.gl.createBuffer(),this.bufferSize=0}emitObject(t,e){return super.emitObject(t,e)}updateData(){let t=this.objects,e=this.alive,i=e*this.elementsPerEmit;if(this.data.length<i){this.data=new Float32Array(gs(i));let t=this.modelObject.model.viewer.gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.data.byteLength,t.DYNAMIC_DRAW)}let n=this.data;for(let i=0,r=0;i<e;i+=1,r+=30){let e=t[i],a=e.vertices,s=e.lta,o=e.lba,l=e.rta,h=e.rba,u=e.rgb;n[r+0]=a[0],n[r+1]=a[1],n[r+2]=a[2],n[r+3]=s,n[r+4]=u,n[r+5]=a[3],n[r+6]=a[4],n[r+7]=a[5],n[r+8]=o,n[r+9]=u,n[r+10]=a[6],n[r+11]=a[7],n[r+12]=a[8],n[r+13]=h,n[r+14]=u,n[r+15]=a[0],n[r+16]=a[1],n[r+17]=a[2],n[r+18]=s,n[r+19]=u,n[r+20]=a[6],n[r+21]=a[7],n[r+22]=a[8],n[r+23]=h,n[r+24]=u,n[r+25]=a[9],n[r+26]=a[10],n[r+27]=a[11],n[r+28]=l,n[r+29]=u}}render(t,e){let i=this.modelObject,n=this.alive;if(i.internalResource&&n>0){let r=i.model,a=r.viewer.gl;a.blendFunc(i.blendSrc,i.blendDst),a.uniform2fv(e.uniforms.u_dimensions,i.dimensions),r.bindTexture(i.internalResource,0,t),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferSubData(a.ARRAY_BUFFER,0,this.data.subarray(0,30*n)),a.vertexAttribPointer(e.attribs.a_position,3,a.FLOAT,!1,20,0),a.vertexAttribPointer(e.attribs.a_uva_rgb,2,a.FLOAT,!1,20,12),a.drawArrays(a.TRIANGLES,0,6*n)}}}let Ad=u.create(),_d=l.create(),xd=new Uint8Array(4),Td=new Float32Array(1),Ed=new Float32Array(1),Sd=new Float32Array(1),Md=new Float32Array(1),Rd=new Float32Array(1),Id=new Float32Array(1);class Bd{constructor(t){this.emitter=t,this.emitterView=null,this.health=0,this.head=!0,this.location=l.create(),this.velocity=l.create(),this.gravity=0,this.nodeScale=l.create(),this.vertices=new Float32Array(12),this.lta=0,this.lba=0,this.rta=0,this.rba=0,this.rgb=0}reset(t,e){t.getWidth(Td),t.getLength(Ed),t.getLatitude(Sd),t.getVariation(Md),t.getSpeed(Rd),t.getGravity(Id);let i=this.emitter.modelObject,n=t.instance.nodes[i.index],r=n.pivot,a=n.worldScale,s=.5*Td[0],o=.5*Ed[0],h=os(Sd[0]),c=Md[0],d=Rd[0],f=this.location,m=this.velocity;this.emitterView=t,this.node=n,this.health=i.lifeSpan,this.head=e,this.gravity=Id[0]*a[2],l.copy(this.nodeScale,a),f[0]=r[0]+hs(-s,s),f[1]=r[1]+hs(-o,o),f[2]=r[2],i.modelSpace||l.transformMat4(f,f,n.worldMatrix),u.identity(Ad),u.rotateZ(Ad,Ad,Math.PI/2),u.rotateY(Ad,Ad,hs(-h,h)),i.lineEmitter||u.rotateX(Ad,Ad,hs(-h,h)),i.modelSpace||u.mul(Ad,n.worldRotation,Ad),l.transformQuat(m,Ka,Ad),l.scale(m,m,d+hs(-c,c)),l.mul(m,m,a)}update(){let t=this.emitter.modelObject,e=.001*t.model.viewer.frameTime,i=this.location,n=_d,r=this.velocity;this.health-=e,r[2]-=this.gravity*e,l.scaleAndAdd(i,i,r,e),l.copy(n,i);let a,s,o,u=(t.lifeSpan-this.health)/t.lifeSpan,c=t.timeMiddle,d=t.intervals,f=this.head;u<c?(a=u/c,s=0,o=f?d[0]:d[2]):(a=(u-c)/(1-c),s=1,o=f?d[1]:d[3]),a=Math.min(a,1);let m,g,p,v,b=o[0],w=o[1],y=o[2],A=t.scaling,_=t.colors,x=cs(A[s],A[s+1],a),T=this.emitterView.instance;if(t.teamColored){let t=T.teamColor;p=(m=t%4)+1,v=(g=t/4|0)+1}else{let e=t.dimensions[0],i=0,n=w-b;n&&(i=b+Math.floor(n*y*a)%n),p=(m=i%e)+1,v=(g=i/e|0)+1}h.lerp(xd,_[s],_[s+1],a);let E=xd[3];this.lta=Object(qs.p)(p,v,E),this.lba=Object(qs.p)(m,v,E),this.rta=Object(qs.p)(p,g,E),this.rba=Object(qs.p)(m,g,E),this.rgb=Object(qs.p)(xd[0],xd[1],xd[2]);let S,M=T.scene.camera;S=t.xYQuad?M.vectors:M.billboardedVectors;let R=this.vertices,I=this.nodeScale,B=x*I[0],C=x*I[1],L=x*I[2];if(f){t.modelSpace&&l.transformMat4(n,n,this.node.worldMatrix);let e=n[0],i=n[1],r=n[2],a=S[0],s=S[1],o=S[2],h=S[3];R[0]=e+a[0]*B,R[1]=i+a[1]*C,R[2]=r+a[2]*L,R[3]=e+s[0]*B,R[4]=i+s[1]*C,R[5]=r+s[2]*L,R[6]=e+o[0]*B,R[7]=i+o[1]*C,R[8]=r+o[2]*L,R[9]=e+h[0]*B,R[10]=i+h[1]*C,R[11]=r+h[2]*L}else{let e=t.tailLength,i=e*r[0]*1,a=e*r[1]*1,s=e*r[2]*1,o=[n[0]-i,n[1]-a,n[2]-s],h=[n[0],n[1],n[2]];t.modelSpace&&(l.transformMat4(o,o,this.node.worldMatrix),l.transformMat4(h,h,this.node.worldMatrix));let u=o[0],c=o[1],d=o[2],f=h[0],m=h[1],g=h[2],p=[f-u,m-c,g-d];l.normalize(p,p);let v=l.cross([],M.billboardedVectors[6],p);l.normalize(v,v);let b=v[0]*B,w=v[1]*C,y=v[2]*L;R[0]=u-b,R[1]=c-w,R[2]=d-y,R[6]=f+b,R[7]=m+w,R[8]=g+y,R[3]=f-b,R[4]=m-w,R[5]=g-y,R[9]=u+b,R[10]=c+w,R[11]=d+y}}}class Cd extends yd{constructor(t){super(t),this.elementsPerEmit=30*(2===t.headOrTail?2:1)}emit(t){this.modelObject.head&&this.emitObject(t,!0),this.modelObject.tail&&this.emitObject(t,!1)}createObject(){return new Bd(this)}}let Ld=l.create(),Ud=l.create(),kd=l.create(),Fd=new Float32Array(1),Pd=new Float32Array(1);class Dd{constructor(t){this.emitter=t,this.health=0,this.emitterView=null,this.vertices=new Float32Array(12),this.lta=0,this.lba=0,this.rta=0,this.rba=0,this.rgb=0}reset(t){let e=this.emitter,i=this.vertices;this.index=t.currentRibbon++,t.ribbonCount++,this.emitterView=t,this.health=e.modelObject.lifeSpan;let n=t.lastEmit;if(n&&n.health>0){let r=t.instance.nodes[e.modelObject.index],a=r.pivot;t.getHeightBelow(Ld),t.getHeightAbove(Ud),l.set(Ld,a[0],a[1]-Ld[0],a[2]),l.transformMat4(Ld,Ld,r.worldMatrix),l.set(Ud,a[0],a[1]+Ud[0],a[2]),l.transformMat4(Ud,Ud,r.worldMatrix);let s=n.vertices;i[0]=Ud[0],i[1]=Ud[1],i[2]=Ud[2],i[3]=Ld[0],i[4]=Ld[1],i[5]=Ld[2],i[6]=s[3],i[7]=s[4],i[8]=s[5],i[9]=s[0],i[10]=s[1],i[11]=s[2]}else i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=0,i[11]=0}update(){let t=this.emitterView;t.getColor(kd),t.getAlpha(Fd),t.getTextureSlot(Pd);let e=this.emitter.modelObject,i=.001*e.model.viewer.frameTime,n=e.gravity*i*i,r=this.vertices,a=Fd[0],s=Pd[0],o=1/t.ribbonCount,l=t.currentRibbon-this.index-1;if(this.health-=i,r[1]-=n,r[4]-=n,r[7]-=n,r[10]-=n,this.health<=0)t.ribbonCount--;else{let t=e.dimensions[0],i=s%t+l*o,n=s/t|0,r=i+o,h=n+1;i=255*i|0,n=255*n|0,r=255*r|0,h*=255,a=255*a|0,this.lta=Object(qs.p)(i,n,a),this.lba=Object(qs.p)(i,h,a),this.rta=Object(qs.p)(r,n,a),this.rba=Object(qs.p)(r,h,a),this.rgb=Object(qs.p)(255*kd[0]|0,255*kd[1]|0,255*kd[2]|0)}}}class Od extends yd{constructor(t){super(t),this.elementsPerEmit=30}emit(t){t.lastEmit=this.emitObject(t)}createObject(){return new Dd(this)}fill(t){t.currentEmission>=1&&(this.emit(t),t.currentEmission--)}render(t,e){let i=this.alive;if(i>0){let n=this.modelObject,r=n.model,a=r.viewer.gl;n.layer.bind(e),a.uniform2fv(e.uniforms.u_dimensions,n.dimensions),r.bindTexture(n.texture,0,t),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferSubData(a.ARRAY_BUFFER,0,this.data.subarray(0,30*i)),a.vertexAttribPointer(e.attribs.a_position,3,a.FLOAT,!1,20,0),a.vertexAttribPointer(e.attribs.a_uva_rgb,2,a.FLOAT,!1,20,12),a.drawArrays(a.TRIANGLES,0,6*i)}}}class Nd{constructor(t){this.emitter=t,this.emitterView=null,this.health=0,this.internalResource=t.modelObject.internalResource.addInstance()}reset(t){let e=this.internalResource,i=t.instance.nodes[this.emitter.modelObject.index];this.emitterView=t,e.setSequence(0),e.setTransformation(i.worldLocation,i.worldRotation,i.worldScale),e.show(),t.instance.scene.addInstance(e),this.health=1}update(){let t=this.internalResource;t.frame>=t.model.sequences[0].interval[1]&&(this.health=0,t.hide())}}class Vd extends cd{constructor(t){super(t),this.type="SPN"}emit(t){this.modelObject.ok&&this.emitObject(t)}createObject(){return new Nd(this)}}class Gd{constructor(t){this.emitter=t,this.emitterView=null,this.health=0,this.color=new Uint8Array(4),this.vertices=new Float32Array(12),this.lta=0,this.lba=0,this.rta=0,this.rba=0,this.rgb=0}reset(t){let e,i=this.emitter.modelObject,n=this.vertices,r=i.scale,a=t.instance.nodes[i.index].worldMatrix;this.emitterView=t,e=n.subarray(0,2),l.transformMat4(e,[-r,-r,0],a),e=n.subarray(3,5),l.transformMat4(e,[-r,r,0],a),e=n.subarray(6,8),l.transformMat4(e,[r,r,0],a),e=n.subarray(9,11),l.transformMat4(e,[r,-r,0],a),this.health=i.lifespan}update(){let t,e,i,n,r=this.emitter.modelObject,a=r.dimensions[0],s=r.intervalTimes,o=r.intervals,l=s[0],u=s[1],c=r.colors,d=this.color;this.health-=.001*r.model.viewer.frameTime;let f=r.lifespan-this.health;f<l?(t=f/l,e=o[0],i=0):(t=(f-l)/u,e=o[1],i=1),h.lerp(d,c[i],c[i+1],t);let m=(n=Math.floor(cs(e[0],e[1],t)))%a,g=Math.floor(n/a),p=m+1,v=g+1,b=d[3];this.lta=Object(qs.p)(p,v,b),this.lba=Object(qs.p)(m,v,b),this.rta=Object(qs.p)(p,g,b),this.rba=Object(qs.p)(m,g,b),this.rgb=Object(qs.p)(d[0],d[1],d[2])}}class jd extends yd{constructor(t){super(t),this.type="SPL",this.elementsPerEmit=30}emit(t){this.modelObject.ok&&this.emitObject(t)}createObject(){return new Gd(this)}}class Hd{constructor(t){this.emitter=t,this.emitterView=null,this.health=0,this.color=new Uint8Array(4),this.vertices=new Float32Array(12),this.lta=0,this.lba=0,this.rta=0,this.rba=0,this.rgb=0}reset(t){let e,i=this.emitter.modelObject,n=this.vertices,r=i.scale,a=t.instance.nodes[i.index].worldMatrix;this.emitterView=t,e=n.subarray(0,2),l.transformMat4(e,[-r,-r,0],a),e=n.subarray(3,5),l.transformMat4(e,[-r,r,0],a),e=n.subarray(6,8),l.transformMat4(e,[r,r,0],a),e=n.subarray(9,11),l.transformMat4(e,[r,-r,0],a),this.health=i.lifespan}update(){let t=this.emitter.modelObject,e=t.intervalTimes,i=e[0],n=e[1],r=e[2],a=t.colors,s=this.color;this.health-=.001*t.model.viewer.frameTime;let o=t.lifespan-this.health;o<i?h.lerp(s,a[0],a[1],o/i):o<i+n?h.copy(s,t.colors[1]):h.lerp(s,a[1],a[2],(o-i-n)/r);let l=s[3];this.lta=Object(qs.p)(1,0,l),this.lba=Object(qs.p)(0,0,l),this.rta=Object(qs.p)(1,1,l),this.rba=Object(qs.p)(0,1,l),this.rgb=Object(qs.p)(s[0],s[1],s[2])}}class $d extends yd{constructor(t){super(t),this.type="UBR",this.elementsPerEmit=30}emit(t){this.modelObject.ok&&this.emitObject(t)}createObject(){return new Hd(this)}}class qd{constructor(t){this.modelObject=t,this.type="SND"}emit(t){if(this.modelObject.ok){let e=this.modelObject.model.viewer,i=t.instance.scene;if(e.enableAudio&&i.audioEnabled){let e=i.audioContext,n=t.emitter,r=n.decodedBuffers,a=e.createPanner(),s=e.createBufferSource();a.setPosition(...t.instance.nodes[n.objectId].worldLocation),a.maxDistance=n.distanceCutoff,a.refDistance=n.minDistance,a.connect(e.destination),s.buffer=r[Math.random()*r.length|0],s.connect(a),s.start(0)}}}update(){}fill(t){let e=t.currentEmission;if(e>=1)for(let i=0;i<e;i+=1,t.currentEmission--)this.emit(t)}render(t,e){}clear(t){}}var zd=class extends Vu{constructor(t){super(t);let e=this.model,i=e.batchSize,n=e.viewer.gl,r=e.bones.length+1;this.boneArrayInstanceSize=16*r,this.boneArray=new Float32Array(this.boneArrayInstanceSize*i),this.boneTexture=n.createTexture(),this.boneTextureWidth=4*r,this.boneTextureHeight=i,this.vectorSize=1/this.boneTextureWidth,this.rowSize=1/this.boneTextureHeight,n.activeTexture(n.TEXTURE15),n.bindTexture(n.TEXTURE_2D,this.boneTexture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.boneTextureWidth,this.boneTextureHeight,0,n.RGBA,n.FLOAT,this.boneArray),this.colorData=new Uint8Array(5*i),this.colorBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),n.bufferData(n.ARRAY_BUFFER,this.colorData.byteLength,n.DYNAMIC_DRAW),e.batches.length>0&&(this.geosetColorsData=new Uint8Array(i*e.geosets.length*4),this.geosetColorsBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.geosetColorsBuffer),n.bufferData(n.ARRAY_BUFFER,this.geosetColorsData.byteLength,n.DYNAMIC_DRAW),this.layersData=new ArrayBuffer(i*e.layers.length*29),this.uvTransformsData=new Float32Array(this.layersData,0,i*e.layers.length*7),this.layerAlphasData=new Uint8Array(this.layersData,i*e.layers.length*28,i*e.layers.length),this.layersBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.layersBuffer),n.bufferData(n.ARRAY_BUFFER,this.layersData.byteLength,n.DYNAMIC_DRAW))}fill(t){let e=t.baseIndex,i=this.model,n=i.viewer.gl,r=i.batchSize,a=i.batches.length>0,s=i.geosets.length,o=i.layers.length,l=i.bones.length,h=this.boneArray,u=this.colorData,c=this.geosetColorsData,d=this.layerAlphasData,f=this.uvTransformsData,m=0,g=t.instances,p=t.particleEmitters,v=t.particleEmitters2,b=t.ribbonEmitters,w=t.eventObjectEmitters;for(let t=g.length;e<t&&m<r;e++){let t=g[e];if(t.rendered&&!t.culled){let e=16+m*(16+16*l),i=t.worldMatrices,n=t.vertexColor,g=t.particleEmitters,y=t.particleEmitters2,A=t.ribbonEmitters,_=t.eventObjectEmitters,x=4*m,T=5*m,E=7*m;for(let t=0,n=16*l;t<n;t++)h[e+t]=i[t];if(u[T]=t.teamColor,u[T+1]=n[0],u[T+2]=n[1],u[T+3]=n[2],u[T+4]=n[3],a){let e=t.geosetColors,i=t.layerAlphas,n=t.uvOffsets,a=t.uvRots,l=t.uvScales;for(let t=0;t<s;t++){let i=4*t,n=r*i+x;c[n]=e[i],c[n+1]=e[i+1],c[n+2]=e[i+2],c[n+3]=e[i+3]}for(let t=0;t<o;t++){let e=4*t,s=r*t*7+E;d[r*t+m]=i[t],f[s]=n[e],f[s+1]=n[e+1],f[s+2]=a[2*t],f[s+3]=a[2*t+1],f[s+4]=l[t],f[s+5]=n[e+2],f[s+6]=n[e+3]}}for(let t=0,e=p.length;t<e;t++)p[t].fill(g[t]);for(let t=0,e=v.length;t<e;t++)v[t].fill(y[t]);for(let t=0,e=b.length;t<e;t++)b[t].fill(A[t]);for(let t=0,e=w.length;t<e;t++)w[t].fill(_[t]);m+=1}}return this.count=m,m&&(n.activeTexture(n.TEXTURE15),n.bindTexture(n.TEXTURE_2D,this.boneTexture),n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.boneTextureWidth,m,n.RGBA,n.FLOAT,h),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,u),s&&(n.bindBuffer(n.ARRAY_BUFFER,this.geosetColorsBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,c)),o&&(n.bindBuffer(n.ARRAY_BUFFER,this.layersBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.layersData))),e}};class Kd extends iu{convertBasis(t){u.rotateY(t,t,-Math.PI/2)}}let Wd=new Float32Array(1);class Yd{constructor(t,e){let i=e.internalModel.addInstance();i.setSequenceLoopMode(2),i.dontInheritScale=!1,i.hide(),i.setParent(t.nodes[e.objectId]),this.instance=t,this.attachment=e,this.internalInstance=i}update(){let t=this.internalInstance;t.model.ok&&(this.attachment.getVisibility(Wd,this.instance),Wd[0]>.1?(this.instance.scene.addInstance(t),t.hidden()&&(t.show(),t.setSequence(0))):t.hide())}}let Xd=new Float32Array(1);class Jd{constructor(t,e){this.instance=t,this.emitter=e,this.currentEmission=0}update(){this.instance.allowParticleSpawn&&(this.getEmissionRate(Xd),this.currentEmission+=Xd[0]*this.instance.model.viewer.frameTime*.001)}getSpeed(t){return this.emitter.getSpeed(t,this.instance)}getLatitude(t){return this.emitter.getLatitude(t,this.instance)}getLongitude(t){return this.emitter.getLongitude(t,this.instance)}getLifeSpan(t){return this.emitter.getLifeSpan(t,this.instance)}getGravity(t){return this.emitter.getGravity(t,this.instance)}getEmissionRate(t){return this.emitter.getEmissionRate(t,this.instance)}getVisibility(t){return this.emitter.getVisibility(t,this.instance)}}let Zd=new Float32Array(1);class Qd{constructor(t,e){this.instance=t,this.emitter=e,this.currentEmission=0,this.lastEmissionKey=-1}update(){if(this.instance.allowParticleSpawn){let t=this.getEmissionRate(Zd);this.emitter.squirt?(t!==this.lastEmissionKey&&(this.currentEmission+=Zd[0]),this.lastEmissionKey=t):this.currentEmission+=Zd[0]*this.instance.model.viewer.frameTime*.001}}getWidth(t){return this.emitter.getWidth(t,this.instance)}getLength(t){return this.emitter.getLength(t,this.instance)}getSpeed(t){return this.emitter.getSpeed(t,this.instance)}getLatitude(t){return this.emitter.getLatitude(t,this.instance)}getGravity(t){return this.emitter.getGravity(t,this.instance)}getEmissionRate(t){return this.emitter.getEmissionRate(t,this.instance)}getVisibility(t){return this.emitter.getVisibility(t,this.instance)}getVariation(t){return this.emitter.getVariation(t,this.instance)}}class tf{constructor(t,e){this.instance=t,this.emitter=e,this.currentEmission=0,this.lastEmit=null,this.currentRibbon=-1,this.ribbonCount=0}update(){this.instance.allowParticleSpawn&&(this.currentEmission+=this.emitter.emissionRate*this.instance.model.viewer.frameTime*.001)}getHeightBelow(t){return this.emitter.getHeightBelow(t,this.instance)}getHeightAbove(t){return this.emitter.getHeightAbove(t,this.instance)}getTextureSlot(t){return this.emitter.getTextureSlot(t,this.instance)}getColor(t){return this.emitter.getColor(t,this.instance)}getAlpha(t){return this.emitter.getAlpha(t,this.instance)}getVisibility(t){return this.emitter.getVisibility(t,this.instance)}}let ef=d.create();class nf{constructor(t,e){this.instance=t,this.emitter=e,this.lastTrack=new Uint16Array(2),this.currentEmission=0}reset(){this.lastTrack.fill(0)}update(){if(this.instance.allowParticleSpawn){let t=this.emitter,e=this.lastTrack;t.getValue(ef,this.instance),1!==ef[0]||ef[0]===e[0]&&ef[1]===e[1]||(this.currentEmission+=1),e[0]=ef[0],e[1]=ef[1]}}}let rf=new Float32Array(1),af=l.create(),sf=u.create(),of=l.create(),lf=new Float32Array(3),hf=new Float32Array(1),uf=new Float32Array(1);class cf extends Hu{constructor(t){super(t),this.attachments=[],this.particleEmitters=[],this.particleEmitters2=[],this.ribbonEmitters=[],this.eventObjectEmitters=[],this.nodes=[],this.sortedNodes=[],this.frame=0,this.counter=0,this.sequence=-1,this.sequenceLoopMode=0,this.teamColor=0,this.vertexColor=new Uint8Array([255,255,255,255]),this.allowParticleSpawn=!1,this.forced=!0}load(){let t=this.model,e=t.geosets.length,i=t.layers.length;this.geosetColors=new Uint8Array(4*e),this.layerAlphas=new Uint8Array(i),this.uvOffsets=new Float32Array(4*i),this.uvScales=new Float32Array(i),this.uvRots=new Float32Array(2*i);let n=ru(t.genericObjects.length,Kd),r=n.nodes,a=0;this.nodes.push(...r),this.worldMatrices=n.worldMatrices;for(let e of t.bones)this.initNode(r,r[a++],e);for(let e of t.lights)this.initNode(r,r[a++],e);for(let e of t.helpers)this.initNode(r,r[a++],e);for(let e of t.attachments){let t;e.internalModel&&(t=new Yd(this,e),this.attachments.push(t)),this.initNode(r,r[a++],e,t)}for(let e of t.particleEmitters){let t=new Jd(this,e);this.particleEmitters.push(t),this.initNode(r,r[a++],e,t)}for(let e of t.particleEmitters2){let t=new Qd(this,e);this.particleEmitters2.push(t),this.initNode(r,r[a++],e,t)}for(let e of t.ribbonEmitters){let t=new tf(this,e);this.ribbonEmitters.push(t),this.initNode(r,r[a++],e,t)}for(let e of t.cameras)this.initNode(r,r[a++],e);for(let e of t.eventObjects){let t=new nf(this,e);this.eventObjectEmitters.push(t),this.initNode(r,r[a++],e,t)}for(let e of t.collisionShapes)this.initNode(r,r[a++],e);let s=t.hierarchy;for(let t=0,e=r.length;t<e;t++)this.sortedNodes[t]=r[s[t]];this.setSequence(this.sequence)}clearEmittedObjects(){if(this.modelView)for(let t of this.modelView.sceneData.values()){for(let e of t.particleEmitters)e.clear(this);for(let e of t.particleEmitters2)e.clear(this);for(let e of t.ribbonEmitters)e.clear(this);for(let e of t.eventObjectEmitters)e.clear(this)}}initNode(t,e,i,n){e.pivot.set(i.pivot),-1===i.parentId?e.parent=this:e.parent=t[i.parentId],i.billboarded?e.billboarded=!0:i.billboardedX?e.billboardedX=!0:i.billboardedY?e.billboardedY=!0:i.billboardedZ&&(e.billboardedZ=!0),n&&(e.object=n)}hide(){super.hide();for(let t of this.attachments)t.internalInstance.hide()}show(){super.show();for(let t of this.attachments)t.internalInstance.show()}updateTimers(){if(-1!==this.sequence){let t=this.model,e=t.sequences[this.sequence],i=e.interval,n=t.viewer.frameTime;this.frame+=n,this.counter+=n,this.allowParticleSpawn=!0,this.frame>=i[1]&&(2===this.sequenceLoopMode||0===this.sequenceLoopMode&&0===e.flags?(this.frame=i[0],this.resetEventEmitters()):(this.frame=i[1],this.counter-=n,this.allowParticleSpawn=!1),this.emit("seqend",this))}}updateNodes(t){let e=this.sortedNodes,i=this.sequence,n=this.model.sortedGenericObjects,r=this.scene;for(let a=0,s=e.length;a<s;a++){let s=n[a],o=e[a],l=o.parent;s.getVisibility(rf,this);let h=rf[0]>=.75,u=t||l.visible&&h;if(o.visible=u,u){let e=!1,n=s.variants,a=o.localLocation,u=o.localRotation,c=o.localScale;(t||n.generic[i])&&(e=!0,(t||n.translation[i])&&(s.getTranslation(af,this),a[0]=af[0],a[1]=af[1],a[2]=af[2]),(t||n.rotation[i])&&(s.getRotation(sf,this),u[0]=sf[0],u[1]=sf[1],u[2]=sf[2],u[3]=sf[3]),(t||n.scale[i])&&(s.getScale(of,this),c[0]=of[0],c[1]=of[1],c[2]=of[2]));let d=t||e||l.wasDirty||s.anyBillboarding;o.wasDirty=d,d&&o.recalculateTransformation(r);let f=o.object;f&&h&&f.update(),o.updateChildren(r)}}}updateBatches(t){let e=this.model,i=e.geosets,n=e.layers,r=this.geosetColors,a=this.layerAlphas,s=this.uvOffsets,o=this.uvScales,l=this.uvRots,h=this.sequence;for(let e=0,n=i.length;e<n;e++){let n=i[e],a=4*e;(t||n.variants.color[h])&&(n.getColor(lf,this),r[a]=255*lf[0],r[a+1]=255*lf[1],r[a+2]=255*lf[2]),(t||n.variants.alpha[h])&&(n.getAlpha(hf,this),r[a+3]=255*hf[0])}for(let e=0,i=n.length;e<i;e++){let i=n[e],r=2*e,u=4*e;if((t||i.variants.alpha[h])&&(i.getAlpha(hf,this),a[e]=255*hf[0]),(t||i.variants.translation[h])&&(i.getTranslation(af,this),s[u]=af[0],s[u+1]=af[1]),(t||i.variants.rotation[h])&&(i.getRotation(sf,this),l[r]=sf[2],l[r+1]=sf[3]),(t||i.variants.scale[h])&&(i.getScale(of,this),o[e]=of[0]),t||i.variants.slot[h]){i.getTextureId(uf,this);let t=i.uvDivisor,e=uf[0];s[u+2]=e%t[0],s[u+3]=e/t[1]|0}}}updateAnimations(){let t=this.forced;(t||-1!==this.sequence&&!this.model.viewer.noUpdating)&&(this.forced=!1,this.updateNodes(t),this.updateBatches(t))}setTeamColor(t){return this.teamColor=t,this}setVertexColor(t){return this.vertexColor.set(t),this}setSequence(t){if(this.sequence=t,this.model.ok){let e=this.model.sequences;t<0||t>e.length-1?(this.sequence=-1,this.frame=0,this.allowParticleSpawn=!1):this.frame=e[t].interval[0],this.resetEventEmitters(),this.forced=!0}return this}setSequenceLoopMode(t){return this.sequenceLoopMode=t,this}getAttachment(t){let e=this.model.attachments[t];if(e)return this.nodes[e.index]}resetEventEmitters(){for(let t of this.eventObjectEmitters)t.reset()}}var df={vs:`\n    ${qu}\n    ${zu}\n    uniform mat4 u_mvp;\n\n    attribute vec3 a_position;\n    attribute vec3 a_normal;\n    attribute vec2 a_uv;\n    attribute vec4 a_bones;\n    attribute float a_boneNumber;\n    attribute float a_teamColor;\n    attribute vec4 a_vertexColor;\n    attribute vec4 a_geosetColor;\n    attribute float a_layerAlpha;\n    attribute vec4 a_uvTransRot;\n    attribute vec3 a_uvScaleSprite;\n\n    varying vec3 v_normal;\n    varying vec2 v_uv;\n    varying float v_teamColor;\n    varying vec4 v_vertexColor;\n    varying vec4 v_geosetColor;\n    varying vec4 v_uvTransRot;\n    varying vec3 v_uvScaleSprite;\n\n    void transform(inout vec3 position, inout vec3 normal, float boneNumber, vec4 bones) {\n      // For the broken models out there, since the game supports this.\n      if (boneNumber > 0.0) {\n        mat4 b0 = fetchMatrix(bones[0], a_InstanceID);\n        mat4 b1 = fetchMatrix(bones[1], a_InstanceID);\n        mat4 b2 = fetchMatrix(bones[2], a_InstanceID);\n        mat4 b3 = fetchMatrix(bones[3], a_InstanceID);\n        vec4 p = vec4(position, 1);\n        vec4 n = vec4(normal, 0);\n\n        position = vec3(b0 * p + b1 * p + b2 * p + b3 * p) / boneNumber;\n        normal = normalize(vec3(b0 * n + b1 * n + b2 * n + b3 * n));\n      }\n    }\n\n    void main() {\n      vec2 uv = a_uv;\n      vec3 position = a_position;\n      vec3 normal = a_normal;\n\n      transform(position, normal, a_boneNumber, a_bones);\n\n      v_uv = a_uv;\n      v_uvTransRot = a_uvTransRot;\n      v_uvScaleSprite = a_uvScaleSprite;\n\n      v_normal = normal;\n      v_teamColor = a_teamColor;\n      v_vertexColor = a_vertexColor;\n\n      // Is the alpha here even correct?\n      v_geosetColor = vec4(a_geosetColor.rgb, a_layerAlpha);\n\n      // Definitely not correct, but the best I could figure so far.\n      if (a_geosetColor.a < 0.75 || a_layerAlpha < 0.1) {\n        gl_Position = vec4(0.0);\n      } else {\n        gl_Position = u_mvp * vec4(position, 1);\n      }\n    }\n  `,fs:`\n    uniform sampler2D u_texture;\n    uniform bool u_alphaTest;\n    // uniform bool u_unshaded;\n    uniform bool u_isTeamColor;\n    uniform vec2 u_uvScale;\n    uniform bool u_hasSlotAnim;\n    uniform bool u_hasTranslationAnim;\n    uniform bool u_hasRotationAnim;\n    uniform bool u_hasScaleAnim;\n\n    varying vec3 v_normal;\n    varying vec2 v_uv;\n    varying float v_teamColor;\n    varying vec4 v_vertexColor;\n    varying vec4 v_geosetColor;\n    varying vec4 v_uvTransRot;\n    varying vec3 v_uvScaleSprite;\n\n    // const vec3 lightDirection = normalize(vec3(-0.3, -0.3, 0.25));\n\n    ${Wu}\n\n    void main() {\n      vec2 uv;\n\n      if (u_isTeamColor) {\n        // 4 is the amount of columns and rows in the team colors/glows texture.\n        uv = (vec2(mod(v_teamColor, 4.0), floor(v_teamColor / 4.0)) + v_uv) / 4.0;\n      } else {\n        uv = v_uv;\n\n        // Translation animation\n        if (u_hasTranslationAnim) {\n          uv += v_uvTransRot.xy;\n        }\n\n        // Rotation animation\n        if (u_hasRotationAnim) {\n          uv = quat_transform(v_uvTransRot.zw, uv - 0.5) + 0.5;\n        }\n\n        // Scale animation\n        if (u_hasScaleAnim) {\n          uv = v_uvScaleSprite.x * (uv - 0.5) + 0.5;\n        }\n\n        // Sprite animation\n        if (u_hasSlotAnim) {\n          uv = (v_uvScaleSprite.yz + fract(uv)) * u_uvScale;\n        }\n      }\n\n      vec4 texel = texture2D(u_texture, uv);\n\n      // 1bit Alpha\n      if (u_alphaTest && texel.a < 0.75) {\n        discard;\n      }\n\n      vec4 color = texel * v_geosetColor.bgra * v_vertexColor;\n\n      // if (!u_unshaded) {\n      //   color *= clamp(dot(v_normal, lightDirection) + 0.45, 0.0, 1.0);\n      // }\n\n      gl_FragColor = color;\n    }\n  `,vsParticles:`\n    ${Ku}\n    uniform mat4 u_mvp;\n    uniform vec2 u_dimensions;\n    uniform bool u_isRibbonEmitter;\n\n    attribute vec3 a_position;\n    attribute vec2 a_uva_rgb;\n\n    varying vec2 v_uv;\n    varying vec4 v_color;\n\n    void main() {\n      vec3 uva = decodeFloat3(a_uva_rgb[0]);\n      vec3 rgb = decodeFloat3(a_uva_rgb[1]);\n      vec2 uv = uva.xy;\n\n      if (u_isRibbonEmitter) {\n        uv /= 255.0;\n      }\n\n      v_uv = uv / u_dimensions;\n      v_color = vec4(rgb, uva.z) / 255.0;\n\n      gl_Position = u_mvp * vec4(a_position, 1);\n    }\n  `,fsParticles:"\n    uniform sampler2D u_texture;\n    uniform bool u_alphaTest;\n    uniform bool u_isRibbonEmitter;\n\n    varying vec2 v_uv;\n    varying vec4 v_color;\n\n    void main() {\n      vec4 texel = texture2D(u_texture, v_uv);\n\n      // 1bit Alpha, used by ribbon emitters\n      if (u_isRibbonEmitter && u_alphaTest && texel.a < 0.75) {\n        discard;\n      }\n\n      gl_FragColor = texel * v_color;\n    }\n  "},ff={load(t){t.addHandler(mu),t.addHandler(Qu),t.addHandler(uu);let e=t.loadShader("MdxStandardShader",df.vs,df.fs),i=t.loadShader("MdxParticleShader",df.vsParticles,df.fsParticles);return e.ok&&i.ok},extensions:[[".mdx","arrayBuffer"],[".mdl","text"]],Constructor:ud,View:class extends Pu{createSceneData(t){let e=this.model,i=super.createSceneData(t),n=[],r=[],a=[],s=[];for(let t of e.particleEmitters)n.push(new wd(t));for(let t of e.particleEmitters2)r.push(new Cd(t));for(let t of e.ribbonEmitters)a.push(new Od(t));for(let t of e.eventObjects){let e=t.type;"SPN"===e?s.push(new Vd(t)):"SPL"===e?s.push(new jd(t)):"UBR"===e?s.push(new $d(t)):"SND"===e&&s.push(new qd(t))}return{...i,particleEmitters:n,particleEmitters2:r,ribbonEmitters:a,eventObjectEmitters:s}}update(t){let e=super.update(t);if(e){let t=this.model.batches.length,i=e.buckets,n=0,r=0,a=0,s=0;for(let r=0,o=e.usedBuckets;r<o;r++)n+=i[r].count,a+=1,s+=t;for(let t of e.particleEmitters){t.update();let e=t.alive;e&&(r+=e,s+=1)}for(let t of e.particleEmitters2){t.update();let e=t.alive;e&&(r+=e,s+=1)}for(let t of e.ribbonEmitters){t.update();let e=t.alive;e&&(r+=e,s+=1)}for(let t of e.eventObjectEmitters)if(t.update(),"SND"!==t.type){let e=t.alive;e&&(r+=e,s+=1)}this.renderedInstances=n,this.renderedParticles=r,this.renderedBuckets=a,this.renderCalls=s}}},Bucket:zd,Instance:cf},mf={handler:ff,Model:ud,ModelInstance:cf,Bucket:zd},gf={handler:uu,Texture:hu};class pf extends Du{constructor(t){super(t),this.vertexBuffer=null,this.faceBuffer=null,this.elements=0}load(t){let e=t.split("\n"),i=[],n=[];for(let t=0,r=e.length;t<r;t++){let r=e[t].split("#")[0];if(""!==r){let t=r.match(/v\s+([\d.\-+]+)\s+([\d.\-+]+)\s+([\d.\-+]+)/);t?i.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])):(t=r.match(/f\s+([\d]+)\s+([\d]+)\s+([\d]+)/))&&n.push(parseInt(t[1],10)-1,parseInt(t[2],10)-1,parseInt(t[3],10)-1)}}let r=this.viewer.gl,a=new Float32Array(i),s=new Uint16Array(n);const o=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,o),r.bufferData(r.ARRAY_BUFFER,a,r.STATIC_DRAW);const l=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l),r.bufferData(r.ELEMENT_ARRAY_BUFFER,s,r.STATIC_DRAW),this.vertexBuffer=o,this.faceBuffer=l,this.elements=n.length}renderOpaque(t){let e=t.scene,i=this.viewer.webgl,n=this.viewer.gl,r=this.viewer.shaderMap.get("ObjShader"),a=r.uniforms,s=r.attribs,o=t.instances;i.useShaderProgram(r),n.uniformMatrix4fv(a.u_mvp,!1,e.camera.worldProjectionMatrix),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(s.a_position,3,n.FLOAT,!1,12,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.faceBuffer);for(let t=0,e=o.length;t<e;t++)n.uniform3fv(a.u_color,o[t].color),n.uniformMatrix4fv(a.u_transform,!1,o[t].worldMatrix),n.drawElements(n.TRIANGLES,this.elements,n.UNSIGNED_SHORT,0)}}class vf extends ju{load(){this.color=new Float32Array([Math.random(),Math.random(),Math.random()])}updateAnimations(){}}var bf={vs:"\n    uniform mat4 u_mvp;\n    uniform mat4 u_transform;\n\n    attribute vec3 a_position;\n\n    void main() {\n      gl_Position = u_mvp * u_transform * vec4(a_position, 1.0);\n    }\n  ",fs:"\n    uniform vec3 u_color;\n\n    void main() {\n      gl_FragColor = vec4(u_color, 1.0);\n    }\n  "},wf={handler:{load:t=>t.loadShader("ObjShader",bf.vs,bf.fs).ok,extensions:[[".obj","text"]],Constructor:pf,View:Fu,Bucket:Vu,Instance:vf},Model:pf,ModelInstance:vf},yf={handler:Qu,Texture:Zu},Af={vsGround:`\n    uniform mat4 u_mvp;\n    uniform sampler2D u_heightMap;\n    uniform vec2 u_size;\n    uniform vec2 u_offset;\n    uniform float u_tilesetHeight;\n    uniform float u_tilesetCount;\n\n    attribute vec2 a_position;\n    ${qu}\n    attribute vec4 a_textures;\n    attribute vec4 a_variations;\n\n    varying vec2 v_uv[4];\n    varying vec3 v_normal;\n\n    vec4 getCell(float tileset, float variation) {\n      float x = variation * 0.03125;\n      float y = tileset * u_tilesetHeight;\n\n      return vec4(x, y, x + 0.03125, y + u_tilesetHeight);\n    }\n    \n    vec2 getUV(vec2 position, float tileset, float variation) {\n      vec2 uv = vec2(position.x, 1.0 - position.y);\n      vec4 cell = getCell(tileset, variation);\n      vec2 cellSize = vec2(1.0 / 32.0, 1.0 / u_tilesetCount);\n      vec2 pixelSize = vec2(2.0 / 2048.0, 2.0 / (64.0 * u_tilesetCount));\n\n      return clamp(cell.xy + uv * cellSize, cell.xy + pixelSize, cell.zw - pixelSize);\n    }\n\n    void main() {\n      if (a_textures[0] > 0.5) {\n        v_uv[0] = getUV(a_position, a_textures[0], a_variations[0]);\n        v_uv[1] = getUV(a_position, a_textures[1], a_variations[1]);\n        v_uv[2] = getUV(a_position, a_textures[2], a_variations[2]);\n        v_uv[3] = getUV(a_position, a_textures[3], a_variations[3]);\n\n        vec2 corner = vec2(mod(a_InstanceID, u_size.x), floor(a_InstanceID / u_size.x));\n        vec2 base = corner + a_position;\n        float height = texture2D(u_heightMap, base / u_size).a;\n\n        float hL = texture2D(u_heightMap, vec2(base - vec2(1.0, 0.0)) / (u_size)).a;\n        float hR = texture2D(u_heightMap, vec2(base + vec2(1.0, 0.0)) / (u_size)).a;\n        float hD = texture2D(u_heightMap, vec2(base - vec2(0.0, 1.0)) / (u_size)).a;\n        float hU = texture2D(u_heightMap, vec2(base + vec2(0.0, 1.0)) / (u_size)).a;\n\n        v_normal = normalize(vec3(hL - hR, hD - hU, 2.0));\n\n        gl_Position = u_mvp * vec4(base * 128.0 + u_offset, height * 128.0, 1.0);\n      } else {\n        v_uv[0] = vec2(0.0);\n        v_uv[1] = vec2(0.0);\n        v_uv[2] = vec2(0.0);\n        v_uv[3] = vec2(0.0);\n\n        v_normal = vec3(0.0);\n\n        gl_Position = vec4(0.0);\n      }\n    }\n  `,fsGround:"\n    uniform sampler2D u_tilesets;\n\n    varying vec2 v_uv[4];\n    varying vec3 v_normal;\n\n    const vec3 lightDirection = normalize(vec3(-0.3, -0.3, 0.25));\n\n    vec4 blend(vec4 color, vec2 uv) {\n      vec4 texel = texture2D(u_tilesets, uv);\n\n      return mix(color, texel, texel.a);\n    }\n\n    void main() {\n      vec4 color = texture2D(u_tilesets, v_uv[0]);\n      color = blend(color, v_uv[1]);\n      color = blend(color, v_uv[2]);\n      color = blend(color, v_uv[3]);\n\n      color *= clamp(dot(v_normal, lightDirection) + 0.45, 0.0, 1.0);\n\n      gl_FragColor = color;\n    }\n  ",vsWater:`\n    uniform mat4 u_mvp;\n    uniform sampler2D u_heightMap;\n    uniform sampler2D u_waterHeightMap;\n    uniform vec2 u_size;\n    uniform vec2 u_offset;\n    uniform float u_offsetHeight;\n    uniform float u_tileIndex;\n    uniform vec4 u_minDeepColor;\n    uniform vec4 u_maxDeepColor;\n    uniform vec4 u_minShallowColor;\n    uniform vec4 u_maxShallowColor;\n\n    attribute vec2 a_position;\n    ${qu}\n    attribute float a_isWater;\n\n    varying vec2 v_uv;\n    varying vec4 v_color;\n\n    const float minDepth = 10.0 / 128.0;\n    const float deepLevel = 64.0 / 128.0;\n    const float maxDepth = 72.0 / 128.0;\n\n    void main() {\n      if (a_isWater > 0.5) {\n        v_uv = (vec2(mod(u_tileIndex, 16.0), floor(u_tileIndex / 16.0)) + a_position) / vec2(16.0, 3.0);\n\n        vec2 corner = vec2(mod(a_InstanceID, u_size.x), floor(a_InstanceID / u_size.x));\n        vec2 base = corner + a_position;\n        float height = texture2D(u_heightMap, base / u_size).a;\n        float waterHeight = texture2D(u_waterHeightMap, base / u_size).a + u_offsetHeight;\n        float value = clamp(waterHeight - height, 0.0, 1.0);\n\n        if (value <= deepLevel) {\n          value = max(0.0, value - minDepth) / (deepLevel - minDepth);\n          v_color = mix(u_minShallowColor, u_maxShallowColor, value) / 255.0;\n        } else {\n          value = clamp(value - deepLevel, 0.0, maxDepth - deepLevel) / (maxDepth - deepLevel);\n          v_color = mix(u_minDeepColor, u_maxDeepColor, value) / 255.0;\n        }\n\n        gl_Position = u_mvp * vec4(base * 128.0 + u_offset, waterHeight * 128.0, 1.0);\n      } else {\n        v_uv = vec2(0.0);\n        v_color = vec4(0.0);\n\n        gl_Position = vec4(0.0);\n      }\n    }\n  `,fsWater:"\n    uniform sampler2D u_waterMap;\n\n    varying vec2 v_uv;\n    varying vec4 v_color;\n\n    void main() {\n      gl_FragColor = texture2D(u_waterMap, v_uv) * v_color;\n    }\n  ",vsCliffs:"\n    uniform mat4 u_mvp;\n    uniform sampler2D u_heightMap;\n    uniform vec2 u_pixel;\n    uniform vec2 u_centerOffset;\n\n    attribute vec3 a_position;\n    attribute vec3 a_normal;\n    attribute vec2 a_uv;\n    attribute vec3 a_instancePosition;\n    attribute float a_instanceTexture;\n\n    varying vec3 v_normal;\n    varying vec2 v_uv;\n    varying float v_texture;\n    varying vec3 v_position;\n\n    void main() {\n      // Half of a pixel in the cliff height map.\n      vec2 halfPixel = u_pixel * 0.5;\n\n      // The bottom left corner of the map tile this vertex is on.\n      vec2 corner = floor((a_instancePosition.xy - vec2(1.0, 0.0) - u_centerOffset.xy) / 128.0);\n\n      // Get the 4 closest heights in the height map.\n      float bottomLeft = texture2D(u_heightMap, corner * u_pixel + halfPixel).a;\n      float bottomRight = texture2D(u_heightMap, (corner + vec2(1.0, 0.0)) * u_pixel + halfPixel).a;\n      float topLeft = texture2D(u_heightMap, (corner + vec2(0.0, 1.0)) * u_pixel + halfPixel).a;\n      float topRight = texture2D(u_heightMap, (corner + vec2(1.0, 1.0)) * u_pixel + halfPixel).a;\n      \n      // Do a bilinear interpolation between the heights to get the final value.\n      float bottom = mix(bottomRight, bottomLeft, -a_position.x / 128.0);\n      float top = mix(topRight, topLeft, -a_position.x / 128.0);\n      float height = mix(bottom, top, a_position.y / 128.0);\n\n      v_normal = a_normal;\n      v_uv = a_uv;\n      v_texture = a_instanceTexture;\n      v_position = a_position + vec3(a_instancePosition.xy, a_instancePosition.z + height * 128.0);\n\n      gl_Position = u_mvp * vec4(v_position, 1.0);\n    }\n  ",fsCliffs:"\n    #extension GL_OES_standard_derivatives : enable\n    uniform sampler2D u_texture1;\n    uniform sampler2D u_texture2;\n\n    varying vec3 v_normal;\n    varying vec2 v_uv;\n    varying float v_texture;\n    varying vec3 v_position;\n\n    const vec3 lightDirection = normalize(vec3(-0.3, -0.3, 0.25));\n\n    vec4 sample(int texture, vec2 uv) {\n      if (texture == 0) {\n        return texture2D(u_texture1, uv);\n      } else {\n        return texture2D(u_texture2, uv);\n      }\n    }\n\n    void main() {\n      vec4 color = sample(int(v_texture), v_uv);\n\n      vec3 faceNormal = cross(dFdx(v_position), dFdy(v_position));\n      vec3 normal = normalize((faceNormal + v_normal) * 0.5);\n\n      color *= clamp(dot(normal, lightDirection) + 0.45, 0.1, 1.0);\n\n      gl_FragColor = color;\n    }\n  ",vsSimpleModel:`\n    uniform mat4 u_mvp;\n\n    attribute vec3 a_position;\n    attribute vec3 a_normal;\n    attribute vec2 a_uv;\n    attribute vec3 a_instancePosition;\n    attribute vec2 a_instanceRotation;\n    attribute float a_instanceScale;\n\n    varying vec3 v_normal;\n    varying vec2 v_uv;\n\n    ${Wu}\n\n    void main() {\n      v_normal = quat_transform(a_instanceRotation, a_normal);\n      v_uv = a_uv;\n\n      gl_Position = u_mvp * vec4(quat_transform(a_instanceRotation, a_position) * a_instanceScale + a_instancePosition, 1.0);\n    }\n  `,fsSimpleModel:"\n    uniform sampler2D u_texture;\n    uniform bool u_alphaTest;\n    uniform bool u_unshaded;\n\n    varying vec3 v_normal;\n    varying vec2 v_uv;\n\n    const vec3 lightDirection = normalize(vec3(-0.3, -0.3, 0.25));\n\n    void main() {\n      vec4 color = texture2D(u_texture, v_uv);\n\n      // 1bit Alpha\n      if (u_alphaTest && color.a < 0.75) {\n        discard;\n      }\n\n      if (!u_unshaded) {\n        color *= clamp(dot(v_normal, lightDirection) + 0.45, 0.1, 1.0);\n      }\n\n      gl_FragColor = color;\n    }\n  "};const _f={AAAB:1,AAAC:1,AABA:1,AABB:2,AABC:0,AACA:1,AACB:0,AACC:1,ABAA:1,ABAB:1,ABAC:0,ABBA:2,ABBB:1,ABBC:0,ABCA:0,ABCB:0,ABCC:0,ACAA:1,ACAB:0,ACAC:1,ACBA:0,ACBB:0,ACBC:0,ACCA:1,ACCB:0,ACCC:1,BAAA:1,BAAB:1,BAAC:0,BABA:1,BABB:1,BABC:0,BACA:0,BACB:0,BACC:0,BBAA:1,BBAB:1,BBAC:0,BBBA:1,BBCA:0,BCAA:0,BCAB:0,BCAC:0,BCBA:0,BCCA:0,CAAA:1,CAAB:0,CAAC:1,CABA:0,CABB:0,CABC:0,CACA:1,CACB:0,CACC:1,CBAA:0,CBAB:0,CBAC:0,CBBA:0,CBCA:0,CCAA:1,CCAB:0,CCAC:1,CCBA:0,CCCA:1},xf={AAAB:2,AAAC:1,AABA:1,AABB:3,AABC:0,AACA:1,AACB:0,AACC:3,ABAA:1,ABAB:2,ABAC:0,ABBA:3,ABBB:0,ABBC:0,ABCA:0,ABCB:0,ABCC:0,ACAA:1,ACAB:0,ACAC:2,ACBA:0,ACBB:0,ACBC:0,ACCA:3,ACCB:0,ACCC:1,BAAA:1,BAAB:3,BAAC:0,BABA:2,BABB:0,BABC:0,BACA:0,BACB:0,BACC:0,BBAA:3,BBAB:1,BBAC:0,BBBA:1,BBCA:0,BCAA:0,BCAB:0,BCAC:0,BCBA:0,BCCA:0,CAAA:1,CAAB:0,CAAC:3,CABA:0,CABB:0,CABC:0,CACA:2,CACB:0,CACC:1,CBAA:0,CBAB:0,CBAC:0,CBBA:0,CBCA:0,CCAA:3,CCAB:0,CCAC:1,CCBA:0,CCCA:1};function Tf(t,e,i){return"Cliffs"===t?Math.min(i,_f[e]):Math.min(i,xf[e])}class Ef{constructor(t,e,i,n){let r=new Qo(e).geosets[0],a=r.vertices,s=r.normals,o=r.uvSets[0],l=r.faces,h=a.byteLength,u=h+s.byteLength,c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,u+o.byteLength,t.STATIC_DRAW),t.bufferSubData(t.ARRAY_BUFFER,0,a),t.bufferSubData(t.ARRAY_BUFFER,h,s),t.bufferSubData(t.ARRAY_BUFFER,u,o);let d=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,d),t.bufferData(t.ELEMENT_ARRAY_BUFFER,l,t.STATIC_DRAW);let f=4*i.length,m=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,f+n.length,t.STATIC_DRAW),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(i)),t.bufferSubData(t.ARRAY_BUFFER,f,new Uint8Array(n)),this.vertexBuffer=c,this.faceBuffer=d,this.normalsOffset=h,this.uvsOffset=u,this.elements=l.length,this.locationAndTextureBuffer=m,this.texturesOffset=f,this.instances=i.length/3}render(t,e,i){t.bindBuffer(t.ARRAY_BUFFER,this.locationAndTextureBuffer),t.vertexAttribPointer(i.a_instancePosition,3,t.FLOAT,!1,12,0),t.vertexAttribPointer(i.a_instanceTexture,1,t.UNSIGNED_BYTE,!1,1,this.texturesOffset),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.vertexAttribPointer(i.a_position,3,t.FLOAT,!1,12,0),t.vertexAttribPointer(i.a_normal,3,t.FLOAT,!1,12,this.normalsOffset),t.vertexAttribPointer(i.a_uv,2,t.FLOAT,!1,8,this.uvsOffset),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.faceBuffer),e.drawElementsInstancedANGLE(t.TRIANGLES,this.elements,t.UNSIGNED_SHORT,0,this.instances)}}function Sf(t,e){return t.sequence.rarity<e.sequence.rarity}function Mf(t){let e=function(t,e){(e=function(t,e){let i=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];r.name.split("-")[0].replace(/\d/g,"").trim().toLowerCase()===t&&i.push({sequence:r,index:n})}return i}(t,e)).sort(Sf);for(var i=0,n=e.length;i<n;i++){let t=e[i].sequence.rarity;if(0===t)break;if(10*Math.random()>t)return e[i]}let r=e.length-i;return e[i+Math.floor(Math.random()*r)]}("stand",t.model.sequences);e&&t.setSequence(e.index)}function Rf(t){t.model.whenLoaded().then(e=>{Mf(t),t.on("seqend",Mf)})}let If=l.create(),Bf=l.create();var Cf={glMatrix:f,ModelViewer:du,Scene:su,Camera:Yh,handlers:{blp:gu,bmp:vu,dds:ku,geo:Ju,m3:Bc,mdx:mf,imagetexture:gf,obj:wf,tga:yf,w3x:{MapViewer:class extends du{constructor(t,e){super(t),this.batchSize=256,this.on("error",(t,e,i)=>console.error(t,e,i)),this.addHandler(Xu),this.addHandler(ff),this.wc3PathSolver=e,this.groundShader=this.loadShader("Ground",Af.vsGround,Af.fsGround),this.waterShader=this.loadShader("Water",Af.vsWater,Af.fsWater),this.cliffShader=this.loadShader("Cliffs",Af.vsCliffs,Af.fsCliffs),this.simpleModelShader=this.loadShader("SimpleModel",Af.vsSimpleModel,Af.fsSimpleModel),this.scene=this.addScene(),this.camera=this.scene.camera,this.waterIndex=0,this.waterIncreasePerFrame=0,this.anyReady=!1,this.terrainCliffsAndWaterLoaded=!1,this.terrainData=new rd.a,this.cliffTypesData=new rd.a,this.waterData=new rd.a,this.terrainReady=!1,this.cliffsReady=!1,this.whenLoaded(["TerrainArt\\Terrain.slk","TerrainArt\\CliffTypes.slk","TerrainArt\\Water.slk"].map(t=>this.loadGeneric(e(t)[0],"text"))).then(([t,e,i])=>{this.terrainCliffsAndWaterLoaded=!0,this.terrainData.load(t.data),this.cliffTypesData.load(e.data),this.waterData.load(i.data),this.emit("terrainloaded")}),this.doodadsAndDestructiblesLoaded=!1,this.doodadsData=new rd.a,this.doodadMetaData=new rd.a,this.destructableMetaData=new rd.a,this.doodads=[],this.terrainDoodads=[],this.doodadsReady=!1,this.whenLoaded(["Doodads\\Doodads.slk","Doodads\\DoodadMetaData.slk","Units\\DestructableData.slk","Units\\DestructableMetaData.slk"].map(t=>this.loadGeneric(e(t)[0],"text"))).then(([t,e,i,n])=>{this.doodadsAndDestructiblesLoaded=!0,this.doodadsData.load(t.data),this.doodadMetaData.load(e.data),this.doodadsData.load(i.data),this.destructableMetaData.load(n.data),this.emit("doodadsloaded")}),this.unitsAndItemsLoaded=!1,this.unitsData=new rd.a,this.unitMetaData=new rd.a,this.units=[],this.unitsReady=!1,this.whenLoaded(["Units\\UnitData.slk","Units\\unitUI.slk","Units\\ItemData.slk","Units\\UnitMetaData.slk"].map(t=>this.loadGeneric(e(t)[0],"text"))).then(([t,e,i,n])=>{this.unitsAndItemsLoaded=!0,this.unitsData.load(t.data),this.unitsData.load(e.data),this.unitsData.load(i.data),this.unitMetaData.load(n.data),this.emit("unitsloaded")})}renderGround(){if(this.terrainReady){let t=this.gl,e=this.webgl,i=e.extensions.instancedArrays,n=this.groundShader,r=n.uniforms,a=n.attribs,{columns:s,rows:o,centerOffset:l,vertexBuffer:h,faceBuffer:u,heightMap:c,instanceBuffer:d,instanceCount:f,textureBuffer:m,variationBuffer:g}=this.terrainRenderData,p=this.tilesetTextures,v=a.a_InstanceID,b=a.a_position,w=a.a_textures,y=a.a_variations;t.disable(t.BLEND),e.useShaderProgram(n),t.uniformMatrix4fv(r.u_mvp,!1,this.camera.worldProjectionMatrix),t.uniform2fv(r.u_offset,l),t.uniform2f(r.u_size,s-1,o-1),t.uniform1i(r.u_heightMap,0),t.uniform1i(r.u_tilesets,1),t.uniform1f(r.u_tilesetHeight,1/(p.length+1)),t.uniform1f(r.u_tilesetCount,p.length+1),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,c),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.tilesetsTexture),t.bindBuffer(t.ARRAY_BUFFER,h),t.vertexAttribPointer(b,2,t.FLOAT,!1,8,0),t.bindBuffer(t.ARRAY_BUFFER,d),t.vertexAttribPointer(v,1,t.FLOAT,!1,4,0),i.vertexAttribDivisorANGLE(v,1),t.bindBuffer(t.ARRAY_BUFFER,m),t.vertexAttribPointer(w,4,t.UNSIGNED_BYTE,!1,4,0),i.vertexAttribDivisorANGLE(w,1),t.bindBuffer(t.ARRAY_BUFFER,g),t.vertexAttribPointer(y,4,t.UNSIGNED_BYTE,!1,4,0),i.vertexAttribDivisorANGLE(y,1),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),i.drawElementsInstancedANGLE(t.TRIANGLES,6,t.UNSIGNED_BYTE,0,f),i.vertexAttribDivisorANGLE(w,0),i.vertexAttribDivisorANGLE(y,0),i.vertexAttribDivisorANGLE(v,0)}}renderWater(){if(this.terrainReady){let t=this.gl,e=this.webgl,i=e.extensions.instancedArrays,n=this.waterShader,r=n.uniforms,a=n.attribs,{columns:s,rows:o,centerOffset:l,vertexBuffer:h,faceBuffer:u,heightMap:c,instanceBuffer:d,instanceCount:f,waterHeightMap:m,waterBuffer:g}=this.terrainRenderData,p=a.a_InstanceID,v=a.a_position,b=a.a_isWater;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),e.useShaderProgram(n),t.uniformMatrix4fv(r.u_mvp,!1,this.camera.worldProjectionMatrix),t.uniform2fv(r.u_offset,l),t.uniform2f(r.u_size,s-1,o-1),t.uniform1i(r.u_heightMap,0),t.uniform1i(r.u_waterHeightMap,1),t.uniform1i(r.u_waterMap,2),t.uniform1f(r.u_offsetHeight,this.waterHeightOffset),t.uniform1f(r.u_tileIndex,0|this.waterIndex),t.uniform4fv(r.u_maxDeepColor,this.maxDeepColor),t.uniform4fv(r.u_minDeepColor,this.minDeepColor),t.uniform4fv(r.u_maxShallowColor,this.maxShallowColor),t.uniform4fv(r.u_minShallowColor,this.minShallowColor),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,c),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,m),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this.waterTexture),t.bindBuffer(t.ARRAY_BUFFER,h),t.vertexAttribPointer(v,2,t.FLOAT,!1,8,0),t.bindBuffer(t.ARRAY_BUFFER,d),t.vertexAttribPointer(p,1,t.FLOAT,!1,4,0),i.vertexAttribDivisorANGLE(p,1),t.bindBuffer(t.ARRAY_BUFFER,g),t.vertexAttribPointer(b,1,t.UNSIGNED_BYTE,!1,1,0),i.vertexAttribDivisorANGLE(b,1),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),i.drawElementsInstancedANGLE(t.TRIANGLES,6,t.UNSIGNED_BYTE,0,f),i.vertexAttribDivisorANGLE(b,0),i.vertexAttribDivisorANGLE(p,0)}}renderCliffs(){if(this.cliffsReady){let t=this.gl,e=t.extensions.instancedArrays,i=this.webgl,n=this.cliffShader,r=n.attribs,a=n.uniforms,{centerOffset:s,cliffHeightMap:o,heightMapSize:l}=this.terrainRenderData;t.disable(t.BLEND),i.useShaderProgram(n),t.uniformMatrix4fv(a.u_mvp,!1,this.camera.worldProjectionMatrix),t.uniform1i(a.u_heightMap,0),t.uniform2fv(a.u_pixel,l),t.uniform2fv(a.u_centerOffset,s),t.uniform1i(a.u_texture1,1),t.uniform1i(a.u_texture2,2),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.cliffTextures[0].webglResource),this.cliffTextures.length>1&&(t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this.cliffTextures[1].webglResource)),e.vertexAttribDivisorANGLE(r.a_instancePosition,1),e.vertexAttribDivisorANGLE(r.a_instanceTexture,1);for(let i of this.cliffModels)i.render(t,e,r);e.vertexAttribDivisorANGLE(r.a_instancePosition,0),e.vertexAttribDivisorANGLE(r.a_instanceTexture,0)}}render(){this.anyReady&&(this.gl.viewport(...this.camera.rect),this.renderGround(),this.renderCliffs(),super.renderOpaque(),super.renderTranslucent(),this.renderWater())}update(){this.anyReady&&(this.waterIndex+=this.waterIncreasePerFrame,this.waterIndex>=this.waterTextures.length&&(this.waterIndex=0),super.update())}async loadMap(t){this.mapMpq=new yh(t,!0);let e=this.wc3PathSolver,i=new eh(this.mapMpq.get("war3map.w3i").arrayBuffer()).tileset;this.emit("maploaded"),this.tilesetMpq=new Cl((await this.loadGeneric(e(`${i}.mpq`)[0],"arrayBuffer").whenLoaded()).data,!0),this.mapPathSolver=(t=>{let i=t.replace(/\//g,"\\"),n=this.mapMpq.get(i)||this.tilesetMpq.get(i);return n?[n.arrayBuffer(),t.substr(t.lastIndexOf(".")),!1]:e(t)});let n=new ql(this.mapMpq.get("war3map.w3e").arrayBuffer());this.corners=n.corners,this.centerOffset=n.centerOffset,this.mapSize=n.mapSize,this.emit("tilesetloaded"),this.terrainCliffsAndWaterLoaded?this.loadTerrainCliffsAndWater(n):this.once("terrainloaded",()=>this.loadTerrainCliffsAndWater(n));let r=this.mapMpq.readModifications();this.doodadsAndDestructiblesLoaded?this.loadDoodadsAndDestructibles(r):this.once("doodadsloaded",()=>this.loadDoodadsAndDestructibles()),this.unitsAndItemsLoaded?this.loadUnitsAndItems(r):this.once("unitsloaded",()=>this.loadUnitsAndItems())}loadDoodadsAndDestructibles(t){this.applyModificationFile(this.doodadsData,this.doodadMetaData,t.w3d),this.applyModificationFile(this.doodadsData,this.destructableMetaData,t.w3b);let e=new Dl(this.mapMpq.get("war3map.doo").arrayBuffer()),i=this.scene;for(let t of e.doodads){let e=this.doodadsData.getRow(t.id),n=e.file,r=e.numVar;n.endsWith(".mdl")&&(n=n.slice(0,-4));let a=n;n+=".mdx",r>1&&(a+=Math.max(t.variation,r-1)),a+=".mdx";let s,o=this.mapMpq.get(a)||this.mapMpq.get(n),l=(s=o?this.load(o.name):this.load(a)).addInstance();l.move(t.location),l.rotateLocal(quat.setAxisAngle(quat.create(),Ka,t.angle)),l.scale(t.scale),l.setScene(i),Rf(l)}this.doodadsReady=!0,this.anyReady=!0}loadUnitsAndItems(t){this.applyModificationFile(this.unitsData,this.unitMetaData,t.w3u),this.applyModificationFile(this.unitsData,this.unitMetaData,t.w3t);let e=new wh(this.mapMpq.get("war3mapUnits.doo").arrayBuffer()),i=this.scene;for(let t of e.units){let e;if("sloc"===t.id?e="Objects\\StartLocation\\StartLocation.mdx":((e=this.unitsData.getRow(t.id).file).endsWith(".mdl")&&(e=e.slice(0,-4)),e+=".mdx"),e){let n=this.load(e).addInstance();n.move(t.location),n.rotateLocal(quat.setAxisAngle(quat.create(),Ka,t.angle)),n.scale(t.scale),n.setTeamColor(t.player),n.setScene(i),Rf(n)}else console.log("Unknown unit ID",t.id,t)}this.unitsReady=!0,this.anyReady=!0}async loadTerrainCliffsAndWater(t){let e=t.tileset;this.tilesets=[],this.tilesetTextures=[];for(let e of t.groundTilesets){let t=this.terrainData.getRow(e);this.tilesets.push(t),this.tilesetTextures.push(this.load(`${t.dir}\\${t.file}.blp`))}this.blightTextureIndex=this.tilesetTextures.length,this.tilesetTextures.push(this.load(`TerrainArt\\Blight\\${{A:"Ashen",B:"Barrens",C:"Felwood",D:"Cave",F:"Lordf",G:"Dungeon",I:"Ice",J:"DRuins",K:"Citadel",L:"Lords",N:"North",O:"Outland",Q:"VillageFall",V:"Village",W:"Lordw",X:"Village",Y:"Village",Z:"Ruins"}[e]}_Blight.blp`)),this.cliffTilesets=[],this.cliffTextures=[];for(let e of t.cliffTilesets){let t=this.cliffTypesData.getRow(e);this.cliffTilesets.push(t),this.cliffTextures.push(this.load(`${t.texDir}\\${t.texFile}.blp`))}let i=this.waterData.getRow(`${e}Sha`);this.waterHeightOffset=i.height,this.waterIncreasePerFrame=i.texRate/60,this.waterTextures=[],this.maxDeepColor=new Float32Array([i.Dmax_R,i.Dmax_G,i.Dmax_B,i.Dmax_A]),this.minDeepColor=new Float32Array([i.Dmin_R,i.Dmin_G,i.Dmin_B,i.Dmin_A]),this.maxShallowColor=new Float32Array([i.Smax_R,i.Smax_G,i.Smax_B,i.Smax_A]),this.minShallowColor=new Float32Array([i.Smin_R,i.Smin_G,i.Smin_B,i.Smin_A]);for(let t=0,e=i.numTex;t<e;t++)this.waterTextures.push(this.load(`${i.texFile}${t<10?"0":""}${t}.blp`));await this.whenLoaded([...this.tilesetTextures,...this.waterTextures]);let n=this.gl;this.createTilesetsAndWaterTextures();let r=t.corners,[a,s]=this.mapSize,o=this.centerOffset,l=(a-1)*(s-1),h=new Float32Array(a*s),u=new Float32Array(a*s),c=new Float32Array(a*s),d=new Uint8Array(4*l),f=new Uint8Array(4*l),m=new Uint8Array(l),g=0,p={};this.columns=a-1,this.rows=s-1;for(let t=0;t<s;t++)for(let e=0;e<a;e++){let i=r[t][e],n=t*a+e;if(h[n]=i.groundHeight,u[n]=i.groundHeight+i.layerHeight-2,c[n]=i.waterHeight,t<s-1&&e<a-1){if(m[g]=this.isWater(e,t),this.isCliff(e,t)){let n=i.layerHeight,a=r[t][e+1].layerHeight,s=r[t+1][e].layerHeight,l=r[t+1][e+1].layerHeight,h=Math.min(n,a,s,l),u=this.cliffFileName(n,a,s,l,h);if("AAAA"!==u){let n=i.cliffTexture;15===n&&(n=1);let r=this.cliffTilesets[n].cliffModelDir,a=`Doodads\\Terrain\\${r}\\${r}${u}${Tf(r,u,i.cliffVariation)}.mdx`;p[a]||(p[a]={locations:[],textures:[]}),p[a].locations.push(128*(e+1)+o[0],128*t+o[1],128*(h-2)),p[a].textures.push(n)}}else{let n=this.cornerTexture(e,t),r=this.cornerTexture(e+1,t),a=this.cornerTexture(e,t+1),s=this.cornerTexture(e+1,t+1),o=Gc([n,r,a,s]).sort();d[4*g]=o[0]+1,f[4*g]=this.getVariation(o[0],i.groundVariation),o.shift();for(let t=0,e=o.length;t<e;t++){let e=o[t],i=0;r===e&&(i|=1),n===e&&(i|=2),s===e&&(i|=4),a===e&&(i|=8),d[4*g+1+t]=e+1,f[4*g+1+t]=i}}g+=1}}let v=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,v),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),n.STATIC_DRAW);let b=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,b),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,1,3,2]),n.STATIC_DRAW);let w=n.createTexture();n.bindTexture(n.TEXTURE_2D,w),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,a,s,0,n.ALPHA,n.FLOAT,h);let y=n.createTexture();n.bindTexture(n.TEXTURE_2D,y),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,a,s,0,n.ALPHA,n.FLOAT,u);let A=n.createTexture();n.bindTexture(n.TEXTURE_2D,A),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,a,s,0,n.ALPHA,n.FLOAT,c);let _=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,_),n.bufferData(n.ARRAY_BUFFER,new Float32Array(l).map((t,e,i)=>e),n.STATIC_DRAW);let x=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,x),n.bufferData(n.ARRAY_BUFFER,d,n.STATIC_DRAW);let T=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,T),n.bufferData(n.ARRAY_BUFFER,f,n.STATIC_DRAW);let E=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,E),n.bufferData(n.ARRAY_BUFFER,m,n.STATIC_DRAW);let S=new Float32Array([1/a,1/s]);this.terrainRenderData={rows:s,columns:a,centerOffset:o,vertexBuffer:v,faceBuffer:b,heightMap:y,instanceBuffer:_,instanceCount:l,cornerTextures:d,textureBuffer:x,variationBuffer:T,heightMapSize:S,cliffHeightMap:w,waterHeightMap:A,waterBuffer:E},this.terrainReady=!0,this.anyReady=!0;let M=Object.entries(p).map(t=>{let e=t[0],{locations:i,textures:r}=t[1];return this.loadGeneric(this.mapPathSolver(e)[0],"arrayBuffer").whenLoaded().then(t=>new Ef(n,t.data,i,r))});this.cliffModels=await Promise.all(M),this.cliffsReady=!0}cliffFileName(t,e,i,n,r){return String.fromCharCode(65+t-r)+String.fromCharCode(65+i-r)+String.fromCharCode(65+n-r)+String.fromCharCode(65+e-r)}createTilesetsAndWaterTextures(){let t=this.tilesetTextures,e=t.length,i=document.createElement("canvas"),n=i.getContext("2d");i.width=2048,i.height=64*(e+1);for(let i=0;i<e;i++){let e=t[i].imageData;for(let t=0;t<16;t++){let r=t%4*64,a=64*(t/4|0);n.putImageData(e,64*t-r,64*(i+1)-a,r,a,64,64)}if(512===e.width)for(let t=0;t<16;t++){let r=256+t%4*64,a=64*(t/4|0);n.putImageData(e,1024+64*t-r,64*(i+1)-a,r,a,64,64)}}let r=this.gl,a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),this.tilesetsTexture=a,i.height=384;let s=this.waterTextures;for(let t=0,e=s.length;t<e;t++){let e=t%16,i=t/16|0;n.putImageData(s[t].imageData,128*e,128*i)}let o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),this.waterTexture=o}getVariation(t,e){let i=this.tilesetTextures[t];return i.width>i.height?e<16?16+e:16===e?15:0:0===e?0:15}isCliff(t,e){if(t<1||t>this.columns-1||e<1||e>this.rows-1)return!1;let i=this.corners,n=i[e][t].layerHeight,r=i[e][t+1].layerHeight,a=i[e+1][t].layerHeight,s=i[e+1][t+1].layerHeight;return n!==r||n!==a||n!==s}isWater(t,e){let i=this.corners;return i[e][t].water||i[e][t+1].water||i[e+1][t].water||i[e+1][t+1].water}cliffGroundIndex(t){let e=this.cliffTilesets[t].groundTile,i=this.tilesets;for(let t=0,n=i.length;t<n;t++)if(i[t].tileID===e)return t}cornerTexture(t,e){let i=this.corners,n=this.columns,r=this.rows;for(let a=-1;a<1;a++)for(let s=-1;s<1;s++)if(t+s>0&&t+s<n-1&&e+a>0&&e+a<r-1&&this.isCliff(t+s,e+a)){let n=i[e+a][t+s].cliffTexture;return 15===n&&(n=1),this.cliffGroundIndex(n)}let a=i[e][t];return a.blight?this.blightTextureIndex:a.groundTexture}load(t){return super.load(t,this.mapPathSolver)}applyModificationFile(t,e,i){i&&(this.applyModificationTable(t,e,i.originalTable),this.applyModificationTable(t,e,i.customTable))}applyModificationTable(t,e,i){for(let n of i.objects){let i=t.getRow(n.oldId),r=n.newId;""===n.newId||t.getRow(r)||t.setRow(n.newId,{...i});for(let t of n.modifications){let n=e.getRow(t.id);n?i[n.field]=t.value:console.warn("Unknown modification ID",t.id)}}}groundNormal(t,e,i){let n=this.centerOffset,r=this.mapSize,a=0|(e=(e-n[0])/128),s=0|(i=(i-n[1])/128);if(a>=0&&a<r[0]-1&&s>=0&&s<r[1]-1){let n=this.corners,r=n[s][a].groundHeight,o=n[s][a+1].groundHeight,h=n[s+1][a].groundHeight,u=n[s+1][a+1].groundHeight;e-a+(i-s)<1?(l.set(If,1,0,o-r),l.set(Bf,0,1,h-r)):(l.set(If,-1,0,u-h),l.set(Bf,0,1,u-o)),l.normalize(t,l.cross(t,If,Bf))}else l.set(t,0,0,1);return t}}}}},Lf=i(24);class Uf{constructor(t){this.model=t,this.objects=[],this.current={children:[]},this.stack=[this.current],this.map={},this.addObjects(t.sequences,"Sequence"),this.addObjects(t.globalSequences,"GlobalSequence"),this.addObjects(t.textures,"Texture"),this.addObjects(t.materials,"Material"),this.addObjects(t.textureAnimations,"TextureAnimation"),this.addObjects(t.geosets,"Geoset"),this.addObjects(t.geosetAnimations,"GeosetAnimation"),this.addObjects(t.bones,"Bone",!0),this.addObjects(t.lights,"Light",!0),this.addObjects(t.helpers,"Helper",!0),this.addObjects(t.attachments,"Attachment",!0),this.addObjects(t.particleEmitters,"ParticleEmitter",!0),this.addObjects(t.particleEmitters2,"ParticleEmitter2",!0),this.addObjects(t.ribbonEmitters,"RibbonEmitter",!0),this.addObjects(t.cameras,"Camera"),this.addObjects(t.eventObjects,"EventObject",!0),this.addObjects(t.collisionShapes,"CollisionShape",!0)}addObjects(t,e,i){let n=[];for(let[r,a]of t.entries()){let t=a.name||a.path,s={objectType:e,index:r,warnings:0,errors:0,children:[]};t&&(s.name=t),i||(s.uses=0),n.push(s)}this.map[e]=n,i&&this.objects.push(...t)}push(t,e){let i,n=this.map[t];n?i=n[e]:(i={objectType:t,warnings:0,errors:0,children:[]},"number"==typeof e&&(i.index=e)),this.current.children.push(i),this.current=i,this.stack.unshift(i)}pop(){this.stack.shift(),this.current=this.stack[0]}add(t,e){this.current.children.push({type:t,message:e})}addWarning(t){this.add("warning",t);for(let t of this.stack)t.warnings+=1}addError(t){this.add("error",t);for(let t of this.stack)t.errors+=1}assertWarning(t,e){t||this.addWarning(e)}assertError(t,e){t||this.addError(e)}addReference(t,e){t?this.map[t][e].uses+=1:this.current.uses+=1}getInvisibility(t){let e=[];t instanceof jo&&-1!==t.geosetAnimationId&&(t=this.model.geosetAnimations[t.geosetAnimationId]);for(let i of t.animations){let t=i.name;if("Visibility"===Co[t][0]||"KGAO"===t){let t=i.tracks;for(let e of this.model.sequences){let[i,n]=e.interval,r=-1,a=-1;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s.frame>=i&&-1===r&&(r=e),s.frame>n&&-1===a){a=e-1;break}}}return e}}return e}}function kf(t,e,i){return e<=t&&t<=i}function Ff(t,e){let i=e.layers;if(i.length)for(let[e,n]of i.entries())t.push("Layer",e),Pf(t,n),t.pop();else t.addWarning("No layers")}function Pf(t,e){let i=t.model.textures,n=t.model.textureAnimations;for(let n of function(t){for(let e of t.animations)if("KMTF"===e.name){let t=[];for(let i of e.tracks)t.push(i.value);return Gc(t)}return[t.textureId]}(e))kf(n,0,i.length-1)?t.addReference("Texture",n):t.addError(`Invalid texture ${n}`);let r=e.textureAnimationId;-1!==r&&(kf(r,0,n.length-1)?t.addReference("TextureAnimation",r):t.addError(`Invalid texture animation ${r}`)),t.assertWarning(kf(e.filterMode,0,6),`Invalid filter mode ${e.filterMode}`),Nf(t,e)}function Df(t,e){let i=t.objects,n=e.vertexGroups,r=e.matrixGroups,a=e.matrixIndices,s=[];for(let t=0,e=r.length,i=0;t<e;t++)s.push(a.subarray(i,i+r[t])),i+=r[t];for(let e=0,r=n.length;e<r;e++){let r=s[n[e]];if(r)for(let n of r){let r=i[n];r?t.assertWarning(r instanceof jo,`Vertex ${e}: Attached to generic object "${r.name}" which is not a bone`):t.addError(`Vertex ${e}: Attached to generic object ${n} which does not exist`)}else t.addWarning(`Vertex ${e}: Attached to vertex group ${n[e]} which does not exist`)}}function Of(t,e){let i=e.objectId,n=e.parentId;t.assertError(-1===n||function(t,e){for(let i of t.objects)if(i.objectId===e)return!0;return!1}(t,n),`Invalid parent ${n}`),t.assertError(i!==n,"Same object and parent"),Nf(t,e)}function Nf(t,e){for(let i of e.animations)t.push(jf.get(i.name)),Vf(t,i),t.pop()}function Vf(t,e){let i=e.globalSequenceId;-1!==i&&(kf(i,0,t.model.globalSequences.length-1)?t.addReference("GlobalSequence",i):t.addError(`Invalid global sequence ${i}`)),"KP2R"===e.name&&t.addWarning("Using a variation animation."),"KP2G"===e.name&&t.addWarning("Using a gravity animation."),function(t,e){"Visibility"===jf.get(e.name)&&0!==e.interpolationType&&t.addWarning("Interpolation type not set to None")}(t,e),function(t,e,i){let n=t.model.sequences,r={};t.assertWarning(e.length,"Zero tracks"),t.assertWarning(-1!==i||0===e.length||0!==n.length,"Tracks used without sequences");for(let n=0,a=e.length;n<a;n++){let a=e[n],s=Gf(t,a.frame,i),o=s[0],l=s[1],h=s[2];t.assertWarning(1===e.length||-1!==o||0===a.frame,`Track ${n}: Frame ${a.frame} is not in any sequence`),t.assertWarning(a.frame>=0,`Track ${n}: Negative frame`),-1!==o&&(r[o]||(r[o]=[!1,!1,0]),l&&(r[o][0]=!0),h&&(r[o][1]=!0),r[o][2]+=1)}for(let e of Object.keys(r)){let a=r[e];if(-1===i){let i=n[e];t.assertWarning(a[0]||1===a[2],`No opening track for "${i.name}" at frame ${i.interval[0]}`),t.assertWarning(a[1]||1===a[2],`No closing track for "${i.name}" at frame ${i.interval[1]}`)}}}(t,e.tracks,i)}function Gf(t,e,i){let n=-1,r=!1,a=!1;if(-1===i){let i=t.model.sequences;for(let t=0,s=i.length;t<s;t++){let s=i[t].interval;if(e>=s[0]&&e<=s[1]){n=t,e===s[0]?r=!0:e===s[1]&&(a=!0);break}}}else{let s=t.model.globalSequences[i];n=i,0===e?r=!0:e===s&&(a=!0)}return[n,r,a]}let jf=new Map([["KMTF","Texture ID"],["KMTA","Alpha"],["KTAT","Translation"],["KTAR","Rotation"],["KTAS","Scaling"],["KGAO","Alpha"],["KGAC","Color"],["KLAS","Attenuation Start"],["KLAE","Attenuation End"],["KLAC","Color"],["KLAI","Intensity"],["KLBI","Ambient Intensity"],["KLBC","Ambient Color"],["KLAV","Visibility"],["KATV","Visibility"],["KPEE","Emission Rate"],["KPEG","Gravity"],["KPLN","Longitude"],["KPLT","Latitude"],["KPEL","Lifespan"],["KPES","Speed"],["KPEV","Visibility"],["KP2E","Emission Rate"],["KP2G","Gravity"],["KP2L","Latitude"],["KP2R","Variation"],["KP2N","Length"],["KP2W","Width"],["KP2S","Speed"],["KP2V","Visibility"],["KRHA","Height Above"],["KRHB","Height Below"],["KRAL","Alpha"],["KRCO","Color"],["KRTX","Texture Slot"],["KRVS","Visibility"],["KCTR","Translation"],["KTTR","Rotation"],["KCRL","Target Translation"],["KGTR","Translation"],["KGRT","Rotation"],["KGSC","Scaling"]]),Hf=new Set(["attack","birth","cinematic","death","decay","dissipate","morph","portrait","sleep","spell","stand","walk"]),$f=new Set([1,2,11,21,31,32,33,34,35,36,37]);function qf(t,e){let i=e[t];for(let n=0;n<t;n++)if(e[n]===i)return!0;return!1}class zf{constructor(t){this.triggerData=t,this.stringTable=null,this.stack=[],this.generatedNames={},this.generatedFunctions=[],this.preplacedObjects={},this.output={ok:!1,error:"",changes:[]}}}function Kf(t,e,i){if(e.startsWith("gg_unit")||e.startsWith("gg_dest")){let n=t.preplacedObjects;n[e]||(n[e]=i)}}function Wf(t){return t.map(t=>t instanceof uh?`Trigger ${t.name}`:t instanceof hh||t instanceof oh?t.name:t instanceof lh?t.value:void 0).reverse().join(" > ")}function Yf(t){return function(t,e){let i=new hh;i.type=2,i.name=e?"CommentString":"CustomScriptCode",i.isEnabled=1;let n=new lh;return n.type=3,n.value=t,i.parameters[0]=n,i}(t,!1)}function Xf(t,e){let i=[],n=e.parameters,{args:r,scriptName:a}=t.triggerData.getFunction(e.type,e.name),s=e.name,o=r.length,l=!1,h=!1;if(a=a||e.name,o){let t=r[o-1];"code"===t?l=!0:"boolexpr"===t&&(h=!0)}if("IfThenElse"===s)i.push(Yf(`if ${Jf(t,n[0],r[0])} then`)),i.push(Yf(`call ${Jf(t,n[1],r[1])}`)),i.push(Yf("else")),i.push(Yf(`call ${Jf(t,n[2],r[2])}`)),i.push(Yf("endif"));else if("OrMultiple"===s)i[0]=Yf(e.ecas.slice().map(e=>Xf(t,e).map(t=>t.parameters[0].value)).join(" or "));else if("ForLoopAMultiple"===s){i.push(Yf(`set bj_forLoopAIndex = ${Jf(t,n[0],r[0])}`)),i.push(Yf(`set bj_forLoopAIndexEnd = ${Jf(t,n[1],r[1])}`)),i.push(Yf("loop")),i.push(Yf("exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd"));for(let n of e.ecas){let e=Xf(t,n);for(let t of e)i.push(Yf(`${t.parameters[0].value}`))}i.push(Yf("endloop"))}else if("IfThenElseMultiple"===s){let n,r=[],a=[];for(let t of e.ecas)0===t.group?n=t:1===t.group?r.push(t):2===t.group&&a.push(t);i.push(Yf(`if ${Xf(t,n)[0].parameters[0].value} then`));for(let e of r){let n=Xf(t,e);for(let t of n)i.push(Yf(`${t.parameters[0].value}`))}if(a.length){i.push(Yf("else"));for(let e of a){let n=Xf(t,e);for(let t of n)i.push(Yf(`${t.parameters[0].value}`))}}i.push(Yf("endif"))}else if(l||h){let s=function(t,e){return void 0===t.generatedNames[e.name]&&(t.generatedNames[e.name]=0),`Trig_${t.stack[t.stack.length-1].name.split("").map(t=>t.charCodeAt(0)>127?"_":t).join("").replace(/\s/g,"_")}_Func${t.generatedNames[e.name]++}_${e.name}`.replace(/_+/g,"_")}(t,e),o=`function ${s}`,l="nothing",u="call",c=n.length-1,d=e.name.endsWith("Multiple");h&&(o=`Filter(${o})`,l="boolean",u="return"),d&&(c=n.length);let f,m=[...n.slice(0,c).map((e,i)=>Jf(t,e,r[i])),o];e instanceof hh?i.push(Yf(`call ${a}(${m.join(", ")})`)):i.push(Yf(`${a}(${m.join(", ")})`));let g="";f=`function ${s} takes nothing returns ${l}\n${g=d?e.ecas.map(e=>Xf(t,e).map(t=>t.parameters[0].value).join("\n")).join("\n"):`${u} ${Jf(t,n[c],r[c])}`}\nendfunction`,t.generatedFunctions.push(f),t.output.changes.push({type:"generatedfunction",stack:Wf(t.stack),data:f})}else"CustomScriptCode"===s?i[0]=e:"SetVariable"===s?i.push(Yf(`set ${Jf(t,n[0],r[0])} = ${Jf(t,n[1],r[1])}`)):"OperatorString"===s?i.push(Yf(`${Jf(t,n[0],r[0])} + ${Jf(t,n[1],r[1])}`)):s.startsWith("Operator")?i.push(Yf(`${Jf(t,n[0],r[0])} ${Jf(t,n[1],r[1])} ${Jf(t,n[2],r[2])}`)):e instanceof hh?i.push(Yf(`call ${a}(${n.map((e,i)=>Jf(t,e,r[i])).join(", ")})`)):e instanceof oh&&i.push(Yf(`${a}(${n.map((e,i)=>Jf(t,e,r[i])).join(", ")})`));return i}function Jf(t,e,i){let n=e.type,r=e.value;if(0===n)return t.triggerData.getPreset(r);if(1===n)return r.startsWith("gg_")?(Kf(t,r,!1),r):e.isArray?`udg_${r}[${Jf(t,e.arrayIndex,"integer")}]`:`udg_${r}`;if(2===e.type)return Xf(t,e.subParameters)[0].parameters[0].value;if(3===e.type){let e=t.triggerData.getBaseType(i);if("string"===e&&"scriptcode"!==i){if(r.startsWith("TRIGSTR")){let e=parseInt(r.slice(8)),i=`StringTable${e}`,n=`function ${i} takes nothing returns string\nreturn "${t.stringTable.stringMap.get(e).replace(/\n/g,"\\n")}"\nendfunction`;return t.generatedFunctions.push(n),t.output.changes.push({type:"generatedstringtable",stack:Wf(t.stack),data:{value:r,callback:n}}),`${i}()`}return`"${r.replace(/\\/g,"\\\\")}"`}return"integer"===e&&isNaN(r)?`'${r}'`:r}return""}function Zf(t,e){let i=e.name;if("OperatorCompareBoolean"===i){let t=e.parameters[0].value;if("IsUnitOwnedByPlayer"===t)return function(t){let e=t.parameters[2].value;if("true"!==e&&"false"!==e)return!1;t.name="OperatorComparePlayer";let i=t.parameters[0].subParameters.parameters[0],n=t.parameters[0].subParameters.parameters[1];return t.parameters[0].value="GetOwningPlayer",t.parameters[0].subParameters.name="GetOwningPlayer",t.parameters[0].subParameters.parameters.length=1,t.parameters[0].subParameters.parameters[0]=i,t.parameters[1].value="true"===e?"OperatorEqualENE":"OperatorNotEqualENE",t.parameters[2]=n,!0}(e);if("IsUnitInRange"===t)return function(t){let e=t.parameters[2].value;if("true"!==e&&"false"!==e)return!1;t.name="OperatorCompareReal";let i=t.parameters[0].subParameters.parameters[0],n=t.parameters[0].subParameters.parameters[1],r=t.parameters[0].subParameters.parameters[2];t.parameters[0].value="DistanceBetweenPoints",t.parameters[0].subParameters.name="DistanceBetweenPoints";let a=new lh;a.type=2,a.value="GetUnitLoc",a.subParameters=new oh,a.subParameters.beginParameters=1,a.subParameters.type=3,a.subParameters.name="GetUnitLoc",a.subParameters.parameters[0]=i;let s=new lh;s.type=2,s.value="GetUnitLoc",s.subParameters=new oh,s.subParameters.beginParameters=1,s.subParameters.type=3,s.subParameters.name="GetUnitLoc",s.subParameters.parameters[0]=n;let o=new lh;return o.type=0,o.value="true"===e?"OperatorLessEq":"OperatorGreater",t.parameters[0].subParameters.parameters.length=0,t.parameters[0].subParameters.parameters[0]=a,t.parameters[0].subParameters.parameters[1]=s,t.parameters[1]=o,t.parameters[2]=r,!0}(e);if("IsUnitType"===t&&-1===e.group)return function(t){let e=t.parameters[0],i=e.subParameters;return"unittypedead"===i.parameters[1].value.toLowerCase()&&(e.value="IsUnitDeadBJ",i.name="IsUnitDeadBJ",i.parameters.length=1,!0)}(e);if("IsUnitRace"===t)return function(t){let e=t.parameters[2].value;if("true"!==e&&"false"!==e)return!1;t.name="OperatorCompareRace";let i=t.parameters[1].value,n=t.parameters[0].subParameters.parameters[1];t.parameters[0].value="GetUnitRace",t.parameters[0].subParameters.name="GetUnitRace",t.parameters[0].subParameters.parameters.length=1,t.parameters[2]=n;let r="OperatorEqualENE"===i,a="true"===e;return t.parameters[1].value=r===a?"OperatorEqualENE":"OperatorNotEqualENE",!0}(e)}else{if("SetHeroStr"===i||"SetHeroAgi"===i||"SetHeroInt"===i)return function(t){if("PermanentPerm"!==t.parameters[2].value)return!1;let e=t.name,i=t.parameters[0],n=t.parameters[1];t.name="ModifyHeroStat";let r=new lh;r.type=0,r.value=`HeroStat${e.slice(-3)}`;let a=new lh;return a.type=0,a.value="ModifyMethodSet",t.parameters[0]=r,t.parameters[1]=i,t.parameters[2]=a,t.parameters[3]=n,!0}(e);if("TriggerRegisterUnitStateEvent"===i)return function(t){let e=t.parameters[1].value;if("UnitStateLife"===e)t.name="TriggerRegisterUnitLifeEvent";else{if("UnitStateMana"!==e)throw new Error(`Trying to replace unit state "${e}"`);t.name="TriggerRegisterUnitManaEvent"}return t.parameters.splice(1,1),!0}(e);if(function(t){return"GetTriggerPlayerMouseX"===t||"GetTriggerPlayerMouseY"===t||"GetTriggerPlayerMousePosition"===t||"GetTriggerPlayerMouseButton"===t||"SetAbilityTooltip"===t||"SetAbilityExtendedTooltip"===t||"SetAbilityResearchTooltip"===t||"SetAbilityResearchExtendedTooltip"===t||"GetAbilityTooltip"===t||"GetAbilityExtendedTooltip"===t||"GetAbilityResearchTooltip"===t||"GetAbilityResearchExtendedTooltip"===t||"SetAbilityIcon"===t||"GetAbilityIcon"===t||"GetAbilityPosX"===t||"GetAbilityPosY"===t||"SetAbilityPosX"===t||"SetAbilityPosY"===t||"GetUnitMaxHP"===t||"SetUnitMaxHP"===t||"GetUnitMaxMana"===t||"SetUnitMaxMana"===t||"SetItemName"===t||"SetItemDescription"===t||"GetItemDescription"===t||"SetItemTooltip"===t||"GetItemTooltip"===t||"SetItemExtendedTooltip"===t||"GetItemExtendedTooltip"===t||"SetItemIconPath"===t||"GetItemIconPath"===t||"SetUnitName"===t||"SetHeroProperName"===t||"GetUnitBaseDamage"===t||"SetUnitBaseDamage"===t||"GetUnitDiceNumber"===t||"SetUnitDiceNumber"===t||"GetUnitDiceSides"===t||"SetUnitDiceSides"===t||"GetUnitAttackCooldown"===t||"SetUnitAttackCooldown"===t||"SetSpcialEffectColorByPlayer"===t||"SetSpecialEffectColor"===t||"SetSpecialEffectAlpha"===t||"SetSpecialEffectScale"===t||"SetSpecialEffectPosition"===t||"SetSpecialEffectHeight"===t||"SetSpecialEffectTimeScale"===t||"SetSpecialEffectTime"===t||"SetSpecialEffectOrientation"===t||"SetSpecialEffectYaw"===t||"SetSpecialEffectPitch"===t||"SetSpecialEffectRoll"===t||"SetSpecialEffectX"===t||"SetSpecialEffectY"===t||"SetSpecialEffectZ"===t||"SetSpecialEffectPositionLoc"===t||"GetLocalSpecialEffectX"===t||"GetLocalSpecialEffectY"===t||"GetLocalSpecialEffectZ"===t||"GetUnitArmor"===t||"SetUnitArmor"===t||"UnitHideAbility"===t||"UnitDisableAbility"===t||"UnitCancelTimedLife"===t||"IsUnitSelectable"===t||"IsUnitInvulnerable"===t||"UnitInterruptAttack"===t||"GetUnitCollisionSize"===t||"GetAbilityManaCost"===t||"GetAbilityCooldown"===t||"SetUnitAbilityCooldown"===t||"GetUnitAbilityCooldown"===t||"GetUnitAbilityCooldownRemaining"===t||"EndUnitAbilityCooldown"===t||"GetUnitAbilityManaCost"===t||"SetEventDamage"===t||"PlaySpecialEffect"===t||"PlaySpecialEffectWithTimeScale"===t}(i))return e.name=`Blz${i}`,e instanceof oh&&(t.stack[1].value=`Blz${i}`),"GetAbilityIcon"!==i&&"SetAbilityIcon"!==i||e.parameters.pop(),!0}return!1}function Qf(t,e){if(Zf(t,e)&&t.output.changes.push({type:"inlinegui",stack:Wf(t.stack)}),!t.triggerData.isBaseFunction(e.type,e.name))return!0;for(let i of e.parameters){if(0===i.type&&t.triggerData.isCustomPreset(i.value))return!0;if(tm(t,i))return!0}return!1}function tm(t,e){t.stack.unshift(e);let i=e.type,n=e.value;if(1===i)n.startsWith("gg_")&&Kf(t,n,!0);else if(2===i&&function(t,e){return t.stack.unshift(e),Qf(t,e)?(t.stack.shift(),!0):(t.stack.shift(),!1)}(t,e.subParameters))return t.stack.shift(),!0;return t.stack.shift(),!1}function em(t,e){let i=new hh;return i.name=t.name,i.type=t.type,i.group=e,i.isEnabled=1,i.parameters.push(...t.parameters),i}function im(t,e){if(t.stack.unshift(e),Qf(t,e)){if(!function(t,e){if("IfThenElse"===e.name){let t=e.parameters,i=em(t[0].subParameters,0),n=em(t[1].subParameters,1),r=em(t[2].subParameters,2);return e.name="IfThenElseMultiple",e.parameters.length=0,e.ecas.push(i,n,r),!0}if("ForGroup"===e.name||"ForForce"===e.name){let t=em(e.parameters[1].subParameters,0);return e.name=`${e.name}Multiple`,e.parameters.length=1,e.ecas.push(t),!0}return!1}(0,e))return t.stack.shift(),!0;if(Qf(t,e))return t.stack.shift(),!0;t.output.changes.push({type:"singletomultiple",stack:Wf(t.stack)})}let i=[];for(let r of e.ecas)if(im(t,r)){let a;if(n=e.name,0!==r.group||"AndMultiple"!==n&&"OrMultiple"!==n&&"IfThenElseMultiple"!==n)a=Xf(t,r);else{let i,n,s=Xf(t,r)[0].parameters[0].value;s.startsWith("call ")&&(s=s.slice(5)),"OrMultiple"===e.name?(i=s,n="true"):(i=`not (${s})`,n="false"),a=[Yf(`if ${i} then`),Yf(`return ${n}`),Yf("endif")]}for(let t of a)t.group=r.group;t.output.changes.push({type:"inlinecustomscript",stack:Wf(t.stack),data:a.map(t=>t.parameters[0].value).join("\n")}),i.push(...a)}else i.push(r);var n;return e.ecas=i,t.stack.shift(),!1}function nm(t,e){t.stack.unshift(e);let i=[],n=[];for(let t of e.ecas){let e=t.type;0===e||1===e?i.push(t):2===e&&n.push(t)}let r=[];for(let e of i){if(im(t,e))return t.stack.shift(),!0;r.push(e)}for(let e of n)if(im(t,e)){let i=Xf(t,e);t.output.changes.push({type:"inlinecustomscript",stack:Wf(t.stack),data:i.map(t=>t.parameters[0].value).join("\n")}),r.push(...i)}else r.push(e);return e.ecas=r,t.stack.shift(),!1}class rm{constructor(t){this.stream=t,this.rootNode={children:[]},this.stack=[this.rootNode],this.counts={},this.ident=0,this.searchBitmapName=!1}}let am=["Version","Model","Sequences","GlobalSequences","Textures","Materials","TextureAnims","PivotPoints"],sm=["Anim","Bitmap","Material","Layer","TVertexAnim","Geoset","GeosetAnim"],om=["Bone","Light","Helper","Attachment","ParticleEmitter","ParticleEmitter2","RibbonEmitter","Camera","EventObject","CollisionShape"];function lm(t,e){return"Anim"===e?"Sequences"===t.stack[0].name:am.includes(e)||sm.includes(e)||om.includes(e)}function hm(t,e){let i=t.counts,n=e,r=t.stream,a={name:e,ident:t.ident,start:r.index-e.length-1,end:0,data:"",children:[]};if(!am.includes(e)){if("Layer"===e){n=`Material${t.stack[0].index}${e}`}void 0===i[n]&&(i[n]=0);let r=i[n]++;a.index=r}"Bitmap"===e&&(t.searchBitmapName=!0),("Anim"===e||om.includes(e))&&(a.objectName=r.read()),t.stack[0].children.push(a),t.stack.unshift(a)}function um(t){let e=t.stream,i=t.stack[0];i.end=e.index,i.data=e.buffer.slice(i.start,i.end),t.stack.shift()}var cm=i(12),dm=i(10),fm=i(1),mm=i.n(fm);let gm={handle:"JassHandle",code:"function()",integer:"number",real:"number",boolean:"boolean",string:"string",agent:"JassAgent",event:"JassEvent",player:"JassPlayer",widget:"JassWidget",unit:"JassUnit",destructable:"JassDestructable",item:"JassItem",ability:"JassAbility",buff:"JassBuff",force:"JassForce",group:"JassGroup",trigger:"JassTrigger",triggercondition:"function(): boolean",triggeraction:"function()",timer:"JassTimer",location:"JassLocation",region:"JassRegion",rect:"JassRect",boolexpr:"function(): boolean",sound:"JassSound",conditionfunc:"function(): boolean",filterfunc:"function(): boolean",unitpool:"JassUnitPool",itempool:"JassItemPool",race:"JassRace",alliancetype:"JassAllianceType",racepreference:"JassRacePreference",gamestate:"JassGameState",igamestate:"JassIGameState",fgamestate:"JassFGameState",playerstate:"JassPlayerState",playerscore:"JassPlayerScore",playergameresult:"JassPlayerGameResult",unitstate:"JassUnitState",aidifficulty:"JassAiDifficulty",eventid:"JassEventId",gameevent:"JassGameEvent",playerevent:"JassPlayerEvent",playerunitevent:"JassPlayerUnitEvent",unitevent:"JassUnitEvent",limitop:"JassLimitOp",widgetevent:"JassWidgetEvent",dialogevent:"JassDialogEvent",unittype:"JassUnitType",gamespeed:"JassGameSpeed",gamedifficulty:"JassGameDifficulty",gametype:"JassGameType",mapflag:"JassMapFlag",mapvisibility:"JassMapVisibility",mapsetting:"JassMapSetting",mapdensity:"JassMapDensity",mapcontrol:"JassMapControl",playerslotstate:"JassPlayerSlotState",volumegroup:"JassVolumeGroup",camerafield:"JassCameraField",camerasetup:"JassCameraSetup",playercolor:"JassPlayerColor",placement:"JassPlacement",startlocprio:"JassStartLocPrio",raritycontrol:"JassRarityControl",blendmode:"JassBlendMode",texmapflags:"JassTexMapFlags",effect:"JassEffect",effecttype:"JassEffectType",weathereffect:"JassWeatherEffect",terraindeformation:"JassTerrainDeformation",fogstate:"JassFogState",fogmodifier:"JassFogModifier",dialog:"JassDialog",button:"JassButton",quest:"JassQuest",questitem:"JassQuestItem",defeatcondition:"JassDefeatCondition",timerdialog:"JassTimerDialog",leaderboard:"JassLeaderboard",multiboard:"JassMultiboard",multiboarditem:"JassMultiboardItem",trackable:"JassTrackable",gamecache:"JassGameCache",version:"JassVersion",itemtype:"JassItemType",texttag:"JassTextTag",attacktype:"JassAttackType",damagetype:"JassDamageType",weapontype:"JassWeaponType",soundtype:"JassSoundType",lightning:"JassLightning",pathingtype:"JassPathingType",image:"JassImage",ubersplat:"JassUberSplat",hashtable:"JassHashTable"};function pm(t){return`// /**\n//  * ${function(t){let e="";return t.isConstant&&(e+="constant "),e+=`native ${t.name} takes `,t.args.length?e+=t.args.map(t=>`${t.type} ${t.name}`).join(", "):e+="nothing",e+` returns ${t.returnType}`}(t)}\n//  *\n${function(t){let e=["param {JassContext} jass"];return t.args.length&&e.push(...t.args.map(t=>`param {${gm[t.type]}} ${t.name}`)),"nothing"!==t.returnType&&e.push(`return {${gm[t.returnType]}}`),"//  * @"+e.join("\n//  * @")}(t)}\n//  */`}var vm=i(13),bm=i(15);var wm=i(14),ym={recompile:cm.a,compileNatives:function(t){return function t(e){let i="";var n;return e instanceof mm.a.Program?i+=e.blocks.map(e=>t(e)).join("\n"):e instanceof mm.a.Native&&(i+=`${pm(e)}\n${`// export function ${e.name}(${n=e.args,n.length?["jass"].concat(n.map(t=>`${t.name}`)).join(", "):"jass"}) {}\n`}`),i}(Object(dm.parse)(t))},rebuild:function(t,e,i,n){let r=new vm.a(t),a=performance.now();function s(t){n(`[${performance.now()-a|0}] ${t}`)}s("Parsing common.j");let o=r.recompile(e);s("Running common.j"),r.run(o),s("Parsing Blizzard.j");let l=r.recompile(i);s("Running Blizzard.j"),r.run(l),s("Parsing war3map.j");let h=r.recompile(r.map.getScript());s("Running war3map.j"),r.run(h),s("Running config()"),r.call("config"),s("Running main()"),r.call("main"),s("Collecting handles");let u=new wh,c=u.units;for(let t of r.handles)if(t instanceof bm.a){let e=new bh;e.id=t.id,e.location[0]=t.location.x,e.location[1]=t.location.y,e.angle=t.face/180*Math.PI,e.player=t.player.index,e.targetAcquisition=t.acquireRange,c.push(e)}s(`Saving war3mapUnits.doo with ${c.length} objects`),t.set("war3mapUnits.doo",u.save()),s("Finished")},Context:vm.a,natives:wm,parse:dm.parse},Am={UnitTester:class{constructor(){let t=document.createElement("canvas");t.width=t.height=256;let e=new du(t,{alpha:!1,antialias:!1});e.gl.clearColor(.05,.05,.05,1),e.on("error",(t,e,i)=>console.log(t,e,i)),e.addHandler(ff),e.addHandler(Ic),e.addHandler(Xu),e.noCulling=!0,this.viewer=e,this.mathRandom=Math.random,this.tests=[]}add(t){t.tests?this.addBaseName(t.tests,t.name):this.tests.push({name:t.name,test:t})}async test(t){for(let e of this.tests){let i=await this.getTestBlob(e),n=await this.getComparisonBlob(e);if(i&&n){let r=new Promise(t=>Lf(i).compareTo(n).ignoreColors().onComplete(e=>t(e))),[a,s,o]=await Promise.all([As(i),As(n),r]);t({done:!1,value:{name:e.name,testImage:a,comparisonImage:s,result:o.rawMisMatchPercentage}})}else t(i?{done:!1,value:{name:e.name,testImage:await As(i),result:100}}:n?{done:!1,value:{name:e.name,comparisonImage:await As(n),result:100}}:{done:!1,value:{name:e.name,result:100}})}t({done:!0})}async download(t){for(let e of this.tests){let i=e.name,n=await this.getTestBlob(e),r=!!n;r&&js(n,`${e.name}.png`),t({done:!1,value:{name:i,ok:r}})}t({done:!0})}isDataAGo(t){if(Array.isArray(t)){for(let e of t)if(!e.ok)return!1;return!0}return t.ok}async getTestBlob(t){let e=t.test.load,i=t.test.test,n=this.viewer;n.clear();let r=n.addScene(),a=r.camera;a.viewport([0,0,n.canvas.width,n.canvas.height]),a.perspective(Math.PI/4,1,8,1e5);let s=e(n);return await n.whenAllLoaded(),this.isDataAGo(s)?(Math.random=(o=6,()=>(o=(9301*o+49297)%233280)/233280),i(n,r,a,s),n.updateAndRender(),Math.random=this.mathRandom,await n.toBlob()):null;var o}async getComparisonBlob(t){let e=await fetch(`compare/${t.name}.png`);if(e.ok)return await e.blob()}compareImages(t,e){if(t.width!==e.width||t.height!==e.height)return!1;let i=Ss(t).data,n=Ss(e).data;for(let t=0,e=i.length;t<e;t++)if(i[t]!==n[t])return!1;return!0}addBaseName(t,e){for(let i of t)i.tests?this.addBaseName(i.tests,e+"-"+i.name):this.tests.push({name:e+"-"+i.name,test:i})}},mdxSanityTest:function(t){let e=new Uf(t);!function(t){let e=t.model.version;t.assertWarning(800===e,`Unknown version ${e}`)}(e),function(t){let e=t.model.sequences;if(e.length){let i=!1,n=!1;for(let[r,a]of e.entries()){t.push("Sequence",r);let e=a.name.toLowerCase().trim().split("-")[0].split(/\s+/),s=e[0],o=a.interval,l=o[1]-o[0];"alternate"===s&&(s=e[1]),"stand"===s&&(i=!0),"death"===s&&(n=!0),Hf.has(s)?t.addReference():t.addWarning(`Unknown sequence "${s}"`),t.assertWarning(0!==l,"Zero length"),t.assertWarning(l>-1,`Negative length ${l}`),t.pop()}t.assertWarning(i,'Missing "Stand" sequence'),t.assertWarning(n,'Missing "Death" sequence')}else t.addWarning("No sequences")}(e),function(t){for(let[e,i]of t.model.globalSequences.entries())t.push("GlobalSequence",e),t.assertWarning(0!==i,"Zero length"),t.assertWarning(i>=0,`Negative length ${i}`),t.pop()}(e),function(t){let e=t.model.textures;if(e.length)for(let[i,n]of e.entries()){t.push("Texture",i);let e=n.replaceableId,r=n.path.toLowerCase();t.assertError(""===r||r.endsWith(".blp")||r.endsWith(".tga"),`Corrupted path "${r}"`),t.assertError(0===e||$f.has(e),`Unknown replaceable ID ${e}`),t.assertWarning(""===r||0===e,`Path "${r}" and replaceable ID ${e} used together`),t.pop()}else t.addWarning("No textures")}(e),function(t){let e=t.model.materials;if(e.length)for(let[i,n]of e.entries())t.push("Material",i),Ff(t,n),t.pop();else t.addWarning("No materials")}(e),function(t){for(let[e,i]of t.model.textureAnimations.entries())t.push("TextureAnimation",e),Nf(t,i),t.pop()}(e),function(t){let e=t.model.geosets,i=t.model.geosetAnimations;for(let n=0,r=e.length;n<r;n++){t.push("Geoset",n);let r=e[n],a=r.materialId;if(Df(t,r),i.length){let e=[];for(let t=0,r=i.length;t<r;t++)i[t].geosetId===n&&e.push(t);t.assertWarning(e.length<=1,`Referenced by ${e.length} geoset animations (${e.join(", ")})`)}kf(a,0,t.model.materials.length-1)?t.addReference("Material",a):t.addError(`Invalid material ${a}`),r.faces.length?t.addReference():t.addWarning("Zero faces"),r.sequenceExtents.length!==t.model.sequences.length&&t.addWarning(`Number of sequence extents (${r.sequenceExtents.length}) does not match the number of sequences (${t.model.sequences.length})`),t.pop()}}(e),function(t){let e=t.model.geosets;for(let[i,n]of t.model.geosetAnimations.entries()){t.push("GeosetAnimation",i);let r=n.geosetId;kf(r,0,e.length-1)?t.addReference():t.addError(`Invalid geoset ${r}`),Nf(t,n),t.pop()}}(e),function(t){let e=t.model.bones,i=t.model.geosets,n=t.model.geosetAnimations;if(e.length)for(let[r,a]of e.entries()){t.push("Bone",r);let e=a.geosetId,s=a.geosetAnimationId;t.assertError(-1===e||e<i.length,`Invalid geoset ${e}`),t.assertError(-1===s||s<n.length,`Invalid geoset animation ${s}`),Of(t,a),t.pop()}else t.addWarning("No bones")}(e),function(t){for(let[e,i]of t.model.lights.entries()){t.push("Light",e);let n=i.attenuation;t.assertWarning(n[0]>=80&&n[1]<=200&&n[1]-n[0]>0,`Attenuation min=${n[0]} max=${n[1]}`),Of(t,i),t.pop()}}(e),function(t){for(let[e,i]of t.model.helpers.entries())t.push("Helper",e),Of(t,i),t.pop()}(e),function(t){for(let[e,i]of t.model.attachments.entries())t.push("Attachment",e),Of(t,i),t.pop()}(e),function(t){let e=t.model.pivotPoints,i=t.objects;t.assertWarning(e.length===i.length,`Expected ${i.length} pivot points, got ${e.length}`)}(e),function(t){for(let[e,i]of t.model.particleEmitters.entries())t.push("ParticleEmitter",e),t.assertError(i.path.toLowerCase().endsWith(".mdl"),"Invalid path"),Of(t,i),t.pop()}(e),function(t){for(let[e,i]of t.model.particleEmitters2.entries()){t.push("ParticleEmitter2",e);let n=i.replaceableId;kf(i.textureId,0,t.model.textures.length-1)?t.addReference("Texture",i.textureId):t.addError(`Invalid texture ${i.textureId}`),t.assertWarning(kf(i.filterMode,0,4),`Invalid filter mode ${i.filterMode}`),t.assertError(0===n||$f.has(n),`Invalid replaceable ID ${n}`),Of(t,i),t.pop()}}(e),function(t){for(let[e,i]of t.model.ribbonEmitters.entries())t.push("RibbonEmitter",e),kf(i.materialId,0,t.model.materials.length-1)?t.addReference("Material",i.materialId):t.addError(`Invalid material ${i.materialId}`),Of(t,i),t.pop()}(e),function(t){for(let[e,i]of t.model.eventObjects.entries()){t.push("EventObject",e);let n=i.tracks,r=i.globalSequenceId;if(-1!==r&&(kf(r,0,t.model.globalSequences.length-1)?t.addReference("GlobalSequence",r):t.addError(`Invalid global sequence ${r}`)),n.length)for(let e=0,i=n.length;e<i;e++){let i=n[e];t.assertWarning(-1!==Gf(t,i,r)[0],`Track ${e}: Frame ${i} is not in any sequence`)}else t.addError("Zero keys");Of(t,i),t.pop()}}(e),function(t){for(let[e,i]of t.model.cameras.entries())t.push("Camera",e),t.addReference(),Nf(t,i),t.pop()}(e),function(t){for(let[e,i]of t.model.collisionShapes.entries())t.push("CollisionShape",e),Of(t,i),t.pop()}(e);let i=e.stack[0].children,n=0,r=0,a=0;for(let t of i)"warning"===t.type?n+=1:t.warnings&&(n+=t.warnings),"error"===t.type?r+=1:t.errors&&(r+=t.errors),0===t.uses&&(a+=1);return{nodes:i,warnings:n,errors:r,unused:a}},blpSanityTest:function(t){let e=[],i=t.content,n=t.alphaBits,r=t.mipmapOffsets,a=t.mipmapSizes,s=t.width,o=t.height;if(0!==i&&1!==i&&e.push("Unknown content type"),0!==n&&1!==n&&4!==n&&8!==n&&e.push(`Expected alpha bits to be 0, 1, 4, or 8, but got ${n}`),(s>512||o>512)&&e.push(`Expected width and height up to 512, but got ${s}x${o}`),0===i){const i=t.jpgHeader;i.length>624&&e.push(`Expected the JPG header to be at most 624 bytes, but got ${i.length}`)}for(let l=0;l<16;l++){if(a[l]>0)if(s<1&&o<1)e.push(`Mipmap ${l}: this mipmap should not exist`);else if(qf(l,r))e.push(`Mipmap ${l}: this mipmap is fake`);else if(s=Math.max(s,1),o=Math.max(o,1),0===i)try{let i=t.getMipmap(l);i.width===s&&i.height===o||e.push(`Mipmap ${l}: the JPG width (${i.width}) and height (${i.height}) do not match the mipmap width (${s}) and height (${o})`)}catch(t){e.push(`Mipmap ${l}: JPG decoding failed`)}else if(1===i){let t=s*o,i=t+Math.ceil(t*n/8);i!==a[l]&&e.push(`Mipmap ${l}: the declared size is ${a[l]}, but the real size is ${i}`)}s>>=1,o>>=1}return e},convertWeu:function(t,e,i){let n,r,a=new zf(e),s=a.output;try{n=t.readTriggers(e)}catch(t){return s.error=`Failed to read the triggers file: ${t}`,s}try{r=t.readCustomTextTriggers()}catch(t){return s.error=`Failed to read the custom text triggers file: ${t}`,s}try{a.stringTable=t.readStringTable()}catch(t){return s.error=`Failed to read the string table file: ${t}`,s}for(let t of n.triggers)try{if(nm(a,t))return s.error=`Trigger ${t.name} needs to be converted due to top-level event/condition, but full trigger conversion is not implemented yet`,s}catch(e){return s.error=`Error at trigger ${t.name}: ${e}`,s}if(function(t,e,i){let n=[];for(let t of Object.entries(i.preplacedObjects))t[1]||n.push(t[0]);if(n.length){let r=new uh;r.name="PreplacedObjectReferences",r.isEnabled=1,r.isInitiallyOff=1;for(let t of n){let e=new hh;e.type=2,e.isEnabled=1,t.startsWith("gg_unit")?e.name="RemoveUnit":t.startsWith("gg_dest")&&(e.name="RemoveDestructable");let i=new lh;i.type=1,i.value=t,e.parameters[0]=i,r.ecas.push(e)}t.triggers.push(r),e.triggers.push(new nh),i.output.changes.push({type:"references",data:n})}}(n,r,a),a.generatedFunctions.length)for(let t of a.generatedFunctions)r.trigger.text+=`\r\n${t.replace(/\n/g,"\r\n")}`;t.set("war3map.wtg",n.save()),t.set("war3map.wct",r.save());try{t.readTriggers(i)}catch(t){return s.error=`Failed to validate the triggers file: ${t}`,s}return s.ok=!0,s},mdlSourceMap:function(t){let e,i=new Ys(t),n=new rm(i);for(;void 0!==(e=i.read());)if("{"===e)n.ident+=1;else if("}"===e)n.ident-=1,n.ident===n.stack[0].ident&&um(n);else if(!n.searchBitmapName||"ReplaceableId"!==e&&"Image"!==e)lm(n,e)&&hm(n,e);else if("ReplaceableId"===e){let t=i.read();"0"!==t&&(n.lookingForAnimName=!1,n.stack[0].objectName=`ReplaceableId ${t}`)}else if("Image"===e){let t=i.read();""!==t&&(n.lookingForAnimName=!1,n.stack[0].objectName=t.split("\\").slice(-1)[0])}return n.rootNode.children},MappedData:rd.a,jass2:ym};e.default={version:"4.5.12",common:Xs,parsers:Uh,viewer:Cf,utils:Am}}]);